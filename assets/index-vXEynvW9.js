function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var t,n,r,i,a={exports:{}},o={},s=(n||(n=1,a.exports=function(){if(t)return o;t=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function r(t,n,r){var i=null;if(void 0!==r&&(i=""+r),void 0!==n.key&&(i=""+n.key),"key"in n)for(var a in r={},n)"key"!==a&&(r[a]=n[a]);else r=n;return n=r.ref,{$$typeof:e,type:t,key:i,ref:void 0!==n?n:null,props:r}}return o.Fragment=n,o.jsx=r,o.jsxs=r,o}()),a.exports),l={exports:{}},c={};function u(){if(r)return c;r=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),s=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.for("react.activity"),p=Symbol.iterator,m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,v={};function y(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||m}function b(){}function x(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||m}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=y.prototype;var _=x.prototype=new b;_.constructor=x,g(_,y.prototype),_.isPureReactComponent=!0;var w=Array.isArray;function S(){}var M={H:null,A:null,T:null,S:null},E=Object.prototype.hasOwnProperty;function T(t,n,r){var i=r.ref;return{$$typeof:e,type:t,key:n,ref:void 0!==i?i:null,props:r}}function C(t){return"object"==typeof t&&null!==t&&t.$$typeof===e}var A=/\/+/g;function k(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(n=""+e.key,r={"=":"=0",":":"=2"},"$"+n.replace(/[=:]/g,function(e){return r[e]})):t.toString(36);var n,r}function R(n,r,i,a,o){var s=typeof n;"undefined"!==s&&"boolean"!==s||(n=null);var l,c,u=!1;if(null===n)u=!0;else switch(s){case"bigint":case"string":case"number":u=!0;break;case"object":switch(n.$$typeof){case e:case t:u=!0;break;case h:return R((u=n._init)(n._payload),r,i,a,o)}}if(u)return o=o(n),u=""===a?"."+k(n,0):a,w(o)?(i="",null!=u&&(i=u.replace(A,"$&/")+"/"),R(o,r,i,"",function(e){return e})):null!=o&&(C(o)&&(l=o,c=i+(null==o.key||n&&n.key===o.key?"":(""+o.key).replace(A,"$&/")+"/")+u,o=T(l.type,c,l.props)),r.push(o)),1;u=0;var d,f=""===a?".":a+":";if(w(n))for(var m=0;m<n.length;m++)u+=R(a=n[m],r,i,s=f+k(a,m),o);else if("function"==typeof(m=null===(d=n)||"object"!=typeof d?null:"function"==typeof(d=p&&d[p]||d["@@iterator"])?d:null))for(n=m.call(n),m=0;!(a=n.next()).done;)u+=R(a=a.value,r,i,s=f+k(a,m++),o);else if("object"===s){if("function"==typeof n.then)return R(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(S,S):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(n),r,i,a,o);throw r=String(n),Error("Objects are not valid as a React child (found: "+("[object Object]"===r?"object with keys {"+Object.keys(n).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.")}return u}function N(e,t,n){if(null==e)return e;var r=[],i=0;return R(e,r,"","",function(e){return t.call(n,e,i++)}),r}function P(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var I="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},L={map:N,forEach:function(e,t,n){N(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return N(e,function(){t++}),t},toArray:function(e){return N(e,function(e){return e})||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};return c.Activity=f,c.Children=L,c.Component=y,c.Fragment=n,c.Profiler=a,c.PureComponent=x,c.StrictMode=i,c.Suspense=u,c.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=M,c.__COMPILER_RUNTIME={__proto__:null,c:function(e){return M.H.useMemoCache(e)}},c.cache=function(e){return function(){return e.apply(null,arguments)}},c.cacheSignal=function(){return null},c.cloneElement=function(e,t,n){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var r=g({},e.props),i=e.key;if(null!=t)for(a in void 0!==t.key&&(i=""+t.key),t)!E.call(t,a)||"key"===a||"__self"===a||"__source"===a||"ref"===a&&void 0===t.ref||(r[a]=t[a]);var a=arguments.length-2;if(1===a)r.children=n;else if(1<a){for(var o=Array(a),s=0;s<a;s++)o[s]=arguments[s+2];r.children=o}return T(e.type,i,r)},c.createContext=function(e){return(e={$$typeof:s,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:o,_context:e},e},c.createElement=function(e,t,n){var r,i={},a=null;if(null!=t)for(r in void 0!==t.key&&(a=""+t.key),t)E.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(i[r]=t[r]);var o=arguments.length-2;if(1===o)i.children=n;else if(1<o){for(var s=Array(o),l=0;l<o;l++)s[l]=arguments[l+2];i.children=s}if(e&&e.defaultProps)for(r in o=e.defaultProps)void 0===i[r]&&(i[r]=o[r]);return T(e,a,i)},c.createRef=function(){return{current:null}},c.forwardRef=function(e){return{$$typeof:l,render:e}},c.isValidElement=C,c.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:P}},c.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},c.startTransition=function(e){var t=M.T,n={};M.T=n;try{var r=e(),i=M.S;null!==i&&i(n,r),"object"==typeof r&&null!==r&&"function"==typeof r.then&&r.then(S,I)}catch(a){I(a)}finally{null!==t&&null!==n.types&&(t.types=n.types),M.T=t}},c.unstable_useCacheRefresh=function(){return M.H.useCacheRefresh()},c.use=function(e){return M.H.use(e)},c.useActionState=function(e,t,n){return M.H.useActionState(e,t,n)},c.useCallback=function(e,t){return M.H.useCallback(e,t)},c.useContext=function(e){return M.H.useContext(e)},c.useDebugValue=function(){},c.useDeferredValue=function(e,t){return M.H.useDeferredValue(e,t)},c.useEffect=function(e,t){return M.H.useEffect(e,t)},c.useEffectEvent=function(e){return M.H.useEffectEvent(e)},c.useId=function(){return M.H.useId()},c.useImperativeHandle=function(e,t,n){return M.H.useImperativeHandle(e,t,n)},c.useInsertionEffect=function(e,t){return M.H.useInsertionEffect(e,t)},c.useLayoutEffect=function(e,t){return M.H.useLayoutEffect(e,t)},c.useMemo=function(e,t){return M.H.useMemo(e,t)},c.useOptimistic=function(e,t){return M.H.useOptimistic(e,t)},c.useReducer=function(e,t,n){return M.H.useReducer(e,t,n)},c.useRef=function(e){return M.H.useRef(e)},c.useState=function(e){return M.H.useState(e)},c.useSyncExternalStore=function(e,t,n){return M.H.useSyncExternalStore(e,t,n)},c.useTransition=function(){return M.H.useTransition()},c.version="19.2.0",c}function d(){return i||(i=1,l.exports=u()),l.exports}var h=d();const f=e(h);var p,m,g={exports:{}},v={},y={exports:{}},b={};var x,_,w,S,M={exports:{}},E={};function T(){return _||(_=1,function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),M.exports=function(){if(x)return E;x=1;var e=d();function t(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(t(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal"),a=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(e,t){return"font"===e?"":"string"==typeof t?"use-credentials"===t?t:"":void 0}return E.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,E.createPortal=function(e,n){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!n||1!==n.nodeType&&9!==n.nodeType&&11!==n.nodeType)throw Error(t(299));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:i,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,n,null,r)},E.flushSync=function(e){var t=a.T,n=r.p;try{if(a.T=null,r.p=2,e)return e()}finally{a.T=t,r.p=n,r.d.f()}},E.preconnect=function(e,t){"string"==typeof e&&(t=t?"string"==typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:null,r.d.C(e,t))},E.prefetchDNS=function(e){"string"==typeof e&&r.d.D(e)},E.preinit=function(e,t){if("string"==typeof e&&t&&"string"==typeof t.as){var n=t.as,i=o(n,t.crossOrigin),a="string"==typeof t.integrity?t.integrity:void 0,s="string"==typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?r.d.S(e,"string"==typeof t.precedence?t.precedence:void 0,{crossOrigin:i,integrity:a,fetchPriority:s}):"script"===n&&r.d.X(e,{crossOrigin:i,integrity:a,fetchPriority:s,nonce:"string"==typeof t.nonce?t.nonce:void 0})}},E.preinitModule=function(e,t){if("string"==typeof e)if("object"==typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=o(t.as,t.crossOrigin);r.d.M(e,{crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0})}}else null==t&&r.d.M(e)},E.preload=function(e,t){if("string"==typeof e&&"object"==typeof t&&null!==t&&"string"==typeof t.as){var n=t.as,i=o(n,t.crossOrigin);r.d.L(e,n,{crossOrigin:i,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0,type:"string"==typeof t.type?t.type:void 0,fetchPriority:"string"==typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"==typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"==typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"==typeof t.imageSizes?t.imageSizes:void 0,media:"string"==typeof t.media?t.media:void 0})}},E.preloadModule=function(e,t){if("string"==typeof e)if(t){var n=o(t.as,t.crossOrigin);r.d.m(e,{as:"string"==typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0})}else r.d.m(e)},E.requestFormReset=function(e){r.d.r(e)},E.unstable_batchedUpdates=function(e,t){return e(t)},E.useFormState=function(e,t,n){return a.H.useFormState(e,t,n)},E.useFormStatus=function(){return a.H.useHostTransitionStatus()},E.version="19.2.0",E}()),M.exports}
/**
* @license React
* react-dom-client.production.js
*
* Copyright (c) Meta Platforms, Inc. and affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/const C=e((S||(S=1,function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),g.exports=function(){if(w)return v;w=1;var e=(m||(m=1,y.exports=(p||(p=1,function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,l=e[s],c=s+1,u=e[c];if(0>i(l,n))c<a&&0>i(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[s]=n,r=s);else{if(!(c<a&&0>i(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(e.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}var l=[],c=[],u=1,d=null,h=3,f=!1,p=!1,m=!1,g=!1,v="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,b="undefined"!=typeof setImmediate?setImmediate:null;function x(e){for(var i=n(c);null!==i;){if(null===i.callback)r(c);else{if(!(i.startTime<=e))break;r(c),i.sortIndex=i.expirationTime,t(l,i)}i=n(c)}}function _(e){if(m=!1,x(e),!p)if(null!==n(l))p=!0,S||(S=!0,w());else{var t=n(c);null!==t&&N(_,t.startTime-e)}}var w,S=!1,M=-1,E=5,T=-1;function C(){return!(!g&&e.unstable_now()-T<E)}function A(){if(g=!1,S){var t=e.unstable_now();T=t;var i=!0;try{e:{p=!1,m&&(m=!1,y(M),M=-1),f=!0;var a=h;try{t:{for(x(t),d=n(l);null!==d&&!(d.expirationTime>t&&C());){var o=d.callback;if("function"==typeof o){d.callback=null,h=d.priorityLevel;var s=o(d.expirationTime<=t);if(t=e.unstable_now(),"function"==typeof s){d.callback=s,x(t),i=!0;break t}d===n(l)&&r(l),x(t)}else r(l);d=n(l)}if(null!==d)i=!0;else{var u=n(c);null!==u&&N(_,u.startTime-t),i=!1}}break e}finally{d=null,h=a,f=!1}i=void 0}}finally{i?w():S=!1}}}if("function"==typeof b)w=function(){b(A)};else if("undefined"!=typeof MessageChannel){var k=new MessageChannel,R=k.port2;k.port1.onmessage=A,w=function(){R.postMessage(null)}}else w=function(){v(A,0)};function N(t,n){M=v(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<e?Math.floor(1e3/e):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},e.unstable_requestPaint=function(){g=!0},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},e.unstable_scheduleCallback=function(r,i,a){var o=e.unstable_now();switch(a="object"==typeof a&&null!==a&&"number"==typeof(a=a.delay)&&0<a?o+a:o,r){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return r={id:u++,callback:i,priorityLevel:r,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(r.sortIndex=a,t(c,r),null===n(l)&&r===n(c)&&(m?(y(M),M=-1):m=!0,N(_,a-o))):(r.sortIndex=s,t(l,r),p||f||(p=!0,S||(S=!0,w()))),r},e.unstable_shouldYield=C,e.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}}(b)),b)),y.exports),t=d(),n=T();function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function a(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function o(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function s(e){if(31===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function l(e){if(a(e)!==e)throw Error(r(188))}function c(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=c(e)))return t;e=e.sibling}return null}var u=Object.assign,h=Symbol.for("react.element"),f=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),M=Symbol.for("react.consumer"),E=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),k=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),I=Symbol.for("react.memo_cache_sentinel"),L=Symbol.iterator;function D(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=L&&e[L]||e["@@iterator"])?e:null}var z=Symbol.for("react.client.reference");function O(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===z?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case x:return"Fragment";case S:return"Profiler";case _:return"StrictMode";case A:return"Suspense";case k:return"SuspenseList";case P:return"Activity"}if("object"==typeof e)switch(e.$$typeof){case g:return"Portal";case E:return e.displayName||"Context";case M:return(e._context.displayName||"Context")+".Consumer";case C:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:O(e.type)||"Memo";case N:t=e._payload,e=e._init;try{return O(e(t))}catch(n){}}return null}var U=Array.isArray,F=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,j={pending:!1,data:null,method:null,action:null},H=[],V=-1;function G(e){return{current:e}}function W(e){0>V||(e.current=H[V],H[V]=null,V--)}function $(e,t){V++,H[V]=e.current,e.current=t}var X,q,Y=G(null),Z=G(null),K=G(null),J=G(null);function Q(e,t){switch($(K,t),$(Z,e),$(Y,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?wd(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=Sd(t=wd(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}W(Y),$(Y,e)}function ee(){W(Y),W(Z),W(K)}function te(e){null!==e.memoizedState&&$(J,e);var t=Y.current,n=Sd(t,e.type);t!==n&&($(Z,e),$(Y,n))}function ne(e){Z.current===e&&(W(Y),W(Z)),J.current===e&&(W(J),mh._currentValue=j)}function re(e){if(void 0===X)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);X=t&&t[1]||"",q=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+X+e+q}var ie=!1;function ae(e,t){if(!e||ie)return"";ie=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(i){var r=i}Reflect.construct(e,[],n)}else{try{n.call()}catch(a){r=a}e.call(n.prototype)}}else{try{throw Error()}catch(o){r=o}(n=e())&&"function"==typeof n.catch&&n.catch(function(){})}}catch(s){if(s&&r&&"string"==typeof s.stack)return[s.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var a=r.DetermineComponentFrameRoot(),o=a[0],s=a[1];if(o&&s){var l=o.split("\n"),c=s.split("\n");for(i=r=0;r<l.length&&!l[r].includes("DetermineComponentFrameRoot");)r++;for(;i<c.length&&!c[i].includes("DetermineComponentFrameRoot");)i++;if(r===l.length||i===c.length)for(r=l.length-1,i=c.length-1;1<=r&&0<=i&&l[r]!==c[i];)i--;for(;1<=r&&0<=i;r--,i--)if(l[r]!==c[i]){if(1!==r||1!==i)do{if(r--,0>--i||l[r]!==c[i]){var u="\n"+l[r].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=r&&0<=i);break}}}finally{ie=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?re(n):""}function oe(e,t){switch(e.tag){case 26:case 27:case 5:return re(e.type);case 16:return re("Lazy");case 13:return e.child!==t&&null!==t?re("Suspense Fallback"):re("Suspense");case 19:return re("SuspenseList");case 0:case 15:return ae(e.type,!1);case 11:return ae(e.type.render,!1);case 1:return ae(e.type,!0);case 31:return re("Activity");default:return""}}function se(e){try{var t="",n=null;do{t+=oe(e,n),n=e,e=e.return}while(e);return t}catch(r){return"\nError generating stack: "+r.message+"\n"+r.stack}}var le=Object.prototype.hasOwnProperty,ce=e.unstable_scheduleCallback,ue=e.unstable_cancelCallback,de=e.unstable_shouldYield,he=e.unstable_requestPaint,fe=e.unstable_now,pe=e.unstable_getCurrentPriorityLevel,me=e.unstable_ImmediatePriority,ge=e.unstable_UserBlockingPriority,ve=e.unstable_NormalPriority,ye=e.unstable_LowPriority,be=e.unstable_IdlePriority,xe=e.log,_e=e.unstable_setDisableYieldValue,we=null,Se=null;function Me(e){if("function"==typeof xe&&_e(e),Se&&"function"==typeof Se.setStrictMode)try{Se.setStrictMode(we,e)}catch(t){}}var Ee=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(Te(e)/Ce|0)|0},Te=Math.log,Ce=Math.LN2,Ae=256,ke=262144,Re=4194304;function Ne(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&e;case 262144:case 524288:case 1048576:case 2097152:return 3932160&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Pe(e,t,n){var r=e.pendingLanes;if(0===r)return 0;var i=0,a=e.suspendedLanes,o=e.pingedLanes;e=e.warmLanes;var s=134217727&r;return 0!==s?0!==(r=s&~a)?i=Ne(r):0!==(o&=s)?i=Ne(o):n||0!==(n=s&~e)&&(i=Ne(n)):0!==(s=r&~a)?i=Ne(s):0!==o?i=Ne(o):n||0!==(n=r&~e)&&(i=Ne(n)),0===i?0:0!==t&&t!==i&&0===(t&a)&&((a=i&-i)>=(n=t&-t)||32===a&&4194048&n)?t:i}function Ie(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Le(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function De(){var e=Re;return!(62914560&(Re<<=1))&&(Re=4194304),e}function ze(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Oe(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ue(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-Ee(t);e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|261930&n}function Fe(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Ee(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}function Be(e,t){var n=t&-t;return 0!==((n=42&n?1:je(n))&(e.suspendedLanes|t))?0:n}function je(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function He(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function Ve(){var e=B.p;return 0!==e?e:void 0===(e=window.event)?32:Nh(e.type)}function Ge(e,t){var n=B.p;try{return B.p=e,t()}finally{B.p=n}}var We=Math.random().toString(36).slice(2),$e="__reactFiber$"+We,Xe="__reactProps$"+We,qe="__reactContainer$"+We,Ye="__reactEvents$"+We,Ze="__reactListeners$"+We,Ke="__reactHandles$"+We,Je="__reactResources$"+We,Qe="__reactMarker$"+We;function et(e){delete e[$e],delete e[Xe],delete e[Ye],delete e[Ze],delete e[Ke]}function tt(e){var t=e[$e];if(t)return t;for(var n=e.parentNode;n;){if(t=n[qe]||n[$e]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=jd(e);null!==e;){if(n=e[$e])return n;e=jd(e)}return t}n=(e=n).parentNode}return null}function nt(e){if(e=e[$e]||e[qe]){var t=e.tag;if(5===t||6===t||13===t||31===t||26===t||27===t||3===t)return e}return null}function rt(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(r(33))}function it(e){var t=e[Je];return t||(t=e[Je]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function at(e){e[Qe]=!0}var ot=new Set,st={};function lt(e,t){ct(e,t),ct(e+"Capture",t)}function ct(e,t){for(st[e]=t,e=0;e<t.length;e++)ot.add(t[e])}var ut=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),dt={},ht={};function ft(e,t,n){if(i=t,le.call(ht,i)||!le.call(dt,i)&&(ut.test(i)?ht[i]=!0:(dt[i]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var r=t.toLowerCase().slice(0,5);if("data-"!==r&&"aria-"!==r)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var i}function pt(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function mt(e,t,n,r){if(null===r)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+r)}}function gt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function vt(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function yt(e){if(!e._valueTracker){var t=vt(e)?"checked":"value";e._valueTracker=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&void 0!==r&&"function"==typeof r.get&&"function"==typeof r.set){var i=r.get,a=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){n=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e,t,""+e[t])}}function bt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=vt(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function xt(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var _t=/[\n"\\]/g;function wt(e){return e.replace(_t,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function St(e,t,n,r,i,a,o,s){e.name="",null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o?e.type=o:e.removeAttribute("type"),null!=t?"number"===o?(0===t&&""===e.value||e.value!=t)&&(e.value=""+gt(t)):e.value!==""+gt(t)&&(e.value=""+gt(t)):"submit"!==o&&"reset"!==o||e.removeAttribute("value"),null!=t?Et(e,o,gt(t)):null!=n?Et(e,o,gt(n)):null!=r&&e.removeAttribute("value"),null==i&&null!=a&&(e.defaultChecked=!!a),null!=i&&(e.checked=i&&"function"!=typeof i&&"symbol"!=typeof i),null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&"boolean"!=typeof s?e.name=""+gt(s):e.removeAttribute("name")}function Mt(e,t,n,r,i,a,o,s){if(null!=a&&"function"!=typeof a&&"symbol"!=typeof a&&"boolean"!=typeof a&&(e.type=a),null!=t||null!=n){if(("submit"===a||"reset"===a)&&null==t)return void yt(e);n=null!=n?""+gt(n):"",t=null!=t?""+gt(t):n,s||t===e.value||(e.value=t),e.defaultValue=t}r="function"!=typeof(r=null!=r?r:i)&&"symbol"!=typeof r&&!!r,e.checked=s?e.checked:!!r,e.defaultChecked=!!r,null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o&&(e.name=o),yt(e)}function Et(e,t,n){"number"===t&&xt(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function Tt(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+gt(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function Ct(e,t,n){null==t||((t=""+gt(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+gt(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function At(e,t,n,i){if(null==t){if(null!=i){if(null!=n)throw Error(r(92));if(U(i)){if(1<i.length)throw Error(r(93));i=i[0]}n=i}null==n&&(n=""),t=n}n=gt(t),e.defaultValue=n,(i=e.textContent)===n&&""!==i&&null!==i&&(e.value=i),yt(e)}function kt(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var Rt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Nt(e,t,n){var r=0===t.indexOf("--");null==n||"boolean"==typeof n||""===n?r?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":r?e.setProperty(t,n):"number"!=typeof n||0===n||Rt.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function Pt(e,t,n){if(null!=t&&"object"!=typeof t)throw Error(r(62));if(e=e.style,null!=n){for(var i in n)!n.hasOwnProperty(i)||null!=t&&t.hasOwnProperty(i)||(0===i.indexOf("--")?e.setProperty(i,""):"float"===i?e.cssFloat="":e[i]="");for(var a in t)i=t[a],t.hasOwnProperty(a)&&n[a]!==i&&Nt(e,a,i)}else for(var o in t)t.hasOwnProperty(o)&&Nt(e,o,t[o])}function It(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Lt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Dt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function zt(e){return Dt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Ot(){}var Ut=null;function Ft(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Bt=null,jt=null;function Ht(e){var t=nt(e);if(t&&(e=t.stateNode)){var n=e[Xe]||null;e:switch(e=t.stateNode,t.type){case"input":if(St(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+wt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var a=i[Xe]||null;if(!a)throw Error(r(90));St(i,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name)}}for(t=0;t<n.length;t++)(i=n[t]).form===e.form&&bt(i)}break e;case"textarea":Ct(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&Tt(e,!!n.multiple,t,!1)}}}var Vt=!1;function Gt(e,t,n){if(Vt)return e(t,n);Vt=!0;try{return e(t)}finally{if(Vt=!1,(null!==Bt||null!==jt)&&(iu(),Bt&&(t=Bt,e=jt,jt=Bt=null,Ht(t),e)))for(t=0;t<e.length;t++)Ht(e[t])}}function Wt(e,t){var n=e.stateNode;if(null===n)return null;var i=n[Xe]||null;if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(r(231,t,typeof n));return n}var $t=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),Xt=!1;if($t)try{var qt={};Object.defineProperty(qt,"passive",{get:function(){Xt=!0}}),window.addEventListener("test",qt,qt),window.removeEventListener("test",qt,qt)}catch(nf){Xt=!1}var Yt=null,Zt=null,Kt=null;function Jt(){if(Kt)return Kt;var e,t,n=Zt,r=n.length,i="value"in Yt?Yt.value:Yt.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return Kt=i.slice(e,1<t?1-t:void 0)}function Qt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function en(){return!0}function tn(){return!1}function nn(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?en:tn,this.isPropagationStopped=tn,this}return u(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=en)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=en)},persist:function(){},isPersistent:en}),t}var rn,an,on,sn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=nn(sn),cn=u({},sn,{view:0,detail:0}),un=nn(cn),dn=u({},cn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==on&&(on&&"mousemove"===e.type?(rn=e.screenX-on.screenX,an=e.screenY-on.screenY):an=rn=0,on=e),rn)},movementY:function(e){return"movementY"in e?e.movementY:an}}),hn=nn(dn),fn=nn(u({},dn,{dataTransfer:0})),pn=nn(u({},cn,{relatedTarget:0})),mn=nn(u({},sn,{animationName:0,elapsedTime:0,pseudoElement:0})),gn=nn(u({},sn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),vn=nn(u({},sn,{data:0})),yn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _n(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=xn[e])&&!!t[e]}function wn(){return _n}var Sn=nn(u({},cn,{key:function(e){if(e.key){var t=yn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Qt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?bn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wn,charCode:function(e){return"keypress"===e.type?Qt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Qt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),Mn=nn(u({},dn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),En=nn(u({},cn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wn})),Tn=nn(u({},sn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Cn=nn(u({},dn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),An=nn(u({},sn,{newState:0,oldState:0})),kn=[9,13,27,32],Rn=$t&&"CompositionEvent"in window,Nn=null;$t&&"documentMode"in document&&(Nn=document.documentMode);var Pn=$t&&"TextEvent"in window&&!Nn,In=$t&&(!Rn||Nn&&8<Nn&&11>=Nn),Ln=String.fromCharCode(32),Dn=!1;function zn(e,t){switch(e){case"keyup":return-1!==kn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function On(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Un=!1,Fn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Bn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Fn[e.type]:"textarea"===t}function jn(e,t,n,r){Bt?jt?jt.push(r):jt=[r]:Bt=r,0<(t=ld(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Hn=null,Vn=null;function Gn(e){ed(e,0)}function Wn(e){if(bt(rt(e)))return e}function $n(e,t){if("change"===e)return t}var Xn=!1;if($t){var qn;if($t){var Yn="oninput"in document;if(!Yn){var Zn=document.createElement("div");Zn.setAttribute("oninput","return;"),Yn="function"==typeof Zn.oninput}qn=Yn}else qn=!1;Xn=qn&&(!document.documentMode||9<document.documentMode)}function Kn(){Hn&&(Hn.detachEvent("onpropertychange",Jn),Vn=Hn=null)}function Jn(e){if("value"===e.propertyName&&Wn(Vn)){var t=[];jn(t,Vn,e,Ft(e)),Gt(Gn,t)}}function Qn(e,t,n){"focusin"===e?(Kn(),Vn=n,(Hn=t).attachEvent("onpropertychange",Jn)):"focusout"===e&&Kn()}function er(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Wn(Vn)}function tr(e,t){if("click"===e)return Wn(t)}function nr(e,t){if("input"===e||"change"===e)return Wn(t)}var rr="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function ir(e,t){if(rr(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!le.call(t,i)||!rr(e[i],t[i]))return!1}return!0}function ar(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function or(e,t){var n,r=ar(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=ar(r)}}function sr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?sr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function lr(e){for(var t=xt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=xt((e=t.contentWindow).document)}return t}function cr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var ur=$t&&"documentMode"in document&&11>=document.documentMode,dr=null,hr=null,fr=null,pr=!1;function mr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;pr||null==dr||dr!==xt(r)||(r="selectionStart"in(r=dr)&&cr(r)?{start:r.selectionStart,end:r.selectionEnd}:{anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},fr&&ir(fr,r)||(fr=r,0<(r=ld(hr,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=dr)))}function gr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var vr={animationend:gr("Animation","AnimationEnd"),animationiteration:gr("Animation","AnimationIteration"),animationstart:gr("Animation","AnimationStart"),transitionrun:gr("Transition","TransitionRun"),transitionstart:gr("Transition","TransitionStart"),transitioncancel:gr("Transition","TransitionCancel"),transitionend:gr("Transition","TransitionEnd")},yr={},br={};function xr(e){if(yr[e])return yr[e];if(!vr[e])return e;var t,n=vr[e];for(t in n)if(n.hasOwnProperty(t)&&t in br)return yr[e]=n[t];return e}$t&&(br=document.createElement("div").style,"AnimationEvent"in window||(delete vr.animationend.animation,delete vr.animationiteration.animation,delete vr.animationstart.animation),"TransitionEvent"in window||delete vr.transitionend.transition);var _r=xr("animationend"),wr=xr("animationiteration"),Sr=xr("animationstart"),Mr=xr("transitionrun"),Er=xr("transitionstart"),Tr=xr("transitioncancel"),Cr=xr("transitionend"),Ar=new Map,kr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Rr(e,t){Ar.set(e,t),lt(t,[e])}kr.push("scrollEnd");var Nr="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},Pr=[],Ir=0,Lr=0;function Dr(){for(var e=Ir,t=Lr=Ir=0;t<e;){var n=Pr[t];Pr[t++]=null;var r=Pr[t];Pr[t++]=null;var i=Pr[t];Pr[t++]=null;var a=Pr[t];if(Pr[t++]=null,null!==r&&null!==i){var o=r.pending;null===o?i.next=i:(i.next=o.next,o.next=i),r.pending=i}0!==a&&Fr(n,i,a)}}function zr(e,t,n,r){Pr[Ir++]=e,Pr[Ir++]=t,Pr[Ir++]=n,Pr[Ir++]=r,Lr|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function Or(e,t,n,r){return zr(e,t,n,r),Br(e)}function Ur(e,t){return zr(e,null,null,t),Br(e)}function Fr(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var i=!1,a=e.return;null!==a;)a.childLanes|=n,null!==(r=a.alternate)&&(r.childLanes|=n),22===a.tag&&(null===(e=a.stateNode)||1&e._visibility||(i=!0)),e=a,a=a.return;return 3===e.tag?(a=e.stateNode,i&&null!==t&&(i=31-Ee(n),null===(r=(e=a.hiddenUpdates)[i])?e[i]=[t]:r.push(t),t.lane=536870912|n),a):null}function Br(e){if(50<Yc)throw Yc=0,Zc=null,Error(r(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var jr={};function Hr(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vr(e,t,n,r){return new Hr(e,t,n,r)}function Gr(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Wr(e,t){var n=e.alternate;return null===n?((n=Vr(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function $r(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Xr(e,t,n,i,a,o){var s=0;if(i=e,"function"==typeof e)Gr(e)&&(s=1);else if("string"==typeof e)s=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"==typeof t.precedence&&null==e);case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,n,Y.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case P:return(e=Vr(31,n,t,a)).elementType=P,e.lanes=o,e;case x:return qr(n.children,a,o,t);case _:s=8,a|=24;break;case S:return(e=Vr(12,n,t,2|a)).elementType=S,e.lanes=o,e;case A:return(e=Vr(13,n,t,a)).elementType=A,e.lanes=o,e;case k:return(e=Vr(19,n,t,a)).elementType=k,e.lanes=o,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case E:s=10;break e;case M:s=9;break e;case C:s=11;break e;case R:s=14;break e;case N:s=16,i=null;break e}s=29,n=Error(r(130,null===e?"null":typeof e,"")),i=null}return(t=Vr(s,n,t,a)).elementType=e,t.type=i,t.lanes=o,t}function qr(e,t,n,r){return(e=Vr(7,e,r,t)).lanes=n,e}function Yr(e,t,n){return(e=Vr(6,e,null,t)).lanes=n,e}function Zr(e){var t=Vr(18,null,null,0);return t.stateNode=e,t}function Kr(e,t,n){return(t=Vr(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Jr=new WeakMap;function Qr(e,t){if("object"==typeof e&&null!==e){var n=Jr.get(e);return void 0!==n?n:(t={value:e,source:t,stack:se(t)},Jr.set(e,t),t)}return{value:e,source:t,stack:se(t)}}var ei=[],ti=0,ni=null,ri=0,ii=[],ai=0,oi=null,si=1,li="";function ci(e,t){ei[ti++]=ri,ei[ti++]=ni,ni=e,ri=t}function ui(e,t,n){ii[ai++]=si,ii[ai++]=li,ii[ai++]=oi,oi=e;var r=si;e=li;var i=32-Ee(r)-1;r&=~(1<<i),n+=1;var a=32-Ee(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,si=1<<32-Ee(t)+i|n<<i|r,li=a+e}else si=1<<a|n<<i|r,li=e}function di(e){null!==e.return&&(ci(e,1),ui(e,1,0))}function hi(e){for(;e===ni;)ni=ei[--ti],ei[ti]=null,ri=ei[--ti],ei[ti]=null;for(;e===oi;)oi=ii[--ai],ii[ai]=null,li=ii[--ai],ii[ai]=null,si=ii[--ai],ii[ai]=null}function fi(e,t){ii[ai++]=si,ii[ai++]=li,ii[ai++]=oi,si=t.id,li=t.overflow,oi=e}var pi=null,mi=null,gi=!1,vi=null,yi=!1,bi=Error(r(519));function xi(e){throw Ti(Qr(Error(r(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML","")),e)),bi}function _i(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[$e]=e,t[Xe]=r,n){case"dialog":td("cancel",t),td("close",t);break;case"iframe":case"object":case"embed":td("load",t);break;case"video":case"audio":for(n=0;n<Ju.length;n++)td(Ju[n],t);break;case"source":td("error",t);break;case"img":case"image":case"link":td("error",t),td("load",t);break;case"details":td("toggle",t);break;case"input":td("invalid",t),Mt(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0);break;case"select":td("invalid",t);break;case"textarea":td("invalid",t),At(t,r.value,r.defaultValue,r.children)}"string"!=typeof(n=r.children)&&"number"!=typeof n&&"bigint"!=typeof n||t.textContent===""+n||!0===r.suppressHydrationWarning||pd(t.textContent,n)?(null!=r.popover&&(td("beforetoggle",t),td("toggle",t)),null!=r.onScroll&&td("scroll",t),null!=r.onScrollEnd&&td("scrollend",t),null!=r.onClick&&(t.onclick=Ot),t=!0):t=!1,t||xi(e,!0)}function wi(e){for(pi=e.return;pi;)switch(pi.tag){case 5:case 31:case 13:return void(yi=!1);case 27:case 3:return void(yi=!0);default:pi=pi.return}}function Si(e){if(e!==pi)return!1;if(!gi)return wi(e),gi=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||Md(e.type,e.memoizedProps)),t=!t),t&&mi&&xi(e),wi(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));mi=Bd(e)}else if(31===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));mi=Bd(e)}else 27===n?(n=mi,Nd(e.type)?(e=Fd,Fd=null,mi=e):mi=n):mi=pi?Ud(e.stateNode.nextSibling):null;return!0}function Mi(){mi=pi=null,gi=!1}function Ei(){var e=vi;return null!==e&&(null===Dc?Dc=e:Dc.push.apply(Dc,e),vi=null),e}function Ti(e){null===vi?vi=[e]:vi.push(e)}var Ci=G(null),Ai=null,ki=null;function Ri(e,t,n){$(Ci,t._currentValue),t._currentValue=n}function Ni(e){e._currentValue=Ci.current,W(Ci)}function Pi(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ii(e,t,n,i){var a=e.child;for(null!==a&&(a.return=e);null!==a;){var o=a.dependencies;if(null!==o){var s=a.child;o=o.firstContext;e:for(;null!==o;){var l=o;o=a;for(var c=0;c<t.length;c++)if(l.context===t[c]){o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Pi(o.return,n,e),i||(s=null);break e}o=l.next}}else if(18===a.tag){if(null===(s=a.return))throw Error(r(341));s.lanes|=n,null!==(o=s.alternate)&&(o.lanes|=n),Pi(s,n,e),s=null}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===e){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}}function Li(e,t,n,i){e=null;for(var a=t,o=!1;null!==a;){if(!o)if(524288&a.flags)o=!0;else if(262144&a.flags)break;if(10===a.tag){var s=a.alternate;if(null===s)throw Error(r(387));if(null!==(s=s.memoizedProps)){var l=a.type;rr(a.pendingProps.value,s.value)||(null!==e?e.push(l):e=[l])}}else if(a===J.current){if(null===(s=a.alternate))throw Error(r(387));s.memoizedState.memoizedState!==a.memoizedState.memoizedState&&(null!==e?e.push(mh):e=[mh])}a=a.return}null!==e&&Ii(t,e,n,i),t.flags|=262144}function Di(e){for(e=e.firstContext;null!==e;){if(!rr(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function zi(e){Ai=e,ki=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Oi(e){return Fi(Ai,e)}function Ui(e,t){return null===Ai&&zi(e),Fi(e,t)}function Fi(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===ki){if(null===e)throw Error(r(308));ki=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else ki=ki.next=t;return n}var Bi="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},ji=e.unstable_scheduleCallback,Hi=e.unstable_NormalPriority,Vi={$$typeof:E,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Gi(){return{controller:new Bi,data:new Map,refCount:0}}function Wi(e){e.refCount--,0===e.refCount&&ji(Hi,function(){e.controller.abort()})}var $i=null,Xi=0,qi=0,Yi=null;function Zi(){if(0===--Xi&&null!==$i){null!==Yi&&(Yi.status="fulfilled");var e=$i;$i=null,qi=0,Yi=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Ki=F.S;F.S=function(e,t){Uc=fe(),"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===$i){var n=$i=[];Xi=0,qi=Xu(),Yi={status:"pending",value:void 0,then:function(e){n.push(e)}}}Xi++,t.then(Zi,Zi)}(0,t),null!==Ki&&Ki(e,t)};var Ji=G(null);function Qi(){var e=Ji.current;return null!==e?e:bc.pooledCache}function ea(e,t){$(Ji,null===t?Ji.current:t.pool)}function ta(){var e=Qi();return null===e?null:{parent:Vi._currentValue,pool:e}}var na=Error(r(460)),ra=Error(r(474)),ia=Error(r(542)),aa={then:function(){}};function oa(e){return"fulfilled"===(e=e.status)||"rejected"===e}function sa(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Ot,Ot),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw da(e=t.reason),e;default:if("string"==typeof t.status)t.then(Ot,Ot);else{if(null!==(e=bc)&&100<e.shellSuspendCounter)throw Error(r(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw da(e=t.reason),e}throw ca=t,na}}function la(e){try{return(0,e._init)(e._payload)}catch(t){if(null!==t&&"object"==typeof t&&"function"==typeof t.then)throw ca=t,na;throw t}}var ca=null;function ua(){if(null===ca)throw Error(r(459));var e=ca;return ca=null,e}function da(e){if(e===na||e===ia)throw Error(r(483))}var ha=null,fa=0;function pa(e){var t=fa;return fa+=1,null===ha&&(ha=[]),sa(ha,e,t)}function ma(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function ga(e,t){if(t.$$typeof===h)throw Error(r(525));throw e=Object.prototype.toString.call(t),Error(r(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function va(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function i(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function a(e,t){return(e=Wr(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=67108866,n):r:(t.flags|=67108866,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Yr(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,r){var i=n.type;return i===x?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"==typeof i&&null!==i&&i.$$typeof===N&&la(i)===t.type)?(ma(t=a(t,n.props),n),t.return=e,t):(ma(t=Xr(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Kr(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function d(e,t,n,r,i){return null===t||7!==t.tag?((t=qr(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function h(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=Yr(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case f:return ma(n=Xr(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case g:return(t=Kr(t,e.mode,n)).return=e,t;case N:return h(e,t=la(t),n)}if(U(t)||D(t))return(t=qr(t,e.mode,n,null)).return=e,t;if("function"==typeof t.then)return h(e,pa(t),n);if(t.$$typeof===E)return h(e,Ui(e,t),n);ga(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return null!==i?null:l(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case f:return n.key===i?c(e,t,n,r):null;case g:return n.key===i?u(e,t,n,r):null;case N:return p(e,t,n=la(n),r)}if(U(n)||D(n))return null!==i?null:d(e,t,n,r,null);if("function"==typeof n.then)return p(e,t,pa(n),r);if(n.$$typeof===E)return p(e,t,Ui(e,n),r);ga(e,n)}return null}function m(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r||"bigint"==typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case f:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case g:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case N:return m(e,t,n,r=la(r),i)}if(U(r)||D(r))return d(t,e=e.get(n)||null,r,i,null);if("function"==typeof r.then)return m(e,t,n,pa(r),i);if(r.$$typeof===E)return m(e,t,n,Ui(t,r),i);ga(t,r)}return null}function v(l,c,u,d){if("object"==typeof u&&null!==u&&u.type===x&&null===u.key&&(u=u.props.children),"object"==typeof u&&null!==u){switch(u.$$typeof){case f:e:{for(var y=u.key;null!==c;){if(c.key===y){if((y=u.type)===x){if(7===c.tag){n(l,c.sibling),(d=a(c,u.props.children)).return=l,l=d;break e}}else if(c.elementType===y||"object"==typeof y&&null!==y&&y.$$typeof===N&&la(y)===c.type){n(l,c.sibling),ma(d=a(c,u.props),u),d.return=l,l=d;break e}n(l,c);break}t(l,c),c=c.sibling}u.type===x?((d=qr(u.props.children,l.mode,d,u.key)).return=l,l=d):(ma(d=Xr(u.type,u.key,u.props,null,l.mode,d),u),d.return=l,l=d)}return s(l);case g:e:{for(y=u.key;null!==c;){if(c.key===y){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){n(l,c.sibling),(d=a(c,u.children||[])).return=l,l=d;break e}n(l,c);break}t(l,c),c=c.sibling}(d=Kr(u,l.mode,d)).return=l,l=d}return s(l);case N:return v(l,c,u=la(u),d)}if(U(u))return function(r,a,s,l){for(var c=null,u=null,d=a,f=a=0,g=null;null!==d&&f<s.length;f++){d.index>f?(g=d,d=null):g=d.sibling;var v=p(r,d,s[f],l);if(null===v){null===d&&(d=g);break}e&&d&&null===v.alternate&&t(r,d),a=o(v,a,f),null===u?c=v:u.sibling=v,u=v,d=g}if(f===s.length)return n(r,d),gi&&ci(r,f),c;if(null===d){for(;f<s.length;f++)null!==(d=h(r,s[f],l))&&(a=o(d,a,f),null===u?c=d:u.sibling=d,u=d);return gi&&ci(r,f),c}for(d=i(d);f<s.length;f++)null!==(g=m(d,r,f,s[f],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?f:g.key),a=o(g,a,f),null===u?c=g:u.sibling=g,u=g);return e&&d.forEach(function(e){return t(r,e)}),gi&&ci(r,f),c}(l,c,u,d);if(D(u)){if("function"!=typeof(y=D(u)))throw Error(r(150));return function(a,s,l,c){if(null==l)throw Error(r(151));for(var u=null,d=null,f=s,g=s=0,v=null,y=l.next();null!==f&&!y.done;g++,y=l.next()){f.index>g?(v=f,f=null):v=f.sibling;var b=p(a,f,y.value,c);if(null===b){null===f&&(f=v);break}e&&f&&null===b.alternate&&t(a,f),s=o(b,s,g),null===d?u=b:d.sibling=b,d=b,f=v}if(y.done)return n(a,f),gi&&ci(a,g),u;if(null===f){for(;!y.done;g++,y=l.next())null!==(y=h(a,y.value,c))&&(s=o(y,s,g),null===d?u=y:d.sibling=y,d=y);return gi&&ci(a,g),u}for(f=i(f);!y.done;g++,y=l.next())null!==(y=m(f,a,g,y.value,c))&&(e&&null!==y.alternate&&f.delete(null===y.key?g:y.key),s=o(y,s,g),null===d?u=y:d.sibling=y,d=y);return e&&f.forEach(function(e){return t(a,e)}),gi&&ci(a,g),u}(l,c,u=y.call(u),d)}if("function"==typeof u.then)return v(l,c,pa(u),d);if(u.$$typeof===E)return v(l,c,Ui(l,u),d);ga(l,u)}return"string"==typeof u&&""!==u||"number"==typeof u||"bigint"==typeof u?(u=""+u,null!==c&&6===c.tag?(n(l,c.sibling),(d=a(c,u)).return=l,l=d):(n(l,c),(d=Yr(u,l.mode,d)).return=l,l=d),s(l)):n(l,c)}return function(e,t,n,r){try{fa=0;var i=v(e,t,n,r);return ha=null,i}catch(o){if(o===na||o===ia)throw o;var a=Vr(29,o,null,e.mode);return a.lanes=r,a.return=e,a}}}var ya=va(!0),ba=va(!1),xa=!1;function _a(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function wa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Sa(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Ma(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&yc){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,t=Br(e),Fr(e,null,n),t}return zr(e,r,t,n),Br(e)}function Ea(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194048&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Fe(e,n)}}function Ta(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===a?i=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var Ca=!1;function Aa(){if(Ca&&null!==Yi)throw Yi}function ka(e,t,n,r){Ca=!1;var i=e.updateQueue;xa=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var l=s,c=l.next;l.next=null,null===o?a=c:o.next=c,o=l;var d=e.alternate;null!==d&&(s=(d=d.updateQueue).lastBaseUpdate)!==o&&(null===s?d.firstBaseUpdate=c:s.next=c,d.lastBaseUpdate=l)}if(null!==a){var h=i.baseState;for(o=0,d=c=l=null,s=a;;){var f=-536870913&s.lane,p=f!==s.lane;if(p?(_c&f)===f:(r&f)===f){0!==f&&f===qi&&(Ca=!0),null!==d&&(d=d.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null});e:{var m=e,g=s;f=t;var v=n;switch(g.tag){case 1:if("function"==typeof(m=g.payload)){h=m.call(v,h,f);break e}h=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null==(f="function"==typeof(m=g.payload)?m.call(v,h,f):m))break e;h=u({},h,f);break e;case 2:xa=!0}}null!==(f=s.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=i.callbacks)?i.callbacks=[f]:p.push(f))}else p={lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===d?(c=d=p,l=h):d=d.next=p,o|=f;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(p=s).next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}null===d&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=d,null===a&&(i.shared.lanes=0),kc|=o,e.lanes=o,e.memoizedState=h}}function Ra(e,t){if("function"!=typeof e)throw Error(r(191,e));e.call(t)}function Na(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)Ra(n[e],t)}var Pa=G(null),Ia=G(0);function La(e,t){$(Ia,e=Cc),$(Pa,t),Cc=e|t.baseLanes}function Da(){$(Ia,Cc),$(Pa,Pa.current)}function za(){Cc=Ia.current,W(Pa),W(Ia)}var Oa=G(null),Ua=null;function Fa(e){var t=e.alternate;$(Ga,1&Ga.current),$(Oa,e),null===Ua&&(null===t||null!==Pa.current||null!==t.memoizedState)&&(Ua=e)}function Ba(e){$(Ga,Ga.current),$(Oa,e),null===Ua&&(Ua=e)}function ja(e){22===e.tag?($(Ga,Ga.current),$(Oa,e),null===Ua&&(Ua=e)):Ha()}function Ha(){$(Ga,Ga.current),$(Oa,Oa.current)}function Va(e){W(Oa),Ua===e&&(Ua=null),W(Ga)}var Ga=G(0);function Wa(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||zd(n)||Od(n)))return t}else if(19!==t.tag||"forwards"!==t.memoizedProps.revealOrder&&"backwards"!==t.memoizedProps.revealOrder&&"unstable_legacy-backwards"!==t.memoizedProps.revealOrder&&"together"!==t.memoizedProps.revealOrder){if(null!==t.child){t.child.return=t,t=t.child;continue}}else if(128&t.flags)return t;if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var $a=0,Xa=null,qa=null,Ya=null,Za=!1,Ka=!1,Ja=!1,Qa=0,eo=0,to=null,no=0;function ro(){throw Error(r(321))}function io(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!rr(e[n],t[n]))return!1;return!0}function ao(e,t,n,r,i,a){return $a=a,Xa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,F.H=null===e||null===e.memoizedState?_s:ws,Ja=!1,a=n(r,i),Ja=!1,Ka&&(a=so(t,n,r,i)),oo(e),a}function oo(e){F.H=xs;var t=null!==qa&&null!==qa.next;if($a=0,Ya=qa=Xa=null,Za=!1,eo=0,to=null,t)throw Error(r(300));null===e||Us||null!==(e=e.dependencies)&&Di(e)&&(Us=!0)}function so(e,t,n,i){Xa=e;var a=0;do{if(Ka&&(to=null),eo=0,Ka=!1,25<=a)throw Error(r(301));if(a+=1,Ya=qa=null,null!=e.updateQueue){var o=e.updateQueue;o.lastEffect=null,o.events=null,o.stores=null,null!=o.memoCache&&(o.memoCache.index=0)}F.H=Ss,o=t(n,i)}while(Ka);return o}function lo(){var e=F.H,t=e.useState()[0];return t="function"==typeof t.then?mo(t):t,e=e.useState()[0],(null!==qa?qa.memoizedState:null)!==e&&(Xa.flags|=1024),t}function co(){var e=0!==Qa;return Qa=0,e}function uo(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function ho(e){if(Za){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Za=!1}$a=0,Ya=qa=Xa=null,Ka=!1,eo=Qa=0,to=null}function fo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Ya?Xa.memoizedState=Ya=e:Ya=Ya.next=e,Ya}function po(){if(null===qa){var e=Xa.alternate;e=null!==e?e.memoizedState:null}else e=qa.next;var t=null===Ya?Xa.memoizedState:Ya.next;if(null!==t)Ya=t,qa=e;else{if(null===e){if(null===Xa.alternate)throw Error(r(467));throw Error(r(310))}e={memoizedState:(qa=e).memoizedState,baseState:qa.baseState,baseQueue:qa.baseQueue,queue:qa.queue,next:null},null===Ya?Xa.memoizedState=Ya=e:Ya=Ya.next=e}return Ya}function mo(e){var t=eo;return eo+=1,null===to&&(to=[]),e=sa(to,e,t),t=Xa,null===(null===Ya?t.memoizedState:Ya.next)&&(t=t.alternate,F.H=null===t||null===t.memoizedState?_s:ws),e}function go(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return mo(e);if(e.$$typeof===E)return Oi(e)}throw Error(r(438,String(e)))}function vo(e){var t=null,n=Xa.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=Xa.alternate;null!==r&&null!==(r=r.updateQueue)&&null!=(r=r.memoCache)&&(t={data:r.data.map(function(e){return e.slice()}),index:0})}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},Xa.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=I;return t.index++,n}function yo(e,t){return"function"==typeof t?t(e):t}function bo(e){return xo(po(),qa,e)}function xo(e,t,n){var i=e.queue;if(null===i)throw Error(r(311));i.lastRenderedReducer=n;var a=e.baseQueue,o=i.pending;if(null!==o){if(null!==a){var s=a.next;a.next=o.next,o.next=s}t.baseQueue=a=o,i.pending=null}if(o=e.baseState,null===a)e.memoizedState=o;else{var l=s=null,c=null,u=t=a.next,d=!1;do{var h=-536870913&u.lane;if(h!==u.lane?(_c&h)===h:($a&h)===h){var f=u.revertLane;if(0===f)null!==c&&(c=c.next={lane:0,revertLane:0,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),h===qi&&(d=!0);else{if(($a&f)===f){u=u.next,f===qi&&(d=!0);continue}h={lane:0,revertLane:u.revertLane,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=h,s=o):c=c.next=h,Xa.lanes|=f,kc|=f}h=u.action,Ja&&n(o,h),o=u.hasEagerState?u.eagerState:n(o,h)}else f={lane:h,revertLane:u.revertLane,gesture:u.gesture,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=f,s=o):c=c.next=f,Xa.lanes|=h,kc|=h;u=u.next}while(null!==u&&u!==t);if(null===c?s=o:c.next=l,!rr(o,e.memoizedState)&&(Us=!0,d&&null!==(n=Yi)))throw n;e.memoizedState=o,e.baseState=s,e.baseQueue=c,i.lastRenderedState=o}return null===a&&(i.lanes=0),[e.memoizedState,i.dispatch]}function _o(e){var t=po(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var i=n.dispatch,a=n.pending,o=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{o=e(o,s.action),s=s.next}while(s!==a);rr(o,t.memoizedState)||(Us=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function wo(e,t,n){var i=Xa,a=po(),o=gi;if(o){if(void 0===n)throw Error(r(407));n=n()}else n=t();var s=!rr((qa||a).memoizedState,n);if(s&&(a.memoizedState=n,Us=!0),a=a.queue,Xo(Eo.bind(null,i,a,e),[e]),a.getSnapshot!==t||s||null!==Ya&&1&Ya.memoizedState.tag){if(i.flags|=2048,Ho(9,{destroy:void 0},Mo.bind(null,i,a,n,t),null),null===bc)throw Error(r(349));o||127&$a||So(i,t,n)}return n}function So(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Xa.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},Xa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Mo(e,t,n,r){t.value=n,t.getSnapshot=r,To(t)&&Co(e)}function Eo(e,t,n){return n(function(){To(t)&&Co(e)})}function To(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!rr(e,n)}catch(r){return!0}}function Co(e){var t=Ur(e,2);null!==t&&Qc(t,0,2)}function Ao(e){var t=fo();if("function"==typeof e){var n=e;if(e=n(),Ja){Me(!0);try{n()}finally{Me(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:yo,lastRenderedState:e},t}function ko(e,t,n,r){return e.baseState=n,xo(e,qa,"function"==typeof r?r:yo)}function Ro(e,t,n,i,a){if(vs(e))throw Error(r(485));if(null!==(e=t.action)){var o={payload:a,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}};null!==F.T?n(!0):o.isTransition=!1,i(o),null===(n=t.pending)?(o.next=t.pending=o,No(t,o)):(o.next=n.next,t.pending=n.next=o)}}function No(e,t){var n=t.action,r=t.payload,i=e.state;if(t.isTransition){var a=F.T,o={};F.T=o;try{var s=n(i,r),l=F.S;null!==l&&l(o,s),Po(e,t,s)}catch(c){Lo(e,t,c)}finally{null!==a&&null!==o.types&&(a.types=o.types),F.T=a}}else try{Po(e,t,a=n(i,r))}catch(u){Lo(e,t,u)}}function Po(e,t,n){null!==n&&"object"==typeof n&&"function"==typeof n.then?n.then(function(n){Io(e,t,n)},function(n){return Lo(e,t,n)}):Io(e,t,n)}function Io(e,t,n){t.status="fulfilled",t.value=n,Do(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,No(e,n)))}function Lo(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do{t.status="rejected",t.reason=n,Do(t),t=t.next}while(t!==r)}e.action=null}function Do(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function zo(e,t){return t}function Oo(e,t){if(gi){var n=bc.formState;if(null!==n){e:{var r=Xa;if(gi){if(mi){t:{for(var i=mi,a=yi;8!==i.nodeType;){if(!a){i=null;break t}if(null===(i=Ud(i.nextSibling))){i=null;break t}}i="F!"===(a=i.data)||"F"===a?i:null}if(i){mi=Ud(i.nextSibling),r="F!"===i.data;break e}}xi(r)}r=!1}r&&(t=n[0])}}return(n=fo()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:zo,lastRenderedState:t},n.queue=r,n=ps.bind(null,Xa,r),r.dispatch=n,r=Ao(!1),a=gs.bind(null,Xa,!1,r.queue),i={state:t,dispatch:null,action:e,pending:null},(r=fo()).queue=i,n=Ro.bind(null,Xa,i,a,n),i.dispatch=n,r.memoizedState=e,[t,n,!1]}function Uo(e){return Fo(po(),qa,e)}function Fo(e,t,n){if(t=xo(e,t,zo)[0],e=bo(yo)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var r=mo(t)}catch(o){if(o===na)throw ia;throw o}else r=t;var i=(t=po()).queue,a=i.dispatch;return n!==t.memoizedState&&(Xa.flags|=2048,Ho(9,{destroy:void 0},Bo.bind(null,i,n),null)),[r,a,e]}function Bo(e,t){e.action=t}function jo(e){var t=po(),n=qa;if(null!==n)return Fo(t,n,e);po(),t=t.memoizedState;var r=(n=po()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function Ho(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},null===(t=Xa.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},Xa.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Vo(){return po().memoizedState}function Go(e,t,n,r){var i=fo();Xa.flags|=e,i.memoizedState=Ho(1|t,{destroy:void 0},n,void 0===r?null:r)}function Wo(e,t,n,r){var i=po();r=void 0===r?null:r;var a=i.memoizedState.inst;null!==qa&&null!==r&&io(r,qa.memoizedState.deps)?i.memoizedState=Ho(t,a,n,r):(Xa.flags|=e,i.memoizedState=Ho(1|t,a,n,r))}function $o(e,t){Go(8390656,8,e,t)}function Xo(e,t){Wo(2048,8,e,t)}function qo(e){var t=po().memoizedState;return function(e){Xa.flags|=4;var t=Xa.updateQueue;if(null===t)t={lastEffect:null,events:null,stores:null,memoCache:null},Xa.updateQueue=t,t.events=[e];else{var n=t.events;null===n?t.events=[e]:n.push(e)}}({ref:t,nextImpl:e}),function(){if(2&yc)throw Error(r(440));return t.impl.apply(void 0,arguments)}}function Yo(e,t){return Wo(4,2,e,t)}function Zo(e,t){return Wo(4,4,e,t)}function Ko(e,t){if("function"==typeof t){e=e();var n=t(e);return function(){"function"==typeof n?n():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function Jo(e,t,n){n=null!=n?n.concat([e]):null,Wo(4,4,Ko.bind(null,t,e),n)}function Qo(){}function es(e,t){var n=po();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&io(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function ts(e,t){var n=po();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&io(t,r[1]))return r[0];if(r=e(),Ja){Me(!0);try{e()}finally{Me(!1)}}return n.memoizedState=[r,t],r}function ns(e,t,n){return void 0===n||1073741824&$a&&!(261930&_c)?e.memoizedState=t:(e.memoizedState=n,e=Jc(),Xa.lanes|=e,kc|=e,n)}function rs(e,t,n,r){return rr(n,t)?n:null!==Pa.current?(e=ns(e,n,r),rr(e,t)||(Us=!0),e):42&$a&&(!(1073741824&$a)||261930&_c)?(e=Jc(),Xa.lanes|=e,kc|=e,t):(Us=!0,e.memoizedState=n)}function is(e,t,n,r,i){var a=B.p;B.p=0!==a&&8>a?a:8;var o,s,l,c=F.T,u={};F.T=u,gs(e,!1,t,n);try{var d=i(),h=F.S;null!==h&&h(u,d),null!==d&&"object"==typeof d&&"function"==typeof d.then?ms(e,t,(o=r,s=[],l={status:"pending",value:null,reason:null,then:function(e){s.push(e)}},d.then(function(){l.status="fulfilled",l.value=o;for(var e=0;e<s.length;e++)(0,s[e])(o)},function(e){for(l.status="rejected",l.reason=e,e=0;e<s.length;e++)(0,s[e])(void 0)}),l),Kc()):ms(e,t,r,Kc())}catch(f){ms(e,t,{then:function(){},status:"rejected",reason:f},Kc())}finally{B.p=a,null!==c&&null!==u.types&&(c.types=u.types),F.T=c}}function as(){}function os(e,t,n,i){if(5!==e.tag)throw Error(r(476));var a=ss(e).queue;is(e,a,t,j,null===n?as:function(){return ls(e),n(i)})}function ss(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:j,baseState:j,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:yo,lastRenderedState:j},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:yo,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function ls(e){var t=ss(e);null===t.next&&(t=e.alternate.memoizedState),ms(e,t.next.queue,{},Kc())}function cs(){return Oi(mh)}function us(){return po().memoizedState}function ds(){return po().memoizedState}function hs(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Kc(),r=Ma(t,e=Sa(n),n);return null!==r&&(Qc(r,0,n),Ea(r,t,n)),t={cache:Gi()},void(e.payload=t)}t=t.return}}function fs(e,t,n){var r=Kc();n={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},vs(e)?ys(t,n):null!==(n=Or(e,t,n,r))&&(Qc(n,0,r),bs(n,t,r))}function ps(e,t,n){ms(e,t,n,Kc())}function ms(e,t,n,r){var i={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(vs(e))ys(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,rr(s,o))return zr(e,t,i,0),null===bc&&Dr(),!1}catch(l){}if(null!==(n=Or(e,t,i,r)))return Qc(n,0,r),bs(n,t,r),!0}return!1}function gs(e,t,n,i){if(i={lane:2,revertLane:Xu(),gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null},vs(e)){if(t)throw Error(r(479))}else null!==(t=Or(e,n,i,2))&&Qc(t,0,2)}function vs(e){var t=e.alternate;return e===Xa||null!==t&&t===Xa}function ys(e,t){Ka=Za=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function bs(e,t,n){if(4194048&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Fe(e,n)}}var xs={readContext:Oi,use:go,useCallback:ro,useContext:ro,useEffect:ro,useImperativeHandle:ro,useLayoutEffect:ro,useInsertionEffect:ro,useMemo:ro,useReducer:ro,useRef:ro,useState:ro,useDebugValue:ro,useDeferredValue:ro,useTransition:ro,useSyncExternalStore:ro,useId:ro,useHostTransitionStatus:ro,useFormState:ro,useActionState:ro,useOptimistic:ro,useMemoCache:ro,useCacheRefresh:ro};xs.useEffectEvent=ro;var _s={readContext:Oi,use:go,useCallback:function(e,t){return fo().memoizedState=[e,void 0===t?null:t],e},useContext:Oi,useEffect:$o,useImperativeHandle:function(e,t,n){n=null!=n?n.concat([e]):null,Go(4194308,4,Ko.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Go(4194308,4,e,t)},useInsertionEffect:function(e,t){Go(4,2,e,t)},useMemo:function(e,t){var n=fo();t=void 0===t?null:t;var r=e();if(Ja){Me(!0);try{e()}finally{Me(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=fo();if(void 0!==n){var i=n(t);if(Ja){Me(!0);try{n(t)}finally{Me(!1)}}}else i=t;return r.memoizedState=r.baseState=i,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},r.queue=e,e=e.dispatch=fs.bind(null,Xa,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},fo().memoizedState=e},useState:function(e){var t=(e=Ao(e)).queue,n=ps.bind(null,Xa,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:Qo,useDeferredValue:function(e,t){return ns(fo(),e,t)},useTransition:function(){var e=Ao(!1);return e=is.bind(null,Xa,e.queue,!0,!1),fo().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var i=Xa,a=fo();if(gi){if(void 0===n)throw Error(r(407));n=n()}else{if(n=t(),null===bc)throw Error(r(349));127&_c||So(i,t,n)}a.memoizedState=n;var o={value:n,getSnapshot:t};return a.queue=o,$o(Eo.bind(null,i,o,e),[e]),i.flags|=2048,Ho(9,{destroy:void 0},Mo.bind(null,i,o,n,t),null),n},useId:function(){var e=fo(),t=bc.identifierPrefix;if(gi){var n=li;t="_"+t+"R_"+(n=(si&~(1<<32-Ee(si)-1)).toString(32)+n),0<(n=Qa++)&&(t+="H"+n.toString(32)),t+="_"}else t="_"+t+"r_"+(n=no++).toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:cs,useFormState:Oo,useActionState:Oo,useOptimistic:function(e){var t=fo();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=gs.bind(null,Xa,!0,n),n.dispatch=t,[e,t]},useMemoCache:vo,useCacheRefresh:function(){return fo().memoizedState=hs.bind(null,Xa)},useEffectEvent:function(e){var t=fo(),n={impl:e};return t.memoizedState=n,function(){if(2&yc)throw Error(r(440));return n.impl.apply(void 0,arguments)}}},ws={readContext:Oi,use:go,useCallback:es,useContext:Oi,useEffect:Xo,useImperativeHandle:Jo,useInsertionEffect:Yo,useLayoutEffect:Zo,useMemo:ts,useReducer:bo,useRef:Vo,useState:function(){return bo(yo)},useDebugValue:Qo,useDeferredValue:function(e,t){return rs(po(),qa.memoizedState,e,t)},useTransition:function(){var e=bo(yo)[0],t=po().memoizedState;return["boolean"==typeof e?e:mo(e),t]},useSyncExternalStore:wo,useId:us,useHostTransitionStatus:cs,useFormState:Uo,useActionState:Uo,useOptimistic:function(e,t){return ko(po(),0,e,t)},useMemoCache:vo,useCacheRefresh:ds};ws.useEffectEvent=qo;var Ss={readContext:Oi,use:go,useCallback:es,useContext:Oi,useEffect:Xo,useImperativeHandle:Jo,useInsertionEffect:Yo,useLayoutEffect:Zo,useMemo:ts,useReducer:_o,useRef:Vo,useState:function(){return _o(yo)},useDebugValue:Qo,useDeferredValue:function(e,t){var n=po();return null===qa?ns(n,e,t):rs(n,qa.memoizedState,e,t)},useTransition:function(){var e=_o(yo)[0],t=po().memoizedState;return["boolean"==typeof e?e:mo(e),t]},useSyncExternalStore:wo,useId:us,useHostTransitionStatus:cs,useFormState:jo,useActionState:jo,useOptimistic:function(e,t){var n=po();return null!==qa?ko(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:vo,useCacheRefresh:ds};function Ms(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:u({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}Ss.useEffectEvent=qo;var Es={enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Kc(),i=Sa(r);i.payload=t,null!=n&&(i.callback=n),null!==(t=Ma(e,i,r))&&(Qc(t,0,r),Ea(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Kc(),i=Sa(r);i.tag=1,i.payload=t,null!=n&&(i.callback=n),null!==(t=Ma(e,i,r))&&(Qc(t,0,r),Ea(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Kc(),r=Sa(n);r.tag=2,null!=t&&(r.callback=t),null!==(t=Ma(e,r,n))&&(Qc(t,0,n),Ea(t,e,n))}};function Ts(e,t,n,r,i,a,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!(t.prototype&&t.prototype.isPureReactComponent&&ir(n,r)&&ir(i,a))}function Cs(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Es.enqueueReplaceState(t,t.state,null)}function As(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var i in n===t&&(n=u({},n)),e)void 0===n[i]&&(n[i]=e[i]);return n}function ks(e){Nr(e)}function Rs(e){console.error(e)}function Ns(e){Nr(e)}function Ps(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Is(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function Ls(e,t,n){return(n=Sa(n)).tag=3,n.payload={element:null},n.callback=function(){Ps(e,t)},n}function Ds(e){return(e=Sa(e)).tag=3,e}function zs(e,t,n,r){var i=n.type.getDerivedStateFromError;if("function"==typeof i){var a=r.value;e.payload=function(){return i(a)},e.callback=function(){Is(t,n,r)}}var o=n.stateNode;null!==o&&"function"==typeof o.componentDidCatch&&(e.callback=function(){Is(t,n,r),"function"!=typeof i&&(null===jc?jc=new Set([this]):jc.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}var Os=Error(r(461)),Us=!1;function Fs(e,t,n,r){t.child=null===e?ba(t,null,n,r):ya(t,e.child,n,r)}function Bs(e,t,n,r,i){n=n.render;var a=t.ref;if("ref"in r){var o={};for(var s in r)"ref"!==s&&(o[s]=r[s])}else o=r;return zi(t),r=ao(e,t,n,o,a,i),s=co(),null===e||Us?(gi&&s&&di(t),t.flags|=1,Fs(e,t,r,i),t.child):(uo(e,t,i),cl(e,t,i))}function js(e,t,n,r,i){if(null===e){var a=n.type;return"function"!=typeof a||Gr(a)||void 0!==a.defaultProps||null!==n.compare?((e=Xr(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Hs(e,t,a,r,i))}if(a=e.child,!ul(e,i)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:ir)(o,r)&&e.ref===t.ref)return cl(e,t,i)}return t.flags|=1,(e=Wr(a,r)).ref=t.ref,e.return=t,t.child=e}function Hs(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(ir(a,r)&&e.ref===t.ref){if(Us=!1,t.pendingProps=r=a,!ul(e,i))return t.lanes=e.lanes,cl(e,t,i);131072&e.flags&&(Us=!0)}}return Ys(e,t,n,r,i)}function Vs(e,t,n,r){var i=r.children,a=null!==e?e.memoizedState:null;if(null===e&&null===t.stateNode&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===r.mode){if(128&t.flags){if(a=null!==a?a.baseLanes|n:n,null!==e){for(r=t.child=e.child,i=0;null!==r;)i=i|r.lanes|r.childLanes,r=r.sibling;r=i&~a}else r=0,t.child=null;return Ws(e,t,a,n,r)}if(!(536870912&n))return r=t.lanes=536870912,Ws(e,t,null!==a?a.baseLanes|n:n,n,r);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&ea(0,null!==a?a.cachePool:null),null!==a?La(t,a):Da(),ja(t)}else null!==a?(ea(0,a.cachePool),La(t,a),Ha(),t.memoizedState=null):(null!==e&&ea(0,null),Da(),Ha());return Fs(e,t,i,n),t.child}function Gs(e,t){return null!==e&&22===e.tag||null!==t.stateNode||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function Ws(e,t,n,r,i){var a=Qi();return a=null===a?null:{parent:Vi._currentValue,pool:a},t.memoizedState={baseLanes:n,cachePool:a},null!==e&&ea(0,null),Da(),ja(t),null!==e&&Li(e,t,r,!0),t.childLanes=i,null}function $s(e,t){return(t=il({mode:t.mode,children:t.children},e.mode)).ref=e.ref,e.child=t,t.return=e,t}function Xs(e,t,n){return ya(t,e.child,null,n),(e=$s(t,t.pendingProps)).flags|=2,Va(t),t.memoizedState=null,e}function qs(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!=typeof n&&"object"!=typeof n)throw Error(r(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function Ys(e,t,n,r,i){return zi(t),n=ao(e,t,n,r,void 0,i),r=co(),null===e||Us?(gi&&r&&di(t),t.flags|=1,Fs(e,t,n,i),t.child):(uo(e,t,i),cl(e,t,i))}function Zs(e,t,n,r,i,a){return zi(t),t.updateQueue=null,n=so(t,r,n,i),oo(e),r=co(),null===e||Us?(gi&&r&&di(t),t.flags|=1,Fs(e,t,n,a),t.child):(uo(e,t,a),cl(e,t,a))}function Ks(e,t,n,r,i){if(zi(t),null===t.stateNode){var a=jr,o=n.contextType;"object"==typeof o&&null!==o&&(a=Oi(o)),a=new n(r,a),t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,a.updater=Es,t.stateNode=a,a._reactInternals=t,(a=t.stateNode).props=r,a.state=t.memoizedState,a.refs={},_a(t),o=n.contextType,a.context="object"==typeof o&&null!==o?Oi(o):jr,a.state=t.memoizedState,"function"==typeof(o=n.getDerivedStateFromProps)&&(Ms(t,n,o,r),a.state=t.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof a.getSnapshotBeforeUpdate||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||(o=a.state,"function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),o!==a.state&&Es.enqueueReplaceState(a,a.state,null),ka(t,r,a,i),Aa(),a.state=t.memoizedState),"function"==typeof a.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){a=t.stateNode;var s=t.memoizedProps,l=As(n,s);a.props=l;var c=a.context,u=n.contextType;o=jr,"object"==typeof u&&null!==u&&(o=Oi(u));var d=n.getDerivedStateFromProps;u="function"==typeof d||"function"==typeof a.getSnapshotBeforeUpdate,s=t.pendingProps!==s,u||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s||c!==o)&&Cs(t,a,r,o),xa=!1;var h=t.memoizedState;a.state=h,ka(t,r,a,i),Aa(),c=t.memoizedState,s||h!==c||xa?("function"==typeof d&&(Ms(t,n,d,r),c=t.memoizedState),(l=xa||Ts(t,n,l,r,h,c,o))?(u||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4194308)):("function"==typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),a.props=r,a.state=c,a.context=o,r=l):("function"==typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,wa(e,t),u=As(n,o=t.memoizedProps),a.props=u,d=t.pendingProps,h=a.context,c=n.contextType,l=jr,"object"==typeof c&&null!==c&&(l=Oi(c)),(c="function"==typeof(s=n.getDerivedStateFromProps)||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o!==d||h!==l)&&Cs(t,a,r,l),xa=!1,h=t.memoizedState,a.state=h,ka(t,r,a,i),Aa();var f=t.memoizedState;o!==d||h!==f||xa||null!==e&&null!==e.dependencies&&Di(e.dependencies)?("function"==typeof s&&(Ms(t,n,s,r),f=t.memoizedState),(u=xa||Ts(t,n,u,r,h,f,l)||null!==e&&null!==e.dependencies&&Di(e.dependencies))?(c||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(r,f,l),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,f,l)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),a.props=r,a.state=f,a.context=l,r=u):("function"!=typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return a=r,qs(e,t),r=!!(128&t.flags),a||r?(a=t.stateNode,n=r&&"function"!=typeof n.getDerivedStateFromError?null:a.render(),t.flags|=1,null!==e&&r?(t.child=ya(t,e.child,null,i),t.child=ya(t,null,n,i)):Fs(e,t,n,i),t.memoizedState=a.state,e=t.child):e=cl(e,t,i),e}function Js(e,t,n,r){return Mi(),t.flags|=256,Fs(e,t,n,r),t.child}var Qs={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function el(e){return{baseLanes:e,cachePool:ta()}}function tl(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=Pc),e}function nl(e,t,n){var i,a=t.pendingProps,o=!1,s=!!(128&t.flags);if((i=s)||(i=(null===e||null!==e.memoizedState)&&!!(2&Ga.current)),i&&(o=!0,t.flags&=-129),i=!!(32&t.flags),t.flags&=-33,null===e){if(gi){if(o?Fa(t):Ha(),(e=mi)?null!==(e=null!==(e=Dd(e,yi))&&"&"!==e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==oi?{id:si,overflow:li}:null,retryLane:536870912,hydrationErrors:null},(n=Zr(e)).return=t,t.child=n,pi=t,mi=null):e=null,null===e)throw xi(t);return Od(e)?t.lanes=32:t.lanes=536870912,null}var l=a.children;return a=a.fallback,o?(Ha(),l=il({mode:"hidden",children:l},o=t.mode),a=qr(a,o,n,null),l.return=t,a.return=t,l.sibling=a,t.child=l,(a=t.child).memoizedState=el(n),a.childLanes=tl(e,i,n),t.memoizedState=Qs,Gs(null,a)):(Fa(t),rl(t,l))}var c=e.memoizedState;if(null!==c&&null!==(l=c.dehydrated)){if(s)256&t.flags?(Fa(t),t.flags&=-257,t=al(e,t,n)):null!==t.memoizedState?(Ha(),t.child=e.child,t.flags|=128,t=null):(Ha(),l=a.fallback,o=t.mode,a=il({mode:"visible",children:a.children},o),(l=qr(l,o,n,null)).flags|=2,a.return=t,l.return=t,a.sibling=l,t.child=a,ya(t,e.child,null,n),(a=t.child).memoizedState=el(n),a.childLanes=tl(e,i,n),t.memoizedState=Qs,t=Gs(null,a));else if(Fa(t),Od(l)){if(i=l.nextSibling&&l.nextSibling.dataset)var u=i.dgst;i=u,(a=Error(r(419))).stack="",a.digest=i,Ti({value:a,source:null,stack:null}),t=al(e,t,n)}else if(Us||Li(e,t,n,!1),i=0!==(n&e.childLanes),Us||i){if(null!==(i=bc)&&0!==(a=Be(i,n))&&a!==c.retryLane)throw c.retryLane=a,Ur(e,a),Qc(i,0,a),Os;zd(l)||du(),t=al(e,t,n)}else zd(l)?(t.flags|=192,t.child=e.child,t=null):(e=c.treeContext,mi=Ud(l.nextSibling),pi=t,gi=!0,vi=null,yi=!1,null!==e&&fi(t,e),(t=rl(t,a.children)).flags|=4096);return t}return o?(Ha(),l=a.fallback,o=t.mode,u=(c=e.child).sibling,(a=Wr(c,{mode:"hidden",children:a.children})).subtreeFlags=65011712&c.subtreeFlags,null!==u?l=Wr(u,l):(l=qr(l,o,n,null)).flags|=2,l.return=t,a.return=t,a.sibling=l,t.child=a,Gs(null,a),a=t.child,null===(l=e.child.memoizedState)?l=el(n):(null!==(o=l.cachePool)?(c=Vi._currentValue,o=o.parent!==c?{parent:c,pool:c}:o):o=ta(),l={baseLanes:l.baseLanes|n,cachePool:o}),a.memoizedState=l,a.childLanes=tl(e,i,n),t.memoizedState=Qs,Gs(e.child,a)):(Fa(t),e=(n=e.child).sibling,(n=Wr(n,{mode:"visible",children:a.children})).return=t,n.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=n,t.memoizedState=null,n)}function rl(e,t){return(t=il({mode:"visible",children:t},e.mode)).return=e,e.child=t}function il(e,t){return(e=Vr(22,e,null,t)).lanes=0,e}function al(e,t,n){return ya(t,e.child,null,n),(e=rl(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function ol(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Pi(e.return,t,n)}function sl(e,t,n,r,i,a){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,treeForkCount:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i,o.treeForkCount=a)}function ll(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;r=r.children;var o=Ga.current,s=!!(2&o);if(s?(o=1&o|2,t.flags|=128):o&=1,$(Ga,o),Fs(e,t,r,n),r=gi?ri:0,!s&&null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ol(e,n,t);else if(19===e.tag)ol(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Wa(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),sl(t,!1,i,n,a,r);break;case"backwards":case"unstable_legacy-backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Wa(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}sl(t,!0,n,null,a,r);break;case"together":sl(t,!1,null,null,void 0,r);break;default:t.memoizedState=null}return t.child}function cl(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),kc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(Li(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(r(153));if(null!==t.child){for(n=Wr(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Wr(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function ul(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Di(e))}function dl(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Us=!0;else{if(!(ul(e,n)||128&t.flags))return Us=!1,function(e,t,n){switch(t.tag){case 3:Q(t,t.stateNode.containerInfo),Ri(0,Vi,e.memoizedState.cache),Mi();break;case 27:case 5:te(t);break;case 4:Q(t,t.stateNode.containerInfo);break;case 10:Ri(0,t.type,t.memoizedProps.value);break;case 31:if(null!==t.memoizedState)return t.flags|=128,Ba(t),null;break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(Fa(t),t.flags|=128,null):0!==(n&t.child.childLanes)?nl(e,t,n):(Fa(t),null!==(e=cl(e,t,n))?e.sibling:null);Fa(t);break;case 19:var i=!!(128&e.flags);if((r=0!==(n&t.childLanes))||(Li(e,t,n,!1),r=0!==(n&t.childLanes)),i){if(r)return ll(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),$(Ga,Ga.current),r)break;return null;case 22:return t.lanes=0,Vs(e,t,n,t.pendingProps);case 24:Ri(0,Vi,e.memoizedState.cache)}return cl(e,t,n)}(e,t,n);Us=!!(131072&e.flags)}else Us=!1,gi&&1048576&t.flags&&ui(t,ri,t.index);switch(t.lanes=0,t.tag){case 16:e:{var i=t.pendingProps;if(e=la(t.elementType),t.type=e,"function"!=typeof e){if(null!=e){var a=e.$$typeof;if(a===C){t.tag=11,t=Bs(null,t,e,i,n);break e}if(a===R){t.tag=14,t=js(null,t,e,i,n);break e}}throw t=O(e)||e,Error(r(306,t,""))}Gr(e)?(i=As(e,i),t.tag=1,t=Ks(null,t,e,i,n)):(t.tag=0,t=Ys(null,t,e,i,n))}return t;case 0:return Ys(e,t,t.type,t.pendingProps,n);case 1:return Ks(e,t,i=t.type,a=As(i,t.pendingProps),n);case 3:e:{if(Q(t,t.stateNode.containerInfo),null===e)throw Error(r(387));i=t.pendingProps;var o=t.memoizedState;a=o.element,wa(e,t),ka(t,i,null,n);var s=t.memoizedState;if(i=s.cache,Ri(0,Vi,i),i!==o.cache&&Ii(t,[Vi],n,!0),Aa(),i=s.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:s.cache},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Js(e,t,i,n);break e}if(i!==a){Ti(a=Qr(Error(r(424)),t)),t=Js(e,t,i,n);break e}for(e=9===(e=t.stateNode.containerInfo).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,mi=Ud(e.firstChild),pi=t,gi=!0,vi=null,yi=!0,n=ba(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(Mi(),i===a){t=cl(e,t,n);break e}Fs(e,t,i,n)}t=t.child}return t;case 26:return qs(e,t),null===e?(n=Zd(t.type,null,t.pendingProps,null))?t.memoizedState=n:gi||(n=t.type,e=t.pendingProps,(i=_d(K.current).createElement(n))[$e]=t,i[Xe]=e,vd(i,n,e),at(i),t.stateNode=i):t.memoizedState=Zd(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return te(t),null===e&&gi&&(i=t.stateNode=Hd(t.type,t.pendingProps,K.current),pi=t,yi=!0,a=mi,Nd(t.type)?(Fd=a,mi=Ud(i.firstChild)):mi=a),Fs(e,t,t.pendingProps.children,n),qs(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&gi&&((a=i=mi)&&(null!==(i=function(e,t,n,r){for(;1===e.nodeType;){var i=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(r){if(!e[Qe])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(a=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(a!==i.rel||e.getAttribute("href")!==(null==i.href||""===i.href?null:i.href)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin)||e.getAttribute("title")!==(null==i.title?null:i.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((a=e.getAttribute("src"))!==(null==i.src?null:i.src)||e.getAttribute("type")!==(null==i.type?null:i.type)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin))&&a&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var a=null==i.name?null:""+i.name;if("hidden"===i.type&&e.getAttribute("name")===a)return e}if(null===(e=Ud(e.nextSibling)))break}return null}(i,t.type,t.pendingProps,yi))?(t.stateNode=i,pi=t,mi=Ud(i.firstChild),yi=!1,a=!0):a=!1),a||xi(t)),te(t),a=t.type,o=t.pendingProps,s=null!==e?e.memoizedProps:null,i=o.children,Md(a,o)?i=null:null!==s&&Md(a,s)&&(t.flags|=32),null!==t.memoizedState&&(a=ao(e,t,lo,null,null,n),mh._currentValue=a),qs(e,t),Fs(e,t,i,n),t.child;case 6:return null===e&&gi&&((e=n=mi)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=Ud(e.nextSibling)))return null}return e}(n,t.pendingProps,yi))?(t.stateNode=n,pi=t,mi=null,e=!0):e=!1),e||xi(t)),null;case 13:return nl(e,t,n);case 4:return Q(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=ya(t,null,i,n):Fs(e,t,i,n),t.child;case 11:return Bs(e,t,t.type,t.pendingProps,n);case 7:return Fs(e,t,t.pendingProps,n),t.child;case 8:case 12:return Fs(e,t,t.pendingProps.children,n),t.child;case 10:return i=t.pendingProps,Ri(0,t.type,i.value),Fs(e,t,i.children,n),t.child;case 9:return a=t.type._context,i=t.pendingProps.children,zi(t),i=i(a=Oi(a)),t.flags|=1,Fs(e,t,i,n),t.child;case 14:return js(e,t,t.type,t.pendingProps,n);case 15:return Hs(e,t,t.type,t.pendingProps,n);case 19:return ll(e,t,n);case 31:return function(e,t,n){var i=t.pendingProps,a=!!(128&t.flags);if(t.flags&=-129,null===e){if(gi){if("hidden"===i.mode)return e=$s(t,i),t.lanes=536870912,Gs(null,e);if(Ba(t),(e=mi)?null!==(e=null!==(e=Dd(e,yi))&&"&"===e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==oi?{id:si,overflow:li}:null,retryLane:536870912,hydrationErrors:null},(n=Zr(e)).return=t,t.child=n,pi=t,mi=null):e=null,null===e)throw xi(t);return t.lanes=536870912,null}return $s(t,i)}var o=e.memoizedState;if(null!==o){var s=o.dehydrated;if(Ba(t),a)if(256&t.flags)t.flags&=-257,t=Xs(e,t,n);else{if(null===t.memoizedState)throw Error(r(558));t.child=e.child,t.flags|=128,t=null}else if(Us||Li(e,t,n,!1),a=0!==(n&e.childLanes),Us||a){if(null!==(i=bc)&&0!==(s=Be(i,n))&&s!==o.retryLane)throw o.retryLane=s,Ur(e,s),Qc(i,0,s),Os;du(),t=Xs(e,t,n)}else e=o.treeContext,mi=Ud(s.nextSibling),pi=t,gi=!0,vi=null,yi=!1,null!==e&&fi(t,e),(t=$s(t,i)).flags|=4096;return t}return(e=Wr(e.child,{mode:i.mode,children:i.children})).ref=t.ref,t.child=e,e.return=t,e}(e,t,n);case 22:return Vs(e,t,n,t.pendingProps);case 24:return zi(t),i=Oi(Vi),null===e?(null===(a=Qi())&&(a=bc,o=Gi(),a.pooledCache=o,o.refCount++,null!==o&&(a.pooledCacheLanes|=n),a=o),t.memoizedState={parent:i,cache:a},_a(t),Ri(0,Vi,a)):(0!==(e.lanes&n)&&(wa(e,t),ka(t,null,null,n),Aa()),a=e.memoizedState,o=t.memoizedState,a.parent!==i?(a={parent:i,cache:i},t.memoizedState=a,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=a),Ri(0,Vi,i)):(i=o.cache,Ri(0,Vi,i),i!==a.cache&&Ii(t,[Vi],n,!0))),Fs(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(r(156,t.tag))}function hl(e){e.flags|=4}function fl(e,t,n,r,i){if((t=!!(32&e.mode))&&(t=!1),t){if(e.flags|=16777216,(335544128&i)===i)if(e.stateNode.complete)e.flags|=8192;else{if(!lu())throw ca=aa,ra;e.flags|=8192}}else e.flags&=-16777217}function pl(e,t){if("stylesheet"!==t.type||4&t.state.loading)e.flags&=-16777217;else if(e.flags|=16777216,!ch(t)){if(!lu())throw ca=aa,ra;e.flags|=8192}}function ml(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?De():536870912,e.lanes|=t,Ic|=t)}function gl(e,t){if(!gi)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function vl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=65011712&i.subtreeFlags,r|=65011712&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function yl(e,t,n){var i=t.pendingProps;switch(hi(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return vl(t),null;case 3:return n=t.stateNode,i=null,null!==e&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),Ni(Vi),ee(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(Si(t)?hl(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,Ei())),vl(t),null;case 26:var a=t.type,o=t.memoizedState;return null===e?(hl(t),null!==o?(vl(t),pl(t,o)):(vl(t),fl(t,a,0,0,n))):o?o!==e.memoizedState?(hl(t),vl(t),pl(t,o)):(vl(t),t.flags&=-16777217):((e=e.memoizedProps)!==i&&hl(t),vl(t),fl(t,a,0,0,n)),null;case 27:if(ne(t),n=K.current,a=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==i&&hl(t);else{if(!i){if(null===t.stateNode)throw Error(r(166));return vl(t),null}e=Y.current,Si(t)?_i(t):(e=Hd(a,i,n),t.stateNode=e,hl(t))}return vl(t),null;case 5:if(ne(t),a=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==i&&hl(t);else{if(!i){if(null===t.stateNode)throw Error(r(166));return vl(t),null}if(o=Y.current,Si(t))_i(t);else{var s=_d(K.current);switch(o){case 1:o=s.createElementNS("http://www.w3.org/2000/svg",a);break;case 2:o=s.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;default:switch(a){case"svg":o=s.createElementNS("http://www.w3.org/2000/svg",a);break;case"math":o=s.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;case"script":(o=s.createElement("div")).innerHTML="<script><\/script>",o=o.removeChild(o.firstChild);break;case"select":o="string"==typeof i.is?s.createElement("select",{is:i.is}):s.createElement("select"),i.multiple?o.multiple=!0:i.size&&(o.size=i.size);break;default:o="string"==typeof i.is?s.createElement(a,{is:i.is}):s.createElement(a)}}o[$e]=t,o[Xe]=i;e:for(s=t.child;null!==s;){if(5===s.tag||6===s.tag)o.appendChild(s.stateNode);else if(4!==s.tag&&27!==s.tag&&null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break e;for(;null===s.sibling;){if(null===s.return||s.return===t)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}t.stateNode=o;e:switch(vd(o,a,i),a){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&hl(t)}}return vl(t),fl(t,t.type,null===e||e.memoizedProps,t.pendingProps,n),null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==i&&hl(t);else{if("string"!=typeof i&&null===t.stateNode)throw Error(r(166));if(e=K.current,Si(t)){if(e=t.stateNode,n=t.memoizedProps,i=null,null!==(a=pi))switch(a.tag){case 27:case 5:i=a.memoizedProps}e[$e]=t,(e=!!(e.nodeValue===n||null!==i&&!0===i.suppressHydrationWarning||pd(e.nodeValue,n)))||xi(t,!0)}else(e=_d(e).createTextNode(i))[$e]=t,t.stateNode=e}return vl(t),null;case 31:if(n=t.memoizedState,null===e||null!==e.memoizedState){if(i=Si(t),null!==n){if(null===e){if(!i)throw Error(r(318));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(r(557));e[$e]=t}else Mi(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;vl(t),e=!1}else n=Ei(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=n),e=!0;if(!e)return 256&t.flags?(Va(t),t):(Va(t),null);if(128&t.flags)throw Error(r(558))}return vl(t),null;case 13:if(i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(a=Si(t),null!==i&&null!==i.dehydrated){if(null===e){if(!a)throw Error(r(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(r(317));a[$e]=t}else Mi(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;vl(t),a=!1}else a=Ei(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=a),a=!0;if(!a)return 256&t.flags?(Va(t),t):(Va(t),null)}return Va(t),128&t.flags?(t.lanes=n,t):(n=null!==i,e=null!==e&&null!==e.memoizedState,n&&(a=null,null!==(i=t.child).alternate&&null!==i.alternate.memoizedState&&null!==i.alternate.memoizedState.cachePool&&(a=i.alternate.memoizedState.cachePool.pool),o=null,null!==i.memoizedState&&null!==i.memoizedState.cachePool&&(o=i.memoizedState.cachePool.pool),o!==a&&(i.flags|=2048)),n!==e&&n&&(t.child.flags|=8192),ml(t,t.updateQueue),vl(t),null);case 4:return ee(),null===e&&id(t.stateNode.containerInfo),vl(t),null;case 10:return Ni(t.type),vl(t),null;case 19:if(W(Ga),null===(i=t.memoizedState))return vl(t),null;if(a=!!(128&t.flags),null===(o=i.rendering))if(a)gl(i,!1);else{if(0!==Ac||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(o=Wa(e))){for(t.flags|=128,gl(i,!1),e=o.updateQueue,t.updateQueue=e,ml(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)$r(n,e),n=n.sibling;return $(Ga,1&Ga.current|2),gi&&ci(t,i.treeForkCount),t.child}e=e.sibling}null!==i.tail&&fe()>Fc&&(t.flags|=128,a=!0,gl(i,!1),t.lanes=4194304)}else{if(!a)if(null!==(e=Wa(o))){if(t.flags|=128,a=!0,e=e.updateQueue,t.updateQueue=e,ml(t,e),gl(i,!0),null===i.tail&&"hidden"===i.tailMode&&!o.alternate&&!gi)return vl(t),null}else 2*fe()-i.renderingStartTime>Fc&&536870912!==n&&(t.flags|=128,a=!0,gl(i,!1),t.lanes=4194304);i.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=i.last)?e.sibling=o:t.child=o,i.last=o)}return null!==i.tail?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=fe(),e.sibling=null,n=Ga.current,$(Ga,a?1&n|2:1&n),gi&&ci(t,i.treeForkCount),e):(vl(t),null);case 22:case 23:return Va(t),za(),i=null!==t.memoizedState,null!==e?null!==e.memoizedState!==i&&(t.flags|=8192):i&&(t.flags|=8192),i?!!(536870912&n)&&!(128&t.flags)&&(vl(t),6&t.subtreeFlags&&(t.flags|=8192)):vl(t),null!==(n=t.updateQueue)&&ml(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),i=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(i=t.memoizedState.cachePool.pool),i!==n&&(t.flags|=2048),null!==e&&W(Ji),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),Ni(Vi),vl(t),null;case 25:case 30:return null}throw Error(r(156,t.tag))}function bl(e,t){switch(hi(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ni(Vi),ee(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return ne(t),null;case 31:if(null!==t.memoizedState){if(Va(t),null===t.alternate)throw Error(r(340));Mi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 13:if(Va(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(r(340));Mi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return W(Ga),null;case 4:return ee(),null;case 10:return Ni(t.type),null;case 22:case 23:return Va(t),za(),null!==e&&W(Ji),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return Ni(Vi),null;default:return null}}function xl(e,t){switch(hi(t),t.tag){case 3:Ni(Vi),ee();break;case 26:case 27:case 5:ne(t);break;case 4:ee();break;case 31:null!==t.memoizedState&&Va(t);break;case 13:Va(t);break;case 19:W(Ga);break;case 10:Ni(t.type);break;case 22:case 23:Va(t),za(),null!==e&&W(Ji);break;case 24:Ni(Vi)}}function _l(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var i=r.next;n=i;do{if((n.tag&e)===e){r=void 0;var a=n.create,o=n.inst;r=a(),o.destroy=r}n=n.next}while(n!==i)}}catch(s){Au(t,t.return,s)}}function wl(e,t,n){try{var r=t.updateQueue,i=null!==r?r.lastEffect:null;if(null!==i){var a=i.next;r=a;do{if((r.tag&e)===e){var o=r.inst,s=o.destroy;if(void 0!==s){o.destroy=void 0,i=t;var l=n,c=s;try{c()}catch(u){Au(i,l,u)}}}r=r.next}while(r!==a)}}catch(u){Au(t,t.return,u)}}function Sl(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{Na(t,n)}catch(r){Au(e,e.return,r)}}}function Ml(e,t,n){n.props=As(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(r){Au(e,t,r)}}function El(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;default:r=e.stateNode}"function"==typeof n?e.refCleanup=n(r):n.current=r}}catch(i){Au(e,t,i)}}function Tl(e,t){var n=e.ref,r=e.refCleanup;if(null!==n)if("function"==typeof r)try{r()}catch(i){Au(e,t,i)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof n)try{n(null)}catch(a){Au(e,t,a)}else n.current=null}function Cl(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break e;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(i){Au(e,e.return,i)}}function Al(e,t,n){try{var i=e.stateNode;!function(e,t,n,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var a=null,o=null,s=null,l=null,c=null,u=null,d=null;for(p in n){var h=n[p];if(n.hasOwnProperty(p)&&null!=h)switch(p){case"checked":case"value":break;case"defaultValue":c=h;default:i.hasOwnProperty(p)||md(e,t,p,null,i,h)}}for(var f in i){var p=i[f];if(h=n[f],i.hasOwnProperty(f)&&(null!=p||null!=h))switch(f){case"type":o=p;break;case"name":a=p;break;case"checked":u=p;break;case"defaultChecked":d=p;break;case"value":s=p;break;case"defaultValue":l=p;break;case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(r(137,t));break;default:p!==h&&md(e,t,f,p,i,h)}}return void St(e,s,l,c,u,d,o,a);case"select":for(o in p=s=l=f=null,n)if(c=n[o],n.hasOwnProperty(o)&&null!=c)switch(o){case"value":break;case"multiple":p=c;default:i.hasOwnProperty(o)||md(e,t,o,null,i,c)}for(a in i)if(o=i[a],c=n[a],i.hasOwnProperty(a)&&(null!=o||null!=c))switch(a){case"value":f=o;break;case"defaultValue":l=o;break;case"multiple":s=o;default:o!==c&&md(e,t,a,o,i,c)}return t=l,n=s,i=p,void(null!=f?Tt(e,!!n,f,!1):!!i!=!!n&&(null!=t?Tt(e,!!n,t,!0):Tt(e,!!n,n?[]:"",!1)));case"textarea":for(l in p=f=null,n)if(a=n[l],n.hasOwnProperty(l)&&null!=a&&!i.hasOwnProperty(l))switch(l){case"value":case"children":break;default:md(e,t,l,null,i,a)}for(s in i)if(a=i[s],o=n[s],i.hasOwnProperty(s)&&(null!=a||null!=o))switch(s){case"value":f=a;break;case"defaultValue":p=a;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=a)throw Error(r(91));break;default:a!==o&&md(e,t,s,a,i,o)}return void Ct(e,f,p);case"option":for(var m in n)f=n[m],n.hasOwnProperty(m)&&null!=f&&!i.hasOwnProperty(m)&&("selected"===m?e.selected=!1:md(e,t,m,null,i,f));for(c in i)f=i[c],p=n[c],!i.hasOwnProperty(c)||f===p||null==f&&null==p||("selected"===c?e.selected=f&&"function"!=typeof f&&"symbol"!=typeof f:md(e,t,c,f,i,p));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)f=n[g],n.hasOwnProperty(g)&&null!=f&&!i.hasOwnProperty(g)&&md(e,t,g,null,i,f);for(u in i)if(f=i[u],p=n[u],i.hasOwnProperty(u)&&f!==p&&(null!=f||null!=p))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(r(137,t));break;default:md(e,t,u,f,i,p)}return;default:if(It(t)){for(var v in n)f=n[v],n.hasOwnProperty(v)&&void 0!==f&&!i.hasOwnProperty(v)&&gd(e,t,v,void 0,i,f);for(d in i)f=i[d],p=n[d],!i.hasOwnProperty(d)||f===p||void 0===f&&void 0===p||gd(e,t,d,f,i,p);return}}for(var y in n)f=n[y],n.hasOwnProperty(y)&&null!=f&&!i.hasOwnProperty(y)&&md(e,t,y,null,i,f);for(h in i)f=i[h],p=n[h],!i.hasOwnProperty(h)||f===p||null==f&&null==p||md(e,t,h,f,i,p)}(i,e.type,n,t),i[Xe]=t}catch(a){Au(e,e.return,a)}}function kl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&Nd(e.type)||4===e.tag}function Rl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||kl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&Nd(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Nl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Ot));else if(4!==r&&(27===r&&Nd(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(Nl(e,t,n),e=e.sibling;null!==e;)Nl(e,t,n),e=e.sibling}function Pl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&(27===r&&Nd(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(Pl(e,t,n),e=e.sibling;null!==e;)Pl(e,t,n),e=e.sibling}function Il(e){var t=e.stateNode,n=e.memoizedProps;try{for(var r=e.type,i=t.attributes;i.length;)t.removeAttributeNode(i[0]);vd(t,r,n),t[$e]=e,t[Xe]=n}catch(a){Au(e,e.return,a)}}var Ll=!1,Dl=!1,zl=!1,Ol="function"==typeof WeakSet?WeakSet:Set,Ul=null;function Fl(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:Ql(e,n),4&r&&_l(5,n);break;case 1:if(Ql(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(o){Au(n,n.return,o)}else{var i=As(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(i,t,e.__reactInternalSnapshotBeforeUpdate)}catch(s){Au(n,n.return,s)}}64&r&&Sl(n),512&r&&El(n,n.return);break;case 3:if(Ql(e,n),64&r&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{Na(e,t)}catch(o){Au(n,n.return,o)}}break;case 27:null===t&&4&r&&Il(n);case 26:case 5:Ql(e,n),null===t&&4&r&&Cl(n),512&r&&El(n,n.return);break;case 12:Ql(e,n);break;case 31:Ql(e,n),4&r&&Wl(e,n);break;case 13:Ql(e,n),4&r&&$l(e,n),64&r&&null!==(e=n.memoizedState)&&null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$~"===e.data)e._reactRetry=t;else if("$?"!==e.data||"loading"!==n.readyState)t();else{var r=function(){t(),n.removeEventListener("DOMContentLoaded",r)};n.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}(e,n=Pu.bind(null,n));break;case 22:if(!(r=null!==n.memoizedState||Ll)){t=null!==t&&null!==t.memoizedState||Dl,i=Ll;var a=Dl;Ll=r,(Dl=t)&&!a?tc(e,n,!!(8772&n.subtreeFlags)):Ql(e,n),Ll=i,Dl=a}break;case 30:break;default:Ql(e,n)}}function Bl(e){var t=e.alternate;null!==t&&(e.alternate=null,Bl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&et(t),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var jl=null,Hl=!1;function Vl(e,t,n){for(n=n.child;null!==n;)Gl(e,t,n),n=n.sibling}function Gl(e,t,n){if(Se&&"function"==typeof Se.onCommitFiberUnmount)try{Se.onCommitFiberUnmount(we,n)}catch(a){}switch(n.tag){case 26:Dl||Tl(n,t),Vl(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:Dl||Tl(n,t);var r=jl,i=Hl;Nd(n.type)&&(jl=n.stateNode,Hl=!1),Vl(e,t,n),Vd(n.stateNode),jl=r,Hl=i;break;case 5:Dl||Tl(n,t);case 6:if(r=jl,i=Hl,jl=null,Vl(e,t,n),Hl=i,null!==(jl=r))if(Hl)try{(9===jl.nodeType?jl.body:"HTML"===jl.nodeName?jl.ownerDocument.body:jl).removeChild(n.stateNode)}catch(o){Au(n,t,o)}else try{jl.removeChild(n.stateNode)}catch(o){Au(n,t,o)}break;case 18:null!==jl&&(Hl?(Pd(9===(e=jl).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Yh(e)):Pd(jl,n.stateNode));break;case 4:r=jl,i=Hl,jl=n.stateNode.containerInfo,Hl=!0,Vl(e,t,n),jl=r,Hl=i;break;case 0:case 11:case 14:case 15:wl(2,n,t),Dl||wl(4,n,t),Vl(e,t,n);break;case 1:Dl||(Tl(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount&&Ml(n,t,r)),Vl(e,t,n);break;case 21:Vl(e,t,n);break;case 22:Dl=(r=Dl)||null!==n.memoizedState,Vl(e,t,n),Dl=r;break;default:Vl(e,t,n)}}function Wl(e,t){if(null===t.memoizedState&&null!==(e=t.alternate)&&null!==(e=e.memoizedState)){e=e.dehydrated;try{Yh(e)}catch(n){Au(t,t.return,n)}}}function $l(e,t){if(null===t.memoizedState&&null!==(e=t.alternate)&&null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))try{Yh(e)}catch(n){Au(t,t.return,n)}}function Xl(e,t){var n=function(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Ol),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Ol),t;default:throw Error(r(435,e.tag))}}(e);t.forEach(function(t){if(!n.has(t)){n.add(t);var r=Iu.bind(null,e,t);t.then(r,r)}})}function ql(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var a=n[i],o=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 27:if(Nd(l.type)){jl=l.stateNode,Hl=!1;break e}break;case 5:jl=l.stateNode,Hl=!1;break e;case 3:case 4:jl=l.stateNode.containerInfo,Hl=!0;break e}l=l.return}if(null===jl)throw Error(r(160));Gl(o,s,a),jl=null,Hl=!1,null!==(o=a.alternate)&&(o.return=null),a.return=null}if(13886&t.subtreeFlags)for(t=t.child;null!==t;)Zl(t,e),t=t.sibling}var Yl=null;function Zl(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:ql(t,e),Kl(e),4&i&&(wl(3,e,e.return),_l(3,e),wl(5,e,e.return));break;case 1:ql(t,e),Kl(e),512&i&&(Dl||null===n||Tl(n,n.return)),64&i&&Ll&&null!==(e=e.updateQueue)&&null!==(i=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?i:n.concat(i));break;case 26:var a=Yl;if(ql(t,e),Kl(e),512&i&&(Dl||null===n||Tl(n,n.return)),4&i){var o=null!==n?n.memoizedState:null;if(i=e.memoizedState,null===n)if(null===i)if(null===e.stateNode){e:{i=e.type,n=e.memoizedProps,a=a.ownerDocument||a;t:switch(i){case"title":(!(o=a.getElementsByTagName("title")[0])||o[Qe]||o[$e]||"http://www.w3.org/2000/svg"===o.namespaceURI||o.hasAttribute("itemprop"))&&(o=a.createElement(i),a.head.insertBefore(o,a.querySelector("head > title"))),vd(o,i,n),o[$e]=e,at(o),i=o;break e;case"link":var s=sh("link","href",a).get(i+(n.href||""));if(s)for(var l=0;l<s.length;l++)if((o=s[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&o.getAttribute("rel")===(null==n.rel?null:n.rel)&&o.getAttribute("title")===(null==n.title?null:n.title)&&o.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){s.splice(l,1);break t}vd(o=a.createElement(i),i,n),a.head.appendChild(o);break;case"meta":if(s=sh("meta","content",a).get(i+(n.content||"")))for(l=0;l<s.length;l++)if((o=s[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&o.getAttribute("name")===(null==n.name?null:n.name)&&o.getAttribute("property")===(null==n.property?null:n.property)&&o.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&o.getAttribute("charset")===(null==n.charSet?null:n.charSet)){s.splice(l,1);break t}vd(o=a.createElement(i),i,n),a.head.appendChild(o);break;default:throw Error(r(468,i))}o[$e]=e,at(o),i=o}e.stateNode=i}else lh(a,e.type,e.stateNode);else e.stateNode=nh(a,i,e.memoizedProps);else o!==i?(null===o?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):o.count--,null===i?lh(a,e.type,e.stateNode):nh(a,i,e.memoizedProps)):null===i&&null!==e.stateNode&&Al(e,e.memoizedProps,n.memoizedProps)}break;case 27:ql(t,e),Kl(e),512&i&&(Dl||null===n||Tl(n,n.return)),null!==n&&4&i&&Al(e,e.memoizedProps,n.memoizedProps);break;case 5:if(ql(t,e),Kl(e),512&i&&(Dl||null===n||Tl(n,n.return)),32&e.flags){a=e.stateNode;try{kt(a,"")}catch(m){Au(e,e.return,m)}}4&i&&null!=e.stateNode&&Al(e,a=e.memoizedProps,null!==n?n.memoizedProps:a),1024&i&&(zl=!0);break;case 6:if(ql(t,e),Kl(e),4&i){if(null===e.stateNode)throw Error(r(162));i=e.memoizedProps,n=e.stateNode;try{n.nodeValue=i}catch(m){Au(e,e.return,m)}}break;case 3:if(oh=null,a=Yl,Yl=$d(t.containerInfo),ql(t,e),Yl=a,Kl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Yh(t.containerInfo)}catch(m){Au(e,e.return,m)}zl&&(zl=!1,Jl(e));break;case 4:i=Yl,Yl=$d(e.stateNode.containerInfo),ql(t,e),Kl(e),Yl=i;break;case 12:default:ql(t,e),Kl(e);break;case 31:case 19:ql(t,e),Kl(e),4&i&&null!==(i=e.updateQueue)&&(e.updateQueue=null,Xl(e,i));break;case 13:ql(t,e),Kl(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==n&&null!==n.memoizedState)&&(Oc=fe()),4&i&&null!==(i=e.updateQueue)&&(e.updateQueue=null,Xl(e,i));break;case 22:a=null!==e.memoizedState;var c=null!==n&&null!==n.memoizedState,u=Ll,d=Dl;if(Ll=u||a,Dl=d||c,ql(t,e),Dl=d,Ll=u,Kl(e),8192&i)e:for(t=e.stateNode,t._visibility=a?-2&t._visibility:1|t._visibility,a&&(null===n||c||Ll||Dl||ec(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t;try{if(o=c.stateNode,a)"function"==typeof(s=o.style).setProperty?s.setProperty("display","none","important"):s.display="none";else{l=c.stateNode;var h=c.memoizedProps.style,f=null!=h&&h.hasOwnProperty("display")?h.display:null;l.style.display=null==f||"boolean"==typeof f?"":(""+f).trim()}}catch(m){Au(c,c.return,m)}}}else if(6===t.tag){if(null===n){c=t;try{c.stateNode.nodeValue=a?"":c.memoizedProps}catch(m){Au(c,c.return,m)}}}else if(18===t.tag){if(null===n){c=t;try{var p=c.stateNode;a?Id(p,!0):Id(c.stateNode,!1)}catch(m){Au(c,c.return,m)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&i&&null!==(i=e.updateQueue)&&null!==(n=i.retryQueue)&&(i.retryQueue=null,Xl(e,n));case 30:case 21:}}function Kl(e){var t=e.flags;if(2&t){try{for(var n,i=e.return;null!==i;){if(kl(i)){n=i;break}i=i.return}if(null==n)throw Error(r(160));switch(n.tag){case 27:var a=n.stateNode;Pl(e,Rl(e),a);break;case 5:var o=n.stateNode;32&n.flags&&(kt(o,""),n.flags&=-33),Pl(e,Rl(e),o);break;case 3:case 4:var s=n.stateNode.containerInfo;Nl(e,Rl(e),s);break;default:throw Error(r(161))}}catch(l){Au(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Jl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Jl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Ql(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Fl(e,t.alternate,t),t=t.sibling}function ec(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:wl(4,t,t.return),ec(t);break;case 1:Tl(t,t.return);var n=t.stateNode;"function"==typeof n.componentWillUnmount&&Ml(t,t.return,n),ec(t);break;case 27:Vd(t.stateNode);case 26:case 5:Tl(t,t.return),ec(t);break;case 22:null===t.memoizedState&&ec(t);break;default:ec(t)}e=e.sibling}}function tc(e,t,n){for(n=n&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,i=e,a=t,o=a.flags;switch(a.tag){case 0:case 11:case 15:tc(i,a,n),_l(4,a);break;case 1:if(tc(i,a,n),"function"==typeof(i=(r=a).stateNode).componentDidMount)try{i.componentDidMount()}catch(c){Au(r,r.return,c)}if(null!==(i=(r=a).updateQueue)){var s=r.stateNode;try{var l=i.shared.hiddenCallbacks;if(null!==l)for(i.shared.hiddenCallbacks=null,i=0;i<l.length;i++)Ra(l[i],s)}catch(c){Au(r,r.return,c)}}n&&64&o&&Sl(a),El(a,a.return);break;case 27:Il(a);case 26:case 5:tc(i,a,n),n&&null===r&&4&o&&Cl(a),El(a,a.return);break;case 12:tc(i,a,n);break;case 31:tc(i,a,n),n&&4&o&&Wl(i,a);break;case 13:tc(i,a,n),n&&4&o&&$l(i,a);break;case 22:null===a.memoizedState&&tc(i,a,n),El(a,a.return);break;case 30:break;default:tc(i,a,n)}t=t.sibling}}function nc(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Wi(n))}function rc(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Wi(e))}function ic(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)ac(e,t,n,r),t=t.sibling}function ac(e,t,n,r){var i=t.flags;switch(t.tag){case 0:case 11:case 15:ic(e,t,n,r),2048&i&&_l(9,t);break;case 1:case 31:case 13:default:ic(e,t,n,r);break;case 3:ic(e,t,n,r),2048&i&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Wi(e)));break;case 12:if(2048&i){ic(e,t,n,r),e=t.stateNode;try{var a=t.memoizedProps,o=a.id,s=a.onPostCommit;"function"==typeof s&&s(o,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){Au(t,t.return,l)}}else ic(e,t,n,r);break;case 23:break;case 22:a=t.stateNode,o=t.alternate,null!==t.memoizedState?2&a._visibility?ic(e,t,n,r):sc(e,t):2&a._visibility?ic(e,t,n,r):(a._visibility|=2,oc(e,t,n,r,!!(10256&t.subtreeFlags)||!1)),2048&i&&nc(o,t);break;case 24:ic(e,t,n,r),2048&i&&rc(t.alternate,t)}}function oc(e,t,n,r,i){for(i=i&&(!!(10256&t.subtreeFlags)||!1),t=t.child;null!==t;){var a=e,o=t,s=n,l=r,c=o.flags;switch(o.tag){case 0:case 11:case 15:oc(a,o,s,l,i),_l(8,o);break;case 23:break;case 22:var u=o.stateNode;null!==o.memoizedState?2&u._visibility?oc(a,o,s,l,i):sc(a,o):(u._visibility|=2,oc(a,o,s,l,i)),i&&2048&c&&nc(o.alternate,o);break;case 24:oc(a,o,s,l,i),i&&2048&c&&rc(o.alternate,o);break;default:oc(a,o,s,l,i)}t=t.sibling}}function sc(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,i=r.flags;switch(r.tag){case 22:sc(n,r),2048&i&&nc(r.alternate,r);break;case 24:sc(n,r),2048&i&&rc(r.alternate,r);break;default:sc(n,r)}t=t.sibling}}var lc=8192;function cc(e,t,n){if(e.subtreeFlags&lc)for(e=e.child;null!==e;)uc(e,t,n),e=e.sibling}function uc(e,t,n){switch(e.tag){case 26:cc(e,t,n),e.flags&lc&&null!==e.memoizedState&&function(e,t,n,r){if(!("stylesheet"!==n.type||"string"==typeof r.media&&!1===matchMedia(r.media).matches||4&n.state.loading)){if(null===n.instance){var i=Kd(r.href),a=t.querySelector(Jd(i));if(a)return null!==(t=a._p)&&"object"==typeof t&&"function"==typeof t.then&&(e.count++,e=dh.bind(e),t.then(e,e)),n.state.loading|=4,n.instance=a,void at(a);a=t.ownerDocument||t,r=Qd(r),(i=Gd.get(i))&&ih(r,i),at(a=a.createElement("link"));var o=a;o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),vd(a,"link",r),n.instance=a}null===e.stylesheets&&(e.stylesheets=new Map),e.stylesheets.set(n,t),(t=n.state.preload)&&!(3&n.state.loading)&&(e.count++,n=dh.bind(e),t.addEventListener("load",n),t.addEventListener("error",n))}}(n,Yl,e.memoizedState,e.memoizedProps);break;case 5:default:cc(e,t,n);break;case 3:case 4:var r=Yl;Yl=$d(e.stateNode.containerInfo),cc(e,t,n),Yl=r;break;case 22:null===e.memoizedState&&(null!==(r=e.alternate)&&null!==r.memoizedState?(r=lc,lc=16777216,cc(e,t,n),lc=r):cc(e,t,n))}}function dc(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function hc(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Ul=r,mc(r,e)}dc(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)fc(e),e=e.sibling}function fc(e){switch(e.tag){case 0:case 11:case 15:hc(e),2048&e.flags&&wl(9,e,e.return);break;case 3:case 12:default:hc(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,pc(e)):hc(e)}}function pc(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Ul=r,mc(r,e)}dc(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:wl(8,t,t.return),pc(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,pc(t));break;default:pc(t)}e=e.sibling}}function mc(e,t){for(;null!==Ul;){var n=Ul;switch(n.tag){case 0:case 11:case 15:wl(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:Wi(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,Ul=r;else e:for(n=e;null!==Ul;){var i=(r=Ul).sibling,a=r.return;if(Bl(r),r===n){Ul=null;break e}if(null!==i){i.return=a,Ul=i;break e}Ul=a}}}var gc={getCacheForType:function(e){var t=Oi(Vi),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n},cacheSignal:function(){return Oi(Vi).controller.signal}},vc="function"==typeof WeakMap?WeakMap:Map,yc=0,bc=null,xc=null,_c=0,wc=0,Sc=null,Mc=!1,Ec=!1,Tc=!1,Cc=0,Ac=0,kc=0,Rc=0,Nc=0,Pc=0,Ic=0,Lc=null,Dc=null,zc=!1,Oc=0,Uc=0,Fc=1/0,Bc=null,jc=null,Hc=0,Vc=null,Gc=null,Wc=0,$c=0,Xc=null,qc=null,Yc=0,Zc=null;function Kc(){return 2&yc&&0!==_c?_c&-_c:null!==F.T?Xu():Ve()}function Jc(){if(0===Pc)if(536870912&_c&&!gi)Pc=536870912;else{var e=ke;!(3932160&(ke<<=1))&&(ke=262144),Pc=e}return null!==(e=Oa.current)&&(e.flags|=32),Pc}function Qc(e,t,n){(e!==bc||2!==wc&&9!==wc)&&null===e.cancelPendingCommit||(ou(e,0),ru(e,_c,Pc,!1)),Oe(e,n),2&yc&&e===bc||(e===bc&&(!(2&yc)&&(Rc|=n),4===Ac&&ru(e,_c,Pc,!1)),Bu(e))}function eu(e,t,n){if(6&yc)throw Error(r(327));for(var i=!n&&!(127&t)&&0===(t&e.expiredLanes)||Ie(e,t),a=i?function(e,t){var n=yc;yc|=2;var i=cu(),a=uu();bc!==e||_c!==t?(Bc=null,Fc=fe()+500,ou(e,t)):Ec=Ie(e,t);e:for(;;)try{if(0!==wc&&null!==xc){t=xc;var o=Sc;t:switch(wc){case 1:wc=0,Sc=null,vu(e,t,o,1);break;case 2:case 9:if(oa(o)){wc=0,Sc=null,gu(t);break}t=function(){2!==wc&&9!==wc||bc!==e||(wc=7),Bu(e)},o.then(t,t);break e;case 3:wc=7;break e;case 4:wc=5;break e;case 7:oa(o)?(wc=0,Sc=null,gu(t)):(wc=0,Sc=null,vu(e,t,o,7));break;case 5:var s=null;switch(xc.tag){case 26:s=xc.memoizedState;case 5:case 27:var l=xc;if(s?ch(s):l.stateNode.complete){wc=0,Sc=null;var c=l.sibling;if(null!==c)xc=c;else{var u=l.return;null!==u?(xc=u,yu(u)):xc=null}break t}}wc=0,Sc=null,vu(e,t,o,5);break;case 6:wc=0,Sc=null,vu(e,t,o,6);break;case 8:au(),Ac=6;break e;default:throw Error(r(462))}}pu();break}catch(d){su(e,d)}return ki=Ai=null,F.H=i,F.A=a,yc=n,null!==xc?0:(bc=null,_c=0,Dr(),Ac)}(e,t):hu(e,t,!0),o=i;;){if(0===a){Ec&&!i&&ru(e,t,0,!1);break}if(n=e.current.alternate,!o||nu(n)){if(2===a){if(o=t,e.errorRecoveryDisabledLanes&o)var s=0;else s=0!=(s=-536870913&e.pendingLanes)?s:536870912&s?536870912:0;if(0!==s){t=s;e:{var l=e;a=Lc;var c=l.current.memoizedState.isDehydrated;if(c&&(ou(l,s).flags|=256),2!==(s=hu(l,s,!1))){if(Tc&&!c){l.errorRecoveryDisabledLanes|=o,Rc|=o,a=4;break e}o=Dc,Dc=a,null!==o&&(null===Dc?Dc=o:Dc.push.apply(Dc,o))}a=s}if(o=!1,2!==a)continue}}if(1===a){ou(e,0),ru(e,t,0,!0);break}e:{switch(i=e,o=a){case 0:case 1:throw Error(r(345));case 4:if((4194048&t)!==t)break;case 6:ru(i,t,Pc,!Mc);break e;case 2:Dc=null;break;case 3:case 5:break;default:throw Error(r(329))}if((62914560&t)===t&&10<(a=Oc+300-fe())){if(ru(i,t,Pc,!Mc),0!==Pe(i,0,!0))break e;Wc=t,i.timeoutHandle=Td(tu.bind(null,i,n,Dc,Bc,zc,t,Pc,Rc,Ic,Mc,o,"Throttled",-0,0),a)}else tu(i,n,Dc,Bc,zc,t,Pc,Rc,Ic,Mc,o,null,-0,0)}break}a=hu(e,t,!1),o=!1}Bu(e)}function tu(e,t,n,r,i,a,o,s,l,c,u,d,h,f){if(e.timeoutHandle=-1,8192&(d=t.subtreeFlags)||!(16785408&~d)){uc(t,a,d={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ot});var p=(62914560&a)===a?Oc-fe():(4194048&a)===a?Uc-fe():0;if(null!==(p=function(e,t){return e.stylesheets&&0===e.count&&fh(e,e.stylesheets),0<e.count||0<e.imgCount?function(n){var r=setTimeout(function(){if(e.stylesheets&&fh(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4+t);0<e.imgBytes&&0===uh&&(uh=62500*function(){if("function"==typeof performance.getEntriesByType){for(var e=0,t=0,n=performance.getEntriesByType("resource"),r=0;r<n.length;r++){var i=n[r],a=i.transferSize,o=i.initiatorType,s=i.duration;if(a&&s&&yd(o)){for(o=0,s=i.responseEnd,r+=1;r<n.length;r++){var l=n[r],c=l.startTime;if(c>s)break;var u=l.transferSize,d=l.initiatorType;u&&yd(d)&&(o+=u*((l=l.responseEnd)<s?1:(s-c)/(l-c)))}if(--r,t+=8*(a+o)/(i.duration/1e3),10<++e)break}}if(0<e)return t/e/1e6}return navigator.connection&&"number"==typeof(e=navigator.connection.downlink)?e:5}());var i=setTimeout(function(){if(e.waitingForImages=!1,0===e.count&&(e.stylesheets&&fh(e,e.stylesheets),e.unsuspend)){var t=e.unsuspend;e.unsuspend=null,t()}},(e.imgBytes>uh?50:800)+t);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(r),clearTimeout(i)}}:null}(d,p)))return Wc=a,e.cancelPendingCommit=p(xu.bind(null,e,t,a,n,r,i,o,s,l,u,d,null,h,f)),void ru(e,a,o,!c)}xu(e,t,a,n,r,i,o,s,l)}function nu(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&null!==(n=t.updateQueue)&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!rr(a(),i))return!1}catch(o){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ru(e,t,n,r){t&=~Nc,t&=~Rc,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var i=t;0<i;){var a=31-Ee(i),o=1<<a;r[a]=-1,i&=~o}0!==n&&Ue(e,n,t)}function iu(){return!!(6&yc)||(ju(0),!1)}function au(){if(null!==xc){if(0===wc)var e=xc.return;else ki=Ai=null,ho(e=xc),ha=null,fa=0,e=xc;for(;null!==e;)xl(e.alternate,e),e=e.return;xc=null}}function ou(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,Cd(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Wc=0,au(),bc=e,xc=n=Wr(e.current,null),_c=t,wc=0,Sc=null,Mc=!1,Ec=Ie(e,t),Tc=!1,Ic=Pc=Nc=Rc=kc=Ac=0,Dc=Lc=null,zc=!1,8&t&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var i=31-Ee(r),a=1<<i;t|=e[i],r&=~a}return Cc=t,Dr(),n}function su(e,t){Xa=null,F.H=xs,t===na||t===ia?(t=ua(),wc=3):t===ra?(t=ua(),wc=4):wc=t===Os?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,Sc=t,null===xc&&(Ac=1,Ps(e,Qr(t,e.current)))}function lu(){var e=Oa.current;return null===e||((4194048&_c)===_c?null===Ua:!!((62914560&_c)===_c||536870912&_c)&&e===Ua)}function cu(){var e=F.H;return F.H=xs,null===e?xs:e}function uu(){var e=F.A;return F.A=gc,e}function du(){Ac=4,Mc||(4194048&_c)!==_c&&null!==Oa.current||(Ec=!0),!(134217727&kc)&&!(134217727&Rc)||null===bc||ru(bc,_c,Pc,!1)}function hu(e,t,n){var r=yc;yc|=2;var i=cu(),a=uu();bc===e&&_c===t||(Bc=null,ou(e,t)),t=!1;var o=Ac;e:for(;;)try{if(0!==wc&&null!==xc){var s=xc,l=Sc;switch(wc){case 8:au(),o=6;break e;case 3:case 2:case 9:case 6:null===Oa.current&&(t=!0);var c=wc;if(wc=0,Sc=null,vu(e,s,l,c),n&&Ec){o=0;break e}break;default:c=wc,wc=0,Sc=null,vu(e,s,l,c)}}fu(),o=Ac;break}catch(u){su(e,u)}return t&&e.shellSuspendCounter++,ki=Ai=null,yc=r,F.H=i,F.A=a,null===xc&&(bc=null,_c=0,Dr()),o}function fu(){for(;null!==xc;)mu(xc)}function pu(){for(;null!==xc&&!de();)mu(xc)}function mu(e){var t=dl(e.alternate,e,Cc);e.memoizedProps=e.pendingProps,null===t?yu(e):xc=t}function gu(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Zs(n,t,t.pendingProps,t.type,void 0,_c);break;case 11:t=Zs(n,t,t.pendingProps,t.type.render,t.ref,_c);break;case 5:ho(t);default:xl(n,t),t=dl(n,t=xc=$r(t,Cc),Cc)}e.memoizedProps=e.pendingProps,null===t?yu(e):xc=t}function vu(e,t,n,i){ki=Ai=null,ho(t),ha=null,fa=0;var a=t.return;try{if(function(e,t,n,i,a){if(n.flags|=32768,null!==i&&"object"==typeof i&&"function"==typeof i.then){if(null!==(t=n.alternate)&&Li(t,n,a,!0),null!==(n=Oa.current)){switch(n.tag){case 31:case 13:return null===Ua?du():null===n.alternate&&0===Ac&&(Ac=3),n.flags&=-257,n.flags|=65536,n.lanes=a,i===aa?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([i]):t.add(i),ku(e,i,a)),!1;case 22:return n.flags|=65536,i===aa?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([i])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([i]):n.add(i),ku(e,i,a)),!1}throw Error(r(435,n.tag))}return ku(e,i,a),du(),!1}if(gi)return null!==(t=Oa.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=a,i!==bi&&Ti(Qr(e=Error(r(422),{cause:i}),n))):(i!==bi&&Ti(Qr(t=Error(r(423),{cause:i}),n)),(e=e.current.alternate).flags|=65536,a&=-a,e.lanes|=a,i=Qr(i,n),Ta(e,a=Ls(e.stateNode,i,a)),4!==Ac&&(Ac=2)),!1;var o=Error(r(520),{cause:i});if(o=Qr(o,n),null===Lc?Lc=[o]:Lc.push(o),4!==Ac&&(Ac=2),null===t)return!0;i=Qr(i,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=a&-a,n.lanes|=e,Ta(n,e=Ls(n.stateNode,i,e)),!1;case 1:if(t=n.type,o=n.stateNode,!(128&n.flags||"function"!=typeof t.getDerivedStateFromError&&(null===o||"function"!=typeof o.componentDidCatch||null!==jc&&jc.has(o))))return n.flags|=65536,a&=-a,n.lanes|=a,zs(a=Ds(a),e,n,i),Ta(n,a),!1}n=n.return}while(null!==n);return!1}(e,a,t,n,_c))return Ac=1,Ps(e,Qr(n,e.current)),void(xc=null)}catch(o){if(null!==a)throw xc=a,o;return Ac=1,Ps(e,Qr(n,e.current)),void(xc=null)}32768&t.flags?(gi||1===i?e=!0:Ec||536870912&_c?e=!1:(Mc=e=!0,(2===i||9===i||3===i||6===i)&&null!==(i=Oa.current)&&13===i.tag&&(i.flags|=16384)),bu(t,e)):yu(t)}function yu(e){var t=e;do{if(32768&t.flags)return void bu(t,Mc);e=t.return;var n=yl(t.alternate,t,Cc);if(null!==n)return void(xc=n);if(null!==(t=t.sibling))return void(xc=t);xc=t=e}while(null!==t);0===Ac&&(Ac=5)}function bu(e,t){do{var n=bl(e.alternate,e);if(null!==n)return n.flags&=32767,void(xc=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(xc=e);xc=e=n}while(null!==e);Ac=6,xc=null}function xu(e,t,n,i,a,o,s,l,c){e.cancelPendingCommit=null;do{Eu()}while(0!==Hc);if(6&yc)throw Error(r(327));if(null!==t){if(t===e.current)throw Error(r(177));if(o=t.lanes|t.childLanes,function(e,t,n,r,i,a){var o=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var s=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=o&~n;0<n;){var u=31-Ee(n),d=1<<u;s[u]=0,l[u]=-1;var h=c[u];if(null!==h)for(c[u]=null,u=0;u<h.length;u++){var f=h[u];null!==f&&(f.lane&=-536870913)}n&=~d}0!==r&&Ue(e,r,0),0!==a&&0===i&&0!==e.tag&&(e.suspendedLanes|=a&~(o&~t))}(e,n,o|=Lr,s,l,c),e===bc&&(xc=bc=null,_c=0),Gc=t,Vc=e,Wc=n,$c=o,Xc=a,qc=i,10256&t.subtreeFlags||10256&t.flags?(e.callbackNode=null,e.callbackPriority=0,ce(ve,function(){return Tu(),null})):(e.callbackNode=null,e.callbackPriority=0),i=!!(13878&t.flags),13878&t.subtreeFlags||i){i=F.T,F.T=null,a=B.p,B.p=2,s=yc,yc|=4;try{!function(e,t){if(e=e.containerInfo,bd=Mh,cr(e=lr(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var a=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(g){n=null;break e}var s=0,l=-1,c=-1,u=0,d=0,h=e,f=null;t:for(;;){for(var p;h!==n||0!==a&&3!==h.nodeType||(l=s+a),h!==o||0!==i&&3!==h.nodeType||(c=s+i),3===h.nodeType&&(s+=h.nodeValue.length),null!==(p=h.firstChild);)f=h,h=p;for(;;){if(h===e)break t;if(f===n&&++u===a&&(l=s),f===o&&++d===i&&(c=s),null!==(p=h.nextSibling))break;f=(h=f).parentNode}h=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(xd={focusedElem:e,selectionRange:n},Mh=!1,Ul=t;null!==Ul;)if(e=(t=Ul).child,1028&t.subtreeFlags&&null!==e)e.return=t,Ul=e;else for(;null!==Ul;){switch(o=(t=Ul).alternate,e=t.flags,t.tag){case 0:if(4&e&&null!==(e=null!==(e=t.updateQueue)?e.events:null))for(n=0;n<e.length;n++)(a=e[n]).ref.impl=a.nextImpl;break;case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(1024&e&&null!==o){e=void 0,n=t,a=o.memoizedProps,o=o.memoizedState,i=n.stateNode;try{var m=As(n.type,a);e=i.getSnapshotBeforeUpdate(m,o),i.__reactInternalSnapshotBeforeUpdate=e}catch(v){Au(n,n.return,v)}}break;case 3:if(1024&e)if(9===(n=(e=t.stateNode.containerInfo).nodeType))Ld(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Ld(e);break;default:e.textContent=""}break;default:if(1024&e)throw Error(r(163))}if(null!==(e=t.sibling)){e.return=t.return,Ul=e;break}Ul=t.return}}(e,t)}finally{yc=s,B.p=a,F.T=i}}Hc=1,_u(),wu(),Su()}}function _u(){if(1===Hc){Hc=0;var e=Vc,t=Gc,n=!!(13878&t.flags);if(13878&t.subtreeFlags||n){n=F.T,F.T=null;var r=B.p;B.p=2;var i=yc;yc|=4;try{Zl(t,e);var a=xd,o=lr(e.containerInfo),s=a.focusedElem,l=a.selectionRange;if(o!==s&&s&&s.ownerDocument&&sr(s.ownerDocument.documentElement,s)){if(null!==l&&cr(s)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in s)s.selectionStart=c,s.selectionEnd=Math.min(u,s.value.length);else{var d=s.ownerDocument||document,h=d&&d.defaultView||window;if(h.getSelection){var f=h.getSelection(),p=s.textContent.length,m=Math.min(l.start,p),g=void 0===l.end?m:Math.min(l.end,p);!f.extend&&m>g&&(o=g,g=m,m=o);var v=or(s,m),y=or(s,g);if(v&&y&&(1!==f.rangeCount||f.anchorNode!==v.node||f.anchorOffset!==v.offset||f.focusNode!==y.node||f.focusOffset!==y.offset)){var b=d.createRange();b.setStart(v.node,v.offset),f.removeAllRanges(),m>g?(f.addRange(b),f.extend(y.node,y.offset)):(b.setEnd(y.node,y.offset),f.addRange(b))}}}}for(d=[],f=s;f=f.parentNode;)1===f.nodeType&&d.push({element:f,left:f.scrollLeft,top:f.scrollTop});for("function"==typeof s.focus&&s.focus(),s=0;s<d.length;s++){var x=d[s];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}Mh=!!bd,xd=bd=null}finally{yc=i,B.p=r,F.T=n}}e.current=t,Hc=2}}function wu(){if(2===Hc){Hc=0;var e=Vc,t=Gc,n=!!(8772&t.flags);if(8772&t.subtreeFlags||n){n=F.T,F.T=null;var r=B.p;B.p=2;var i=yc;yc|=4;try{Fl(e,t.alternate,t)}finally{yc=i,B.p=r,F.T=n}}Hc=3}}function Su(){if(4===Hc||3===Hc){Hc=0,he();var e=Vc,t=Gc,n=Wc,r=qc;10256&t.subtreeFlags||10256&t.flags?Hc=5:(Hc=0,Gc=Vc=null,Mu(e,e.pendingLanes));var i=e.pendingLanes;if(0===i&&(jc=null),He(n),t=t.stateNode,Se&&"function"==typeof Se.onCommitFiberRoot)try{Se.onCommitFiberRoot(we,t,void 0,!(128&~t.current.flags))}catch(l){}if(null!==r){t=F.T,i=B.p,B.p=2,F.T=null;try{for(var a=e.onRecoverableError,o=0;o<r.length;o++){var s=r[o];a(s.value,{componentStack:s.stack})}}finally{F.T=t,B.p=i}}3&Wc&&Eu(),Bu(e),i=e.pendingLanes,261930&n&&42&i?e===Zc?Yc++:(Yc=0,Zc=e):Yc=0,ju(0)}}function Mu(e,t){0===(e.pooledCacheLanes&=t)&&null!=(t=e.pooledCache)&&(e.pooledCache=null,Wi(t))}function Eu(){return _u(),wu(),Su(),Tu()}function Tu(){if(5!==Hc)return!1;var e=Vc,t=$c;$c=0;var n=He(Wc),i=F.T,a=B.p;try{B.p=32>n?32:n,F.T=null,n=Xc,Xc=null;var o=Vc,s=Wc;if(Hc=0,Gc=Vc=null,Wc=0,6&yc)throw Error(r(331));var l=yc;if(yc|=4,fc(o.current),ac(o,o.current,s,n),yc=l,ju(0),Se&&"function"==typeof Se.onPostCommitFiberRoot)try{Se.onPostCommitFiberRoot(we,o)}catch(c){}return!0}finally{B.p=a,F.T=i,Mu(e,t)}}function Cu(e,t,n){t=Qr(n,t),null!==(e=Ma(e,t=Ls(e.stateNode,t,2),2))&&(Oe(e,2),Bu(e))}function Au(e,t,n){if(3===e.tag)Cu(e,e,n);else for(;null!==t;){if(3===t.tag){Cu(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===jc||!jc.has(r))){e=Qr(n,e),null!==(r=Ma(t,n=Ds(2),2))&&(zs(n,r,t,e),Oe(r,2),Bu(r));break}}t=t.return}}function ku(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new vc;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(Tc=!0,i.add(n),e=Ru.bind(null,e,t,n),t.then(e,e))}function Ru(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,bc===e&&(_c&n)===n&&(4===Ac||3===Ac&&(62914560&_c)===_c&&300>fe()-Oc?!(2&yc)&&ou(e,0):Nc|=n,Ic===_c&&(Ic=0)),Bu(e)}function Nu(e,t){0===t&&(t=De()),null!==(e=Ur(e,t))&&(Oe(e,t),Bu(e))}function Pu(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Nu(e,n)}function Iu(e,t){var n=0;switch(e.tag){case 31:case 13:var i=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:i=e.stateNode;break;case 22:i=e.stateNode._retryCache;break;default:throw Error(r(314))}null!==i&&i.delete(t),Nu(e,n)}var Lu=null,Du=null,zu=!1,Ou=!1,Uu=!1,Fu=0;function Bu(e){e!==Du&&null===e.next&&(null===Du?Lu=Du=e:Du=Du.next=e),Ou=!0,zu||(zu=!0,kd(function(){6&yc?ce(me,Hu):Vu()}))}function ju(e,t){if(!Uu&&Ou){Uu=!0;do{for(var n=!1,r=Lu;null!==r;){if(0!==e){var i=r.pendingLanes;if(0===i)var a=0;else{var o=r.suspendedLanes,s=r.pingedLanes;a=(1<<31-Ee(42|e)+1)-1,a=201326741&(a&=i&~(o&~s))?201326741&a|1:a?2|a:0}0!==a&&(n=!0,$u(r,a))}else a=_c,!(3&(a=Pe(r,r===bc?a:0,null!==r.cancelPendingCommit||-1!==r.timeoutHandle)))||Ie(r,a)||(n=!0,$u(r,a));r=r.next}}while(n);Uu=!1}}function Hu(){Vu()}function Vu(){Ou=zu=!1;var e,t=0;0!==Fu&&((e=window.event)&&"popstate"===e.type?e!==Ed&&(Ed=e,1):(Ed=null,0))&&(t=Fu);for(var n=fe(),r=null,i=Lu;null!==i;){var a=i.next,o=Gu(i,n);0===o?(i.next=null,null===r?Lu=a:r.next=a,null===a&&(Du=r)):(r=i,(0!==t||3&o)&&(Ou=!0)),i=a}0!==Hc&&5!==Hc||ju(t),0!==Fu&&(Fu=0)}function Gu(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=-62914561&e.pendingLanes;0<a;){var o=31-Ee(a),s=1<<o,l=i[o];-1===l?0!==(s&n)&&0===(s&r)||(i[o]=Le(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}if(n=_c,n=Pe(e,e===(t=bc)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),r=e.callbackNode,0===n||e===t&&(2===wc||9===wc)||null!==e.cancelPendingCommit)return null!==r&&null!==r&&ue(r),e.callbackNode=null,e.callbackPriority=0;if(!(3&n)||Ie(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&ue(r),He(n)){case 2:case 8:n=ge;break;case 32:default:n=ve;break;case 268435456:n=be}return r=Wu.bind(null,e),n=ce(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&ue(r),e.callbackPriority=2,e.callbackNode=null,2}function Wu(e,t){if(0!==Hc&&5!==Hc)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(Eu()&&e.callbackNode!==n)return null;var r=_c;return 0===(r=Pe(e,e===bc?r:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(eu(e,r,t),Gu(e,fe()),null!=e.callbackNode&&e.callbackNode===n?Wu.bind(null,e):null)}function $u(e,t){if(Eu())return null;eu(e,t,!0)}function Xu(){if(0===Fu){var e=qi;0===e&&(e=Ae,!(261888&(Ae<<=1))&&(Ae=256)),Fu=e}return Fu}function qu(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:zt(""+e)}function Yu(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Zu=0;Zu<kr.length;Zu++){var Ku=kr[Zu];Rr(Ku.toLowerCase(),"on"+(Ku[0].toUpperCase()+Ku.slice(1)))}Rr(_r,"onAnimationEnd"),Rr(wr,"onAnimationIteration"),Rr(Sr,"onAnimationStart"),Rr("dblclick","onDoubleClick"),Rr("focusin","onFocus"),Rr("focusout","onBlur"),Rr(Mr,"onTransitionRun"),Rr(Er,"onTransitionStart"),Rr(Tr,"onTransitionCancel"),Rr(Cr,"onTransitionEnd"),ct("onMouseEnter",["mouseout","mouseover"]),ct("onMouseLeave",["mouseout","mouseover"]),ct("onPointerEnter",["pointerout","pointerover"]),ct("onPointerLeave",["pointerout","pointerover"]),lt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),lt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),lt("onBeforeInput",["compositionend","keypress","textInput","paste"]),lt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),lt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),lt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ju="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qu=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ju));function ed(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&i.isPropagationStopped())break e;a=s,i.currentTarget=c;try{a(i)}catch(u){Nr(u)}i.currentTarget=null,a=l}else for(o=0;o<r.length;o++){if(l=(s=r[o]).instance,c=s.currentTarget,s=s.listener,l!==a&&i.isPropagationStopped())break e;a=s,i.currentTarget=c;try{a(i)}catch(u){Nr(u)}i.currentTarget=null,a=l}}}}function td(e,t){var n=t[Ye];void 0===n&&(n=t[Ye]=new Set);var r=e+"__bubble";n.has(r)||(ad(t,e,2,!1),n.add(r))}function nd(e,t,n){var r=0;t&&(r|=4),ad(n,e,r,t)}var rd="_reactListening"+Math.random().toString(36).slice(2);function id(e){if(!e[rd]){e[rd]=!0,ot.forEach(function(t){"selectionchange"!==t&&(Qu.has(t)||nd(t,!1,e),nd(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[rd]||(t[rd]=!0,nd("selectionchange",!1,t))}}function ad(e,t,n,r){switch(Nh(t)){case 2:var i=Eh;break;case 8:i=Th;break;default:i=Ch}n=i.bind(null,t,n,e),i=void 0,!Xt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function od(e,t,n,r,i){var o=r;if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var l=r.stateNode.containerInfo;if(l===i)break;if(4===s)for(s=r.return;null!==s;){var c=s.tag;if((3===c||4===c)&&s.stateNode.containerInfo===i)return;s=s.return}for(;null!==l;){if(null===(s=tt(l)))return;if(5===(c=s.tag)||6===c||26===c||27===c){r=o=s;continue e}l=l.parentNode}}r=r.return}Gt(function(){var r=o,i=Ft(n),s=[];e:{var l=Ar.get(e);if(void 0!==l){var c=ln,u=e;switch(e){case"keypress":if(0===Qt(n))break e;case"keydown":case"keyup":c=Sn;break;case"focusin":u="focus",c=pn;break;case"focusout":u="blur",c=pn;break;case"beforeblur":case"afterblur":c=pn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=hn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=En;break;case _r:case wr:case Sr:c=mn;break;case Cr:c=Tn;break;case"scroll":case"scrollend":c=un;break;case"wheel":c=Cn;break;case"copy":case"cut":case"paste":c=gn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=Mn;break;case"toggle":case"beforetoggle":c=An}var d=!!(4&t),h=!d&&("scroll"===e||"scrollend"===e),f=d?null!==l?l+"Capture":null:l;d=[];for(var p,m=r;null!==m;){var g=m;if(p=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===p||null===f||null!=(g=Wt(m,f))&&d.push(sd(m,g,p)),h)break;m=m.return}0<d.length&&(l=new c(l,u,null,n,i),s.push({event:l,listeners:d}))}}if(!(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(l="mouseover"===e||"pointerover"===e)||n===Ut||!(u=n.relatedTarget||n.fromElement)||!tt(u)&&!u[qe])&&(c||l)&&(l=i.window===i?i:(l=i.ownerDocument)?l.defaultView||l.parentWindow:window,c?(c=r,null!==(u=(u=n.relatedTarget||n.toElement)?tt(u):null)&&(h=a(u),d=u.tag,u!==h||5!==d&&27!==d&&6!==d)&&(u=null)):(c=null,u=r),c!==u)){if(d=hn,g="onMouseLeave",f="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(d=Mn,g="onPointerLeave",f="onPointerEnter",m="pointer"),h=null==c?l:rt(c),p=null==u?l:rt(u),(l=new d(g,m+"leave",c,n,i)).target=h,l.relatedTarget=p,g=null,tt(i)===r&&((d=new d(f,m+"enter",u,n,i)).target=p,d.relatedTarget=h,g=d),h=g,c&&u)e:{for(d=cd,m=u,p=0,g=f=c;g;g=d(g))p++;g=0;for(var v=m;v;v=d(v))g++;for(;0<p-g;)f=d(f),p--;for(;0<g-p;)m=d(m),g--;for(;p--;){if(f===m||null!==m&&f===m.alternate){d=f;break e}f=d(f),m=d(m)}d=null}else d=null;null!==c&&ud(s,l,c,d,!1),null!==u&&null!==h&&ud(s,h,u,d,!0)}if("select"===(c=(l=r?rt(r):window).nodeName&&l.nodeName.toLowerCase())||"input"===c&&"file"===l.type)var y=$n;else if(Bn(l))if(Xn)y=nr;else{y=er;var b=Qn}else!(c=l.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==l.type&&"radio"!==l.type?r&&It(r.elementType)&&(y=$n):y=tr;switch(y&&(y=y(e,r))?jn(s,y,n,i):(b&&b(e,l,r),"focusout"===e&&r&&"number"===l.type&&null!=r.memoizedProps.value&&Et(l,"number",l.value)),b=r?rt(r):window,e){case"focusin":(Bn(b)||"true"===b.contentEditable)&&(dr=b,hr=r,fr=null);break;case"focusout":fr=hr=dr=null;break;case"mousedown":pr=!0;break;case"contextmenu":case"mouseup":case"dragend":pr=!1,mr(s,n,i);break;case"selectionchange":if(ur)break;case"keydown":case"keyup":mr(s,n,i)}var x;if(Rn)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Un?zn(e,n)&&(_="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(_="onCompositionStart");_&&(In&&"ko"!==n.locale&&(Un||"onCompositionStart"!==_?"onCompositionEnd"===_&&Un&&(x=Jt()):(Zt="value"in(Yt=i)?Yt.value:Yt.textContent,Un=!0)),0<(b=ld(r,_)).length&&(_=new vn(_,e,null,n,i),s.push({event:_,listeners:b}),(x||null!==(x=On(n)))&&(_.data=x))),(x=Pn?function(e,t){switch(e){case"compositionend":return On(t);case"keypress":return 32!==t.which?null:(Dn=!0,Ln);case"textInput":return(e=t.data)===Ln&&Dn?null:e;default:return null}}(e,n):function(e,t){if(Un)return"compositionend"===e||!Rn&&zn(e,t)?(e=Jt(),Kt=Zt=Yt=null,Un=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return In&&"ko"!==t.locale?null:t.data}}(e,n))&&0<(_=ld(r,"onBeforeInput")).length&&(b=new vn("onBeforeInput","beforeinput",null,n,i),s.push({event:b,listeners:_}),b.data=x),function(e,t,n,r,i){if("submit"===t&&n&&n.stateNode===i){var a=qu((i[Xe]||null).action),o=r.submitter;o&&null!==(t=(t=o[Xe]||null)?qu(t.formAction):o.getAttribute("formAction"))&&(a=t,o=null);var s=new ln("action","action",null,r,i);e.push({event:s,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(0!==Fu){var e=o?Yu(i,o):new FormData(i);os(n,{pending:!0,data:e,method:i.method,action:a},null,e)}}else"function"==typeof a&&(s.preventDefault(),e=o?Yu(i,o):new FormData(i),os(n,{pending:!0,data:e,method:i.method,action:a},a,e))},currentTarget:i}]})}}(s,e,r,n,i)}ed(s,t)})}function sd(e,t,n){return{instance:e,listener:t,currentTarget:n}}function ld(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;if(5!==(i=i.tag)&&26!==i&&27!==i||null===a||(null!=(i=Wt(e,n))&&r.unshift(sd(e,i,a)),null!=(i=Wt(e,t))&&r.push(sd(e,i,a))),3===e.tag)return r;e=e.return}return[]}function cd(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function ud(e,t,n,r,i){for(var a=t._reactName,o=[];null!==n&&n!==r;){var s=n,l=s.alternate,c=s.stateNode;if(s=s.tag,null!==l&&l===r)break;5!==s&&26!==s&&27!==s||null===c||(l=c,i?null!=(c=Wt(n,a))&&o.unshift(sd(n,c,l)):i||null!=(c=Wt(n,a))&&o.push(sd(n,c,l))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var dd=/\r\n?/g,hd=/\u0000|\uFFFD/g;function fd(e){return("string"==typeof e?e:""+e).replace(dd,"\n").replace(hd,"")}function pd(e,t){return t=fd(t),fd(e)===t}function md(e,t,n,i,a,o){switch(n){case"children":"string"==typeof i?"body"===t||"textarea"===t&&""===i||kt(e,i):("number"==typeof i||"bigint"==typeof i)&&"body"!==t&&kt(e,""+i);break;case"className":pt(e,"class",i);break;case"tabIndex":pt(e,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":pt(e,n,i);break;case"style":Pt(e,i,o);break;case"data":if("object"!==t){pt(e,"data",i);break}case"src":case"href":if(""===i&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==i||"function"==typeof i||"symbol"==typeof i||"boolean"==typeof i){e.removeAttribute(n);break}i=zt(""+i),e.setAttribute(n,i);break;case"action":case"formAction":if("function"==typeof i){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof o&&("formAction"===n?("input"!==t&&md(e,t,"name",a.name,a,null),md(e,t,"formEncType",a.formEncType,a,null),md(e,t,"formMethod",a.formMethod,a,null),md(e,t,"formTarget",a.formTarget,a,null)):(md(e,t,"encType",a.encType,a,null),md(e,t,"method",a.method,a,null),md(e,t,"target",a.target,a,null))),null==i||"symbol"==typeof i||"boolean"==typeof i){e.removeAttribute(n);break}i=zt(""+i),e.setAttribute(n,i);break;case"onClick":null!=i&&(e.onclick=Ot);break;case"onScroll":null!=i&&td("scroll",e);break;case"onScrollEnd":null!=i&&td("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!=typeof i||!("__html"in i))throw Error(r(61));if(null!=(n=i.__html)){if(null!=a.children)throw Error(r(60));e.innerHTML=n}}break;case"multiple":e.multiple=i&&"function"!=typeof i&&"symbol"!=typeof i;break;case"muted":e.muted=i&&"function"!=typeof i&&"symbol"!=typeof i;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==i||"function"==typeof i||"boolean"==typeof i||"symbol"==typeof i){e.removeAttribute("xlink:href");break}n=zt(""+i),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=i&&"function"!=typeof i&&"symbol"!=typeof i?e.setAttribute(n,""+i):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&"function"!=typeof i&&"symbol"!=typeof i?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===i?e.setAttribute(n,""):!1!==i&&null!=i&&"function"!=typeof i&&"symbol"!=typeof i?e.setAttribute(n,i):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=i&&"function"!=typeof i&&"symbol"!=typeof i&&!isNaN(i)&&1<=i?e.setAttribute(n,i):e.removeAttribute(n);break;case"rowSpan":case"start":null==i||"function"==typeof i||"symbol"==typeof i||isNaN(i)?e.removeAttribute(n):e.setAttribute(n,i);break;case"popover":td("beforetoggle",e),td("toggle",e),ft(e,"popover",i);break;case"xlinkActuate":mt(e,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":mt(e,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":mt(e,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":mt(e,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":mt(e,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":mt(e,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":mt(e,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":mt(e,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":mt(e,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":ft(e,"is",i);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&ft(e,n=Lt.get(n)||n,i)}}function gd(e,t,n,i,a,o){switch(n){case"style":Pt(e,i,o);break;case"dangerouslySetInnerHTML":if(null!=i){if("object"!=typeof i||!("__html"in i))throw Error(r(61));if(null!=(n=i.__html)){if(null!=a.children)throw Error(r(60));e.innerHTML=n}}break;case"children":"string"==typeof i?kt(e,i):("number"==typeof i||"bigint"==typeof i)&&kt(e,""+i);break;case"onScroll":null!=i&&td("scroll",e);break;case"onScrollEnd":null!=i&&td("scrollend",e);break;case"onClick":null!=i&&(e.onclick=Ot);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:st.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(a=n.endsWith("Capture"),t=n.slice(2,a?n.length-7:void 0),"function"==typeof(o=null!=(o=e[Xe]||null)?o[n]:null)&&e.removeEventListener(t,o,a),"function"!=typeof i)?n in e?e[n]=i:!0===i?e.setAttribute(n,""):ft(e,n,i):("function"!=typeof o&&null!==o&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,i,a)))}}function vd(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":td("error",e),td("load",e);var i,a=!1,o=!1;for(i in n)if(n.hasOwnProperty(i)){var s=n[i];if(null!=s)switch(i){case"src":a=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,t));default:md(e,t,i,s,n,null)}}return o&&md(e,t,"srcSet",n.srcSet,n,null),void(a&&md(e,t,"src",n.src,n,null));case"input":td("invalid",e);var l=i=s=o=null,c=null,u=null;for(a in n)if(n.hasOwnProperty(a)){var d=n[a];if(null!=d)switch(a){case"name":o=d;break;case"type":s=d;break;case"checked":c=d;break;case"defaultChecked":u=d;break;case"value":i=d;break;case"defaultValue":l=d;break;case"children":case"dangerouslySetInnerHTML":if(null!=d)throw Error(r(137,t));break;default:md(e,t,a,d,n,null)}}return void Mt(e,i,l,c,u,s,o,!1);case"select":for(o in td("invalid",e),a=s=i=null,n)if(n.hasOwnProperty(o)&&null!=(l=n[o]))switch(o){case"value":i=l;break;case"defaultValue":s=l;break;case"multiple":a=l;default:md(e,t,o,l,n,null)}return t=i,n=s,e.multiple=!!a,void(null!=t?Tt(e,!!a,t,!1):null!=n&&Tt(e,!!a,n,!0));case"textarea":for(s in td("invalid",e),i=o=a=null,n)if(n.hasOwnProperty(s)&&null!=(l=n[s]))switch(s){case"value":a=l;break;case"defaultValue":o=l;break;case"children":i=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(r(91));break;default:md(e,t,s,l,n,null)}return void At(e,a,o,i);case"option":for(c in n)n.hasOwnProperty(c)&&null!=(a=n[c])&&("selected"===c?e.selected=a&&"function"!=typeof a&&"symbol"!=typeof a:md(e,t,c,a,n,null));return;case"dialog":td("beforetoggle",e),td("toggle",e),td("cancel",e),td("close",e);break;case"iframe":case"object":td("load",e);break;case"video":case"audio":for(a=0;a<Ju.length;a++)td(Ju[a],e);break;case"image":td("error",e),td("load",e);break;case"details":td("toggle",e);break;case"embed":case"source":case"link":td("error",e),td("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in n)if(n.hasOwnProperty(u)&&null!=(a=n[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,t));default:md(e,t,u,a,n,null)}return;default:if(It(t)){for(d in n)n.hasOwnProperty(d)&&void 0!==(a=n[d])&&gd(e,t,d,a,n,void 0);return}}for(l in n)n.hasOwnProperty(l)&&null!=(a=n[l])&&md(e,t,l,a,n,null)}function yd(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}var bd=null,xd=null;function _d(e){return 9===e.nodeType?e:e.ownerDocument}function wd(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Sd(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function Md(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Ed=null,Td="function"==typeof setTimeout?setTimeout:void 0,Cd="function"==typeof clearTimeout?clearTimeout:void 0,Ad="function"==typeof Promise?Promise:void 0,kd="function"==typeof queueMicrotask?queueMicrotask:void 0!==Ad?function(e){return Ad.resolve(null).then(e).catch(Rd)}:Td;function Rd(e){setTimeout(function(){throw e})}function Nd(e){return"head"===e}function Pd(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)||"/&"===n){if(0===r)return e.removeChild(i),void Yh(t);r--}else if("$"===n||"$?"===n||"$~"===n||"$!"===n||"&"===n)r++;else if("html"===n)Vd(e.ownerDocument.documentElement);else if("head"===n){Vd(n=e.ownerDocument.head);for(var a=n.firstChild;a;){var o=a.nextSibling,s=a.nodeName;a[Qe]||"SCRIPT"===s||"STYLE"===s||"LINK"===s&&"stylesheet"===a.rel.toLowerCase()||n.removeChild(a),a=o}}else"body"===n&&Vd(e.ownerDocument.body);n=i}while(n);Yh(t)}function Id(e,t){var n=e;e=0;do{var r=n.nextSibling;if(1===n.nodeType?t?(n._stashedDisplay=n.style.display,n.style.display="none"):(n.style.display=n._stashedDisplay||"",""===n.getAttribute("style")&&n.removeAttribute("style")):3===n.nodeType&&(t?(n._stashedText=n.nodeValue,n.nodeValue=""):n.nodeValue=n._stashedText||""),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===e)break;e--}else"$"!==n&&"$?"!==n&&"$~"!==n&&"$!"!==n||e++;n=r}while(n)}function Ld(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":Ld(n),et(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function Dd(e,t){for(;8!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!t)return null;if(null===(e=Ud(e.nextSibling)))return null}return e}function zd(e){return"$?"===e.data||"$~"===e.data}function Od(e){return"$!"===e.data||"$?"===e.data&&"loading"!==e.ownerDocument.readyState}function Ud(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"$~"===t||"&"===t||"F!"===t||"F"===t)break;if("/$"===t||"/&"===t)return null}}return e}var Fd=null;function Bd(e){e=e.nextSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n||"/&"===n){if(0===t)return Ud(e.nextSibling);t--}else"$"!==n&&"$!"!==n&&"$?"!==n&&"$~"!==n&&"&"!==n||t++}e=e.nextSibling}return null}function jd(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n||"$~"===n||"&"===n){if(0===t)return e;t--}else"/$"!==n&&"/&"!==n||t++}e=e.previousSibling}return null}function Hd(e,t,n){switch(t=_d(n),e){case"html":if(!(e=t.documentElement))throw Error(r(452));return e;case"head":if(!(e=t.head))throw Error(r(453));return e;case"body":if(!(e=t.body))throw Error(r(454));return e;default:throw Error(r(451))}}function Vd(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);et(e)}var Gd=new Map,Wd=new Set;function $d(e){return"function"==typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Xd=B.d;B.d={f:function(){var e=Xd.f(),t=iu();return e||t},r:function(e){var t=nt(e);null!==t&&5===t.tag&&"form"===t.type?ls(t):Xd.r(e)},D:function(e){Xd.D(e),Yd("dns-prefetch",e,null)},C:function(e,t){Xd.C(e,t),Yd("preconnect",e,t)},L:function(e,t,n){Xd.L(e,t,n);var r=qd;if(r&&e&&t){var i='link[rel="preload"][as="'+wt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(i+='[imagesrcset="'+wt(n.imageSrcSet)+'"]',"string"==typeof n.imageSizes&&(i+='[imagesizes="'+wt(n.imageSizes)+'"]')):i+='[href="'+wt(e)+'"]';var a=i;switch(t){case"style":a=Kd(e);break;case"script":a=eh(e)}Gd.has(a)||(e=u({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),Gd.set(a,e),null!==r.querySelector(i)||"style"===t&&r.querySelector(Jd(a))||"script"===t&&r.querySelector(th(a))||(vd(t=r.createElement("link"),"link",e),at(t),r.head.appendChild(t)))}},m:function(e,t){Xd.m(e,t);var n=qd;if(n&&e){var r=t&&"string"==typeof t.as?t.as:"script",i='link[rel="modulepreload"][as="'+wt(r)+'"][href="'+wt(e)+'"]',a=i;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":a=eh(e)}if(!Gd.has(a)&&(e=u({rel:"modulepreload",href:e},t),Gd.set(a,e),null===n.querySelector(i))){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(th(a)))return}vd(r=n.createElement("link"),"link",e),at(r),n.head.appendChild(r)}}},X:function(e,t){Xd.X(e,t);var n=qd;if(n&&e){var r=it(n).hoistableScripts,i=eh(e),a=r.get(i);a||((a=n.querySelector(th(i)))||(e=u({src:e,async:!0},t),(t=Gd.get(i))&&ah(e,t),at(a=n.createElement("script")),vd(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},r.set(i,a))}},S:function(e,t,n){Xd.S(e,t,n);var r=qd;if(r&&e){var i=it(r).hoistableStyles,a=Kd(e);t=t||"default";var o=i.get(a);if(!o){var s={loading:0,preload:null};if(o=r.querySelector(Jd(a)))s.loading=5;else{e=u({rel:"stylesheet",href:e,"data-precedence":t},n),(n=Gd.get(a))&&ih(e,n);var l=o=r.createElement("link");at(l),vd(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){s.loading|=1}),l.addEventListener("error",function(){s.loading|=2}),s.loading|=4,rh(o,t,r)}o={type:"stylesheet",instance:o,count:1,state:s},i.set(a,o)}}},M:function(e,t){Xd.M(e,t);var n=qd;if(n&&e){var r=it(n).hoistableScripts,i=eh(e),a=r.get(i);a||((a=n.querySelector(th(i)))||(e=u({src:e,async:!0,type:"module"},t),(t=Gd.get(i))&&ah(e,t),at(a=n.createElement("script")),vd(a,"link",e),n.head.appendChild(a)),a={type:"script",instance:a,count:1,state:null},r.set(i,a))}}};var qd="undefined"==typeof document?null:document;function Yd(e,t,n){var r=qd;if(r&&"string"==typeof t&&t){var i=wt(t);i='link[rel="'+e+'"][href="'+i+'"]',"string"==typeof n&&(i+='[crossorigin="'+n+'"]'),Wd.has(i)||(Wd.add(i),e={rel:e,crossOrigin:n,href:t},null===r.querySelector(i)&&(vd(t=r.createElement("link"),"link",e),at(t),r.head.appendChild(t)))}}function Zd(e,t,n,i){var a,o,s,l,c=(c=K.current)?$d(c):null;if(!c)throw Error(r(446));switch(e){case"meta":case"title":return null;case"style":return"string"==typeof n.precedence&&"string"==typeof n.href?(t=Kd(n.href),(i=(n=it(c).hoistableStyles).get(t))||(i={type:"style",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"==typeof n.href&&"string"==typeof n.precedence){e=Kd(n.href);var u=it(c).hoistableStyles,d=u.get(e);if(d||(c=c.ownerDocument||c,d={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,d),(u=c.querySelector(Jd(e)))&&!u._p&&(d.instance=u,d.state.loading=5),Gd.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Gd.set(e,n),u||(a=c,o=e,s=n,l=d.state,a.querySelector('link[rel="preload"][as="style"]['+o+"]")?l.loading=1:(o=a.createElement("link"),l.preload=o,o.addEventListener("load",function(){return l.loading|=1}),o.addEventListener("error",function(){return l.loading|=2}),vd(o,"link",s),at(o),a.head.appendChild(o))))),t&&null===i)throw Error(r(528,""));return d}if(t&&null!==i)throw Error(r(529,""));return null;case"script":return t=n.async,"string"==typeof(n=n.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=eh(n),(i=(n=it(c).hoistableScripts).get(t))||(i={type:"script",instance:null,count:0,state:null},n.set(t,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,e))}}function Kd(e){return'href="'+wt(e)+'"'}function Jd(e){return'link[rel="stylesheet"]['+e+"]"}function Qd(e){return u({},e,{"data-precedence":e.precedence,precedence:null})}function eh(e){return'[src="'+wt(e)+'"]'}function th(e){return"script[async]"+e}function nh(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var i=e.querySelector('style[data-href~="'+wt(n.href)+'"]');if(i)return t.instance=i,at(i),i;var a=u({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return at(i=(e.ownerDocument||e).createElement("style")),vd(i,"style",a),rh(i,n.precedence,e),t.instance=i;case"stylesheet":a=Kd(n.href);var o=e.querySelector(Jd(a));if(o)return t.state.loading|=4,t.instance=o,at(o),o;i=Qd(n),(a=Gd.get(a))&&ih(i,a),at(o=(e.ownerDocument||e).createElement("link"));var s=o;return s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),vd(o,"link",i),t.state.loading|=4,rh(o,n.precedence,e),t.instance=o;case"script":return o=eh(n.src),(a=e.querySelector(th(o)))?(t.instance=a,at(a),a):(i=n,(a=Gd.get(o))&&ah(i=u({},n),a),at(a=(e=e.ownerDocument||e).createElement("script")),vd(a,"link",i),e.head.appendChild(a),t.instance=a);case"void":return null;default:throw Error(r(443,t.type))}else"stylesheet"===t.type&&!(4&t.state.loading)&&(i=t.instance,t.state.loading|=4,rh(i,n.precedence,e));return t.instance}function rh(e,t,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=r.length?r[r.length-1]:null,a=i,o=0;o<r.length;o++){var s=r[o];if(s.dataset.precedence===t)a=s;else if(a!==i)break}a?a.parentNode.insertBefore(e,a.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function ih(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function ah(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var oh=null;function sh(e,t,n){if(null===oh){var r=new Map,i=oh=new Map;i.set(n,r)}else(r=(i=oh).get(n))||(r=new Map,i.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),i=0;i<n.length;i++){var a=n[i];if(!(a[Qe]||a[$e]||"link"===e&&"stylesheet"===a.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==a.namespaceURI){var o=a.getAttribute(t)||"";o=e+o;var s=r.get(o);s?s.push(a):r.set(o,[a])}}return r}function lh(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function ch(e){return!!("stylesheet"!==e.type||3&e.state.loading)}var uh=0;function dh(){if(this.count--,0===this.count&&(0===this.imgCount||!this.waitingForImages))if(this.stylesheets)fh(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var hh=null;function fh(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,hh=new Map,t.forEach(ph,e),hh=null,dh.call(e))}function ph(e,t){if(!(4&t.state.loading)){var n=hh.get(e);if(n)var r=n.get(null);else{n=new Map,hh.set(e,n);for(var i=e.querySelectorAll("link[data-precedence],style[data-precedence]"),a=0;a<i.length;a++){var o=i[a];"LINK"!==o.nodeName&&"not all"===o.getAttribute("media")||(n.set(o.dataset.precedence,o),r=o)}r&&n.set(null,r)}o=(i=t.instance).getAttribute("data-precedence"),(a=n.get(o)||r)===r&&n.set(null,i),n.set(o,i),this.count++,r=dh.bind(this),i.addEventListener("load",r),i.addEventListener("error",r),a?a.parentNode.insertBefore(i,a.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(i,e.firstChild),t.state.loading|=4}}var mh={$$typeof:E,Provider:null,Consumer:null,_currentValue:j,_currentValue2:j,_threadCount:0};function gh(e,t,n,r,i,a,o,s,l){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ze(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ze(0),this.hiddenUpdates=ze(null),this.identifierPrefix=r,this.onUncaughtError=i,this.onCaughtError=a,this.onRecoverableError=o,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function vh(e,t,n,r,i,a,o,s,l,c,u,d){return e=new gh(e,t,n,o,l,c,u,d,s),t=1,!0===a&&(t|=24),a=Vr(3,null,null,t),e.current=a,a.stateNode=e,(t=Gi()).refCount++,e.pooledCache=t,t.refCount++,a.memoizedState={element:r,isDehydrated:n,cache:t},_a(a),e}function yh(e){return e?e=jr:jr}function bh(e,t,n,r,i,a){i=yh(i),null===r.context?r.context=i:r.pendingContext=i,(r=Sa(t)).payload={element:n},null!==(a=void 0===a?null:a)&&(r.callback=a),null!==(n=Ma(e,r,t))&&(Qc(n,0,t),Ea(n,e,t))}function xh(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function _h(e,t){xh(e,t),(e=e.alternate)&&xh(e,t)}function wh(e){if(13===e.tag||31===e.tag){var t=Ur(e,67108864);null!==t&&Qc(t,0,67108864),_h(e,67108864)}}function Sh(e){if(13===e.tag||31===e.tag){var t=Kc(),n=Ur(e,t=je(t));null!==n&&Qc(n,0,t),_h(e,t)}}var Mh=!0;function Eh(e,t,n,r){var i=F.T;F.T=null;var a=B.p;try{B.p=2,Ch(e,t,n,r)}finally{B.p=a,F.T=i}}function Th(e,t,n,r){var i=F.T;F.T=null;var a=B.p;try{B.p=8,Ch(e,t,n,r)}finally{B.p=a,F.T=i}}function Ch(e,t,n,r){if(Mh){var i=Ah(r);if(null===i)od(e,t,r,kh,n),Bh(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return Ih=jh(Ih,e,t,n,r,i),!0;case"dragenter":return Lh=jh(Lh,e,t,n,r,i),!0;case"mouseover":return Dh=jh(Dh,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return zh.set(a,jh(zh.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Oh.set(a,jh(Oh.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Bh(e,r),4&t&&-1<Fh.indexOf(e)){for(;null!==i;){var a=nt(i);if(null!==a)switch(a.tag){case 3:if((a=a.stateNode).current.memoizedState.isDehydrated){var o=Ne(a.pendingLanes);if(0!==o){var s=a;for(s.pendingLanes|=2,s.entangledLanes|=2;o;){var l=1<<31-Ee(o);s.entanglements[1]|=l,o&=~l}Bu(a),!(6&yc)&&(Fc=fe()+500,ju(0))}}break;case 31:case 13:null!==(s=Ur(a,2))&&Qc(s,0,2),iu(),_h(a,2)}if(null===(a=Ah(r))&&od(e,t,r,kh,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else od(e,t,r,null,n)}}function Ah(e){return Rh(e=Ft(e))}var kh=null;function Rh(e){if(kh=null,null!==(e=tt(e))){var t=a(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=o(t)))return e;e=null}else if(31===n){if(null!==(e=s(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return kh=e,null}function Nh(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(pe()){case me:return 2;case ge:return 8;case ve:case ye:return 32;case be:return 268435456;default:return 32}default:return 32}}var Ph=!1,Ih=null,Lh=null,Dh=null,zh=new Map,Oh=new Map,Uh=[],Fh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Bh(e,t){switch(e){case"focusin":case"focusout":Ih=null;break;case"dragenter":case"dragleave":Lh=null;break;case"mouseover":case"mouseout":Dh=null;break;case"pointerover":case"pointerout":zh.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Oh.delete(t.pointerId)}}function jh(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==t&&null!==(t=nt(t))&&wh(t),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Hh(e){var t=tt(e.target);if(null!==t){var n=a(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=o(n)))return e.blockedOn=t,void Ge(e.priority,function(){Sh(n)})}else if(31===t){if(null!==(t=s(n)))return e.blockedOn=t,void Ge(e.priority,function(){Sh(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Vh(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Ah(e.nativeEvent);if(null!==n)return null!==(t=nt(n))&&wh(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);Ut=r,n.target.dispatchEvent(r),Ut=null,t.shift()}return!0}function Gh(e,t,n){Vh(e)&&n.delete(t)}function Wh(){Ph=!1,null!==Ih&&Vh(Ih)&&(Ih=null),null!==Lh&&Vh(Lh)&&(Lh=null),null!==Dh&&Vh(Dh)&&(Dh=null),zh.forEach(Gh),Oh.forEach(Gh)}function $h(t,n){t.blockedOn===n&&(t.blockedOn=null,Ph||(Ph=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Wh)))}var Xh=null;function qh(t){Xh!==t&&(Xh=t,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Xh===t&&(Xh=null);for(var e=0;e<t.length;e+=3){var n=t[e],r=t[e+1],i=t[e+2];if("function"!=typeof r){if(null===Rh(r||n))continue;break}var a=nt(n);null!==a&&(t.splice(e,3),e-=3,os(a,{pending:!0,data:i,method:n.method,action:r},r,i))}}))}function Yh(e){function t(t){return $h(t,e)}null!==Ih&&$h(Ih,e),null!==Lh&&$h(Lh,e),null!==Dh&&$h(Dh,e),zh.forEach(t),Oh.forEach(t);for(var n=0;n<Uh.length;n++){var r=Uh[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<Uh.length&&null===(n=Uh[0]).blockedOn;)Hh(n),null===n.blockedOn&&Uh.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(r=0;r<n.length;r+=3){var i=n[r],a=n[r+1],o=i[Xe]||null;if("function"==typeof a)o||qh(n);else if(o){var s=null;if(a&&a.hasAttribute("formAction")){if(i=a,o=a[Xe]||null)s=o.formAction;else if(null!==Rh(i))continue}else s=o.action;"function"==typeof s?n[r+1]=s:(n.splice(r,3),r-=3),qh(n)}}}function Zh(){function e(e){e.canIntercept&&"react-transition"===e.info&&e.intercept({handler:function(){return new Promise(function(e){return i=e})},focusReset:"manual",scroll:"manual"})}function t(){null!==i&&(i(),i=null),r||setTimeout(n,20)}function n(){if(!r&&!navigation.transition){var e=navigation.currentEntry;e&&null!=e.url&&navigation.navigate(e.url,{state:e.getState(),info:"react-transition",history:"replace"})}}if("object"==typeof navigation){var r=!1,i=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(n,100),function(){r=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),null!==i&&(i(),i=null)}}}function Kh(e){this._internalRoot=e}function Jh(e){this._internalRoot=e}Jh.prototype.render=Kh.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(r(409));bh(t.current,Kc(),e,t,null,null)},Jh.prototype.unmount=Kh.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;bh(e.current,2,null,e,null,null),iu(),t[qe]=null}},Jh.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ve();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Uh.length&&0!==t&&t<Uh[n].priority;n++);Uh.splice(n,0,e),0===n&&Hh(e)}};var Qh=t.version;if("19.2.0"!==Qh)throw Error(r(527,Qh,"19.2.0"));B.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(r(188));throw e=Object.keys(e).join(","),Error(r(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=a(e)))throw Error(r(188));return t!==e?null:e}for(var n=e,i=t;;){var o=n.return;if(null===o)break;var s=o.alternate;if(null===s){if(null!==(i=o.return)){n=i;continue}break}if(o.child===s.child){for(s=o.child;s;){if(s===n)return l(o),e;if(s===i)return l(o),t;s=s.sibling}throw Error(r(188))}if(n.return!==i.return)n=o,i=s;else{for(var c=!1,u=o.child;u;){if(u===n){c=!0,n=o,i=s;break}if(u===i){c=!0,i=o,n=s;break}u=u.sibling}if(!c){for(u=s.child;u;){if(u===n){c=!0,n=s,i=o;break}if(u===i){c=!0,i=s,n=o;break}u=u.sibling}if(!c)throw Error(r(189))}}if(n.alternate!==i)throw Error(r(190))}if(3!==n.tag)throw Error(r(188));return n.stateNode.current===n?e:t}(t),null===(e=null!==e?c(e):null)?null:e.stateNode};var ef={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.2.0"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var tf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tf.isDisabled&&tf.supportsFiber)try{we=tf.inject(ef),Se=tf}catch(rf){}}return v.createRoot=function(e,t){if(!i(e))throw Error(r(299));var n=!1,a="",o=ks,s=Rs,l=Ns;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(a=t.identifierPrefix),void 0!==t.onUncaughtError&&(o=t.onUncaughtError),void 0!==t.onCaughtError&&(s=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError)),t=vh(e,1,!1,null,0,n,a,null,o,s,l,Zh),e[qe]=t.current,id(e),new Kh(t)},v.hydrateRoot=function(e,t,n){if(!i(e))throw Error(r(299));var a=!1,o="",s=ks,l=Rs,c=Ns,u=null;return null!=n&&(!0===n.unstable_strictMode&&(a=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onUncaughtError&&(s=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.formState&&(u=n.formState)),(t=vh(e,1,!0,t,0,a,o,u,s,l,c,Zh)).context=yh(null),n=t.current,(o=Sa(a=je(a=Kc()))).callback=null,Ma(n,o,a),n=a,t.current.lanes=n,Oe(t,n),Bu(t),e[qe]=t.current,id(e),new Jh(t)},v.version="19.2.0",v}()),g.exports));function A(e){if("string"==typeof e||"number"==typeof e)return""+e;let t="";if(Array.isArray(e))for(let n,r=0;r<e.length;r++)""!==(n=A(e[r]))&&(t+=(t&&" ")+n);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}var k,R,N,P,I={exports:{}},L={},D={exports:{}},z={};const O=e((P||(P=1,I.exports=function(){if(N)return L;N=1;var e=d(),t=(R||(R=1,D.exports=function(){if(k)return z;k=1;var e=d(),t="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=e.useState,r=e.useEffect,i=e.useLayoutEffect,a=e.useDebugValue;function o(e){var n=e.getSnapshot;e=e.value;try{var r=n();return!t(e,r)}catch(i){return!0}}var s="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var s=t(),l=n({inst:{value:s,getSnapshot:t}}),c=l[0].inst,u=l[1];return i(function(){c.value=s,c.getSnapshot=t,o(c)&&u({inst:c})},[e,s,t]),r(function(){return o(c)&&u({inst:c}),e(function(){o(c)&&u({inst:c})})},[e]),a(s),s};return z.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:s,z}()),D.exports),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},r=t.useSyncExternalStore,i=e.useRef,a=e.useEffect,o=e.useMemo,s=e.useDebugValue;return L.useSyncExternalStoreWithSelector=function(e,t,l,c,u){var d=i(null);if(null===d.current){var h={hasValue:!1,value:null};d.current=h}else h=d.current;d=o(function(){function e(e){if(!a){if(a=!0,r=e,e=c(e),void 0!==u&&h.hasValue){var t=h.value;if(u(t,e))return i=t}return i=e}if(t=i,n(r,e))return t;var o=c(e);return void 0!==u&&u(t,o)?(r=e,t):(r=e,i=o)}var r,i,a=!1,o=void 0===l?null:l;return[function(){return e(t())},null===o?void 0:function(){return e(o())}]},[t,l,c,u]);var f=r(e,d[0],d[1]);return a(function(){h.hasValue=!0,h.value=f},[f]),s(f),f},L}()),I.exports)),U={},F=e=>{let t;const n=new Set,r=(e,r)=>{const i="function"==typeof e?e(t):e;if(!Object.is(i,t)){const e=t;t=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,a={setState:r,getState:i,getInitialState:()=>o,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{"production"!==(U?"production":void 0)&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},o=t=e(r,i,a);return a},{useDebugValue:B}=f,{useSyncExternalStoreWithSelector:j}=O,H=e=>e;function V(e,t=H,n){const r=j(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return B(r),r}const G=(e,t)=>{const n=(e=>e?F(e):F)(e),r=(e,r=t)=>V(n,e,r);return Object.assign(r,n),r};function W(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,r]of e)if(!Object.is(r,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}var $={value:()=>{}};function X(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new q(r)}function q(e){this._=e}function Y(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function Z(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=$,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}q.prototype=X.prototype={constructor:q,on:function(e,t){var n,r,i=this._,a=(r=i,(e+"").trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");if(n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!r.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:t}})),o=-1,s=a.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++o<s;)if(n=(e=a[o]).type)i[n]=Z(i[n],e.name,t);else if(null==t)for(n in i)i[n]=Z(i[n],e.name,null);return this}for(;++o<s;)if((n=(e=a[o]).type)&&(n=Y(i[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new q(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),a=0;a<n;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,n=(r=this._[e]).length;a<n;++a)r[a].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};var K="http://www.w3.org/1999/xhtml";const J={svg:"http://www.w3.org/2000/svg",xhtml:K,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Q(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),J.hasOwnProperty(t)?{space:J[t],local:e}:e}function ee(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===K&&t.documentElement.namespaceURI===K?t.createElement(e):t.createElementNS(n,e)}}function te(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function ne(e){var t=Q(e);return(t.local?te:ee)(t)}function re(){}function ie(e){return null==e?re:function(){return this.querySelector(e)}}function ae(){return[]}function oe(e){return null==e?ae:function(){return this.querySelectorAll(e)}}function se(e){return function(){return this.matches(e)}}function le(e){return function(t){return t.matches(e)}}var ce=Array.prototype.find;function ue(){return this.firstElementChild}var de=Array.prototype.filter;function he(){return Array.from(this.children)}function fe(e){return new Array(e.length)}function pe(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function me(e,t,n,r,i,a){for(var o,s=0,l=t.length,c=a.length;s<c;++s)(o=t[s])?(o.__data__=a[s],r[s]=o):n[s]=new pe(e,a[s]);for(;s<l;++s)(o=t[s])&&(i[s]=o)}function ge(e,t,n,r,i,a,o){var s,l,c,u=new Map,d=t.length,h=a.length,f=new Array(d);for(s=0;s<d;++s)(l=t[s])&&(f[s]=c=o.call(l,l.__data__,s,t)+"",u.has(c)?i[s]=l:u.set(c,l));for(s=0;s<h;++s)c=o.call(e,a[s],s,a)+"",(l=u.get(c))?(r[s]=l,l.__data__=a[s],u.delete(c)):n[s]=new pe(e,a[s]);for(s=0;s<d;++s)(l=t[s])&&u.get(f[s])===l&&(i[s]=l)}function ve(e){return e.__data__}function ye(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function be(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function xe(e){return function(){this.removeAttribute(e)}}function _e(e){return function(){this.removeAttributeNS(e.space,e.local)}}function we(e,t){return function(){this.setAttribute(e,t)}}function Se(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Me(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function Ee(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Te(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Ce(e){return function(){this.style.removeProperty(e)}}function Ae(e,t,n){return function(){this.style.setProperty(e,t,n)}}function ke(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Re(e,t){return e.style.getPropertyValue(t)||Te(e).getComputedStyle(e,null).getPropertyValue(t)}function Ne(e){return function(){delete this[e]}}function Pe(e,t){return function(){this[e]=t}}function Ie(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function Le(e){return e.trim().split(/^|\s+/)}function De(e){return e.classList||new ze(e)}function ze(e){this._node=e,this._names=Le(e.getAttribute("class")||"")}function Oe(e,t){for(var n=De(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function Ue(e,t){for(var n=De(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function Fe(e){return function(){Oe(this,e)}}function Be(e){return function(){Ue(this,e)}}function je(e,t){return function(){(t.apply(this,arguments)?Oe:Ue)(this,e)}}function He(){this.textContent=""}function Ve(e){return function(){this.textContent=e}}function Ge(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function We(){this.innerHTML=""}function $e(e){return function(){this.innerHTML=e}}function Xe(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function qe(){this.nextSibling&&this.parentNode.appendChild(this)}function Ye(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ze(){return null}function Ke(){var e=this.parentNode;e&&e.removeChild(this)}function Je(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Qe(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function et(e){return function(){var t=this.__on;if(t){for(var n,r=0,i=-1,a=t.length;r<a;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?t.length=i:delete this.__on}}}function tt(e,t,n){return function(){var r,i=this.__on,a=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(i)for(var o=0,s=i.length;o<s;++o)if((r=i[o]).type===e.type&&r.name===e.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=a,r.options=n),void(r.value=t);this.addEventListener(e.type,a,n),r={type:e.type,name:e.name,value:t,listener:a,options:n},i?i.push(r):this.__on=[r]}}function nt(e,t,n){var r=Te(e),i=r.CustomEvent;"function"==typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function rt(e,t){return function(){return nt(this,e,t)}}function it(e,t){return function(){return nt(this,e,t.apply(this,arguments))}}pe.prototype={constructor:pe,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},ze.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var at=[null];function ot(e,t){this._groups=e,this._parents=t}function st(){return new ot([[document.documentElement]],at)}function lt(e){return"string"==typeof e?new ot([[document.querySelector(e)]],[document.documentElement]):new ot([[e]],at)}function ct(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}ot.prototype=st.prototype={constructor:ot,select:function(e){"function"!=typeof e&&(e=ie(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o,s=t[i],l=s.length,c=r[i]=new Array(l),u=0;u<l;++u)(a=s[u])&&(o=e.call(a,a.__data__,u,s))&&("__data__"in a&&(o.__data__=a.__data__),c[u]=o);return new ot(r,this._parents)},selectAll:function(e){e="function"==typeof e?function(e){return function(){return null==(t=e.apply(this,arguments))?[]:Array.isArray(t)?t:Array.from(t);var t}}(e):oe(e);for(var t=this._groups,n=t.length,r=[],i=[],a=0;a<n;++a)for(var o,s=t[a],l=s.length,c=0;c<l;++c)(o=s[c])&&(r.push(e.call(o,o.__data__,c,s)),i.push(o));return new ot(r,i)},selectChild:function(e){return this.select(null==e?ue:function(e){return function(){return ce.call(this.children,e)}}("function"==typeof e?e:le(e)))},selectChildren:function(e){return this.selectAll(null==e?he:function(e){return function(){return de.call(this.children,e)}}("function"==typeof e?e:le(e)))},filter:function(e){"function"!=typeof e&&(e=se(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o=t[i],s=o.length,l=r[i]=[],c=0;c<s;++c)(a=o[c])&&e.call(a,a.__data__,c,o)&&l.push(a);return new ot(r,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,ve);var n,r=t?ge:me,i=this._parents,a=this._groups;"function"!=typeof e&&(n=e,e=function(){return n});for(var o=a.length,s=new Array(o),l=new Array(o),c=new Array(o),u=0;u<o;++u){var d=i[u],h=a[u],f=h.length,p=ye(e.call(d,d&&d.__data__,u,i)),m=p.length,g=l[u]=new Array(m),v=s[u]=new Array(m);r(d,h,g,v,c[u]=new Array(f),p,t);for(var y,b,x=0,_=0;x<m;++x)if(y=g[x]){for(x>=_&&(_=x+1);!(b=v[_])&&++_<m;);y._next=b||null}}return(s=new ot(s,i))._enter=l,s._exit=c,s},enter:function(){return new ot(this._enter||this._groups.map(fe),this._parents)},exit:function(){return new ot(this._exit||this._groups.map(fe),this._parents)},join:function(e,t,n){var r=this.enter(),i=this,a=this.exit();return"function"==typeof e?(r=e(r))&&(r=r.selection()):r=r.append(e+""),null!=t&&(i=t(i))&&(i=i.selection()),null==n?a.remove():n(a),r&&i?r.merge(i).order():i},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,a=r.length,o=Math.min(i,a),s=new Array(i),l=0;l<o;++l)for(var c,u=n[l],d=r[l],h=u.length,f=s[l]=new Array(h),p=0;p<h;++p)(c=u[p]||d[p])&&(f[p]=c);for(;l<i;++l)s[l]=n[l];return new ot(s,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],a=i.length-1,o=i[a];--a>=0;)(r=i[a])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=be);for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var o,s=n[a],l=s.length,c=i[a]=new Array(l),u=0;u<l;++u)(o=s[u])&&(c[u]=o);c.sort(t)}return new ot(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,a=t[n],o=0,s=a.length;o<s;++o)(i=a[o])&&e.call(i,i.__data__,o,a);return this},attr:function(e,t){var n=Q(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?_e:xe:"function"==typeof t?n.local?Ee:Me:n.local?Se:we)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?Ce:"function"==typeof t?ke:Ae)(e,t,null==n?"":n)):Re(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?Ne:"function"==typeof t?Ie:Pe)(e,t)):this.node()[e]},classed:function(e,t){var n=Le(e+"");if(arguments.length<2){for(var r=De(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?je:t?Fe:Be)(n,t))},text:function(e){return arguments.length?this.each(null==e?He:("function"==typeof e?Ge:Ve)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?We:("function"==typeof e?Xe:$e)(e)):this.node().innerHTML},raise:function(){return this.each(qe)},lower:function(){return this.each(Ye)},append:function(e){var t="function"==typeof e?e:ne(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"==typeof e?e:ne(e),r=null==t?Ze:"function"==typeof t?t:ie(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(Ke)},clone:function(e){return this.select(e?Qe:Je)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,i,a=function(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}(e+""),o=a.length;if(!(arguments.length<2)){for(s=t?tt:et,r=0;r<o;++r)this.each(s(a[r],t,n));return this}var s=this.node().__on;if(s)for(var l,c=0,u=s.length;c<u;++c)for(r=0,l=s[c];r<o;++r)if((i=a[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"==typeof t?it:rt)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r,i=e[t],a=0,o=i.length;a<o;++a)(r=i[a])&&(yield r)}};const ut={passive:!1},dt={capture:!0,passive:!1};function ht(e){e.stopImmediatePropagation()}function ft(e){e.preventDefault(),e.stopImmediatePropagation()}function pt(e){var t=e.document.documentElement,n=lt(e).on("dragstart.drag",ft,dt);"onselectstart"in t?n.on("selectstart.drag",ft,dt):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function mt(e,t){var n=e.document.documentElement,r=lt(e).on("dragstart.drag",null);t&&(r.on("click.drag",ft,dt),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const gt=e=>()=>e;function vt(e,{sourceEvent:t,subject:n,target:r,identifier:i,active:a,x:o,y:s,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:a,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}function yt(e){return!e.ctrlKey&&!e.button}function bt(){return this.parentNode}function xt(e,t){return null==t?{x:e.x,y:e.y}:t}function _t(){return navigator.maxTouchPoints||"ontouchstart"in this}function wt(){var e,t,n,r,i=yt,a=bt,o=xt,s=_t,l={},c=X("start","drag","end"),u=0,d=0;function h(e){e.on("mousedown.drag",f).filter(s).on("touchstart.drag",g).on("touchmove.drag",v,ut).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(o,s){if(!r&&i.call(this,o,s)){var l=b(this,a.call(this,o,s),o,s,"mouse");l&&(lt(o.view).on("mousemove.drag",p,dt).on("mouseup.drag",m,dt),pt(o.view),ht(o),n=!1,e=o.clientX,t=o.clientY,l("start",o))}}function p(r){if(ft(r),!n){var i=r.clientX-e,a=r.clientY-t;n=i*i+a*a>d}l.mouse("drag",r)}function m(e){lt(e.view).on("mousemove.drag mouseup.drag",null),mt(e.view,n),ft(e),l.mouse("end",e)}function g(e,t){if(i.call(this,e,t)){var n,r,o=e.changedTouches,s=a.call(this,e,t),l=o.length;for(n=0;n<l;++n)(r=b(this,s,e,t,o[n].identifier,o[n]))&&(ht(e),r("start",e,o[n]))}}function v(e){var t,n,r=e.changedTouches,i=r.length;for(t=0;t<i;++t)(n=l[r[t].identifier])&&(ft(e),n("drag",e,r[t]))}function y(e){var t,n,i=e.changedTouches,a=i.length;for(r&&clearTimeout(r),r=setTimeout(function(){r=null},500),t=0;t<a;++t)(n=l[i[t].identifier])&&(ht(e),n("end",e,i[t]))}function b(e,t,n,r,i,a){var s,d,f,p=c.copy(),m=ct(a||n,t);if(null!=(f=o.call(e,new vt("beforestart",{sourceEvent:n,target:h,identifier:i,active:u,x:m[0],y:m[1],dx:0,dy:0,dispatch:p}),r)))return s=f.x-m[0]||0,d=f.y-m[1]||0,function n(a,o,c){var g,v=m;switch(a){case"start":l[i]=n,g=u++;break;case"end":delete l[i],--u;case"drag":m=ct(c||o,t),g=u}p.call(a,e,new vt(a,{sourceEvent:o,subject:f,target:h,identifier:i,active:g,x:m[0]+s,y:m[1]+d,dx:m[0]-v[0],dy:m[1]-v[1],dispatch:p}),r)}}return h.filter=function(e){return arguments.length?(i="function"==typeof e?e:gt(!!e),h):i},h.container=function(e){return arguments.length?(a="function"==typeof e?e:gt(e),h):a},h.subject=function(e){return arguments.length?(o="function"==typeof e?e:gt(e),h):o},h.touchable=function(e){return arguments.length?(s="function"==typeof e?e:gt(!!e),h):s},h.on=function(){var e=c.on.apply(c,arguments);return e===c?h:e},h.clickDistance=function(e){return arguments.length?(d=(e=+e)*e,h):Math.sqrt(d)},h}function St(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Mt(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Et(){}vt.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};var Tt=.7,Ct=1/Tt,At="\\s*([+-]?\\d+)\\s*",kt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Rt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Nt=/^#([0-9a-f]{3,8})$/,Pt=new RegExp(`^rgb\\(${At},${At},${At}\\)$`),It=new RegExp(`^rgb\\(${Rt},${Rt},${Rt}\\)$`),Lt=new RegExp(`^rgba\\(${At},${At},${At},${kt}\\)$`),Dt=new RegExp(`^rgba\\(${Rt},${Rt},${Rt},${kt}\\)$`),zt=new RegExp(`^hsl\\(${kt},${Rt},${Rt}\\)$`),Ot=new RegExp(`^hsla\\(${kt},${Rt},${Rt},${kt}\\)$`),Ut={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ft(){return this.rgb().formatHex()}function Bt(){return this.rgb().formatRgb()}function jt(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Nt.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Ht(t):3===n?new Wt(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Vt(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Vt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Pt.exec(e))?new Wt(t[1],t[2],t[3],1):(t=It.exec(e))?new Wt(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Lt.exec(e))?Vt(t[1],t[2],t[3],t[4]):(t=Dt.exec(e))?Vt(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=zt.exec(e))?Kt(t[1],t[2]/100,t[3]/100,1):(t=Ot.exec(e))?Kt(t[1],t[2]/100,t[3]/100,t[4]):Ut.hasOwnProperty(e)?Ht(Ut[e]):"transparent"===e?new Wt(NaN,NaN,NaN,0):null}function Ht(e){return new Wt(e>>16&255,e>>8&255,255&e,1)}function Vt(e,t,n,r){return r<=0&&(e=t=n=NaN),new Wt(e,t,n,r)}function Gt(e,t,n,r){return 1===arguments.length?((i=e)instanceof Et||(i=jt(i)),i?new Wt((i=i.rgb()).r,i.g,i.b,i.opacity):new Wt):new Wt(e,t,n,null==r?1:r);var i}function Wt(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function $t(){return`#${Zt(this.r)}${Zt(this.g)}${Zt(this.b)}`}function Xt(){const e=qt(this.opacity);return`${1===e?"rgb(":"rgba("}${Yt(this.r)}, ${Yt(this.g)}, ${Yt(this.b)}${1===e?")":`, ${e})`}`}function qt(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Yt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Zt(e){return((e=Yt(e))<16?"0":"")+e.toString(16)}function Kt(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Qt(e,t,n,r)}function Jt(e){if(e instanceof Qt)return new Qt(e.h,e.s,e.l,e.opacity);if(e instanceof Et||(e=jt(e)),!e)return new Qt;if(e instanceof Qt)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new Qt(o,s,l,e.opacity)}function Qt(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function en(e){return(e=(e||0)%360)<0?e+360:e}function tn(e){return Math.max(0,Math.min(1,e||0))}function nn(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}St(Et,jt,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Ft,formatHex:Ft,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Jt(this).formatHsl()},formatRgb:Bt,toString:Bt}),St(Wt,Gt,Mt(Et,{brighter(e){return e=null==e?Ct:Math.pow(Ct,e),new Wt(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?Tt:Math.pow(Tt,e),new Wt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Wt(Yt(this.r),Yt(this.g),Yt(this.b),qt(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:$t,formatHex:$t,formatHex8:function(){return`#${Zt(this.r)}${Zt(this.g)}${Zt(this.b)}${Zt(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Xt,toString:Xt})),St(Qt,function(e,t,n,r){return 1===arguments.length?Jt(e):new Qt(e,t,n,null==r?1:r)},Mt(Et,{brighter(e){return e=null==e?Ct:Math.pow(Ct,e),new Qt(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?Tt:Math.pow(Tt,e),new Qt(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Wt(nn(e>=240?e-240:e+120,i,r),nn(e,i,r),nn(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new Qt(en(this.h),tn(this.s),tn(this.l),qt(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=qt(this.opacity);return`${1===e?"hsl(":"hsla("}${en(this.h)}, ${100*tn(this.s)}%, ${100*tn(this.l)}%${1===e?")":`, ${e})`}`}}));const rn=e=>()=>e;function an(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):rn(isNaN(e)?t:e)}const on=function e(t){var n=function(e){return 1===(e=+e)?an:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):rn(isNaN(t)?n:t)}}(t);function r(e,t){var r=n((e=Gt(e)).r,(t=Gt(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=an(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function sn(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var ln=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,cn=new RegExp(ln.source,"g");function un(e,t){var n,r,i,a=ln.lastIndex=cn.lastIndex=0,o=-1,s=[],l=[];for(e+="",t+="";(n=ln.exec(e))&&(r=cn.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:sn(n,r)})),a=cn.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)s[(n=l[r]).i]=n.x(e);return s.join("")})}var dn,hn=180/Math.PI,fn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function pn(e,t,n,r,i,a){var o,s,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,l/=s),e*r<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*hn,skewX:Math.atan(l)*hn,scaleX:o,scaleY:s}}function mn(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(a,o){var s=[],l=[];return a=e(a),o=e(o),function(e,r,i,a,o,s){if(e!==i||r!==a){var l=o.push("translate(",null,t,null,n);s.push({i:l-4,x:sn(e,i)},{i:l-2,x:sn(r,a)})}else(i||a)&&o.push("translate("+i+t+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,l),function(e,t,n,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:sn(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(a.rotate,o.rotate,s,l),function(e,t,n,a){e!==t?a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:sn(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(a.skewX,o.skewX,s,l),function(e,t,n,r,a,o){if(e!==n||t!==r){var s=a.push(i(a)+"scale(",null,",",null,")");o.push({i:s-4,x:sn(e,n)},{i:s-2,x:sn(t,r)})}else 1===n&&1===r||a.push(i(a)+"scale("+n+","+r+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,l),a=o=null,function(e){for(var t,n=-1,r=l.length;++n<r;)s[(t=l[n]).i]=t.x(e);return s.join("")}}}var gn=mn(function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?fn:pn(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),vn=mn(function(e){return null==e?fn:(dn||(dn=document.createElementNS("http://www.w3.org/2000/svg","g")),dn.setAttribute("transform",e),(e=dn.transform.baseVal.consolidate())?pn((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):fn)},", ",")",")");function yn(e){return((e=Math.exp(e))+1/e)/2}const bn=function e(t,n,r){function i(e,i){var a,o,s=e[0],l=e[1],c=e[2],u=i[0],d=i[1],h=i[2],f=u-s,p=d-l,m=f*f+p*p;if(m<1e-12)o=Math.log(h/c)/t,a=function(e){return[s+e*f,l+e*p,c*Math.exp(t*e*o)]};else{var g=Math.sqrt(m),v=(h*h-c*c+r*m)/(2*c*n*g),y=(h*h-c*c-r*m)/(2*h*n*g),b=Math.log(Math.sqrt(v*v+1)-v),x=Math.log(Math.sqrt(y*y+1)-y);o=(x-b)/t,a=function(e){var r,i=e*o,a=yn(b),u=c/(n*g)*(a*(r=t*i+b,((r=Math.exp(2*r))-1)/(r+1))-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[s+u*f,l+u*p,c*a/yn(t*i+b)]}}return a.duration=1e3*o*t/Math.SQRT2,a}return i.rho=function(t){var n=Math.max(.001,+t),r=n*n;return e(n,r,r*r)},i}(Math.SQRT2,2,4);var xn,_n,wn=0,Sn=0,Mn=0,En=0,Tn=0,Cn=0,An="object"==typeof performance&&performance.now?performance:Date,kn="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Rn(){return Tn||(kn(Nn),Tn=An.now()+Cn)}function Nn(){Tn=0}function Pn(){this._call=this._time=this._next=null}function In(e,t,n){var r=new Pn;return r.restart(e,t,n),r}function Ln(){Tn=(En=An.now())+Cn,wn=Sn=0;try{!function(){Rn(),++wn;for(var e,t=xn;t;)(e=Tn-t._time)>=0&&t._call.call(void 0,e),t=t._next;--wn}()}finally{wn=0,function(){for(var e,t,n=xn,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:xn=t);_n=e,zn(r)}(),Tn=0}}function Dn(){var e=An.now(),t=e-En;t>1e3&&(Cn-=t,En=e)}function zn(e){wn||(Sn&&(Sn=clearTimeout(Sn)),e-Tn>24?(e<1/0&&(Sn=setTimeout(Ln,e-An.now()-Cn)),Mn&&(Mn=clearInterval(Mn))):(Mn||(En=An.now(),Mn=setInterval(Dn,1e3)),wn=1,kn(Ln)))}function On(e,t,n){var r=new Pn;return t=null==t?0:+t,r.restart(n=>{r.stop(),e(n+t)},t,n),r}Pn.prototype=In.prototype={constructor:Pn,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Rn():+n)+(null==t?0:+t),this._next||_n===this||(_n?_n._next=this:xn=this,_n=this),this._call=e,this._time=n,zn()},stop:function(){this._call&&(this._call=null,this._time=1/0,zn())}};var Un=X("start","end","cancel","interrupt"),Fn=[];function Bn(e,t,n,r,i,a){var o=e.__transition;if(o){if(n in o)return}else e.__transition={};!function(e,t,n){var r,i=e.__transition;function a(l){var c,u,d,h;if(1!==n.state)return s();for(c in i)if((h=i[c]).name===n.name){if(3===h.state)return On(a);4===h.state?(h.state=6,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete i[c]):+c<t&&(h.state=6,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete i[c])}if(On(function(){3===n.state&&(n.state=4,n.timer.restart(o,n.delay,n.time),o(l))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(d=n.tween.length),c=0,u=-1;c<d;++c)(h=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(r[++u]=h);r.length=u+1}}function o(t){for(var i=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(s),n.state=5,1),a=-1,o=r.length;++a<o;)r[a].call(e,i);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),s())}function s(){for(var r in n.state=6,n.timer.stop(),delete i[t],i)return;delete e.__transition}i[t]=n,n.timer=In(function(e){n.state=1,n.timer.restart(a,n.delay,n.time),n.delay<=e&&a(e-n.delay)},0,n.time)}(e,n,{name:t,index:r,group:i,on:Un,tween:Fn,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:0})}function jn(e,t){var n=Vn(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function Hn(e,t){var n=Vn(e,t);if(n.state>3)throw new Error("too late; already running");return n}function Vn(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Gn(e,t){var n,r,i,a=e.__transition,o=!0;if(a){for(i in t=null==t?null:t+"",a)(n=a[i]).name===t?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete a[i]):o=!1;o&&delete e.__transition}}function Wn(e,t){var n,r;return function(){var i=Hn(this,e),a=i.tween;if(a!==n)for(var o=0,s=(r=n=a).length;o<s;++o)if(r[o].name===t){(r=r.slice()).splice(o,1);break}i.tween=r}}function $n(e,t,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var a=Hn(this,e),o=a.tween;if(o!==r){i=(r=o).slice();for(var s={name:t,value:n},l=0,c=i.length;l<c;++l)if(i[l].name===t){i[l]=s;break}l===c&&i.push(s)}a.tween=i}}function Xn(e,t,n){var r=e._id;return e.each(function(){var e=Hn(this,r);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return Vn(e,r).value[t]}}function qn(e,t){var n;return("number"==typeof t?sn:t instanceof jt?on:(n=jt(t))?(t=n,on):un)(e,t)}function Yn(e){return function(){this.removeAttribute(e)}}function Zn(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Kn(e,t,n){var r,i,a=n+"";return function(){var o=this.getAttribute(e);return o===a?null:o===r?i:i=t(r=o,n)}}function Jn(e,t,n){var r,i,a=n+"";return function(){var o=this.getAttributeNS(e.space,e.local);return o===a?null:o===r?i:i=t(r=o,n)}}function Qn(e,t,n){var r,i,a;return function(){var o,s,l=n(this);if(null!=l)return(o=this.getAttribute(e))===(s=l+"")?null:o===r&&s===i?a:(i=s,a=t(r=o,l));this.removeAttribute(e)}}function er(e,t,n){var r,i,a;return function(){var o,s,l=n(this);if(null!=l)return(o=this.getAttributeNS(e.space,e.local))===(s=l+"")?null:o===r&&s===i?a:(i=s,a=t(r=o,l));this.removeAttributeNS(e.space,e.local)}}function tr(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&function(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,i)),n}return i._value=t,i}function nr(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&function(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,i)),n}return i._value=t,i}function rr(e,t){return function(){jn(this,e).delay=+t.apply(this,arguments)}}function ir(e,t){return t=+t,function(){jn(this,e).delay=t}}function ar(e,t){return function(){Hn(this,e).duration=+t.apply(this,arguments)}}function or(e,t){return t=+t,function(){Hn(this,e).duration=t}}var sr=st.prototype.constructor;function lr(e){return function(){this.style.removeProperty(e)}}var cr=0;function ur(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function dr(){return++cr}var hr=st.prototype;ur.prototype={constructor:ur,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=ie(e));for(var r=this._groups,i=r.length,a=new Array(i),o=0;o<i;++o)for(var s,l,c=r[o],u=c.length,d=a[o]=new Array(u),h=0;h<u;++h)(s=c[h])&&(l=e.call(s,s.__data__,h,c))&&("__data__"in s&&(l.__data__=s.__data__),d[h]=l,Bn(d[h],t,n,h,d,Vn(s,n)));return new ur(a,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=oe(e));for(var r=this._groups,i=r.length,a=[],o=[],s=0;s<i;++s)for(var l,c=r[s],u=c.length,d=0;d<u;++d)if(l=c[d]){for(var h,f=e.call(l,l.__data__,d,c),p=Vn(l,n),m=0,g=f.length;m<g;++m)(h=f[m])&&Bn(h,t,n,m,f,p);a.push(f),o.push(l)}return new ur(a,o,t,n)},selectChild:hr.selectChild,selectChildren:hr.selectChildren,filter:function(e){"function"!=typeof e&&(e=se(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var a,o=t[i],s=o.length,l=r[i]=[],c=0;c<s;++c)(a=o[c])&&e.call(a,a.__data__,c,o)&&l.push(a);return new ur(r,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,a=Math.min(r,i),o=new Array(r),s=0;s<a;++s)for(var l,c=t[s],u=n[s],d=c.length,h=o[s]=new Array(d),f=0;f<d;++f)(l=c[f]||u[f])&&(h[f]=l);for(;s<r;++s)o[s]=t[s];return new ur(o,this._parents,this._name,this._id)},selection:function(){return new sr(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=dr(),r=this._groups,i=r.length,a=0;a<i;++a)for(var o,s=r[a],l=s.length,c=0;c<l;++c)if(o=s[c]){var u=Vn(o,t);Bn(o,e,n,c,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new ur(r,this._parents,e,n)},call:hr.call,nodes:hr.nodes,node:hr.node,size:hr.size,empty:hr.empty,each:hr.each,on:function(e,t){var n=this._id;return arguments.length<2?Vn(this.node(),n).on.on(e):this.each(function(e,t,n){var r,i,a=function(e){return(e+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})}(t)?jn:Hn;return function(){var o=a(this,e),s=o.on;s!==r&&(i=(r=s).copy()).on(t,n),o.on=i}}(n,e,t))},attr:function(e,t){var n=Q(e),r="transform"===n?vn:qn;return this.attrTween(e,"function"==typeof t?(n.local?er:Qn)(n,r,Xn(this,"attr."+e,t)):null==t?(n.local?Zn:Yn)(n):(n.local?Jn:Kn)(n,r,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var r=Q(e);return this.tween(n,(r.local?tr:nr)(r,t))},style:function(e,t,n){var r="transform"==(e+="")?gn:qn;return null==t?this.styleTween(e,function(e,t){var n,r,i;return function(){var a=Re(this,e),o=(this.style.removeProperty(e),Re(this,e));return a===o?null:a===n&&o===r?i:i=t(n=a,r=o)}}(e,r)).on("end.style."+e,lr(e)):"function"==typeof t?this.styleTween(e,function(e,t,n){var r,i,a;return function(){var o=Re(this,e),s=n(this),l=s+"";return null==s&&(this.style.removeProperty(e),l=s=Re(this,e)),o===l?null:o===r&&l===i?a:(i=l,a=t(r=o,s))}}(e,r,Xn(this,"style."+e,t))).each(function(e,t){var n,r,i,a,o="style."+t,s="end."+o;return function(){var l=Hn(this,e),c=l.on,u=null==l.value[o]?a||(a=lr(t)):void 0;c===n&&i===u||(r=(n=c).copy()).on(s,i=u),l.on=r}}(this._id,e)):this.styleTween(e,function(e,t,n){var r,i,a=n+"";return function(){var o=Re(this,e);return o===a?null:o===r?i:i=t(r=o,n)}}(e,r,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw new Error;return this.tween(r,function(e,t,n){var r,i;function a(){var a=t.apply(this,arguments);return a!==i&&(r=(i=a)&&function(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}(e,a,n)),r}return a._value=t,a}(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(Xn(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,function(e){var t,n;function r(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&function(e){return function(t){this.textContent=e.call(this,t)}}(r)),t}return r._value=e,r}(e))},remove:function(){return this.on("end.remove",(e=this._id,function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}));var e},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r,i=Vn(this.node(),n).tween,a=0,o=i.length;a<o;++a)if((r=i[a]).name===e)return r.value;return null}return this.each((null==t?Wn:$n)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?rr:ir)(t,e)):Vn(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?ar:or)(t,e)):Vn(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw new Error;return function(){Hn(this,e).ease=t}}(t,e)):Vn(this.node(),t).ease},easeVarying:function(e){if("function"!=typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;Hn(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,r=n._id,i=n.size();return new Promise(function(a,o){var s={value:o},l={value:function(){0===--i&&a()}};n.each(function(){var n=Hn(this,r),i=n.on;i!==e&&((t=(e=i).copy())._.cancel.push(s),t._.interrupt.push(s),t._.end.push(l)),n.on=t}),0===i&&a()})},[Symbol.iterator]:hr[Symbol.iterator]};var fr={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function pr(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}st.prototype.interrupt=function(e){return this.each(function(){Gn(this,e)})},st.prototype.transition=function(e){var t,n;e instanceof ur?(t=e._id,e=e._name):(t=dr(),(n=fr).time=Rn(),e=null==e?null:e+"");for(var r=this._groups,i=r.length,a=0;a<i;++a)for(var o,s=r[a],l=s.length,c=0;c<l;++c)(o=s[c])&&Bn(o,e,t,c,s,n||pr(o,t));return new ur(r,this._parents,e,t)};const mr=e=>()=>e;function gr(e,{sourceEvent:t,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function vr(e,t,n){this.k=e,this.x=t,this.y=n}vr.prototype={constructor:vr,scale:function(e){return 1===e?this:new vr(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new vr(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var yr=new vr(1,0,0);function br(e){e.stopImmediatePropagation()}function xr(e){e.preventDefault(),e.stopImmediatePropagation()}function _r(e){return!(e.ctrlKey&&"wheel"!==e.type||e.button)}function wr(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function Sr(){return this.__zoom||yr}function Mr(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Er(){return navigator.maxTouchPoints||"ontouchstart"in this}function Tr(e,t,n){var r=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],a=e.invertY(t[0][1])-n[0][1],o=e.invertY(t[1][1])-n[1][1];return e.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>a?(a+o)/2:Math.min(0,a)||Math.max(0,o))}function Cr(){var e,t,n,r=_r,i=wr,a=Tr,o=Mr,s=Er,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],u=250,d=bn,h=X("start","zoom","end"),f=0,p=10;function m(e){e.property("__zoom",Sr).on("wheel.zoom",w,{passive:!1}).on("mousedown.zoom",S).on("dblclick.zoom",M).filter(s).on("touchstart.zoom",E).on("touchmove.zoom",T).on("touchend.zoom touchcancel.zoom",C).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(e,t){return(t=Math.max(l[0],Math.min(l[1],t)))===e.k?e:new vr(t,e.x,e.y)}function v(e,t,n){var r=t[0]-n[0]*e.k,i=t[1]-n[1]*e.k;return r===e.x&&i===e.y?e:new vr(e.k,r,i)}function y(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function b(e,t,n,r){e.on("start.zoom",function(){x(this,arguments).event(r).start()}).on("interrupt.zoom end.zoom",function(){x(this,arguments).event(r).end()}).tween("zoom",function(){var e=this,a=arguments,o=x(e,a).event(r),s=i.apply(e,a),l=null==n?y(s):"function"==typeof n?n.apply(e,a):n,c=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),u=e.__zoom,h="function"==typeof t?t.apply(e,a):t,f=d(u.invert(l).concat(c/u.k),h.invert(l).concat(c/h.k));return function(e){if(1===e)e=h;else{var t=f(e),n=c/t[2];e=new vr(n,l[0]-t[0]*n,l[1]-t[1]*n)}o.zoom(null,e)}})}function x(e,t,n){return!n&&e.__zooming||new _(e,t)}function _(e,t){this.that=e,this.args=t,this.active=0,this.sourceEvent=null,this.extent=i.apply(e,t),this.taps=0}function w(e,...t){if(r.apply(this,arguments)){var n=x(this,t).event(e),i=this.__zoom,s=Math.max(l[0],Math.min(l[1],i.k*Math.pow(2,o.apply(this,arguments)))),u=ct(e);if(n.wheel)n.mouse[0][0]===u[0]&&n.mouse[0][1]===u[1]||(n.mouse[1]=i.invert(n.mouse[0]=u)),clearTimeout(n.wheel);else{if(i.k===s)return;n.mouse=[u,i.invert(u)],Gn(this),n.start()}xr(e),n.wheel=setTimeout(function(){n.wheel=null,n.end()},150),n.zoom("mouse",a(v(g(i,s),n.mouse[0],n.mouse[1]),n.extent,c))}}function S(e,...t){if(!n&&r.apply(this,arguments)){var i=e.currentTarget,o=x(this,t,!0).event(e),s=lt(e.view).on("mousemove.zoom",function(e){if(xr(e),!o.moved){var t=e.clientX-u,n=e.clientY-d;o.moved=t*t+n*n>f}o.event(e).zoom("mouse",a(v(o.that.__zoom,o.mouse[0]=ct(e,i),o.mouse[1]),o.extent,c))},!0).on("mouseup.zoom",function(e){s.on("mousemove.zoom mouseup.zoom",null),mt(e.view,o.moved),xr(e),o.event(e).end()},!0),l=ct(e,i),u=e.clientX,d=e.clientY;pt(e.view),br(e),o.mouse=[l,this.__zoom.invert(l)],Gn(this),o.start()}}function M(e,...t){if(r.apply(this,arguments)){var n=this.__zoom,o=ct(e.changedTouches?e.changedTouches[0]:e,this),s=n.invert(o),l=n.k*(e.shiftKey?.5:2),d=a(v(g(n,l),o,s),i.apply(this,t),c);xr(e),u>0?lt(this).transition().duration(u).call(b,d,o,e):lt(this).call(m.transform,d,o,e)}}function E(n,...i){if(r.apply(this,arguments)){var a,o,s,l,c=n.touches,u=c.length,d=x(this,i,n.changedTouches.length===u).event(n);for(br(n),o=0;o<u;++o)l=[l=ct(s=c[o],this),this.__zoom.invert(l),s.identifier],d.touch0?d.touch1||d.touch0[2]===l[2]||(d.touch1=l,d.taps=0):(d.touch0=l,a=!0,d.taps=1+!!e);e&&(e=clearTimeout(e)),a&&(d.taps<2&&(t=l[0],e=setTimeout(function(){e=null},500)),Gn(this),d.start())}}function T(e,...t){if(this.__zooming){var n,r,i,o,s=x(this,t).event(e),l=e.changedTouches,u=l.length;for(xr(e),n=0;n<u;++n)i=ct(r=l[n],this),s.touch0&&s.touch0[2]===r.identifier?s.touch0[0]=i:s.touch1&&s.touch1[2]===r.identifier&&(s.touch1[0]=i);if(r=s.that.__zoom,s.touch1){var d=s.touch0[0],h=s.touch0[1],f=s.touch1[0],p=s.touch1[1],m=(m=f[0]-d[0])*m+(m=f[1]-d[1])*m,y=(y=p[0]-h[0])*y+(y=p[1]-h[1])*y;r=g(r,Math.sqrt(m/y)),i=[(d[0]+f[0])/2,(d[1]+f[1])/2],o=[(h[0]+p[0])/2,(h[1]+p[1])/2]}else{if(!s.touch0)return;i=s.touch0[0],o=s.touch0[1]}s.zoom("touch",a(v(r,i,o),s.extent,c))}}function C(e,...r){if(this.__zooming){var i,a,o=x(this,r).event(e),s=e.changedTouches,l=s.length;for(br(e),n&&clearTimeout(n),n=setTimeout(function(){n=null},500),i=0;i<l;++i)a=s[i],o.touch0&&o.touch0[2]===a.identifier?delete o.touch0:o.touch1&&o.touch1[2]===a.identifier&&delete o.touch1;if(o.touch1&&!o.touch0&&(o.touch0=o.touch1,delete o.touch1),o.touch0)o.touch0[1]=this.__zoom.invert(o.touch0[0]);else if(o.end(),2===o.taps&&(a=ct(a,this),Math.hypot(t[0]-a[0],t[1]-a[1])<p)){var c=lt(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return m.transform=function(e,t,n,r){var i=e.selection?e.selection():e;i.property("__zoom",Sr),e!==i?b(e,t,n,r):i.interrupt().each(function(){x(this,arguments).event(r).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()})},m.scaleBy=function(e,t,n,r){m.scaleTo(e,function(){return this.__zoom.k*("function"==typeof t?t.apply(this,arguments):t)},n,r)},m.scaleTo=function(e,t,n,r){m.transform(e,function(){var e=i.apply(this,arguments),r=this.__zoom,o=null==n?y(e):"function"==typeof n?n.apply(this,arguments):n,s=r.invert(o),l="function"==typeof t?t.apply(this,arguments):t;return a(v(g(r,l),o,s),e,c)},n,r)},m.translateBy=function(e,t,n,r){m.transform(e,function(){return a(this.__zoom.translate("function"==typeof t?t.apply(this,arguments):t,"function"==typeof n?n.apply(this,arguments):n),i.apply(this,arguments),c)},null,r)},m.translateTo=function(e,t,n,r,o){m.transform(e,function(){var e=i.apply(this,arguments),o=this.__zoom,s=null==r?y(e):"function"==typeof r?r.apply(this,arguments):r;return a(yr.translate(s[0],s[1]).scale(o.k).translate("function"==typeof t?-t.apply(this,arguments):-t,"function"==typeof n?-n.apply(this,arguments):-n),e,c)},r,o)},_.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var t=lt(this.that).datum();h.call(e,this.that,new gr(e,{sourceEvent:this.sourceEvent,target:m,transform:this.that.__zoom,dispatch:h}),t)}},m.wheelDelta=function(e){return arguments.length?(o="function"==typeof e?e:mr(+e),m):o},m.filter=function(e){return arguments.length?(r="function"==typeof e?e:mr(!!e),m):r},m.touchable=function(e){return arguments.length?(s="function"==typeof e?e:mr(!!e),m):s},m.extent=function(e){return arguments.length?(i="function"==typeof e?e:mr([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),m):i},m.scaleExtent=function(e){return arguments.length?(l[0]=+e[0],l[1]=+e[1],m):[l[0],l[1]]},m.translateExtent=function(e){return arguments.length?(c[0][0]=+e[0][0],c[1][0]=+e[1][0],c[0][1]=+e[0][1],c[1][1]=+e[1][1],m):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},m.constrain=function(e){return arguments.length?(a=e,m):a},m.duration=function(e){return arguments.length?(u=+e,m):u},m.interpolate=function(e){return arguments.length?(d=e,m):d},m.on=function(){var e=h.on.apply(h,arguments);return e===h?m:e},m.clickDistance=function(e){return arguments.length?(f=(e=+e)*e,m):Math.sqrt(f)},m.tapDistance=function(e){return arguments.length?(p=+e,m):p},m}vr.prototype,T();const Ar=h.createContext(null),kr=Ar.Provider,Rr="[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001";function Nr(e,t){const n=h.useContext(Ar);if(null===n)throw new Error(Rr);return V(n,e,t)}const Pr=()=>{const e=h.useContext(Ar);if(null===e)throw new Error(Rr);return h.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe,destroy:e.destroy}),[e])},Ir=e=>e.userSelectionActive?"none":"all";function Lr({position:e,children:t,className:n,style:r,...i}){const a=Nr(Ir),o=`${e}`.split("-");return f.createElement("div",{className:A(["react-flow__panel",n,...o]),style:{...r,pointerEvents:a},...i},t)}function Dr({proOptions:e,position:t="bottom-right"}){return(null==e?void 0:e.hideAttribution)?null:f.createElement(Lr,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://reactflow.dev/pro"},f.createElement("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution"},"React Flow"))}var zr=h.memo(({x:e,y:t,label:n,labelStyle:r={},labelShowBg:i=!0,labelBgStyle:a={},labelBgPadding:o=[2,4],labelBgBorderRadius:s=2,children:l,className:c,...u})=>{const d=h.useRef(null),[p,m]=h.useState({x:0,y:0,width:0,height:0}),g=A(["react-flow__edge-textwrapper",c]);return h.useEffect(()=>{if(d.current){const e=d.current.getBBox();m({x:e.x,y:e.y,width:e.width,height:e.height})}},[n]),void 0!==n&&n?f.createElement("g",{transform:`translate(${e-p.width/2} ${t-p.height/2})`,className:g,visibility:p.width?"visible":"hidden",...u},i&&f.createElement("rect",{width:p.width+2*o[0],x:-o[0],y:-o[1],height:p.height+2*o[1],className:"react-flow__edge-textbg",style:a,rx:s,ry:s}),f.createElement("text",{className:"react-flow__edge-text",y:p.height/2,dy:"0.3em",ref:d,style:r},n),l):null});const Or=e=>({width:e.offsetWidth,height:e.offsetHeight}),Ur=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),Fr=(e={x:0,y:0},t)=>({x:Ur(e.x,t[0][0],t[1][0]),y:Ur(e.y,t[0][1],t[1][1])}),Br=(e,t,n)=>e<t?Ur(Math.abs(e-t),1,50)/50:e>n?-Ur(Math.abs(e-n),1,50)/50:0,jr=(e,t)=>[20*Br(e.x,35,t.width-35),20*Br(e.y,35,t.height-35)],Hr=e=>{var t;return(null==(t=e.getRootNode)?void 0:t.call(e))||(null==window?void 0:window.document)},Vr=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),Gr=({x:e,y:t,width:n,height:r})=>({x:e,y:t,x2:e+n,y2:t+r}),Wr=({x:e,y:t,x2:n,y2:r})=>({x:e,y:t,width:n-e,height:r-t}),$r=e=>({...e.positionAbsolute||{x:0,y:0},width:e.width||0,height:e.height||0}),Xr=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),r=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*r)},qr=e=>!isNaN(e)&&isFinite(e),Yr=Symbol.for("internals"),Zr=["Enter"," ","Escape"];function Kr(e){var t,n;const r=(e=>"nativeEvent"in e)(e)?e.nativeEvent:e,i=(null==(n=null==(t=r.composedPath)?void 0:t.call(r))?void 0:n[0])||e.target;return["INPUT","SELECT","TEXTAREA"].includes(null==i?void 0:i.nodeName)||(null==i?void 0:i.hasAttribute("contenteditable"))||!!(null==i?void 0:i.closest(".nokey"))}const Jr=e=>"clientX"in e,Qr=(e,t)=>{var n,r;const i=Jr(e),a=i?e.clientX:null==(n=e.touches)?void 0:n[0].clientX,o=i?e.clientY:null==(r=e.touches)?void 0:r[0].clientY;return{x:a-((null==t?void 0:t.left)??0),y:o-((null==t?void 0:t.top)??0)}},ei=()=>{var e;return"undefined"!=typeof navigator&&(null==(e=null==navigator?void 0:navigator.userAgent)?void 0:e.indexOf("Mac"))>=0},ti=({id:e,path:t,labelX:n,labelY:r,label:i,labelStyle:a,labelShowBg:o,labelBgStyle:s,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:d,markerStart:h,interactionWidth:p=20})=>f.createElement(f.Fragment,null,f.createElement("path",{id:e,style:u,d:t,fill:"none",className:"react-flow__edge-path",markerEnd:d,markerStart:h}),p&&f.createElement("path",{d:t,fill:"none",strokeOpacity:0,strokeWidth:p,className:"react-flow__edge-interaction"}),i&&qr(n)&&qr(r)?f.createElement(zr,{x:n,y:r,label:i,labelStyle:a,labelShowBg:o,labelBgStyle:s,labelBgPadding:l,labelBgBorderRadius:c}):null);function ni(e,t,n){return void 0===n?n:r=>{const i=t().edges.find(t=>t.id===e);i&&n(r,{...i})}}function ri({sourceX:e,sourceY:t,targetX:n,targetY:r}){const i=Math.abs(n-e)/2,a=n<e?n+i:n-i,o=Math.abs(r-t)/2;return[a,r<t?r+o:r-o,i,o]}function ii({sourceX:e,sourceY:t,targetX:n,targetY:r,sourceControlX:i,sourceControlY:a,targetControlX:o,targetControlY:s}){const l=.125*e+.375*i+.375*o+.125*n,c=.125*t+.375*a+.375*s+.125*r;return[l,c,Math.abs(l-e),Math.abs(c-t)]}var ai,oi,si,li,ci,ui,di,hi,fi,pi,mi,gi;function vi({pos:e,x1:t,y1:n,x2:r,y2:i}){return e===mi.Left||e===mi.Right?[.5*(t+r),n]:[t,.5*(n+i)]}function yi({sourceX:e,sourceY:t,sourcePosition:n=mi.Bottom,targetX:r,targetY:i,targetPosition:a=mi.Top}){const[o,s]=vi({pos:n,x1:e,y1:t,x2:r,y2:i}),[l,c]=vi({pos:a,x1:r,y1:i,x2:e,y2:t}),[u,d,h,f]=ii({sourceX:e,sourceY:t,targetX:r,targetY:i,sourceControlX:o,sourceControlY:s,targetControlX:l,targetControlY:c});return[`M${e},${t} C${o},${s} ${l},${c} ${r},${i}`,u,d,h,f]}ti.displayName="BaseEdge",(oi=ai||(ai={})).Strict="strict",oi.Loose="loose",(li=si||(si={})).Free="free",li.Vertical="vertical",li.Horizontal="horizontal",(ui=ci||(ci={})).Partial="partial",ui.Full="full",(hi=di||(di={})).Bezier="default",hi.Straight="straight",hi.Step="step",hi.SmoothStep="smoothstep",hi.SimpleBezier="simplebezier",(pi=fi||(fi={})).Arrow="arrow",pi.ArrowClosed="arrowclosed",(gi=mi||(mi={})).Left="left",gi.Top="top",gi.Right="right",gi.Bottom="bottom";const bi=h.memo(({sourceX:e,sourceY:t,targetX:n,targetY:r,sourcePosition:i=mi.Bottom,targetPosition:a=mi.Top,label:o,labelStyle:s,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:p,markerStart:m,interactionWidth:g})=>{const[v,y,b]=yi({sourceX:e,sourceY:t,sourcePosition:i,targetX:n,targetY:r,targetPosition:a});return f.createElement(ti,{path:v,labelX:y,labelY:b,label:o,labelStyle:s,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:p,markerStart:m,interactionWidth:g})});bi.displayName="SimpleBezierEdge";const xi={[mi.Left]:{x:-1,y:0},[mi.Right]:{x:1,y:0},[mi.Top]:{x:0,y:-1},[mi.Bottom]:{x:0,y:1}},_i=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function wi({sourceX:e,sourceY:t,sourcePosition:n=mi.Bottom,targetX:r,targetY:i,targetPosition:a=mi.Top,borderRadius:o=5,centerX:s,centerY:l,offset:c=20}){const[u,d,h,f,p]=function({source:e,sourcePosition:t=mi.Bottom,target:n,targetPosition:r=mi.Top,center:i,offset:a}){const o=xi[t],s=xi[r],l={x:e.x+o.x*a,y:e.y+o.y*a},c={x:n.x+s.x*a,y:n.y+s.y*a},u=(({source:e,sourcePosition:t=mi.Bottom,target:n})=>t===mi.Left||t===mi.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1})({source:l,sourcePosition:t,target:c}),d=0!==u.x?"x":"y",h=u[d];let f,p,m=[];const g={x:0,y:0},v={x:0,y:0},[y,b,x,_]=ri({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(o[d]*s[d]===-1){f=i.x??y,p=i.y??b;const e=[{x:f,y:l.y},{x:f,y:c.y}],t=[{x:l.x,y:p},{x:c.x,y:p}];m=o[d]===h?"x"===d?e:t:"x"===d?t:e}else{const i=[{x:l.x,y:c.y}],u=[{x:c.x,y:l.y}];if(m="x"===d?o.x===h?u:i:o.y===h?i:u,t===r){const t=Math.abs(e[d]-n[d]);if(t<=a){const r=Math.min(a-1,a-t);o[d]===h?g[d]=(l[d]>e[d]?-1:1)*r:v[d]=(c[d]>n[d]?-1:1)*r}}if(t!==r){const e="x"===d?"y":"x",t=o[d]===s[e],n=l[e]>c[e],r=l[e]<c[e];(1===o[d]&&(!t&&n||t&&r)||1!==o[d]&&(!t&&r||t&&n))&&(m="x"===d?i:u)}const y={x:l.x+g.x,y:l.y+g.y},b={x:c.x+v.x,y:c.y+v.y};Math.max(Math.abs(y.x-m[0].x),Math.abs(b.x-m[0].x))>=Math.max(Math.abs(y.y-m[0].y),Math.abs(b.y-m[0].y))?(f=(y.x+b.x)/2,p=m[0].y):(f=m[0].x,p=(y.y+b.y)/2)}return[[e,{x:l.x+g.x,y:l.y+g.y},...m,{x:c.x+v.x,y:c.y+v.y},n],f,p,x,_]}({source:{x:e,y:t},sourcePosition:n,target:{x:r,y:i},targetPosition:a,center:{x:s,y:l},offset:c});return[u.reduce((e,t,n)=>{let r="";return r=n>0&&n<u.length-1?function(e,t,n,r){const i=Math.min(_i(e,t)/2,_i(t,n)/2,r),{x:a,y:o}=t;if(e.x===a&&a===n.x||e.y===o&&o===n.y)return`L${a} ${o}`;if(e.y===o)return`L ${a+i*(e.x<n.x?-1:1)},${o}Q ${a},${o} ${a},${o+i*(e.y<n.y?1:-1)}`;const s=e.x<n.x?1:-1;return`L ${a},${o+i*(e.y<n.y?-1:1)}Q ${a},${o} ${a+i*s},${o}`}(u[n-1],t,u[n+1],o):`${0===n?"M":"L"}${t.x} ${t.y}`,e+r},""),d,h,f,p]}const Si=h.memo(({sourceX:e,sourceY:t,targetX:n,targetY:r,label:i,labelStyle:a,labelShowBg:o,labelBgStyle:s,labelBgPadding:l,labelBgBorderRadius:c,style:u,sourcePosition:d=mi.Bottom,targetPosition:h=mi.Top,markerEnd:p,markerStart:m,pathOptions:g,interactionWidth:v})=>{const[y,b,x]=wi({sourceX:e,sourceY:t,sourcePosition:d,targetX:n,targetY:r,targetPosition:h,borderRadius:null==g?void 0:g.borderRadius,offset:null==g?void 0:g.offset});return f.createElement(ti,{path:y,labelX:b,labelY:x,label:i,labelStyle:a,labelShowBg:o,labelBgStyle:s,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:p,markerStart:m,interactionWidth:v})});Si.displayName="SmoothStepEdge";const Mi=h.memo(e=>{var t;return f.createElement(Si,{...e,pathOptions:h.useMemo(()=>{var t;return{borderRadius:0,offset:null==(t=e.pathOptions)?void 0:t.offset}},[null==(t=e.pathOptions)?void 0:t.offset])})});Mi.displayName="StepEdge";const Ei=h.memo(({sourceX:e,sourceY:t,targetX:n,targetY:r,label:i,labelStyle:a,labelShowBg:o,labelBgStyle:s,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:d,markerStart:h,interactionWidth:p})=>{const[m,g,v]=function({sourceX:e,sourceY:t,targetX:n,targetY:r}){const[i,a,o,s]=ri({sourceX:e,sourceY:t,targetX:n,targetY:r});return[`M ${e},${t}L ${n},${r}`,i,a,o,s]}({sourceX:e,sourceY:t,targetX:n,targetY:r});return f.createElement(ti,{path:m,labelX:g,labelY:v,label:i,labelStyle:a,labelShowBg:o,labelBgStyle:s,labelBgPadding:l,labelBgBorderRadius:c,style:u,markerEnd:d,markerStart:h,interactionWidth:p})});function Ti(e,t){return e>=0?.5*e:25*t*Math.sqrt(-e)}function Ci({pos:e,x1:t,y1:n,x2:r,y2:i,c:a}){switch(e){case mi.Left:return[t-Ti(t-r,a),n];case mi.Right:return[t+Ti(r-t,a),n];case mi.Top:return[t,n-Ti(n-i,a)];case mi.Bottom:return[t,n+Ti(i-n,a)]}}function Ai({sourceX:e,sourceY:t,sourcePosition:n=mi.Bottom,targetX:r,targetY:i,targetPosition:a=mi.Top,curvature:o=.25}){const[s,l]=Ci({pos:n,x1:e,y1:t,x2:r,y2:i,c:o}),[c,u]=Ci({pos:a,x1:r,y1:i,x2:e,y2:t,c:o}),[d,h,f,p]=ii({sourceX:e,sourceY:t,targetX:r,targetY:i,sourceControlX:s,sourceControlY:l,targetControlX:c,targetControlY:u});return[`M${e},${t} C${s},${l} ${c},${u} ${r},${i}`,d,h,f,p]}Ei.displayName="StraightEdge";const ki=h.memo(({sourceX:e,sourceY:t,targetX:n,targetY:r,sourcePosition:i=mi.Bottom,targetPosition:a=mi.Top,label:o,labelStyle:s,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:p,markerStart:m,pathOptions:g,interactionWidth:v})=>{const[y,b,x]=Ai({sourceX:e,sourceY:t,sourcePosition:i,targetX:n,targetY:r,targetPosition:a,curvature:null==g?void 0:g.curvature});return f.createElement(ti,{path:y,labelX:b,labelY:x,label:o,labelStyle:s,labelShowBg:l,labelBgStyle:c,labelBgPadding:u,labelBgBorderRadius:d,style:h,markerEnd:p,markerStart:m,interactionWidth:v})});ki.displayName="BezierEdge";const Ri=h.createContext(null),Ni=Ri.Provider;Ri.Consumer;const Pi=()=>h.useContext(Ri),Ii=({source:e,sourceHandle:t,target:n,targetHandle:r})=>`reactflow__edge-${e}${t||""}-${n}${r||""}`,Li=(e,t)=>void 0===e?"":"string"==typeof e?e:`${t?`${t}__`:""}${Object.keys(e).sort().map(t=>`${t}=${e[t]}`).join("&")}`,Di=(e,t)=>{if(!e.source||!e.target)return t;let n;var r;return n="id"in(r=e)&&"source"in r&&"target"in r?{...e}:{...e,id:Ii(e)},((e,t)=>t.some(t=>!(t.source!==e.source||t.target!==e.target||t.sourceHandle!==e.sourceHandle&&(t.sourceHandle||e.sourceHandle)||t.targetHandle!==e.targetHandle&&(t.targetHandle||e.targetHandle))))(n,t)?t:t.concat(n)},zi=({x:e,y:t},[n,r,i],a,[o,s])=>{const l={x:(e-n)/i,y:(t-r)/i};return a?{x:o*Math.round(l.x/o),y:s*Math.round(l.y/s)}:l},Oi=({x:e,y:t},[n,r,i])=>({x:e*i+n,y:t*i+r}),Ui=(e,t=[0,0])=>{if(!e)return{x:0,y:0,positionAbsolute:{x:0,y:0}};const n=(e.width??0)*t[0],r=(e.height??0)*t[1],i={x:e.position.x-n,y:e.position.y-r};return{...i,positionAbsolute:e.positionAbsolute?{x:e.positionAbsolute.x-n,y:e.positionAbsolute.y-r}:i}},Fi=(e,t=[0,0])=>{if(0===e.length)return{x:0,y:0,width:0,height:0};const n=e.reduce((e,n)=>{const{x:r,y:i}=Ui(n,t).positionAbsolute;return Vr(e,Gr({x:r,y:i,width:n.width||0,height:n.height||0}))},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return Wr(n)},Bi=(e,t,[n,r,i]=[0,0,1],a=!1,o=!1,s=[0,0])=>{const l={x:(t.x-n)/i,y:(t.y-r)/i,width:t.width/i,height:t.height/i},c=[];return e.forEach(e=>{const{width:t,height:n,selectable:r=!0,hidden:i=!1}=e;if(o&&!r||i)return!1;const{positionAbsolute:u}=Ui(e,s),d={x:u.x,y:u.y,width:t||0,height:n||0},h=Xr(l,d);(void 0===t||void 0===n||null===t||null===n||a&&h>0||h>=(t||0)*(n||0)||e.dragging)&&c.push(e)}),c},ji=(e,t)=>{const n=e.map(e=>e.id);return t.filter(e=>n.includes(e.source)||n.includes(e.target))},Hi=(e,t,n,r,i,a=.1)=>{const o=t/(e.width*(1+a)),s=n/(e.height*(1+a)),l=Math.min(o,s),c=Ur(l,r,i);return{x:t/2-(e.x+e.width/2)*c,y:n/2-(e.y+e.height/2)*c,zoom:c}},Vi=(e,t=0)=>e.transition().duration(t);function Gi(e,t,n,r){return(t[n]||[]).reduce((t,i)=>{var a,o;return`${e.id}-${i.id}-${n}`!==r&&t.push({id:i.id||null,type:n,nodeId:e.id,x:((null==(a=e.positionAbsolute)?void 0:a.x)??0)+i.x+i.width/2,y:((null==(o=e.positionAbsolute)?void 0:o.y)??0)+i.y+i.height/2}),t},[])}const Wi={source:null,target:null,sourceHandle:null,targetHandle:null},$i=()=>({handleDomNode:null,isValid:!1,connection:Wi,endHandle:null});function Xi(e,t,n,r,i,a,o){const s="target"===i,l=o.querySelector(`.react-flow__handle[data-id="${null==e?void 0:e.nodeId}-${null==e?void 0:e.id}-${null==e?void 0:e.type}"]`),c={...$i(),handleDomNode:l};if(l){const e=qi(void 0,l),i=l.getAttribute("data-nodeid"),o=l.getAttribute("data-handleid"),u=l.classList.contains("connectable"),d=l.classList.contains("connectableend"),h={source:s?i:n,sourceHandle:s?o:r,target:s?n:i,targetHandle:s?r:o};c.connection=h,u&&d&&(t===ai.Strict?s&&"source"===e||!s&&"target"===e:i!==n||o!==r)&&(c.endHandle={nodeId:i,handleId:o,type:e},c.isValid=a(h))}return c}function qi(e,t){return e||((null==t?void 0:t.classList.contains("target"))?"target":(null==t?void 0:t.classList.contains("source"))?"source":null)}function Yi(e){null==e||e.classList.remove("valid","connecting","react-flow__handle-valid","react-flow__handle-connecting")}function Zi(e,t){let n=null;return t?n="valid":e&&!t&&(n="invalid"),n}function Ki({event:e,handleId:t,nodeId:n,onConnect:r,isTarget:i,getState:a,setState:o,isValidConnection:s,edgeUpdaterType:l,onReconnectEnd:c}){const u=Hr(e.target),{connectionMode:d,domNode:h,autoPanOnConnect:f,connectionRadius:p,onConnectStart:m,panBy:g,getNodes:v,cancelConnection:y}=a();let b,x=0;const{x:_,y:w}=Qr(e),S=null==u?void 0:u.elementFromPoint(_,w),M=qi(l,S),E=null==h?void 0:h.getBoundingClientRect();if(!E||!M)return;let T,C=Qr(e,E),A=!1,k=null,R=!1,N=null;const P=function({nodes:e,nodeId:t,handleId:n,handleType:r}){return e.reduce((e,i)=>{if(i[Yr]){const{handleBounds:a}=i[Yr];let o=[],s=[];a&&(o=Gi(i,a,"source",`${t}-${n}-${r}`),s=Gi(i,a,"target",`${t}-${n}-${r}`)),e.push(...o,...s)}return e},[])}({nodes:v(),nodeId:n,handleId:t,handleType:M}),I=()=>{if(!f)return;const[e,t]=jr(C,E);g({x:e,y:t}),x=requestAnimationFrame(I)};function L(e){const{transform:r}=a();C=Qr(e,E);const{handle:l,validHandleResult:c}=function(e,t,n,r,i,a){const{x:o,y:s}=Qr(e),l=t.elementsFromPoint(o,s).find(e=>e.classList.contains("react-flow__handle"));if(l){const e=l.getAttribute("data-nodeid");if(e){const t=qi(void 0,l),r=l.getAttribute("data-handleid"),o=a({nodeId:e,id:r,type:t});if(o){const a=i.find(n=>n.nodeId===e&&n.type===t&&n.id===r);return{handle:{id:r,type:t,nodeId:e,x:(null==a?void 0:a.x)||n.x,y:(null==a?void 0:a.y)||n.y},validHandleResult:o}}}}let c=[],u=1/0;if(i.forEach(e=>{const t=Math.sqrt((e.x-n.x)**2+(e.y-n.y)**2);if(t<=r){const n=a(e);t<=u&&(t<u?c=[{handle:e,validHandleResult:n}]:t===u&&c.push({handle:e,validHandleResult:n}),u=t)}}),!c.length)return{handle:null,validHandleResult:$i()};if(1===c.length)return c[0];const d=c.some(({validHandleResult:e})=>e.isValid),h=c.some(({handle:e})=>"target"===e.type);return c.find(({handle:e,validHandleResult:t})=>h?"target"===e.type:!d||t.isValid)||c[0]}(e,u,zi(C,r,!1,[1,1]),p,P,e=>Xi(e,d,n,t,i?"target":"source",s,u));if(b=l,A||(I(),A=!0),N=c.handleDomNode,k=c.connection,R=c.isValid,o({connectionPosition:b&&R?Oi({x:b.x,y:b.y},r):C,connectionStatus:Zi(!!b,R),connectionEndHandle:c.endHandle}),!b&&!R&&!N)return Yi(T);k.source!==k.target&&N&&(Yi(T),T=N,N.classList.add("connecting","react-flow__handle-connecting"),N.classList.toggle("valid",R),N.classList.toggle("react-flow__handle-valid",R))}function D(e){var t,n;(b||N)&&k&&R&&(null==r||r(k)),null==(n=(t=a()).onConnectEnd)||n.call(t,e),l&&(null==c||c(e)),Yi(T),y(),cancelAnimationFrame(x),A=!1,R=!1,k=null,N=null,u.removeEventListener("mousemove",L),u.removeEventListener("mouseup",D),u.removeEventListener("touchmove",L),u.removeEventListener("touchend",D)}o({connectionPosition:C,connectionStatus:null,connectionNodeId:n,connectionHandleId:t,connectionHandleType:M,connectionStartHandle:{nodeId:n,handleId:t,type:M},connectionEndHandle:null}),null==m||m(e,{nodeId:n,handleId:t,handleType:M}),u.addEventListener("mousemove",L),u.addEventListener("mouseup",D),u.addEventListener("touchmove",L),u.addEventListener("touchend",D)}const Ji=()=>!0,Qi=e=>({connectionStartHandle:e.connectionStartHandle,connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName}),ea=h.forwardRef(({type:e="source",position:t=mi.Top,isValidConnection:n,isConnectable:r=!0,isConnectableStart:i=!0,isConnectableEnd:a=!0,id:o,onConnect:s,children:l,className:c,onMouseDown:u,onTouchStart:d,...h},p)=>{var m,g;const v=o||null,y="target"===e,b=Pr(),x=Pi(),{connectOnClick:_,noPanClassName:w}=Nr(Qi,W),{connecting:S,clickConnecting:M}=Nr(((e,t,n)=>r=>{const{connectionStartHandle:i,connectionEndHandle:a,connectionClickStartHandle:o}=r;return{connecting:(null==i?void 0:i.nodeId)===e&&(null==i?void 0:i.handleId)===t&&(null==i?void 0:i.type)===n||(null==a?void 0:a.nodeId)===e&&(null==a?void 0:a.handleId)===t&&(null==a?void 0:a.type)===n,clickConnecting:(null==o?void 0:o.nodeId)===e&&(null==o?void 0:o.handleId)===t&&(null==o?void 0:o.type)===n}})(x,v,e),W);x||null==(g=(m=b.getState()).onError)||g.call(m,"010","Handle: No node id found. Make sure to only use a Handle inside a custom Node.");const E=e=>{const{defaultEdgeOptions:t,onConnect:n,hasDefaultEdges:r}=b.getState(),i={...t,...e};if(r){const{edges:e,setEdges:t}=b.getState();t(Di(i,e))}null==n||n(i),null==s||s(i)},T=e=>{if(!x)return;const t=Jr(e);i&&(t&&0===e.button||!t)&&Ki({event:e,handleId:v,nodeId:x,onConnect:E,isTarget:y,getState:b.getState,setState:b.setState,isValidConnection:n||b.getState().isValidConnection||Ji}),t?null==u||u(e):null==d||d(e)};return f.createElement("div",{"data-handleid":v,"data-nodeid":x,"data-handlepos":t,"data-id":`${x}-${v}-${e}`,className:A(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",w,c,{source:!y,target:y,connectable:r,connectablestart:i,connectableend:a,connecting:M,connectionindicator:r&&(i&&!S||a&&S)}]),onMouseDown:T,onTouchStart:T,onClick:_?t=>{const{onClickConnectStart:r,onClickConnectEnd:a,connectionClickStartHandle:o,connectionMode:s,isValidConnection:l}=b.getState();if(!x||!o&&!i)return;if(!o)return null==r||r(t,{nodeId:x,handleId:v,handleType:e}),void b.setState({connectionClickStartHandle:{nodeId:x,type:e,handleId:v}});const c=Hr(t.target),u=n||l||Ji,{connection:d,isValid:h}=Xi({nodeId:x,id:v,type:e},s,o.nodeId,o.handleId||null,o.type,u,c);h&&E(d),null==a||a(t),b.setState({connectionClickStartHandle:null})}:void 0,ref:p,...h},l)});ea.displayName="Handle";var ta=h.memo(ea);const na=({data:e,isConnectable:t,targetPosition:n=mi.Top,sourcePosition:r=mi.Bottom})=>f.createElement(f.Fragment,null,f.createElement(ta,{type:"target",position:n,isConnectable:t}),null==e?void 0:e.label,f.createElement(ta,{type:"source",position:r,isConnectable:t}));na.displayName="DefaultNode";var ra=h.memo(na);const ia=({data:e,isConnectable:t,sourcePosition:n=mi.Bottom})=>f.createElement(f.Fragment,null,null==e?void 0:e.label,f.createElement(ta,{type:"source",position:n,isConnectable:t}));ia.displayName="InputNode";var aa=h.memo(ia);const oa=({data:e,isConnectable:t,targetPosition:n=mi.Top})=>f.createElement(f.Fragment,null,f.createElement(ta,{type:"target",position:n,isConnectable:t}),null==e?void 0:e.label);oa.displayName="OutputNode";var sa=h.memo(oa);const la=()=>null;la.displayName="GroupNode";const ca=e=>({selectedNodes:e.getNodes().filter(e=>e.selected),selectedEdges:e.edges.filter(e=>e.selected).map(e=>({...e}))}),ua=e=>e.id;function da(e,t){return W(e.selectedNodes.map(ua),t.selectedNodes.map(ua))&&W(e.selectedEdges.map(ua),t.selectedEdges.map(ua))}const ha=h.memo(({onSelectionChange:e})=>{const t=Pr(),{selectedNodes:n,selectedEdges:r}=Nr(ca,da);return h.useEffect(()=>{const i={nodes:n,edges:r};null==e||e(i),t.getState().onSelectionChange.forEach(e=>e(i))},[n,r,e]),null});ha.displayName="SelectionListener";const fa=e=>!!e.onSelectionChange;function pa({onSelectionChange:e}){const t=Nr(fa);return e||t?f.createElement(ha,{onSelectionChange:e}):null}const ma=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset});function ga(e,t){h.useEffect(()=>{void 0!==e&&t(e)},[e])}function va(e,t,n){h.useEffect(()=>{void 0!==t&&n({[e]:t})},[t])}const ya=({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,onConnect:i,onConnectStart:a,onConnectEnd:o,onClickConnectStart:s,onClickConnectEnd:l,nodesDraggable:c,nodesConnectable:u,nodesFocusable:d,edgesFocusable:f,edgesUpdatable:p,elevateNodesOnSelect:m,minZoom:g,maxZoom:v,nodeExtent:y,onNodesChange:b,onEdgesChange:x,elementsSelectable:_,connectionMode:w,snapGrid:S,snapToGrid:M,translateExtent:E,connectOnClick:T,defaultEdgeOptions:C,fitView:A,fitViewOptions:k,onNodesDelete:R,onEdgesDelete:N,onNodeDrag:P,onNodeDragStart:I,onNodeDragStop:L,onSelectionDrag:D,onSelectionDragStart:z,onSelectionDragStop:O,noPanClassName:U,nodeOrigin:F,rfId:B,autoPanOnConnect:j,autoPanOnNodeDrag:H,onError:V,connectionRadius:G,isValidConnection:$,nodeDragThreshold:X})=>{const{setNodes:q,setEdges:Y,setDefaultNodesAndEdges:Z,setMinZoom:K,setMaxZoom:J,setTranslateExtent:Q,setNodeExtent:ee,reset:te}=Nr(ma,W),ne=Pr();return h.useEffect(()=>{const e=null==r?void 0:r.map(e=>({...e,...C}));return Z(n,e),()=>{te()}},[]),va("defaultEdgeOptions",C,ne.setState),va("connectionMode",w,ne.setState),va("onConnect",i,ne.setState),va("onConnectStart",a,ne.setState),va("onConnectEnd",o,ne.setState),va("onClickConnectStart",s,ne.setState),va("onClickConnectEnd",l,ne.setState),va("nodesDraggable",c,ne.setState),va("nodesConnectable",u,ne.setState),va("nodesFocusable",d,ne.setState),va("edgesFocusable",f,ne.setState),va("edgesUpdatable",p,ne.setState),va("elementsSelectable",_,ne.setState),va("elevateNodesOnSelect",m,ne.setState),va("snapToGrid",M,ne.setState),va("snapGrid",S,ne.setState),va("onNodesChange",b,ne.setState),va("onEdgesChange",x,ne.setState),va("connectOnClick",T,ne.setState),va("fitViewOnInit",A,ne.setState),va("fitViewOnInitOptions",k,ne.setState),va("onNodesDelete",R,ne.setState),va("onEdgesDelete",N,ne.setState),va("onNodeDrag",P,ne.setState),va("onNodeDragStart",I,ne.setState),va("onNodeDragStop",L,ne.setState),va("onSelectionDrag",D,ne.setState),va("onSelectionDragStart",z,ne.setState),va("onSelectionDragStop",O,ne.setState),va("noPanClassName",U,ne.setState),va("nodeOrigin",F,ne.setState),va("rfId",B,ne.setState),va("autoPanOnConnect",j,ne.setState),va("autoPanOnNodeDrag",H,ne.setState),va("onError",V,ne.setState),va("connectionRadius",G,ne.setState),va("isValidConnection",$,ne.setState),va("nodeDragThreshold",X,ne.setState),ga(e,q),ga(t,Y),ga(g,K),ga(v,J),ga(E,Q),ga(y,ee),null},ba={display:"none"},xa={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},_a="react-flow__node-desc",wa="react-flow__edge-desc",Sa=e=>e.ariaLiveMessage;function Ma({rfId:e}){const t=Nr(Sa);return f.createElement("div",{id:`react-flow__aria-live-${e}`,"aria-live":"assertive","aria-atomic":"true",style:xa},t)}function Ea({rfId:e,disableKeyboardA11y:t}){return f.createElement(f.Fragment,null,f.createElement("div",{id:`${_a}-${e}`,style:ba},"Press enter or space to select a node.",!t&&"You can then use the arrow keys to move the node around."," Press delete to remove it and escape to cancel."," "),f.createElement("div",{id:`${wa}-${e}`,style:ba},"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel."),!t&&f.createElement(Ma,{rfId:e}))}var Ta=(e=null,t={actInsideInputWithModifier:!0})=>{const[n,r]=h.useState(!1),i=h.useRef(!1),a=h.useRef(new Set([])),[o,s]=h.useMemo(()=>{if(null!==e){const t=(Array.isArray(e)?e:[e]).filter(e=>"string"==typeof e).map(e=>e.split("+")),n=t.reduce((e,t)=>e.concat(...t),[]);return[t,n]}return[[],[]]},[e]);return h.useEffect(()=>{const n="undefined"!=typeof document?document:null,l=(null==t?void 0:t.target)||n;if(null!==e){const e=e=>{if(i.current=e.ctrlKey||e.metaKey||e.shiftKey,(!i.current||i.current&&!t.actInsideInputWithModifier)&&Kr(e))return!1;const n=Aa(e.code,s);a.current.add(e[n]),Ca(o,a.current,!1)&&(e.preventDefault(),r(!0))},n=e=>{if((!i.current||i.current&&!t.actInsideInputWithModifier)&&Kr(e))return!1;const n=Aa(e.code,s);Ca(o,a.current,!0)?(r(!1),a.current.clear()):a.current.delete(e[n]),"Meta"===e.key&&a.current.clear(),i.current=!1},c=()=>{a.current.clear(),r(!1)};return null==l||l.addEventListener("keydown",e),null==l||l.addEventListener("keyup",n),window.addEventListener("blur",c),()=>{null==l||l.removeEventListener("keydown",e),null==l||l.removeEventListener("keyup",n),window.removeEventListener("blur",c)}}},[e,r]),n};function Ca(e,t,n){return e.filter(e=>n||e.length===t.size).some(e=>e.every(e=>t.has(e)))}function Aa(e,t){return t.includes(e)?"code":"key"}function ka(e,t,n,r){var i,a;const o=e.parentNode||e.parentId;if(!o)return n;const s=t.get(o),l=Ui(s,r);return ka(s,t,{x:(n.x??0)+l.x,y:(n.y??0)+l.y,z:((null==(i=s[Yr])?void 0:i.z)??0)>(n.z??0)?(null==(a=s[Yr])?void 0:a.z)??0:n.z??0},r)}function Ra(e,t,n){e.forEach(r=>{var i;const a=r.parentNode||r.parentId;if(a&&!e.has(a))throw new Error(`Parent node ${a} not found`);if(a||(null==n?void 0:n[r.id])){const{x:a,y:o,z:s}=ka(r,e,{...r.position,z:(null==(i=r[Yr])?void 0:i.z)??0},t);r.positionAbsolute={x:a,y:o},r[Yr].z=s,(null==n?void 0:n[r.id])&&(r[Yr].isParent=!0)}})}function Na(e,t,n,r){const i=new Map,a={},o=r?1e3:0;return e.forEach(e=>{var n;const r=(qr(e.zIndex)?e.zIndex:0)+(e.selected?o:0),s=t.get(e.id),l={...e,positionAbsolute:{x:e.position.x,y:e.position.y}},c=e.parentNode||e.parentId;c&&(a[c]=!0);const u=(null==s?void 0:s.type)&&(null==s?void 0:s.type)!==e.type;Object.defineProperty(l,Yr,{enumerable:!1,value:{handleBounds:u||null==(n=null==s?void 0:s[Yr])?void 0:n.handleBounds,z:r}}),i.set(e.id,l)}),Ra(i,n,a),i}function Pa(e,t={}){const{getNodes:n,width:r,height:i,minZoom:a,maxZoom:o,d3Zoom:s,d3Selection:l,fitViewOnInitDone:c,fitViewOnInit:u,nodeOrigin:d}=e(),h=t.initial&&!c&&u;if(s&&l&&(h||!t.initial)){const e=n().filter(e=>{var n;const r=t.includeHiddenNodes?e.width&&e.height:!e.hidden;return(null==(n=t.nodes)?void 0:n.length)?r&&t.nodes.some(t=>t.id===e.id):r}),c=e.every(e=>e.width&&e.height);if(e.length>0&&c){const n=Fi(e,d),{x:c,y:u,zoom:h}=Hi(n,r,i,t.minZoom??a,t.maxZoom??o,t.padding??.1),f=yr.translate(c,u).scale(h);return"number"==typeof t.duration&&t.duration>0?s.transform(Vi(l,t.duration),f):s.transform(l,f),!0}}return!1}function Ia(e,t){return e.forEach(e=>{const n=t.get(e.id);n&&t.set(n.id,{...n,[Yr]:n[Yr],selected:e.selected})}),new Map(t)}function La(e,t){return t.map(t=>{const n=e.find(e=>e.id===t.id);return n&&(t.selected=n.selected),t})}function Da({changedNodes:e,changedEdges:t,get:n,set:r}){const{nodeInternals:i,edges:a,onNodesChange:o,onEdgesChange:s,hasDefaultNodes:l,hasDefaultEdges:c}=n();(null==e?void 0:e.length)&&(l&&r({nodeInternals:Ia(e,i)}),null==o||o(e)),(null==t?void 0:t.length)&&(c&&r({edges:La(t,a)}),null==s||s(t))}const za=()=>{},Oa={zoomIn:za,zoomOut:za,zoomTo:za,getZoom:()=>1,setViewport:za,getViewport:()=>({x:0,y:0,zoom:1}),fitView:()=>!1,setCenter:za,fitBounds:za,project:e=>e,screenToFlowPosition:e=>e,flowToScreenPosition:e=>e,viewportInitialized:!1},Ua=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection});function Fa(){const e=(()=>{const e=Pr(),{d3Zoom:t,d3Selection:n}=Nr(Ua,W);return h.useMemo(()=>n&&t?{zoomIn:e=>t.scaleBy(Vi(n,null==e?void 0:e.duration),1.2),zoomOut:e=>t.scaleBy(Vi(n,null==e?void 0:e.duration),1/1.2),zoomTo:(e,r)=>t.scaleTo(Vi(n,null==r?void 0:r.duration),e),getZoom:()=>e.getState().transform[2],setViewport:(r,i)=>{const[a,o,s]=e.getState().transform,l=yr.translate(r.x??a,r.y??o).scale(r.zoom??s);t.transform(Vi(n,null==i?void 0:i.duration),l)},getViewport:()=>{const[t,n,r]=e.getState().transform;return{x:t,y:n,zoom:r}},fitView:t=>Pa(e.getState,t),setCenter:(r,i,a)=>{const{width:o,height:s,maxZoom:l}=e.getState(),c=void 0!==(null==a?void 0:a.zoom)?a.zoom:l,u=o/2-r*c,d=s/2-i*c,h=yr.translate(u,d).scale(c);t.transform(Vi(n,null==a?void 0:a.duration),h)},fitBounds:(r,i)=>{const{width:a,height:o,minZoom:s,maxZoom:l}=e.getState(),{x:c,y:u,zoom:d}=Hi(r,a,o,s,l,(null==i?void 0:i.padding)??.1),h=yr.translate(c,u).scale(d);t.transform(Vi(n,null==i?void 0:i.duration),h)},project:t=>{const{transform:n,snapToGrid:r,snapGrid:i}=e.getState();return console.warn("[DEPRECATED] `project` is deprecated. Instead use `screenToFlowPosition`. There is no need to subtract the react flow bounds anymore! https://reactflow.dev/api-reference/types/react-flow-instance#screen-to-flow-position"),zi(t,n,r,i)},screenToFlowPosition:t=>{const{transform:n,snapToGrid:r,snapGrid:i,domNode:a}=e.getState();if(!a)return t;const{x:o,y:s}=a.getBoundingClientRect(),l={x:t.x-o,y:t.y-s};return zi(l,n,r,i)},flowToScreenPosition:t=>{const{transform:n,domNode:r}=e.getState();if(!r)return t;const{x:i,y:a}=r.getBoundingClientRect(),o=Oi(t,n);return{x:o.x+i,y:o.y+a}},viewportInitialized:!0}:Oa,[t,n])})(),t=Pr(),n=h.useCallback(()=>t.getState().getNodes().map(e=>({...e})),[]),r=h.useCallback(e=>t.getState().nodeInternals.get(e),[]),i=h.useCallback(()=>{const{edges:e=[]}=t.getState();return e.map(e=>({...e}))},[]),a=h.useCallback(e=>{const{edges:n=[]}=t.getState();return n.find(t=>t.id===e)},[]),o=h.useCallback(e=>{const{getNodes:n,setNodes:r,hasDefaultNodes:i,onNodesChange:a}=t.getState(),o=n(),s="function"==typeof e?e(o):e;i?r(s):a&&a(0===s.length?o.map(e=>({type:"remove",id:e.id})):s.map(e=>({item:e,type:"reset"})))},[]),s=h.useCallback(e=>{const{edges:n=[],setEdges:r,hasDefaultEdges:i,onEdgesChange:a}=t.getState(),o="function"==typeof e?e(n):e;i?r(o):a&&a(0===o.length?n.map(e=>({type:"remove",id:e.id})):o.map(e=>({item:e,type:"reset"})))},[]),l=h.useCallback(e=>{const n=Array.isArray(e)?e:[e],{getNodes:r,setNodes:i,hasDefaultNodes:a,onNodesChange:o}=t.getState();a?i([...r(),...n]):o&&o(n.map(e=>({item:e,type:"add"})))},[]),c=h.useCallback(e=>{const n=Array.isArray(e)?e:[e],{edges:r=[],setEdges:i,hasDefaultEdges:a,onEdgesChange:o}=t.getState();a?i([...r,...n]):o&&o(n.map(e=>({item:e,type:"add"})))},[]),u=h.useCallback(()=>{const{getNodes:e,edges:n=[],transform:r}=t.getState(),[i,a,o]=r;return{nodes:e().map(e=>({...e})),edges:n.map(e=>({...e})),viewport:{x:i,y:a,zoom:o}}},[]),d=h.useCallback(({nodes:e,edges:n})=>{const{nodeInternals:r,getNodes:i,edges:a,hasDefaultNodes:o,hasDefaultEdges:s,onNodesDelete:l,onEdgesDelete:c,onNodesChange:u,onEdgesChange:d}=t.getState(),h=(e||[]).map(e=>e.id),f=(n||[]).map(e=>e.id),p=i().reduce((e,t)=>{const n=t.parentNode||t.parentId,r=!h.includes(t.id)&&n&&e.find(e=>e.id===n);return("boolean"!=typeof t.deletable||t.deletable)&&(h.includes(t.id)||r)&&e.push(t),e},[]),m=a.filter(e=>"boolean"!=typeof e.deletable||e.deletable),g=m.filter(e=>f.includes(e.id));if(p||g){const e=ji(p,m),n=[...g,...e],i=n.reduce((e,t)=>(e.includes(t.id)||e.push(t.id),e),[]);(s||o)&&(s&&t.setState({edges:a.filter(e=>!i.includes(e.id))}),o&&(p.forEach(e=>{r.delete(e.id)}),t.setState({nodeInternals:new Map(r)}))),i.length>0&&(null==c||c(n),d&&d(i.map(e=>({id:e,type:"remove"})))),p.length>0&&(null==l||l(p),u)&&u(p.map(e=>({id:e.id,type:"remove"})))}},[]),f=h.useCallback(e=>{const n=qr((r=e).width)&&qr(r.height)&&qr(r.x)&&qr(r.y);var r;const i=n?null:t.getState().nodeInternals.get(e.id);return n||i?[n?e:$r(i),i,n]:[null,null,n]},[]),p=h.useCallback((e,n=!0,r)=>{const[i,a,o]=f(e);return i?(r||t.getState().getNodes()).filter(e=>{if(!(o||e.id!==a.id&&e.positionAbsolute))return!1;const t=$r(e),r=Xr(t,i);return n&&r>0||r>=i.width*i.height}):[]},[]),m=h.useCallback((e,t,n=!0)=>{const[r]=f(e);if(!r)return!1;const i=Xr(r,t);return n&&i>0||i>=r.width*r.height},[]);return h.useMemo(()=>({...e,getNodes:n,getNode:r,getEdges:i,getEdge:a,setNodes:o,setEdges:s,addNodes:l,addEdges:c,toObject:u,deleteElements:d,getIntersectingNodes:p,isNodeIntersecting:m}),[e,n,r,i,a,o,s,l,c,u,d,p,m])}const Ba={actInsideInputWithModifier:!1},ja={position:"absolute",width:"100%",height:"100%",top:0,left:0},Ha=e=>({x:e.x,y:e.y,zoom:e.k}),Va=(e,t)=>e.target.closest(`.${t}`),Ga=(e,t)=>2===t&&Array.isArray(e)&&e.includes(2),Wa=e=>{const t=e.ctrlKey&&ei()?10:1;return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*t},$a=e=>({d3Zoom:e.d3Zoom,d3Selection:e.d3Selection,d3ZoomHandler:e.d3ZoomHandler,userSelectionActive:e.userSelectionActive}),Xa=({onMove:e,onMoveStart:t,onMoveEnd:n,onPaneContextMenu:r,zoomOnScroll:i=!0,zoomOnPinch:a=!0,panOnScroll:o=!1,panOnScrollSpeed:s=.5,panOnScrollMode:l=si.Free,zoomOnDoubleClick:c=!0,elementsSelectable:u,panOnDrag:d=!0,defaultViewport:p,translateExtent:m,minZoom:g,maxZoom:v,zoomActivationKeyCode:y,preventScrolling:b=!0,children:x,noWheelClassName:_,noPanClassName:w})=>{const S=h.useRef(),M=Pr(),E=h.useRef(!1),T=h.useRef(!1),C=h.useRef(null),A=h.useRef({x:0,y:0,zoom:0}),{d3Zoom:k,d3Selection:R,d3ZoomHandler:N,userSelectionActive:P}=Nr($a,W),I=Ta(y),L=h.useRef(0),D=h.useRef(!1),z=h.useRef();return function(e){const t=Pr();h.useEffect(()=>{let n;const r=()=>{var n,r;if(!e.current)return;const i=Or(e.current);0!==i.height&&0!==i.width||null==(r=(n=t.getState()).onError)||r.call(n,"004","The React Flow parent container needs a width and a height to render the graph."),t.setState({width:i.width||500,height:i.height||500})};return r(),window.addEventListener("resize",r),e.current&&(n=new ResizeObserver(()=>r()),n.observe(e.current)),()=>{window.removeEventListener("resize",r),n&&e.current&&n.unobserve(e.current)}},[])}(C),h.useEffect(()=>{if(C.current){const e=C.current.getBoundingClientRect(),t=Cr().scaleExtent([g,v]).translateExtent(m),n=lt(C.current).call(t),r=yr.translate(p.x,p.y).scale(Ur(p.zoom,g,v)),i=[[0,0],[e.width,e.height]],a=t.constrain()(r,i,m);t.transform(n,a),t.wheelDelta(Wa),M.setState({d3Zoom:t,d3Selection:n,d3ZoomHandler:n.on("wheel.zoom"),transform:[a.x,a.y,a.k],domNode:C.current.closest(".react-flow")})}},[]),h.useEffect(()=>{R&&k&&(!o||I||P?void 0!==N&&R.on("wheel.zoom",function(e,t){if(!b&&"wheel"===e.type&&!e.ctrlKey||Va(e,_))return null;e.preventDefault(),N.call(this,e,t)},{passive:!1}):R.on("wheel.zoom",r=>{if(Va(r,_))return!1;r.preventDefault(),r.stopImmediatePropagation();const i=R.property("__zoom").k||1;if(r.ctrlKey&&a){const e=ct(r),t=Wa(r),n=i*Math.pow(2,t);return void k.scaleTo(R,n,e,r)}const o=1===r.deltaMode?20:1;let c=l===si.Vertical?0:r.deltaX*o,u=l===si.Horizontal?0:r.deltaY*o;!ei()&&r.shiftKey&&l!==si.Vertical&&(c=r.deltaY*o,u=0),k.translateBy(R,-c/i*s,-u/i*s,{internal:!0});const d=Ha(R.property("__zoom")),{onViewportChangeStart:h,onViewportChange:f,onViewportChangeEnd:p}=M.getState();clearTimeout(z.current),D.current||(D.current=!0,null==t||t(r,d),null==h||h(d)),D.current&&(null==e||e(r,d),null==f||f(d),z.current=setTimeout(()=>{null==n||n(r,d),null==p||p(d),D.current=!1},150))},{passive:!1}))},[P,o,l,R,k,N,I,a,b,_,t,e,n]),h.useEffect(()=>{k&&k.on("start",e=>{var n,r;if(!e.sourceEvent||e.sourceEvent.internal)return null;L.current=null==(n=e.sourceEvent)?void 0:n.button;const{onViewportChangeStart:i}=M.getState(),a=Ha(e.transform);E.current=!0,A.current=a,"mousedown"===(null==(r=e.sourceEvent)?void 0:r.type)&&M.setState({paneDragging:!0}),null==i||i(a),null==t||t(e.sourceEvent,a)})},[k,t]),h.useEffect(()=>{k&&(P&&!E.current?k.on("zoom",null):P||k.on("zoom",t=>{var n;const{onViewportChange:i}=M.getState();if(M.setState({transform:[t.transform.x,t.transform.y,t.transform.k]}),T.current=!(!r||!Ga(d,L.current??0)),(e||i)&&!(null==(n=t.sourceEvent)?void 0:n.internal)){const n=Ha(t.transform);null==i||i(n),null==e||e(t.sourceEvent,n)}}))},[P,k,e,d,r]),h.useEffect(()=>{k&&k.on("end",e=>{if(!e.sourceEvent||e.sourceEvent.internal)return null;const{onViewportChangeEnd:t}=M.getState();if(E.current=!1,M.setState({paneDragging:!1}),r&&Ga(d,L.current??0)&&!T.current&&r(e.sourceEvent),T.current=!1,(n||t)&&(i=A.current,a=e.transform,i.x!==a.x||i.y!==a.y||i.zoom!==a.k)){const r=Ha(e.transform);A.current=r,clearTimeout(S.current),S.current=setTimeout(()=>{null==t||t(r),null==n||n(e.sourceEvent,r)},o?150:0)}var i,a})},[k,o,d,n,r]),h.useEffect(()=>{k&&k.filter(e=>{const t=I||i,n=a&&e.ctrlKey;if((!0===d||Array.isArray(d)&&d.includes(1))&&1===e.button&&"mousedown"===e.type&&(Va(e,"react-flow__node")||Va(e,"react-flow__edge")))return!0;if(!(d||t||o||c||a))return!1;if(P)return!1;if(!c&&"dblclick"===e.type)return!1;if(Va(e,_)&&"wheel"===e.type)return!1;if(Va(e,w)&&("wheel"!==e.type||o&&"wheel"===e.type&&!I))return!1;if(!a&&e.ctrlKey&&"wheel"===e.type)return!1;if(!t&&!o&&!n&&"wheel"===e.type)return!1;if(!d&&("mousedown"===e.type||"touchstart"===e.type))return!1;if(Array.isArray(d)&&!d.includes(e.button)&&"mousedown"===e.type)return!1;const r=Array.isArray(d)&&d.includes(e.button)||!e.button||e.button<=1;return(!e.ctrlKey||"wheel"===e.type)&&r})},[P,k,i,a,o,c,d,u,I]),f.createElement("div",{className:"react-flow__renderer",ref:C,style:ja},x)},qa=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function Ya(){const{userSelectionActive:e,userSelectionRect:t}=Nr(qa,W);return e&&t?f.createElement("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}function Za(e,t){const n=t.parentNode||t.parentId,r=e.find(e=>e.id===n);if(r){const e=t.position.x+t.width-r.width,n=t.position.y+t.height-r.height;if(e>0||n>0||t.position.x<0||t.position.y<0){if(r.style={...r.style},r.style.width=r.style.width??r.width,r.style.height=r.style.height??r.height,e>0&&(r.style.width+=e),n>0&&(r.style.height+=n),t.position.x<0){const e=Math.abs(t.position.x);r.position.x=r.position.x-e,r.style.width+=e,t.position.x=0}if(t.position.y<0){const e=Math.abs(t.position.y);r.position.y=r.position.y-e,r.style.height+=e,t.position.y=0}r.width=r.style.width,r.height=r.style.height}}}function Ka(e,t){if(e.some(e=>"reset"===e.type))return e.filter(e=>"reset"===e.type).map(e=>e.item);const n=e.filter(e=>"add"===e.type).map(e=>e.item);return t.reduce((t,n)=>{const r=e.filter(e=>e.id===n.id);if(0===r.length)return t.push(n),t;const i={...n};for(const e of r)if(e)switch(e.type){case"select":i.selected=e.selected;break;case"position":void 0!==e.position&&(i.position=e.position),void 0!==e.positionAbsolute&&(i.positionAbsolute=e.positionAbsolute),void 0!==e.dragging&&(i.dragging=e.dragging),i.expandParent&&Za(t,i);break;case"dimensions":void 0!==e.dimensions&&(i.width=e.dimensions.width,i.height=e.dimensions.height),void 0!==e.updateStyle&&(i.style={...i.style||{},...e.dimensions}),"boolean"==typeof e.resizing&&(i.resizing=e.resizing),i.expandParent&&Za(t,i);break;case"remove":return t}return t.push(i),t},n)}function Ja(e,t){return Ka(e,t)}const Qa=(e,t)=>({id:e,type:"select",selected:t});function eo(e,t){return e.reduce((e,n)=>{const r=t.includes(n.id);return!n.selected&&r?(n.selected=!0,e.push(Qa(n.id,!0))):n.selected&&!r&&(n.selected=!1,e.push(Qa(n.id,!1))),e},[])}const to=(e,t)=>n=>{n.target===t.current&&(null==e||e(n))},no=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,dragging:e.paneDragging}),ro=h.memo(({isSelecting:e,selectionMode:t=ci.Full,panOnDrag:n,onSelectionStart:r,onSelectionEnd:i,onPaneClick:a,onPaneContextMenu:o,onPaneScroll:s,onPaneMouseEnter:l,onPaneMouseMove:c,onPaneMouseLeave:u,children:d})=>{const p=h.useRef(null),m=Pr(),g=h.useRef(0),v=h.useRef(0),y=h.useRef(),{userSelectionActive:b,elementsSelectable:x,dragging:_}=Nr(no,W),w=()=>{m.setState({userSelectionActive:!1,userSelectionRect:null}),g.current=0,v.current=0},S=e=>{null==a||a(e),m.getState().resetSelectedElements(),m.setState({nodesSelectionActive:!1})},M=s?e=>s(e):void 0,E=x&&(e||b);return f.createElement("div",{className:A(["react-flow__pane",{dragging:_,selection:e}]),onClick:E?void 0:to(S,p),onContextMenu:to(e=>{Array.isArray(n)&&(null==n?void 0:n.includes(2))?e.preventDefault():null==o||o(e)},p),onWheel:to(M,p),onMouseEnter:E?void 0:l,onMouseDown:E?t=>{const{resetSelectedElements:n,domNode:i}=m.getState();if(y.current=null==i?void 0:i.getBoundingClientRect(),!x||!e||0!==t.button||t.target!==p.current||!y.current)return;const{x:a,y:o}=Qr(t,y.current);n(),m.setState({userSelectionRect:{width:0,height:0,startX:a,startY:o,x:a,y:o}}),null==r||r(t)}:void 0,onMouseMove:E?n=>{const{userSelectionRect:r,nodeInternals:i,edges:a,transform:o,onNodesChange:s,onEdgesChange:l,nodeOrigin:c,getNodes:u}=m.getState();if(!e||!y.current||!r)return;m.setState({userSelectionActive:!0,nodesSelectionActive:!1});const d=Qr(n,y.current),h=r.startX??0,f=r.startY??0,p={...r,x:d.x<h?d.x:h,y:d.y<f?d.y:f,width:Math.abs(d.x-h),height:Math.abs(d.y-f)},b=u(),x=Bi(i,p,o,t===ci.Partial,!0,c),_=ji(x,a).map(e=>e.id),w=x.map(e=>e.id);if(g.current!==w.length){g.current=w.length;const e=eo(b,w);e.length&&(null==s||s(e))}if(v.current!==_.length){v.current=_.length;const e=eo(a,_);e.length&&(null==l||l(e))}m.setState({userSelectionRect:p})}:c,onMouseUp:E?e=>{if(0!==e.button)return;const{userSelectionRect:t}=m.getState();!b&&t&&e.target===p.current&&(null==S||S(e)),m.setState({nodesSelectionActive:g.current>0}),w(),null==i||i(e)}:void 0,onMouseLeave:E?e=>{b&&(m.setState({nodesSelectionActive:g.current>0}),null==i||i(e)),w()}:u,ref:p,style:ja},d,f.createElement(Ya,null))});function io(e,t){const n=e.parentNode||e.parentId;if(!n)return!1;const r=t.get(n);return!!r&&(!!r.selected||io(r,t))}function ao(e,t,n){let r=e;do{if(null==r?void 0:r.matches(t))return!0;if(r===n.current)return!1;r=r.parentElement}while(r);return!1}function oo(e,t,n,r){return Array.from(e.values()).filter(n=>(n.selected||n.id===r)&&(!n.parentNode||n.parentId||!io(n,e))&&(n.draggable||t&&void 0===n.draggable)).map(e=>{var t,r;return{id:e.id,position:e.position||{x:0,y:0},positionAbsolute:e.positionAbsolute||{x:0,y:0},distance:{x:n.x-((null==(t=e.positionAbsolute)?void 0:t.x)??0),y:n.y-((null==(r=e.positionAbsolute)?void 0:r.y)??0)},delta:{x:0,y:0},extent:e.extent,parentNode:e.parentNode||e.parentId,parentId:e.parentNode||e.parentId,width:e.width,height:e.height,expandParent:e.expandParent}})}function so(e,t,n,r,i=[0,0],a){const o=function(e,t){return t&&"parent"!==t?[t[0],[t[1][0]-(e.width||0),t[1][1]-(e.height||0)]]:t}(e,e.extent||r);let s=o;const l=e.parentNode||e.parentId;if("parent"!==e.extent||e.expandParent){if(e.extent&&l&&"parent"!==e.extent){const t=n.get(l),{x:r,y:a}=Ui(t,i).positionAbsolute;s=[[e.extent[0][0]+r,e.extent[0][1]+a],[e.extent[1][0]+r,e.extent[1][1]+a]]}}else if(l&&e.width&&e.height){const t=n.get(l),{x:r,y:a}=Ui(t,i).positionAbsolute;s=t&&qr(r)&&qr(a)&&qr(t.width)&&qr(t.height)?[[r+e.width*i[0],a+e.height*i[1]],[r+t.width-e.width+e.width*i[0],a+t.height-e.height+e.height*i[1]]]:s}else null==a||a("005","Only child nodes can use a parent extent."),s=o;let c={x:0,y:0};if(l){const e=n.get(l);c=Ui(e,i).positionAbsolute}const u=s&&"parent"!==s?Fr(t,s):t;return{position:{x:u.x-c.x,y:u.y-c.y},positionAbsolute:u}}function lo({nodeId:e,dragItems:t,nodeInternals:n}){const r=t.map(e=>({...n.get(e.id),position:e.position,positionAbsolute:e.positionAbsolute}));return[e?r.find(t=>t.id===e):r[0],r]}ro.displayName="Pane";const co=(e,t,n,r)=>{const i=t.querySelectorAll(e);if(!i||!i.length)return null;const a=Array.from(i),o=t.getBoundingClientRect(),s=o.width*r[0],l=o.height*r[1];return a.map(e=>{const t=e.getBoundingClientRect();return{id:e.getAttribute("data-handleid"),position:e.getAttribute("data-handlepos"),x:(t.left-o.left-s)/n,y:(t.top-o.top-l)/n,...Or(e)}})};function uo(e,t,n){return void 0===n?n:r=>{const i=t().nodeInternals.get(e);i&&n(r,{...i})}}function ho({id:e,store:t,unselect:n=!1,nodeRef:r}){const{addSelectedNodes:i,unselectNodesAndEdges:a,multiSelectionActive:o,nodeInternals:s,onError:l}=t.getState(),c=s.get(e);c?(t.setState({nodesSelectionActive:!1}),c.selected?(n||c.selected&&o)&&(a({nodes:[c],edges:[]}),requestAnimationFrame(()=>{var e;return null==(e=null==r?void 0:r.current)?void 0:e.blur()})):i([e])):null==l||l("012",(e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`)(e))}function fo(){const e=Pr();return h.useCallback(({sourceEvent:t})=>{const{transform:n,snapGrid:r,snapToGrid:i}=e.getState(),a=t.touches?t.touches[0].clientX:t.clientX,o=t.touches?t.touches[0].clientY:t.clientY,s={x:(a-n[0])/n[2],y:(o-n[1])/n[2]};return{xSnapped:i?r[0]*Math.round(s.x/r[0]):s.x,ySnapped:i?r[1]*Math.round(s.y/r[1]):s.y,...s}},[])}function po(e){return(t,n,r)=>null==e?void 0:e(t,r)}function mo({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:r,nodeId:i,isSelectable:a,selectNodesOnDrag:o}){const s=Pr(),[l,c]=h.useState(!1),u=h.useRef([]),d=h.useRef({x:null,y:null}),f=h.useRef(0),p=h.useRef(null),m=h.useRef({x:0,y:0}),g=h.useRef(null),v=h.useRef(!1),y=h.useRef(!1),b=h.useRef(!1),x=fo();return h.useEffect(()=>{if(null==e?void 0:e.current){const l=lt(e.current),h=({x:e,y:t})=>{const{nodeInternals:n,onNodeDrag:r,onSelectionDrag:a,updateNodePositions:o,nodeExtent:l,snapGrid:h,snapToGrid:f,nodeOrigin:p,onError:m}=s.getState();d.current={x:e,y:t};let v=!1,y={x:0,y:0,x2:0,y2:0};if(u.current.length>1&&l){const e=Fi(u.current,p);y=Gr(e)}if(u.current=u.current.map(r=>{const i={x:e-r.distance.x,y:t-r.distance.y};f&&(i.x=h[0]*Math.round(i.x/h[0]),i.y=h[1]*Math.round(i.y/h[1]));const a=[[l[0][0],l[0][1]],[l[1][0],l[1][1]]];u.current.length>1&&l&&!r.extent&&(a[0][0]=r.positionAbsolute.x-y.x+l[0][0],a[1][0]=r.positionAbsolute.x+(r.width??0)-y.x2+l[1][0],a[0][1]=r.positionAbsolute.y-y.y+l[0][1],a[1][1]=r.positionAbsolute.y+(r.height??0)-y.y2+l[1][1]);const o=so(r,i,n,a,p,m);return v=v||r.position.x!==o.position.x||r.position.y!==o.position.y,r.position=o.position,r.positionAbsolute=o.positionAbsolute,r}),!v)return;o(u.current,!0,!0),c(!0);const b=i?r:po(a);if(b&&g.current){const[e,t]=lo({nodeId:i,dragItems:u.current,nodeInternals:n});b(g.current,e,t)}},_=()=>{if(!p.current)return;const[e,t]=jr(m.current,p.current);if(0!==e||0!==t){const{transform:n,panBy:r}=s.getState();d.current.x=(d.current.x??0)-e/n[2],d.current.y=(d.current.y??0)-t/n[2],r({x:e,y:t})&&h(d.current)}f.current=requestAnimationFrame(_)},w=t=>{var n;const{nodeInternals:r,multiSelectionActive:l,nodesDraggable:c,unselectNodesAndEdges:h,onNodeDragStart:f,onSelectionDragStart:p}=s.getState();y.current=!0;const m=i?f:po(p);o&&a||l||!i||(null==(n=r.get(i))?void 0:n.selected)||h(),i&&a&&o&&ho({id:i,store:s,nodeRef:e});const g=x(t);if(d.current=g,u.current=oo(r,c,g,i),m&&u.current){const[e,n]=lo({nodeId:i,dragItems:u.current,nodeInternals:r});m(t.sourceEvent,e,n)}};if(!t){const t=wt().on("start",e=>{const{domNode:t,nodeDragThreshold:n}=s.getState();0===n&&w(e),b.current=!1;const r=x(e);d.current=r,p.current=(null==t?void 0:t.getBoundingClientRect())||null,m.current=Qr(e.sourceEvent,p.current)}).on("drag",e=>{var t,n;const r=x(e),{autoPanOnNodeDrag:i,nodeDragThreshold:a}=s.getState();if("touchmove"===e.sourceEvent.type&&e.sourceEvent.touches.length>1&&(b.current=!0),!b.current){if(!v.current&&y.current&&i&&(v.current=!0,_()),!y.current){const i=r.xSnapped-((null==(t=null==d?void 0:d.current)?void 0:t.x)??0),o=r.ySnapped-((null==(n=null==d?void 0:d.current)?void 0:n.y)??0);Math.sqrt(i*i+o*o)>a&&w(e)}(d.current.x!==r.xSnapped||d.current.y!==r.ySnapped)&&u.current&&y.current&&(g.current=e.sourceEvent,m.current=Qr(e.sourceEvent,p.current),h(r))}}).on("end",e=>{if(y.current&&!b.current&&(c(!1),v.current=!1,y.current=!1,cancelAnimationFrame(f.current),u.current)){const{updateNodePositions:t,nodeInternals:n,onNodeDragStop:r,onSelectionDragStop:a}=s.getState(),o=i?r:po(a);if(t(u.current,!1,!1),o){const[t,r]=lo({nodeId:i,dragItems:u.current,nodeInternals:n});o(e.sourceEvent,t,r)}}}).filter(t=>{const i=t.target;return!t.button&&(!n||!ao(i,`.${n}`,e))&&(!r||ao(i,r,e))});return l.call(t),()=>{l.on(".drag",null)}}l.on(".drag",null)}},[e,t,n,r,a,s,i,o,x]),l}function go(){const e=Pr();return h.useCallback(t=>{const{nodeInternals:n,nodeExtent:r,updateNodePositions:i,getNodes:a,snapToGrid:o,snapGrid:s,onError:l,nodesDraggable:c}=e.getState(),u=a().filter(e=>e.selected&&(e.draggable||c&&void 0===e.draggable)),d=o?s[0]:5,h=o?s[1]:5,f=t.isShiftPressed?4:1,p=t.x*d*f,m=t.y*h*f;i(u.map(e=>{if(e.positionAbsolute){const t={x:e.positionAbsolute.x+p,y:e.positionAbsolute.y+m};o&&(t.x=s[0]*Math.round(t.x/s[0]),t.y=s[1]*Math.round(t.y/s[1]));const{positionAbsolute:i,position:a}=so(e,t,n,r,void 0,l);e.position=a,e.positionAbsolute=i}return e}),!0,!1)},[])}const vo={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};var yo=e=>{const t=({id:t,type:n,data:r,xPos:i,yPos:a,xPosOrigin:o,yPosOrigin:s,selected:l,onClick:c,onMouseEnter:u,onMouseMove:d,onMouseLeave:p,onContextMenu:m,onDoubleClick:g,style:v,className:y,isDraggable:b,isSelectable:x,isConnectable:_,isFocusable:w,selectNodesOnDrag:S,sourcePosition:M,targetPosition:E,hidden:T,resizeObserver:C,dragHandle:k,zIndex:R,isParent:N,noDragClassName:P,noPanClassName:I,initialized:L,disableKeyboardA11y:D,ariaLabel:z,rfId:O,hasHandleBounds:U})=>{const F=Pr(),B=h.useRef(null),j=h.useRef(null),H=h.useRef(M),V=h.useRef(E),G=h.useRef(n),W=x||b||c||u||d||p,$=go(),X=uo(t,F.getState,u),q=uo(t,F.getState,d),Y=uo(t,F.getState,p),Z=uo(t,F.getState,m),K=uo(t,F.getState,g);h.useEffect(()=>()=>{j.current&&(null==C||C.unobserve(j.current),j.current=null)},[]),h.useEffect(()=>{if(B.current&&!T){const e=B.current;L&&U&&j.current===e||(j.current&&(null==C||C.unobserve(j.current)),null==C||C.observe(e),j.current=e)}},[T,L,U]),h.useEffect(()=>{const e=G.current!==n,r=H.current!==M,i=V.current!==E;B.current&&(e||r||i)&&(e&&(G.current=n),r&&(H.current=M),i&&(V.current=E),F.getState().updateNodeDimensions([{id:t,nodeElement:B.current,forceUpdate:!0}]))},[t,n,M,E]);const J=mo({nodeRef:B,disabled:T||!b,noDragClassName:P,handleSelector:k,nodeId:t,isSelectable:x,selectNodesOnDrag:S});return T?null:f.createElement("div",{className:A(["react-flow__node",`react-flow__node-${n}`,{[I]:b},y,{selected:l,selectable:x,parent:N,dragging:J}]),ref:B,style:{zIndex:R,transform:`translate(${o}px,${s}px)`,pointerEvents:W?"all":"none",visibility:L?"visible":"hidden",...v},"data-id":t,"data-testid":`rf__node-${t}`,onMouseEnter:X,onMouseMove:q,onMouseLeave:Y,onContextMenu:Z,onClick:e=>{const{nodeDragThreshold:n}=F.getState();if(x&&(!S||!b||n>0)&&ho({id:t,store:F,nodeRef:B}),c){const n=F.getState().nodeInternals.get(t);n&&c(e,{...n})}},onDoubleClick:K,onKeyDown:w?e=>{if(!Kr(e)&&!D)if(Zr.includes(e.key)&&x){const n="Escape"===e.key;ho({id:t,store:F,unselect:n,nodeRef:B})}else b&&l&&Object.prototype.hasOwnProperty.call(vo,e.key)&&(F.setState({ariaLiveMessage:`Moved selected node ${e.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~i}, y: ${~~a}`}),$({x:vo[e.key].x,y:vo[e.key].y,isShiftPressed:e.shiftKey}))}:void 0,tabIndex:w?0:void 0,role:w?"button":void 0,"aria-describedby":D?void 0:`${_a}-${O}`,"aria-label":z},f.createElement(Ni,{value:t},f.createElement(e,{id:t,data:r,type:n,xPos:i,yPos:a,selected:l,isConnectable:_,sourcePosition:M,targetPosition:E,dragging:J,dragHandle:k,zIndex:R})))};return t.displayName="NodeWrapper",h.memo(t)};const bo=e=>{const t=e.getNodes().filter(e=>e.selected);return{...Fi(t,e.nodeOrigin),transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`,userSelectionActive:e.userSelectionActive}};var xo=h.memo(function({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const r=Pr(),{width:i,height:a,x:o,y:s,transformString:l,userSelectionActive:c}=Nr(bo,W),u=go(),d=h.useRef(null);if(h.useEffect(()=>{var e;n||null==(e=d.current)||e.focus({preventScroll:!0})},[n]),mo({nodeRef:d}),c||!i||!a)return null;const p=e?t=>{const n=r.getState().getNodes().filter(e=>e.selected);e(t,n)}:void 0;return f.createElement("div",{className:A(["react-flow__nodesselection","react-flow__container",t]),style:{transform:l}},f.createElement("div",{ref:d,className:"react-flow__nodesselection-rect",onContextMenu:p,tabIndex:n?void 0:-1,onKeyDown:n?void 0:e=>{Object.prototype.hasOwnProperty.call(vo,e.key)&&u({x:vo[e.key].x,y:vo[e.key].y,isShiftPressed:e.shiftKey})},style:{width:i,height:a,top:s,left:o}}))});const _o=e=>e.nodesSelectionActive,wo=({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:i,onPaneContextMenu:a,onPaneScroll:o,deleteKeyCode:s,onMove:l,onMoveStart:c,onMoveEnd:u,selectionKeyCode:d,selectionOnDrag:p,selectionMode:m,onSelectionStart:g,onSelectionEnd:v,multiSelectionKeyCode:y,panActivationKeyCode:b,zoomActivationKeyCode:x,elementsSelectable:_,zoomOnScroll:w,zoomOnPinch:S,panOnScroll:M,panOnScrollSpeed:E,panOnScrollMode:T,zoomOnDoubleClick:C,panOnDrag:A,defaultViewport:k,translateExtent:R,minZoom:N,maxZoom:P,preventScrolling:I,onSelectionContextMenu:L,noWheelClassName:D,noPanClassName:z,disableKeyboardA11y:O})=>{const U=Nr(_o),F=Ta(d),B=Ta(b),j=B||A,H=B||M,V=F||p&&!0!==j;return(({deleteKeyCode:e,multiSelectionKeyCode:t})=>{const n=Pr(),{deleteElements:r}=Fa(),i=Ta(e,Ba),a=Ta(t);h.useEffect(()=>{if(i){const{edges:e,getNodes:t}=n.getState(),i=t().filter(e=>e.selected),a=e.filter(e=>e.selected);r({nodes:i,edges:a}),n.setState({nodesSelectionActive:!1})}},[i]),h.useEffect(()=>{n.setState({multiSelectionActive:a})},[a])})({deleteKeyCode:s,multiSelectionKeyCode:y}),f.createElement(Xa,{onMove:l,onMoveStart:c,onMoveEnd:u,onPaneContextMenu:a,elementsSelectable:_,zoomOnScroll:w,zoomOnPinch:S,panOnScroll:H,panOnScrollSpeed:E,panOnScrollMode:T,zoomOnDoubleClick:C,panOnDrag:!F&&j,defaultViewport:k,translateExtent:R,minZoom:N,maxZoom:P,zoomActivationKeyCode:x,preventScrolling:I,noWheelClassName:D,noPanClassName:z},f.createElement(ro,{onSelectionStart:g,onSelectionEnd:v,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:r,onPaneMouseLeave:i,onPaneContextMenu:a,onPaneScroll:o,panOnDrag:j,isSelecting:!!V,selectionMode:m},e,U&&f.createElement(xo,{onSelectionContextMenu:L,noPanClassName:z,disableKeyboardA11y:O})))};wo.displayName="FlowRenderer";var So=h.memo(wo);function Mo(e){return{input:yo(e.input||aa),default:yo(e.default||ra),output:yo(e.output||sa),group:yo(e.group||la),...Object.keys(e).filter(e=>!["input","default","output","group"].includes(e)).reduce((t,n)=>(t[n]=yo(e[n]||ra),t),{})}}const Eo=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,updateNodeDimensions:e.updateNodeDimensions,onError:e.onError}),To=e=>{const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:r,elementsSelectable:i,updateNodeDimensions:a,onError:o}=Nr(Eo,W),s=(l=e.onlyRenderVisibleElements,Nr(h.useCallback(e=>l?Bi(e.nodeInternals,{x:0,y:0,width:e.width,height:e.height},e.transform,!0):e.getNodes(),[l])));var l;const c=h.useRef(),u=h.useMemo(()=>{if("undefined"==typeof ResizeObserver)return null;const e=new ResizeObserver(e=>{const t=e.map(e=>({id:e.target.getAttribute("data-id"),nodeElement:e.target,forceUpdate:!0}));a(t)});return c.current=e,e},[]);return h.useEffect(()=>()=>{var e;null==(e=null==c?void 0:c.current)||e.disconnect()},[]),f.createElement("div",{className:"react-flow__nodes",style:ja},s.map(a=>{var s,l,c;let d=a.type||"default";e.nodeTypes[d]||(null==o||o("003",(e=>`Node type "${e}" not found. Using fallback type "default".`)(d)),d="default");const h=e.nodeTypes[d]||e.nodeTypes.default,p=!!(a.draggable||t&&void 0===a.draggable),m=!!(a.selectable||i&&void 0===a.selectable),g=!!(a.connectable||n&&void 0===a.connectable),v=!!(a.focusable||r&&void 0===a.focusable),y=e.nodeExtent?Fr(a.positionAbsolute,e.nodeExtent):a.positionAbsolute,b=(null==y?void 0:y.x)??0,x=(null==y?void 0:y.y)??0,_=(({x:e,y:t,width:n,height:r,origin:i})=>n&&r?i[0]<0||i[1]<0||i[0]>1||i[1]>1?{x:e,y:t}:{x:e-n*i[0],y:t-r*i[1]}:{x:e,y:t})({x:b,y:x,width:a.width??0,height:a.height??0,origin:e.nodeOrigin});return f.createElement(h,{key:a.id,id:a.id,className:a.className,style:a.style,type:d,data:a.data,sourcePosition:a.sourcePosition||mi.Bottom,targetPosition:a.targetPosition||mi.Top,hidden:a.hidden,xPos:b,yPos:x,xPosOrigin:_.x,yPosOrigin:_.y,selectNodesOnDrag:e.selectNodesOnDrag,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,selected:!!a.selected,isDraggable:p,isSelectable:m,isConnectable:g,isFocusable:v,resizeObserver:u,dragHandle:a.dragHandle,zIndex:(null==(s=a[Yr])?void 0:s.z)??0,isParent:!!(null==(l=a[Yr])?void 0:l.isParent),noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,initialized:!!a.width&&!!a.height,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,ariaLabel:a.ariaLabel,hasHandleBounds:!!(null==(c=a[Yr])?void 0:c.handleBounds)})}))};To.displayName="NodeRenderer";var Co=h.memo(To);const Ao=(e,t,n)=>n===mi.Left?e-t:n===mi.Right?e+t:e,ko=(e,t,n)=>n===mi.Top?e-t:n===mi.Bottom?e+t:e,Ro="react-flow__edgeupdater",No=({position:e,centerX:t,centerY:n,radius:r=10,onMouseDown:i,onMouseEnter:a,onMouseOut:o,type:s})=>f.createElement("circle",{onMouseDown:i,onMouseEnter:a,onMouseOut:o,className:A([Ro,`${Ro}-${s}`]),cx:Ao(t,r,e),cy:ko(n,r,e),r:r,stroke:"transparent",fill:"transparent"}),Po=()=>!0;var Io=e=>{const t=({id:t,className:n,type:r,data:i,onClick:a,onEdgeDoubleClick:o,selected:s,animated:l,label:c,labelStyle:u,labelShowBg:d,labelBgStyle:p,labelBgPadding:m,labelBgBorderRadius:g,style:v,source:y,target:b,sourceX:x,sourceY:_,targetX:w,targetY:S,sourcePosition:M,targetPosition:E,elementsSelectable:T,hidden:C,sourceHandleId:k,targetHandleId:R,onContextMenu:N,onMouseEnter:P,onMouseMove:I,onMouseLeave:L,reconnectRadius:D,onReconnect:z,onReconnectStart:O,onReconnectEnd:U,markerEnd:F,markerStart:B,rfId:j,ariaLabel:H,isFocusable:V,isReconnectable:G,pathOptions:W,interactionWidth:$,disableKeyboardA11y:X})=>{const q=h.useRef(null),[Y,Z]=h.useState(!1),[K,J]=h.useState(!1),Q=Pr(),ee=h.useMemo(()=>`url('#${Li(B,j)}')`,[B,j]),te=h.useMemo(()=>`url('#${Li(F,j)}')`,[F,j]);if(C)return null;const ne=ni(t,Q.getState,o),re=ni(t,Q.getState,N),ie=ni(t,Q.getState,P),ae=ni(t,Q.getState,I),oe=ni(t,Q.getState,L),se=(e,n)=>{if(0!==e.button)return;const{edges:r,isValidConnection:i}=Q.getState(),a=n?b:y,o=(n?R:k)||null,s=n?"target":"source",l=i||Po,c=n,u=r.find(e=>e.id===t);J(!0),null==O||O(e,u,s),Ki({event:e,handleId:o,nodeId:a,onConnect:e=>null==z?void 0:z(u,e),isTarget:c,getState:Q.getState,setState:Q.setState,isValidConnection:l,edgeUpdaterType:s,onReconnectEnd:e=>{J(!1),null==U||U(e,u,s)}})},le=()=>Z(!0),ce=()=>Z(!1),ue=!T&&!a;return f.createElement("g",{className:A(["react-flow__edge",`react-flow__edge-${r}`,n,{selected:s,animated:l,inactive:ue,updating:Y}]),onClick:e=>{var n;const{edges:r,addSelectedEdges:i,unselectNodesAndEdges:o,multiSelectionActive:s}=Q.getState(),l=r.find(e=>e.id===t);l&&(T&&(Q.setState({nodesSelectionActive:!1}),l.selected&&s?(o({nodes:[],edges:[l]}),null==(n=q.current)||n.blur()):i([t])),a&&a(e,l))},onDoubleClick:ne,onContextMenu:re,onMouseEnter:ie,onMouseMove:ae,onMouseLeave:oe,onKeyDown:V?e=>{var n;if(!X&&Zr.includes(e.key)&&T){const{unselectNodesAndEdges:r,addSelectedEdges:i,edges:a}=Q.getState();"Escape"===e.key?(null==(n=q.current)||n.blur(),r({edges:[a.find(e=>e.id===t)]})):i([t])}}:void 0,tabIndex:V?0:void 0,role:V?"button":"img","data-testid":`rf__edge-${t}`,"aria-label":null===H?void 0:H||`Edge from ${y} to ${b}`,"aria-describedby":V?`${wa}-${j}`:void 0,ref:q},!K&&f.createElement(e,{id:t,source:y,target:b,selected:s,animated:l,label:c,labelStyle:u,labelShowBg:d,labelBgStyle:p,labelBgPadding:m,labelBgBorderRadius:g,data:i,style:v,sourceX:x,sourceY:_,targetX:w,targetY:S,sourcePosition:M,targetPosition:E,sourceHandleId:k,targetHandleId:R,markerStart:ee,markerEnd:te,pathOptions:W,interactionWidth:$}),G&&f.createElement(f.Fragment,null,("source"===G||!0===G)&&f.createElement(No,{position:M,centerX:x,centerY:_,radius:D,onMouseDown:e=>se(e,!0),onMouseEnter:le,onMouseOut:ce,type:"source"}),("target"===G||!0===G)&&f.createElement(No,{position:E,centerX:w,centerY:S,radius:D,onMouseDown:e=>se(e,!1),onMouseEnter:le,onMouseOut:ce,type:"target"})))};return t.displayName="EdgeWrapper",h.memo(t)};function Lo(e){return{default:Io(e.default||ki),straight:Io(e.bezier||Ei),step:Io(e.step||Mi),smoothstep:Io(e.step||Si),simplebezier:Io(e.simplebezier||bi),...Object.keys(e).filter(e=>!["default","bezier"].includes(e)).reduce((t,n)=>(t[n]=Io(e[n]||ki),t),{})}}function Do(e,t,n=null){const r=((null==n?void 0:n.x)||0)+t.x,i=((null==n?void 0:n.y)||0)+t.y,a=(null==n?void 0:n.width)||t.width,o=(null==n?void 0:n.height)||t.height;switch(e){case mi.Top:return{x:r+a/2,y:i};case mi.Right:return{x:r+a,y:i+o/2};case mi.Bottom:return{x:r+a/2,y:i+o};case mi.Left:return{x:r,y:i+o/2}}}function zo(e,t){return e?1!==e.length&&t?t&&e.find(e=>e.id===t)||null:e[0]:null}function Oo(e){var t,n,r,i,a;const o=(null==(t=null==e?void 0:e[Yr])?void 0:t.handleBounds)||null,s=o&&(null==e?void 0:e.width)&&(null==e?void 0:e.height)&&void 0!==(null==(n=null==e?void 0:e.positionAbsolute)?void 0:n.x)&&void 0!==(null==(r=null==e?void 0:e.positionAbsolute)?void 0:r.y);return[{x:(null==(i=null==e?void 0:e.positionAbsolute)?void 0:i.x)||0,y:(null==(a=null==e?void 0:e.positionAbsolute)?void 0:a.y)||0,width:(null==e?void 0:e.width)||0,height:(null==e?void 0:e.height)||0},o,!!s]}const Uo=[{level:0,isMaxLevel:!0,edges:[]}];const Fo={[fi.Arrow]:({color:e="none",strokeWidth:t=1})=>f.createElement("polyline",{style:{stroke:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",fill:"none",points:"-5,-4 0,0 -5,4"}),[fi.ArrowClosed]:({color:e="none",strokeWidth:t=1})=>f.createElement("polyline",{style:{stroke:e,fill:e,strokeWidth:t},strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})},Bo=({id:e,type:t,color:n,width:r=12.5,height:i=12.5,markerUnits:a="strokeWidth",strokeWidth:o,orient:s="auto-start-reverse"})=>{const l=function(e){const t=Pr();return h.useMemo(()=>{var n,r;return Object.prototype.hasOwnProperty.call(Fo,e)?Fo[e]:(null==(r=(n=t.getState()).onError)||r.call(n,"009",(e=>`Marker type "${e}" doesn't exist.`)(e)),null)},[e])}(t);return l?f.createElement("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${r}`,markerHeight:`${i}`,viewBox:"-10 -10 20 20",markerUnits:a,orient:s,refX:"0",refY:"0"},f.createElement(l,{color:n,strokeWidth:o})):null},jo=({defaultColor:e,rfId:t})=>{const n=Nr(h.useCallback((({defaultColor:e,rfId:t})=>n=>{const r=[];return n.edges.reduce((n,i)=>([i.markerStart,i.markerEnd].forEach(i=>{if(i&&"object"==typeof i){const a=Li(i,t);r.includes(a)||(n.push({id:a,color:i.color||e,...i}),r.push(a))}}),n),[]).sort((e,t)=>e.id.localeCompare(t.id))})({defaultColor:e,rfId:t}),[e,t]),(e,t)=>!(e.length!==t.length||e.some((e,n)=>e.id!==t[n].id)));return f.createElement("defs",null,n.map(e=>f.createElement(Bo,{id:e.id,key:e.id,type:e.type,color:e.color,width:e.width,height:e.height,markerUnits:e.markerUnits,strokeWidth:e.strokeWidth,orient:e.orient})))};jo.displayName="MarkerDefinitions";var Ho=h.memo(jo);const Vo=e=>({nodesConnectable:e.nodesConnectable,edgesFocusable:e.edgesFocusable,edgesUpdatable:e.edgesUpdatable,elementsSelectable:e.elementsSelectable,width:e.width,height:e.height,connectionMode:e.connectionMode,nodeInternals:e.nodeInternals,onError:e.onError}),Go=({defaultMarkerColor:e,onlyRenderVisibleElements:t,elevateEdgesOnSelect:n,rfId:r,edgeTypes:i,noPanClassName:a,onEdgeContextMenu:o,onEdgeMouseEnter:s,onEdgeMouseMove:l,onEdgeMouseLeave:c,onEdgeClick:u,onEdgeDoubleClick:d,onReconnect:p,onReconnectStart:m,onReconnectEnd:g,reconnectRadius:v,children:y,disableKeyboardA11y:b})=>{const{edgesFocusable:x,edgesUpdatable:_,elementsSelectable:w,width:S,height:M,connectionMode:E,nodeInternals:T,onError:C}=Nr(Vo,W),k=function(e,t,n){return function(e,t,n=!1){let r=-1;const i=e.reduce((e,i)=>{var a,o;const s=qr(i.zIndex);let l=s?i.zIndex:0;if(n){const e=t.get(i.target),n=t.get(i.source),r=i.selected||(null==e?void 0:e.selected)||(null==n?void 0:n.selected),c=Math.max((null==(a=null==n?void 0:n[Yr])?void 0:a.z)||0,(null==(o=null==e?void 0:e[Yr])?void 0:o.z)||0,1e3);l=(s?i.zIndex:0)+(r?c:0)}return e[l]?e[l].push(i):e[l]=[i],r=l>r?l:r,e},{}),a=Object.entries(i).map(([e,t])=>{const n=+e;return{edges:t,level:n,isMaxLevel:n===r}});return 0===a.length?Uo:a}(Nr(h.useCallback(n=>e?n.edges.filter(e=>{const r=t.get(e.source),i=t.get(e.target);return(null==r?void 0:r.width)&&(null==r?void 0:r.height)&&(null==i?void 0:i.width)&&(null==i?void 0:i.height)&&function({sourcePos:e,targetPos:t,sourceWidth:n,sourceHeight:r,targetWidth:i,targetHeight:a,width:o,height:s,transform:l}){const c={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x+n,t.x+i),y2:Math.max(e.y+r,t.y+a)};c.x===c.x2&&(c.x2+=1),c.y===c.y2&&(c.y2+=1);const u=Gr({x:(0-l[0])/l[2],y:(0-l[1])/l[2],width:o/l[2],height:s/l[2]}),d=Math.max(0,Math.min(u.x2,c.x2)-Math.max(u.x,c.x)),h=Math.max(0,Math.min(u.y2,c.y2)-Math.max(u.y,c.y));return Math.ceil(d*h)>0}({sourcePos:r.positionAbsolute||{x:0,y:0},targetPos:i.positionAbsolute||{x:0,y:0},sourceWidth:r.width,sourceHeight:r.height,targetWidth:i.width,targetHeight:i.height,width:n.width,height:n.height,transform:n.transform})}):n.edges,[e,t])),t,n)}(t,T,n);return S?f.createElement(f.Fragment,null,k.map(({level:t,edges:n,isMaxLevel:h})=>f.createElement("svg",{key:t,style:{zIndex:t},width:S,height:M,className:"react-flow__edges react-flow__container"},h&&f.createElement(Ho,{defaultColor:e,rfId:r}),f.createElement("g",null,n.map(e=>{const[t,n,h]=Oo(T.get(e.source)),[y,S,M]=Oo(T.get(e.target));if(!h||!M)return null;let k=e.type||"default";i[k]||(null==C||C("011",(e=>`Edge type "${e}" not found. Using fallback type "default".`)(k)),k="default");const R=i[k]||i.default,N=E===ai.Strict?S.target:(S.target??[]).concat(S.source??[]),P=zo(n.source,e.sourceHandle),I=zo(N,e.targetHandle),L=(null==P?void 0:P.position)||mi.Bottom,D=(null==I?void 0:I.position)||mi.Top,z=!!(e.focusable||x&&void 0===e.focusable),O=e.reconnectable||e.updatable,U=void 0!==p&&(O||_&&void 0===O);if(!P||!I)return null==C||C("008",((e,t)=>`Couldn't create edge for ${e?"target":"source"} handle id: "${e?t.targetHandle:t.sourceHandle}", edge id: ${t.id}.`)(P,e)),null;const{sourceX:F,sourceY:B,targetX:j,targetY:H}=((e,t,n,r,i,a)=>{const o=Do(n,e,t),s=Do(a,r,i);return{sourceX:o.x,sourceY:o.y,targetX:s.x,targetY:s.y}})(t,P,L,y,I,D);return f.createElement(R,{key:e.id,id:e.id,className:A([e.className,a]),type:k,data:e.data,selected:!!e.selected,animated:!!e.animated,hidden:!!e.hidden,label:e.label,labelStyle:e.labelStyle,labelShowBg:e.labelShowBg,labelBgStyle:e.labelBgStyle,labelBgPadding:e.labelBgPadding,labelBgBorderRadius:e.labelBgBorderRadius,style:e.style,source:e.source,target:e.target,sourceHandleId:e.sourceHandle,targetHandleId:e.targetHandle,markerEnd:e.markerEnd,markerStart:e.markerStart,sourceX:F,sourceY:B,targetX:j,targetY:H,sourcePosition:L,targetPosition:D,elementsSelectable:w,onContextMenu:o,onMouseEnter:s,onMouseMove:l,onMouseLeave:c,onClick:u,onEdgeDoubleClick:d,onReconnect:p,onReconnectStart:m,onReconnectEnd:g,reconnectRadius:v,rfId:r,ariaLabel:e.ariaLabel,isFocusable:z,isReconnectable:U,pathOptions:"pathOptions"in e?e.pathOptions:void 0,interactionWidth:e.interactionWidth,disableKeyboardA11y:b})})))),y):null};Go.displayName="EdgeRenderer";var Wo=h.memo(Go);const $o=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function Xo({children:e}){const t=Nr($o);return f.createElement("div",{className:"react-flow__viewport react-flow__container",style:{transform:t}},e)}const qo={[mi.Left]:mi.Right,[mi.Right]:mi.Left,[mi.Top]:mi.Bottom,[mi.Bottom]:mi.Top},Yo=({nodeId:e,handleType:t,style:n,type:r=di.Bezier,CustomComponent:i,connectionStatus:a})=>{var o,s,l;const{fromNode:c,handleId:u,toX:d,toY:p,connectionMode:m}=Nr(h.useCallback(t=>({fromNode:t.nodeInternals.get(e),handleId:t.connectionHandleId,toX:(t.connectionPosition.x-t.transform[0])/t.transform[2],toY:(t.connectionPosition.y-t.transform[1])/t.transform[2],connectionMode:t.connectionMode}),[e]),W),g=null==(o=null==c?void 0:c[Yr])?void 0:o.handleBounds;let v=null==g?void 0:g[t];if(m===ai.Loose&&(v=v||(null==g?void 0:g["source"===t?"target":"source"])),!c||!v)return null;const y=u?v.find(e=>e.id===u):v[0],b=y?y.x+y.width/2:(c.width??0)/2,x=y?y.y+y.height/2:c.height??0,_=((null==(s=c.positionAbsolute)?void 0:s.x)??0)+b,w=((null==(l=c.positionAbsolute)?void 0:l.y)??0)+x,S=null==y?void 0:y.position,M=S?qo[S]:null;if(!S||!M)return null;if(i)return f.createElement(i,{connectionLineType:r,connectionLineStyle:n,fromNode:c,fromHandle:y,fromX:_,fromY:w,toX:d,toY:p,fromPosition:S,toPosition:M,connectionStatus:a});let E="";const T={sourceX:_,sourceY:w,sourcePosition:S,targetX:d,targetY:p,targetPosition:M};return r===di.Bezier?[E]=Ai(T):r===di.Step?[E]=wi({...T,borderRadius:0}):r===di.SmoothStep?[E]=wi(T):r===di.SimpleBezier?[E]=yi(T):E=`M${_},${w} ${d},${p}`,f.createElement("path",{d:E,fill:"none",className:"react-flow__connection-path",style:n})};Yo.displayName="ConnectionLine";const Zo=e=>({nodeId:e.connectionNodeId,handleType:e.connectionHandleType,nodesConnectable:e.nodesConnectable,connectionStatus:e.connectionStatus,width:e.width,height:e.height});function Ko({containerStyle:e,style:t,type:n,component:r}){const{nodeId:i,handleType:a,nodesConnectable:o,width:s,height:l,connectionStatus:c}=Nr(Zo,W);return i&&a&&s&&o?f.createElement("svg",{style:e,width:s,height:l,className:"react-flow__edges react-flow__connectionline react-flow__container"},f.createElement("g",{className:A(["react-flow__connection",c])},f.createElement(Yo,{nodeId:i,handleType:a,style:t,type:n,CustomComponent:r,connectionStatus:c}))):null}function Jo(e,t){return h.useRef(null),Pr(),h.useMemo(()=>t(e),[e])}const Qo=({nodeTypes:e,edgeTypes:t,onMove:n,onMoveStart:r,onMoveEnd:i,onInit:a,onNodeClick:o,onEdgeClick:s,onNodeDoubleClick:l,onEdgeDoubleClick:c,onNodeMouseEnter:u,onNodeMouseMove:d,onNodeMouseLeave:p,onNodeContextMenu:m,onSelectionContextMenu:g,onSelectionStart:v,onSelectionEnd:y,connectionLineType:b,connectionLineStyle:x,connectionLineComponent:_,connectionLineContainerStyle:w,selectionKeyCode:S,selectionOnDrag:M,selectionMode:E,multiSelectionKeyCode:T,panActivationKeyCode:C,zoomActivationKeyCode:A,deleteKeyCode:k,onlyRenderVisibleElements:R,elementsSelectable:N,selectNodesOnDrag:P,defaultViewport:I,translateExtent:L,minZoom:D,maxZoom:z,preventScrolling:O,defaultMarkerColor:U,zoomOnScroll:F,zoomOnPinch:B,panOnScroll:j,panOnScrollSpeed:H,panOnScrollMode:V,zoomOnDoubleClick:G,panOnDrag:W,onPaneClick:$,onPaneMouseEnter:X,onPaneMouseMove:q,onPaneMouseLeave:Y,onPaneScroll:Z,onPaneContextMenu:K,onEdgeContextMenu:J,onEdgeMouseEnter:Q,onEdgeMouseMove:ee,onEdgeMouseLeave:te,onReconnect:ne,onReconnectStart:re,onReconnectEnd:ie,reconnectRadius:ae,noDragClassName:oe,noWheelClassName:se,noPanClassName:le,elevateEdgesOnSelect:ce,disableKeyboardA11y:ue,nodeOrigin:de,nodeExtent:he,rfId:fe})=>{const pe=Jo(e,Mo),me=Jo(t,Lo);return function(e){const t=Fa(),n=h.useRef(!1);h.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}(a),f.createElement(So,{onPaneClick:$,onPaneMouseEnter:X,onPaneMouseMove:q,onPaneMouseLeave:Y,onPaneContextMenu:K,onPaneScroll:Z,deleteKeyCode:k,selectionKeyCode:S,selectionOnDrag:M,selectionMode:E,onSelectionStart:v,onSelectionEnd:y,multiSelectionKeyCode:T,panActivationKeyCode:C,zoomActivationKeyCode:A,elementsSelectable:N,onMove:n,onMoveStart:r,onMoveEnd:i,zoomOnScroll:F,zoomOnPinch:B,zoomOnDoubleClick:G,panOnScroll:j,panOnScrollSpeed:H,panOnScrollMode:V,panOnDrag:W,defaultViewport:I,translateExtent:L,minZoom:D,maxZoom:z,onSelectionContextMenu:g,preventScrolling:O,noDragClassName:oe,noWheelClassName:se,noPanClassName:le,disableKeyboardA11y:ue},f.createElement(Xo,null,f.createElement(Wo,{edgeTypes:me,onEdgeClick:s,onEdgeDoubleClick:c,onlyRenderVisibleElements:R,onEdgeContextMenu:J,onEdgeMouseEnter:Q,onEdgeMouseMove:ee,onEdgeMouseLeave:te,onReconnect:ne,onReconnectStart:re,onReconnectEnd:ie,reconnectRadius:ae,defaultMarkerColor:U,noPanClassName:le,elevateEdgesOnSelect:!!ce,disableKeyboardA11y:ue,rfId:fe},f.createElement(Ko,{style:x,type:b,component:_,containerStyle:w})),f.createElement("div",{className:"react-flow__edgelabel-renderer"}),f.createElement(Co,{nodeTypes:pe,onNodeClick:o,onNodeDoubleClick:l,onNodeMouseEnter:u,onNodeMouseMove:d,onNodeMouseLeave:p,onNodeContextMenu:m,selectNodesOnDrag:P,onlyRenderVisibleElements:R,noPanClassName:le,noDragClassName:oe,disableKeyboardA11y:ue,nodeOrigin:de,nodeExtent:he,rfId:fe})))};Qo.displayName="GraphView";var es=h.memo(Qo);const ts=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],ns={rfId:"1",width:0,height:0,transform:[0,0,1],nodeInternals:new Map,edges:[],onNodesChange:null,onEdgesChange:null,hasDefaultNodes:!1,hasDefaultEdges:!1,d3Zoom:null,d3Selection:null,d3ZoomHandler:void 0,minZoom:.5,maxZoom:2,translateExtent:ts,nodeExtent:ts,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionNodeId:null,connectionHandleId:null,connectionHandleType:"source",connectionPosition:{x:0,y:0},connectionStatus:null,connectionMode:ai.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:[0,0],nodeDragThreshold:0,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesUpdatable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,fitViewOnInit:!1,fitViewOnInitDone:!1,fitViewOnInitOptions:void 0,onSelectionChange:[],multiSelectionActive:!1,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,connectionRadius:20,onError:(e,t)=>{},isValidConnection:void 0},rs=({children:e})=>{const t=h.useRef(null);return t.current||(t.current=(n=(e,t)=>({...ns,setNodes:n=>{const{nodeInternals:r,nodeOrigin:i,elevateNodesOnSelect:a}=t();e({nodeInternals:Na(n,r,i,a)})},getNodes:()=>Array.from(t().nodeInternals.values()),setEdges:n=>{const{defaultEdgeOptions:r={}}=t();e({edges:n.map(e=>({...r,...e}))})},setDefaultNodesAndEdges:(n,r)=>{const i=void 0!==n,a=void 0!==r,o=i?Na(n,new Map,t().nodeOrigin,t().elevateNodesOnSelect):new Map;e({nodeInternals:o,edges:a?r:[],hasDefaultNodes:i,hasDefaultEdges:a})},updateNodeDimensions:n=>{const{onNodesChange:r,nodeInternals:i,fitViewOnInit:a,fitViewOnInitDone:o,fitViewOnInitOptions:s,domNode:l,nodeOrigin:c}=t(),u=null==l?void 0:l.querySelector(".react-flow__viewport");if(!u)return;const d=window.getComputedStyle(u),{m22:h}=new window.DOMMatrixReadOnly(d.transform),f=n.reduce((e,t)=>{const n=i.get(t.id);if(null==n?void 0:n.hidden)i.set(n.id,{...n,[Yr]:{...n[Yr],handleBounds:void 0}});else if(n){const r=Or(t.nodeElement);r.width&&r.height&&(n.width!==r.width||n.height!==r.height||t.forceUpdate)&&(i.set(n.id,{...n,[Yr]:{...n[Yr],handleBounds:{source:co(".source",t.nodeElement,h,c),target:co(".target",t.nodeElement,h,c)}},...r}),e.push({id:n.id,type:"dimensions",dimensions:r}))}return e},[]);Ra(i,c);const p=o||a&&!o&&Pa(t,{initial:!0,...s});e({nodeInternals:new Map(i),fitViewOnInitDone:p}),(null==f?void 0:f.length)>0&&(null==r||r(f))},updateNodePositions:(e,n=!0,r=!1)=>{const{triggerNodeChanges:i}=t();i(e.map(e=>{const t={id:e.id,type:"position",dragging:r};return n&&(t.positionAbsolute=e.positionAbsolute,t.position=e.position),t}))},triggerNodeChanges:n=>{const{onNodesChange:r,nodeInternals:i,hasDefaultNodes:a,nodeOrigin:o,getNodes:s,elevateNodesOnSelect:l}=t();if(null==n?void 0:n.length){if(a){const t=Na(Ja(n,s()),i,o,l);e({nodeInternals:t})}null==r||r(n)}},addSelectedNodes:n=>{const{multiSelectionActive:r,edges:i,getNodes:a}=t();let o,s=null;r?o=n.map(e=>Qa(e,!0)):(o=eo(a(),n),s=eo(i,[])),Da({changedNodes:o,changedEdges:s,get:t,set:e})},addSelectedEdges:n=>{const{multiSelectionActive:r,edges:i,getNodes:a}=t();let o,s=null;r?o=n.map(e=>Qa(e,!0)):(o=eo(i,n),s=eo(a(),[])),Da({changedNodes:s,changedEdges:o,get:t,set:e})},unselectNodesAndEdges:({nodes:n,edges:r}={})=>{const{edges:i,getNodes:a}=t(),o=r||i;Da({changedNodes:(n||a()).map(e=>(e.selected=!1,Qa(e.id,!1))),changedEdges:o.map(e=>Qa(e.id,!1)),get:t,set:e})},setMinZoom:n=>{const{d3Zoom:r,maxZoom:i}=t();null==r||r.scaleExtent([n,i]),e({minZoom:n})},setMaxZoom:n=>{const{d3Zoom:r,minZoom:i}=t();null==r||r.scaleExtent([i,n]),e({maxZoom:n})},setTranslateExtent:n=>{var r;null==(r=t().d3Zoom)||r.translateExtent(n),e({translateExtent:n})},resetSelectedElements:()=>{const{edges:n,getNodes:r}=t();Da({changedNodes:r().filter(e=>e.selected).map(e=>Qa(e.id,!1)),changedEdges:n.filter(e=>e.selected).map(e=>Qa(e.id,!1)),get:t,set:e})},setNodeExtent:n=>{const{nodeInternals:r}=t();r.forEach(e=>{e.positionAbsolute=Fr(e.position,n)}),e({nodeExtent:n,nodeInternals:new Map(r)})},panBy:e=>{const{transform:n,width:r,height:i,d3Zoom:a,d3Selection:o,translateExtent:s}=t();if(!a||!o||!e.x&&!e.y)return!1;const l=yr.translate(n[0]+e.x,n[1]+e.y).scale(n[2]),c=[[0,0],[r,i]],u=null==a?void 0:a.constrain()(l,c,s);return a.transform(o,u),n[0]!==u.x||n[1]!==u.y||n[2]!==u.k},cancelConnection:()=>e({connectionNodeId:ns.connectionNodeId,connectionHandleId:ns.connectionHandleId,connectionHandleType:ns.connectionHandleType,connectionStatus:ns.connectionStatus,connectionStartHandle:ns.connectionStartHandle,connectionEndHandle:ns.connectionEndHandle}),reset:()=>e({...ns})}),r=Object.is,n?G(n,r):G)),f.createElement(kr,{value:t.current},e);var n,r};rs.displayName="ReactFlowProvider";const is=({children:e})=>h.useContext(Ar)?f.createElement(f.Fragment,null,e):f.createElement(rs,null,e);is.displayName="ReactFlowWrapper";const as={input:aa,default:ra,output:sa,group:la},os={default:ki,straight:Ei,step:Mi,smoothstep:Si,simplebezier:bi},ss=[0,0],ls=[15,15],cs={x:0,y:0,zoom:1},us={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0},ds=h.forwardRef(({nodes:e,edges:t,defaultNodes:n,defaultEdges:r,className:i,nodeTypes:a=as,edgeTypes:o=os,onNodeClick:s,onEdgeClick:l,onInit:c,onMove:u,onMoveStart:d,onMoveEnd:h,onConnect:p,onConnectStart:m,onConnectEnd:g,onClickConnectStart:v,onClickConnectEnd:y,onNodeMouseEnter:b,onNodeMouseMove:x,onNodeMouseLeave:_,onNodeContextMenu:w,onNodeDoubleClick:S,onNodeDragStart:M,onNodeDrag:E,onNodeDragStop:T,onNodesDelete:C,onEdgesDelete:k,onSelectionChange:R,onSelectionDragStart:N,onSelectionDrag:P,onSelectionDragStop:I,onSelectionContextMenu:L,onSelectionStart:D,onSelectionEnd:z,connectionMode:O=ai.Strict,connectionLineType:U=di.Bezier,connectionLineStyle:F,connectionLineComponent:B,connectionLineContainerStyle:j,deleteKeyCode:H="Backspace",selectionKeyCode:V="Shift",selectionOnDrag:G=!1,selectionMode:W=ci.Full,panActivationKeyCode:$="Space",multiSelectionKeyCode:X=(ei()?"Meta":"Control"),zoomActivationKeyCode:q=(ei()?"Meta":"Control"),snapToGrid:Y=!1,snapGrid:Z=ls,onlyRenderVisibleElements:K=!1,selectNodesOnDrag:J=!0,nodesDraggable:Q,nodesConnectable:ee,nodesFocusable:te,nodeOrigin:ne=ss,edgesFocusable:re,edgesUpdatable:ie,elementsSelectable:ae,defaultViewport:oe=cs,minZoom:se=.5,maxZoom:le=2,translateExtent:ce=ts,preventScrolling:ue=!0,nodeExtent:de,defaultMarkerColor:he="#b1b1b7",zoomOnScroll:fe=!0,zoomOnPinch:pe=!0,panOnScroll:me=!1,panOnScrollSpeed:ge=.5,panOnScrollMode:ve=si.Free,zoomOnDoubleClick:ye=!0,panOnDrag:be=!0,onPaneClick:xe,onPaneMouseEnter:_e,onPaneMouseMove:we,onPaneMouseLeave:Se,onPaneScroll:Me,onPaneContextMenu:Ee,children:Te,onEdgeContextMenu:Ce,onEdgeDoubleClick:Ae,onEdgeMouseEnter:ke,onEdgeMouseMove:Re,onEdgeMouseLeave:Ne,onEdgeUpdate:Pe,onEdgeUpdateStart:Ie,onEdgeUpdateEnd:Le,onReconnect:De,onReconnectStart:ze,onReconnectEnd:Oe,reconnectRadius:Ue=10,edgeUpdaterRadius:Fe=10,onNodesChange:Be,onEdgesChange:je,noDragClassName:He="nodrag",noWheelClassName:Ve="nowheel",noPanClassName:Ge="nopan",fitView:We=!1,fitViewOptions:$e,connectOnClick:Xe=!0,attributionPosition:qe,proOptions:Ye,defaultEdgeOptions:Ze,elevateNodesOnSelect:Ke=!0,elevateEdgesOnSelect:Je=!1,disableKeyboardA11y:Qe=!1,autoPanOnConnect:et=!0,autoPanOnNodeDrag:tt=!0,connectionRadius:nt=20,isValidConnection:rt,onError:it,style:at,id:ot,nodeDragThreshold:st,...lt},ct)=>{const ut=ot||"1";return f.createElement("div",{...lt,style:{...at,...us},ref:ct,className:A(["react-flow",i]),"data-testid":"rf__wrapper",id:ot},f.createElement(is,null,f.createElement(es,{onInit:c,onMove:u,onMoveStart:d,onMoveEnd:h,onNodeClick:s,onEdgeClick:l,onNodeMouseEnter:b,onNodeMouseMove:x,onNodeMouseLeave:_,onNodeContextMenu:w,onNodeDoubleClick:S,nodeTypes:a,edgeTypes:o,connectionLineType:U,connectionLineStyle:F,connectionLineComponent:B,connectionLineContainerStyle:j,selectionKeyCode:V,selectionOnDrag:G,selectionMode:W,deleteKeyCode:H,multiSelectionKeyCode:X,panActivationKeyCode:$,zoomActivationKeyCode:q,onlyRenderVisibleElements:K,selectNodesOnDrag:J,defaultViewport:oe,translateExtent:ce,minZoom:se,maxZoom:le,preventScrolling:ue,zoomOnScroll:fe,zoomOnPinch:pe,zoomOnDoubleClick:ye,panOnScroll:me,panOnScrollSpeed:ge,panOnScrollMode:ve,panOnDrag:be,onPaneClick:xe,onPaneMouseEnter:_e,onPaneMouseMove:we,onPaneMouseLeave:Se,onPaneScroll:Me,onPaneContextMenu:Ee,onSelectionContextMenu:L,onSelectionStart:D,onSelectionEnd:z,onEdgeContextMenu:Ce,onEdgeDoubleClick:Ae,onEdgeMouseEnter:ke,onEdgeMouseMove:Re,onEdgeMouseLeave:Ne,onReconnect:De??Pe,onReconnectStart:ze??Ie,onReconnectEnd:Oe??Le,reconnectRadius:Ue??Fe,defaultMarkerColor:he,noDragClassName:He,noWheelClassName:Ve,noPanClassName:Ge,elevateEdgesOnSelect:Je,rfId:ut,disableKeyboardA11y:Qe,nodeOrigin:ne,nodeExtent:de}),f.createElement(ya,{nodes:e,edges:t,defaultNodes:n,defaultEdges:r,onConnect:p,onConnectStart:m,onConnectEnd:g,onClickConnectStart:v,onClickConnectEnd:y,nodesDraggable:Q,nodesConnectable:ee,nodesFocusable:te,edgesFocusable:re,edgesUpdatable:ie,elementsSelectable:ae,elevateNodesOnSelect:Ke,minZoom:se,maxZoom:le,nodeExtent:de,onNodesChange:Be,onEdgesChange:je,snapToGrid:Y,snapGrid:Z,connectionMode:O,translateExtent:ce,connectOnClick:Xe,defaultEdgeOptions:Ze,fitView:We,fitViewOptions:$e,onNodesDelete:C,onEdgesDelete:k,onNodeDragStart:M,onNodeDrag:E,onNodeDragStop:T,onSelectionDrag:P,onSelectionDragStart:N,onSelectionDragStop:I,noPanClassName:Ge,nodeOrigin:ne,rfId:ut,autoPanOnConnect:et,autoPanOnNodeDrag:tt,onError:it,connectionRadius:nt,isValidConnection:rt,nodeDragThreshold:st}),f.createElement(pa,{onSelectionChange:R}),Te,f.createElement(Dr,{proOptions:Ye,position:qe}),f.createElement(Ea,{rfId:ut,disableKeyboardA11y:Qe})))});function hs(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,r]of e)if(!Object.is(r,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}ds.displayName="ReactFlow";const fs=({id:e,x:t,y:n,width:r,height:i,style:a,color:o,strokeColor:s,strokeWidth:l,className:c,borderRadius:u,shapeRendering:d,onClick:h,selected:p})=>{const{background:m,backgroundColor:g}=a||{},v=o||m||g;return f.createElement("rect",{className:A(["react-flow__minimap-node",{selected:p},c]),x:t,y:n,rx:u,ry:u,width:r,height:i,fill:v,stroke:s,strokeWidth:l,shapeRendering:d,onClick:h?t=>h(t,e):void 0})};fs.displayName="MiniMapNode";var ps=h.memo(fs);const ms=e=>e.nodeOrigin,gs=e=>e.getNodes().filter(e=>!e.hidden&&e.width&&e.height),vs=e=>e instanceof Function?e:()=>e;var ys=h.memo(function({nodeStrokeColor:e="transparent",nodeColor:t="#e2e2e2",nodeClassName:n="",nodeBorderRadius:r=5,nodeStrokeWidth:i=2,nodeComponent:a=ps,onClick:o}){const s=Nr(gs,hs),l=Nr(ms),c=vs(t),u=vs(e),d=vs(n),h="undefined"==typeof window||window.chrome?"crispEdges":"geometricPrecision";return f.createElement(f.Fragment,null,s.map(e=>{const{x:t,y:n}=Ui(e,l).positionAbsolute;return f.createElement(a,{key:e.id,x:t,y:n,width:e.width,height:e.height,style:e.style,selected:e.selected,className:d(e),color:c(e),borderRadius:r,strokeColor:u(e),strokeWidth:i,shapeRendering:h,onClick:o,id:e.id})}))});const bs=e=>{const t=e.getNodes(),n={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:n,boundingRect:t.length>0?(r=Fi(t,e.nodeOrigin),i=n,Wr(Vr(Gr(r),Gr(i)))):n,rfId:e.rfId};var r,i};function xs({style:e,className:t,nodeStrokeColor:n="transparent",nodeColor:r="#e2e2e2",nodeClassName:i="",nodeBorderRadius:a=5,nodeStrokeWidth:o=2,nodeComponent:s,maskColor:l="rgb(240, 240, 240, 0.6)",maskStrokeColor:c="none",maskStrokeWidth:u=1,position:d="bottom-right",onClick:p,onNodeClick:m,pannable:g=!1,zoomable:v=!1,ariaLabel:y="React Flow mini map",inversePan:b=!1,zoomStep:x=10,offsetScale:_=5}){const w=Pr(),S=h.useRef(null),{boundingRect:M,viewBB:E,rfId:T}=Nr(bs,hs),C=(null==e?void 0:e.width)??200,k=(null==e?void 0:e.height)??150,R=M.width/C,N=M.height/k,P=Math.max(R,N),I=P*C,L=P*k,D=_*P,z=M.x-(I-M.width)/2-D,O=M.y-(L-M.height)/2-D,U=I+2*D,F=L+2*D,B=`react-flow__minimap-desc-${T}`,j=h.useRef(0);j.current=P,h.useEffect(()=>{if(S.current){const e=lt(S.current),t=e=>{const{transform:t,d3Selection:n,d3Zoom:r}=w.getState();if("wheel"!==e.sourceEvent.type||!n||!r)return;const i=-e.sourceEvent.deltaY*(1===e.sourceEvent.deltaMode?.05:e.sourceEvent.deltaMode?1:.002)*x,a=t[2]*Math.pow(2,i);r.scaleTo(n,a)},n=e=>{const{transform:t,d3Selection:n,d3Zoom:r,translateExtent:i,width:a,height:o}=w.getState();if("mousemove"!==e.sourceEvent.type||!n||!r)return;const s=j.current*Math.max(1,t[2])*(b?-1:1),l={x:t[0]-e.sourceEvent.movementX*s,y:t[1]-e.sourceEvent.movementY*s},c=[[0,0],[a,o]],u=yr.translate(l.x,l.y).scale(t[2]),d=r.constrain()(u,c,i);r.transform(n,d)},r=Cr().on("zoom",g?n:null).on("zoom.wheel",v?t:null);return e.call(r),()=>{e.on("zoom",null)}}},[g,v,b,x]);const H=p?e=>{const t=ct(e);p(e,{x:t[0],y:t[1]})}:void 0,V=m?(e,t)=>{const n=w.getState().nodeInternals.get(t);m(e,n)}:void 0;return f.createElement(Lr,{position:d,style:e,className:A(["react-flow__minimap",t]),"data-testid":"rf__minimap"},f.createElement("svg",{width:C,height:k,viewBox:`${z} ${O} ${U} ${F}`,role:"img","aria-labelledby":B,ref:S,onClick:H},y&&f.createElement("title",{id:B},y),f.createElement(ys,{onClick:V,nodeColor:r,nodeStrokeColor:n,nodeBorderRadius:a,nodeClassName:i,nodeStrokeWidth:o,nodeComponent:s}),f.createElement("path",{className:"react-flow__minimap-mask",d:`M${z-D},${O-D}h${U+2*D}v${F+2*D}h${-U-2*D}z\n        M${E.x},${E.y}h${E.width}v${E.height}h${-E.width}z`,fill:l,fillRule:"evenodd",stroke:c,strokeWidth:u,pointerEvents:"none"})))}xs.displayName="MiniMap";var _s=h.memo(xs);function ws(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,r]of e)if(!Object.is(r,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}function Ss(){return f.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},f.createElement("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"}))}function Ms(){return f.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},f.createElement("path",{d:"M0 0h32v4.2H0z"}))}function Es(){return f.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},f.createElement("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"}))}function Ts(){return f.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},f.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"}))}function Cs(){return f.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},f.createElement("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"}))}const As=({children:e,className:t,...n})=>f.createElement("button",{type:"button",className:A(["react-flow__controls-button",t]),...n},e);As.displayName="ControlButton";const ks=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom}),Rs=({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:r=!0,fitViewOptions:i,onZoomIn:a,onZoomOut:o,onFitView:s,onInteractiveChange:l,className:c,children:u,position:d="bottom-left"})=>{const p=Pr(),[m,g]=h.useState(!1),{isInteractive:v,minZoomReached:y,maxZoomReached:b}=Nr(ks,ws),{zoomIn:x,zoomOut:_,fitView:w}=Fa();return h.useEffect(()=>{g(!0)},[]),m?f.createElement(Lr,{className:A(["react-flow__controls",c]),position:d,style:e,"data-testid":"rf__controls"},t&&f.createElement(f.Fragment,null,f.createElement(As,{onClick:()=>{x(),null==a||a()},className:"react-flow__controls-zoomin",title:"zoom in","aria-label":"zoom in",disabled:b},f.createElement(Ss,null)),f.createElement(As,{onClick:()=>{_(),null==o||o()},className:"react-flow__controls-zoomout",title:"zoom out","aria-label":"zoom out",disabled:y},f.createElement(Ms,null))),n&&f.createElement(As,{className:"react-flow__controls-fitview",onClick:()=>{w(i),null==s||s()},title:"fit view","aria-label":"fit view"},f.createElement(Es,null)),r&&f.createElement(As,{className:"react-flow__controls-interactive",onClick:()=>{p.setState({nodesDraggable:!v,nodesConnectable:!v,elementsSelectable:!v}),null==l||l(!v)},title:"toggle interactivity","aria-label":"toggle interactivity"},v?f.createElement(Cs,null):f.createElement(Ts,null)),u):null};Rs.displayName="Controls";var Ns,Ps,Is=h.memo(Rs);function Ls(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,r]of e)if(!Object.is(r,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const r of n)if(!Object.prototype.hasOwnProperty.call(t,r)||!Object.is(e[r],t[r]))return!1;return!0}function Ds({color:e,dimensions:t,lineWidth:n}){return f.createElement("path",{stroke:e,strokeWidth:n,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`})}function zs({color:e,radius:t}){return f.createElement("circle",{cx:t,cy:t,r:t,fill:e})}(Ps=Ns||(Ns={})).Lines="lines",Ps.Dots="dots",Ps.Cross="cross";const Os={[Ns.Dots]:"#91919a",[Ns.Lines]:"#eee",[Ns.Cross]:"#e2e2e2"},Us={[Ns.Dots]:1,[Ns.Lines]:1,[Ns.Cross]:6},Fs=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function Bs({id:e,variant:t=Ns.Dots,gap:n=20,size:r,lineWidth:i=1,offset:a=2,color:o,style:s,className:l}){const c=h.useRef(null),{transform:u,patternId:d}=Nr(Fs,Ls),p=o||Os[t],m=r||Us[t],g=t===Ns.Dots,v=t===Ns.Cross,y=Array.isArray(n)?n:[n,n],b=[y[0]*u[2]||1,y[1]*u[2]||1],x=m*u[2],_=v?[x,x]:b,w=g?[x/a,x/a]:[_[0]/a,_[1]/a];return f.createElement("svg",{className:A(["react-flow__background",l]),style:{...s,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:c,"data-testid":"rf__background"},f.createElement("pattern",{id:d+e,x:u[0]%b[0],y:u[1]%b[1],width:b[0],height:b[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${w[0]},-${w[1]})`},g?f.createElement(zs,{color:p,radius:x/a}):f.createElement(Ds,{dimensions:_,color:p,lineWidth:i})),f.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${d+e})`}))}Bs.displayName="Background";var js,Hs,Vs=h.memo(Bs);(Hs=js||(js={})).Line="line",Hs.Handle="handle";const Gs={width:0,height:0,x:0,y:0},Ws={...Gs,pointerX:0,pointerY:0,aspectRatio:1};var $s=h.memo(function({nodeId:e,position:t,variant:n=js.Handle,className:r,style:i={},children:a,color:o,minWidth:s=10,minHeight:l=10,maxWidth:c=Number.MAX_VALUE,maxHeight:u=Number.MAX_VALUE,keepAspectRatio:d=!1,shouldResize:p,onResizeStart:m,onResize:g,onResizeEnd:v}){const y=Pi(),b="string"==typeof e?e:y,x=Pr(),_=h.useRef(null),w=h.useRef(Ws),S=h.useRef(Gs),M=fo(),E=n===js.Line?"right":"bottom-right",T=t??E;h.useEffect(()=>{if(!_.current||!b)return;const e=lt(_.current),t=T.includes("right")||T.includes("left"),n=T.includes("bottom")||T.includes("top"),r=T.includes("left"),i=T.includes("top"),a=wt().on("start",e=>{const t=x.getState().nodeInternals.get(b),{xSnapped:n,ySnapped:r}=M(e);S.current={width:(null==t?void 0:t.width)??0,height:(null==t?void 0:t.height)??0,x:(null==t?void 0:t.position.x)??0,y:(null==t?void 0:t.position.y)??0},w.current={...S.current,pointerX:n,pointerY:r,aspectRatio:S.current.width/S.current.height},null==m||m(e,{...S.current})}).on("drag",e=>{const{nodeInternals:a,triggerNodeChanges:o}=x.getState(),{xSnapped:h,ySnapped:f}=M(e),m=a.get(b);if(m){const a=[],{pointerX:v,pointerY:y,width:x,height:_,x:M,y:E,aspectRatio:T}=w.current,{x:C,y:A,width:k,height:R}=S.current,N=Math.floor(t?h-v:0),P=Math.floor(n?f-y:0);let I=Ur(x+(r?-N:N),s,c),L=Ur(_+(i?-P:P),l,u);if(d){const e=I/L,r=t&&n;I=e<=T&&r||n&&!t?L*T:I,L=e>T&&r||t&&!n?I/T:L,I>=c?(I=c,L=c/T):I<=s&&(I=s,L=s/T),L>=u?(L=u,I=u*T):L<=l&&(L=l,I=l*T)}const D=I!==k,z=L!==R;if(r||i){const e=r?M-(I-x):M,t=i?E-(L-_):E,n=e!==C&&D,o=t!==A&&z;if(n||o){const r={id:m.id,type:"position",position:{x:n?e:C,y:o?t:A}};a.push(r),S.current.x=r.position.x,S.current.y=r.position.y}}if(D||z){const e={id:b,type:"dimensions",updateStyle:!0,resizing:!0,dimensions:{width:I,height:L}};a.push(e),S.current.width=I,S.current.height=L}if(0===a.length)return;const O=function({width:e,prevWidth:t,height:n,prevHeight:r,invertX:i,invertY:a}){const o=e-t,s=n-r,l=[o>0?1:o<0?-1:0,s>0?1:s<0?-1:0];return o&&i&&(l[0]=-1*l[0]),s&&a&&(l[1]=-1*l[1]),l}({width:S.current.width,prevWidth:k,height:S.current.height,prevHeight:R,invertX:r,invertY:i}),U={...S.current,direction:O};if(!1===(null==p?void 0:p(e,U)))return;null==g||g(e,U),o(a)}}).on("end",e=>{const t={id:b,type:"dimensions",resizing:!1};null==v||v(e,{...S.current}),x.getState().triggerNodeChanges([t])});return e.call(a),()=>{e.on(".drag",null)}},[b,T,s,l,c,u,d,M,m,g,v]);const C=T.split("-"),k=n===js.Line?"borderColor":"backgroundColor",R=o?{...i,[k]:o}:i;return f.createElement("div",{className:A(["react-flow__resize-control","nodrag",...C,n,r]),ref:_,style:R},a)});const Xs=["top-left","top-right","bottom-left","bottom-right"],qs=["top","right","bottom","left"];function Ys({nodeId:e,isVisible:t=!0,handleClassName:n,handleStyle:r,lineClassName:i,lineStyle:a,color:o,minWidth:s=10,minHeight:l=10,maxWidth:c=Number.MAX_VALUE,maxHeight:u=Number.MAX_VALUE,keepAspectRatio:d=!1,shouldResize:h,onResizeStart:p,onResize:m,onResizeEnd:g}){return t?f.createElement(f.Fragment,null,qs.map(t=>f.createElement($s,{key:t,className:i,style:a,nodeId:e,position:t,variant:js.Line,color:o,minWidth:s,minHeight:l,maxWidth:c,maxHeight:u,onResizeStart:p,keepAspectRatio:d,shouldResize:h,onResize:m,onResizeEnd:g})),Xs.map(t=>f.createElement($s,{key:t,className:n,style:r,nodeId:e,position:t,color:o,minWidth:s,minHeight:l,maxWidth:c,maxHeight:u,onResizeStart:p,keepAspectRatio:d,shouldResize:h,onResize:m,onResizeEnd:g}))):null}const Zs=e=>{let t;const n=new Set,r=(e,r)=>{const i="function"==typeof e?e(t):e;if(!Object.is(i,t)){const e=t;t=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,a={setState:r,getState:i,getInitialState:()=>o,subscribe:e=>(n.add(e),()=>n.delete(e))},o=t=e(r,i,a);return a},Ks=e=>e?Zs(e):Zs,Js=e=>e,Qs=e=>{const t=Ks(e),n=e=>function(e,t=Js){const n=f.useSyncExternalStore(e.subscribe,f.useCallback(()=>t(e.getState()),[e,t]),f.useCallback(()=>t(e.getInitialState()),[e,t]));return f.useDebugValue(n),n}(t,e);return Object.assign(n,t),n},el=e=>e?Qs(e):Qs,tl="\nuniform int u_raymarch_steps;vec2 rayBoxIntersect(vec3 rayOrigin,vec3 rayDir,vec3 boxMin,vec3 boxMax){vec3 tMin=(boxMin-rayOrigin)/rayDir;vec3 tMax=(boxMax-rayOrigin)/rayDir;vec3 t1=min(tMin,tMax);vec3 t2=max(tMin,tMax);float tNear=max(max(t1.x,t1.y),t1.z);float tFar=min(min(t2.x,t2.y),t2.z);return vec2(tNear,tFar);}vec4 raymarch(vec3 rayOrigin,vec3 rayDir){vec2 hit=rayBoxIntersect(rayOrigin,rayDir,vec3(-.5),vec3(.5));if(hit.x>hit.y || hit.y<.0){discard;}hit.x=max(hit.x,.0);float distanceToTravel=hit.y-hit.x;int num_steps=u_raymarch_steps;float stepSize=distanceToTravel/float(num_steps);vec3 pos=rayOrigin+rayDir*hit.x;vec4 color=vec4(.0);for(int i=0;i<256;i++){if(i>=num_steps)break;if(color.a>.99)break;vec4 noiseSample=getNoise(pos);float densityValue=(noiseSample.r+noiseSample.g+noiseSample.b)/3.;float density=pow(densityValue,2.)*u_density;if(density>.01){vec3 lightColor=getPreviewColor(noiseSample,u_channel_mask);float alpha=1.-exp(-density*stepSize);color.rgb+=lightColor*alpha*(1.-color.a);color.a+=alpha*(1.-color.a);}pos+=rayDir*stepSize;}return color;}",nl="\nvarying vec2 vUv;uniform vec4 u_channel_mask;uniform float u_zoom;uniform vec2 u_offset;uniform int u_slice_axis;uniform float u_slice_pos;uniform vec2 u_resolution;__PREAMBLE__\n#ifdef IS_BAKED\nuniform sampler3D u_baked_texture;uniform float u_tiling;uniform bool u_use_bicubic;uniform vec3 u_texture_res;vec4 getNoise(vec3 p){vec3 uvw=fract((p+.5)*u_tiling);if(u_use_bicubic){return textureBicubic(u_baked_texture,uvw,u_texture_res);}return texture(u_baked_texture,uvw);}\n#else\nuniform float u_time;__NOISE_FUNCTION__\n#endif\nvec4 computeSliceColor(vec2 uv_coords){vec2 st=uv_coords*2.-1.;float aspect=u_resolution.x/u_resolution.y;st.x*=aspect;vec2 uv=st*u_zoom-u_offset;vec3 pos;if(u_slice_axis==0){pos=vec3(u_slice_pos-.5,uv.x,uv.y);}else if(u_slice_axis==1){pos=vec3(uv.x,u_slice_pos-.5,uv.y);}else{pos=vec3(uv.x,uv.y,u_slice_pos-.5);}vec4 noise_val=getNoise(pos);return vec4(getPreviewColor(noise_val,u_channel_mask),1.);}void main(){\n#if SUPERSAMPLING_FACTOR > 1\nvec4 total_color=vec4(.0);float num_samples=.0;vec2 pixel_size=1./u_resolution;for(int sx=0;sx<MAX_SUPERSAMPLING_ITERATIONS;sx++){if(sx>=SUPERSAMPLING_FACTOR)break;for(int sy=0;sy<MAX_SUPERSAMPLING_ITERATIONS;sy++){if(sy>=SUPERSAMPLING_FACTOR)break;vec2 sub_pixel_offset=((vec2(float(sx),float(sy))+.5)/float(SUPERSAMPLING_FACTOR))-.5;vec2 sample_uv=vUv+sub_pixel_offset*pixel_size;total_color+=computeSliceColor(sample_uv);num_samples+=1.;}}gl_FragColor=total_color/num_samples;\n#else\ngl_FragColor=computeSliceColor(vUv);\n#endif\n}",rl=[];function il(e){rl.push(e)}il({type:"Blend",label:"Blend",color:"teal",category:"Combiners",description:'Combines two input values using a selected blending mode. The "Mask" input controls the mix between A and B in "Normal" mode.',params:()=>[{id:"mode",label:"Mode",type:"select",value:"mix",options:[{value:"mix",label:"Normal (Mix)"},{value:"add",label:"Add"},{value:"subtract",label:"Subtract"},{value:"multiply",label:"Multiply"},{value:"screen",label:"Screen"},{value:"overlay",label:"Overlay"},{value:"softlight",label:"Soft Light"},{value:"hardlight",label:"Hard Light"},{value:"difference",label:"Difference"},{value:"dodge",label:"Dodge"},{value:"burn",label:"Burn"}]}],inputs:()=>[{id:"in_a",label:"A"},{id:"in_b",label:"B"},{id:"mask",label:"Mask"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>{var r;const i=(null==(r=t.params.find(e=>"mode"===e.id))?void 0:r.value)||"mix",a=n("in_a","float","0.0"),o=n("in_b","float","0.0"),s=n("mask","float","0.5");let l="";const c=["overlay","softlight","hardlight","dodge","burn"].includes(i);switch(i){case"add":l+=`float ${e}=clamp(${a}+${o},.0,1.);`;break;case"subtract":l+=`float ${e}=clamp(${a}-${o},.0,1.);`;break;case"multiply":l+=`float ${e}=${a}*${o};`;break;case"screen":l+=`float ${e}=1.-(1.-${a})*(1.-${o});`;break;case"overlay":l+=`float ${e}=blend_overlay(${a},${o});`;break;case"softlight":l+=`float ${e}=blend_softlight(${a},${o});`;break;case"hardlight":l+=`float ${e}=blend_overlay(${o},${a});`;break;case"difference":l+=`float ${e}=abs(${a}-${o});`;break;case"dodge":l+=`float ${e}=blend_dodge(${a},${o});`;break;case"burn":l+=`float ${e}=blend_burn(${a},${o});`;break;default:l+=`float ${e}=mix(${a},${o},${s});`}return{preamble:c?"\nfloat blend_overlay(float a,float b){return(a<.5)?(2.*a*b):(1.-2.*(1.-a)*(1.-b));}float blend_softlight(float a,float b){return(b<.5)?(2.*a*b+a*a*(1.-2.*b)):(sqrt(a)*(2.*b-1.)+2.*a*(1.-b));}float blend_dodge(float a,float b){return(b==1.)?1.:min(1.,a/(1.-b));}float blend_burn(float a,float b){return(b==.0)?.0:1.-min(1.,(1.-a)/b);}":void 0,code:l+"\n",outputType:"float"}}}),il({type:"Math",label:"Math",color:"teal",category:"Combiners",description:"Performs a basic mathematical operation (Add, Subtract, Multiply, etc.) on two input values.",params:()=>[{id:"op",label:"Operation",type:"select",value:"add",options:[{value:"add",label:"Add"},{value:"subtract",label:"Subtract"},{value:"multiply",label:"Multiply"},{value:"divide",label:"Divide"},{value:"min",label:"Min"},{value:"max",label:"Max"},{value:"pow",label:"Power"},{value:"modulo",label:"Modulo"},{value:"step",label:"Step"},{value:"fract",label:"Fract"},{value:"round",label:"Round"},{value:"ceil",label:"Ceil"},{value:"floor",label:"Floor"},{value:"sign",label:"Sign"}]}],inputs:()=>[{id:"in_a",label:"A"},{id:"in_b",label:"B"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>{var r;const i=(null==(r=t.params.find(e=>"op"===e.id))?void 0:r.value)||"add",a=n("in_a","float","0.0"),o=n("in_b","float","0.0");let s,l="";switch(i){case"add":l=`float ${e}=${a}+${o};\n`;break;case"subtract":l=`float ${e}=${a}-${o};\n`;break;case"multiply":l=`float ${e}=${a}*${o};\n`;break;case"divide":l=`float ${e}=${o}==.0?.0:${a}/${o};\n`;break;case"min":l=`float ${e}=min(${a},${o});\n`;break;case"max":l=`float ${e}=max(${a},${o});\n`;break;case"pow":l=`float ${e}=pow(abs(${a}),${o});\n`;break;case"modulo":l=`float ${e}=mod(${a},${o});\n`;break;case"step":l=`float ${e}=step(${o},${a});\n`;break;case"fract":l=`float ${e}=fract(${a});\n`;break;case"round":l=`float ${e}=round(${a});\n`,s="\nfloat round(float x){return floor(x+.5);}";break;case"ceil":l=`float ${e}=ceil(${a});\n`;break;case"floor":l=`float ${e}=floor(${a});\n`;break;case"sign":l=`float ${e}=sign(${a});\n`;break;default:l=`float ${e}=.0;\n`}return{preamble:s,code:l,outputType:"float"}}}),il({type:"Polar",label:"Polar Coords",color:"yellow",category:"Coordinates",description:"Converts Cartesian coordinates (X, Y, Z) into Polar coordinates (Spherical or Cylindrical). Useful for creating radial or circular patterns.",params:()=>[{id:"mode",label:"Mode",type:"select",value:"spherical",options:[{value:"spherical",label:"Spherical"},{value:"cylindrical",label:"Cylindrical"}]}],inputs:()=>[{id:"in",label:"Coords"}],outputs:()=>[{id:"out",label:"Coords",type:"vec3"}],glsl:(e,t,n)=>{var r;const i=(null==(r=t.params.find(e=>"mode"===e.id))?void 0:r.value)||"spherical",a=n("in","vec3","pos");let o="";return"spherical"===i?(o=`float r_${e} = length(${a});\n`,o+=`  float theta_${e} = atan(${a}.y, ${a}.x);\n`,o+=`  float phi_${e} = r_${e} > 0.0 ? acos(${a}.z / r_${e}) : 0.0;\n`,o+=`  vec3 ${e} = vec3(r_${e}, theta_${e}, phi_${e});\n`):(o=`float r_cyl_${e} = length(${a}.xy);\n`,o+=`  float theta_cyl_${e} = atan(${a}.y, ${a}.x);\n`,o+=`  vec3 ${e} = vec3(r_cyl_${e}, theta_cyl_${e}, ${a}.z);\n`),{code:o,outputType:"vec3"}}}),il({type:"Tiler",label:"Tiler Coords",color:"yellow",category:"Coordinates",description:"Repeats or mirrors the coordinate space, allowing patterns to tile seamlessly. Adjust frequency on each axis independently.",params:()=>[{id:"mode",label:"Mode",type:"select",value:"repeat",options:[{value:"repeat",label:"Repeat (mod)"},{value:"mirror",label:"Mirror (ping-pong)"}]},{id:"freqX",label:"Frequency X",type:"slider",value:1,min:.1,max:10,step:.1},{id:"freqY",label:"Frequency Y",type:"slider",value:1,min:.1,max:10,step:.1},{id:"freqZ",label:"Frequency Z",type:"slider",value:1,min:.1,max:10,step:.1}],inputs:()=>[{id:"in",label:"Coords"}],outputs:()=>[{id:"out",label:"Coords",type:"vec3"}],glsl:(e,t,n)=>{var r;const i=(null==(r=t.params.find(e=>"mode"===e.id))?void 0:r.value)||"repeat",a=n("in","vec3","pos"),o=`vec3(${n("freqX","float","1.0")}, ${n("freqY","float","1.0")}, ${n("freqZ","float","1.0")})`;let s="";return"repeat"===i?s=`vec3 ${e} = mod(${a}, ${o});\n`:(s=`vec3 p_mir_${e} = ${a};\n`,s+=`  vec3 freq_mir_${e} = ${o};\n`,s+=`  vec3 ${e} = freq_mir_${e} - abs(mod(p_mir_${e}, 2.0 * freq_mir_${e}) - freq_mir_${e});\n`),{code:s,outputType:"vec3"}}}),il({type:"Transform",label:"Transform Coords",color:"yellow",category:"Coordinates",description:"Applies standard 3D transformations (Translate, Rotate, Scale) to the input coordinates before they are used by other nodes.",params:()=>[{id:"translateX",label:"Translate X",type:"slider",value:0,min:-5,max:5,step:.01},{id:"translateY",label:"Translate Y",type:"slider",value:0,min:-5,max:5,step:.01},{id:"translateZ",label:"Translate Z",type:"slider",value:0,min:-5,max:5,step:.01},{id:"rotateX",label:"Rotate X",type:"slider",value:0,min:-180,max:180,step:1},{id:"rotateY",label:"Rotate Y",type:"slider",value:0,min:-180,max:180,step:1},{id:"rotateZ",label:"Rotate Z",type:"slider",value:0,min:-180,max:180,step:1},{id:"scaleX",label:"Scale X",type:"slider",value:1,min:0,max:5,step:.01},{id:"scaleY",label:"Scale Y",type:"slider",value:1,min:0,max:5,step:.01},{id:"scaleZ",label:"Scale Z",type:"slider",value:1,min:0,max:5,step:.01}],inputs:()=>[{id:"in",label:"Coords"}],outputs:()=>[{id:"out",label:"Coords",type:"vec3"}],glsl:(e,t,n)=>{let r=`mat4 transform_${e} = translationMatrix(vec3(${n("translateX","float","0.0")}, ${n("translateY","float","0.0")}, ${n("translateZ","float","0.0")})) * rotationX(${n("rotateX","float","0.0")} * 0.01745) * rotationY(${n("rotateY","float","0.0")} * 0.01745) * rotationZ(${n("rotateZ","float","0.0")} * 0.01745) * scaleMatrix(vec3(${n("scaleX","float","1.0")}, ${n("scaleY","float","1.0")}, ${n("scaleZ","float","1.0")}));\n`;return r+=`  vec3 ${e} = (transform_${e} * vec4(${n("in","vec3","pos")}, 1.0)).xyz;\n`,{code:r,outputType:"vec3"}}}),il({type:"FlowWarp",label:"Flow Warp",color:"yellow",category:"Coordinates",description:"Distorts the input coordinate space using a Perlin noise-based vector field. Connect its output to the 'Position' input of any generator to create flowing, warped effects.",params:()=>[{id:"tileable",label:"Tileable",type:"checkbox",value:!0},{id:"scale",label:"Field Scale",type:"slider",value:2,min:.1,max:20,step:.1},{id:"angle",label:"Angle",type:"slider",value:45,min:0,max:360,step:1},{id:"strength",label:"Strength",type:"slider",value:1,min:0,max:5,step:.1},{id:"iterations",label:"Iterations",type:"slider",value:3,min:1,max:8,step:1},{id:"seed",label:"Seed",type:"slider",value:0,min:0,max:100,step:.1}],inputs:()=>[{id:"in",label:"Coords"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Coords",type:"vec3"}],glsl:(e,t,n)=>{const r=t.params.find(e=>"tileable"===e.id),i=!r||r.value,a=n("scale","float","2.0"),o=n("angle","float","45.0"),s=n("strength","float","1.0"),l=`int(floor(${n("iterations","float","3.")}))`,c=n("seed","float","0.0");return{preamble:"\nvec3 flow_warp_generator(vec3 pos,float scale,bool tileable,float angle,float strength,int iterations,float seed){vec3 p=pos;float final_scale=scale;float angle_rad=angle*.0174533;mat2 rotation=mat2(cos(angle_rad),-sin(angle_rad),sin(angle_rad),cos(angle_rad));if(tileable){p=pos+.5;final_scale=max(1.,floor(scale));}for(int i=0;i<iterations;i++){float noise_val;if(tileable){noise_val=gradientNoise(p*final_scale,final_scale,seed+float(i));}else{noise_val=gradientNoise_nonTileable(p*final_scale,seed+float(i));}float flow_angle=noise_val*3.14159265;vec2 flow_vector=vec2(cos(flow_angle),sin(flow_angle));flow_vector=rotation*flow_vector;p.xy+=flow_vector*strength*.05;}if(tileable){p=p-.5;}return p;}",code:`vec3 ${e}=flow_warp_generator(${n("in","vec3","pos")}+${n("offset","vec3","vec3(0.0)")},${a},${i},${o},${s},${l},${c});\n`,outputType:"vec3"}}}),il({type:"AngularWorley",label:"Worley",color:"blue",category:"Generators",description:"A variant of Worley noise based on angular distance, creating unique cellular patterns. F2-F1 is great for generating procedural cracks or veins.",params:()=>[{id:"outputType",label:"Output",type:"select",value:"f1",options:[{value:"f1",label:"F1 (Closest)"},{value:"f2",label:"F2 (2nd Closest)"},{value:"f2_f1",label:"F2 - F1 (Edge)"}]},{id:"pointCount",label:"Points",type:"slider",value:16,min:1,max:256,step:1},{id:"seed",label:"Seed",type:"slider",value:0,min:0,max:100,step:.1},{id:"maxExpected",label:"Max Distance",type:"slider",value:2.8,min:.1,max:5,step:.1},{id:"edgeWidth",label:"Edge Width",type:"slider",value:5,min:.1,max:10,step:.1}],inputs:()=>[{id:"pos",label:"Position"},{id:"scale",label:"Scale"},{id:"repeat",label:"Repeat"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>{var r;const i={f1:0,f2:1,f2_f1:2}[(null==(r=t.params.find(e=>"outputType"===e.id))?void 0:r.value)||"f1"]??0;return{preamble:"\nstruct e{vec3 c;vec3 s;};float angular_worley_hash1(float x){return fract(sin(x)*43758.5453123);}vec3 angular_worley_hash3(float x){return vec3(angular_worley_hash1(x+.11),angular_worley_hash1(x+.22),angular_worley_hash1(x+.33));}vec3 angular_worley_featureAngles(int idx,float seed){float base=float(idx)*12.9898+seed*78.233;vec3 h=angular_worley_hash3(base);return h*6.283185307179586;}e angular_worley_anglesTo6D(vec3 ang){return e(cos(ang),sin(ang));}float angular_worley_dist6D(e a,e b){vec3 dc=a.c-b.c;vec3 ds=a.s-b.s;return sqrt(dot(dc,dc)+dot(ds,ds));}float angular_worley_get_noise(vec3 pos,vec3 scale,vec3 repeat,int pointCount,float seed,int outputType,float maxExpected,float edgeWidth){vec3 p=pos*scale;vec3 fracPos=fract(p*repeat);vec3 angles=fracPos*6.283185307179586;e sample6=angular_worley_anglesTo6D(angles);float best=1e20;float secondBest=1e20;for(int i=0;i<256;++i){if(i>=pointCount)break;vec3 fAng=angular_worley_featureAngles(i,seed);e f6=angular_worley_anglesTo6D(fAng);float d=angular_worley_dist6D(sample6,f6);if(d<best){secondBest=best;best=d;}else if(d<secondBest){secondBest=d;}}float result=.0;if(outputType==1){result=clamp(secondBest/maxExpected,.0,1.);}else if(outputType==2){if(secondBest>1e19){result=1.;}else{float child=secondBest-best;result=clamp(child*edgeWidth,.0,1.);}}else{result=clamp(best/maxExpected,.0,1.);}return result;}",code:`float ${e}_internal=angular_worley_get_noise(${n("pos","vec3","pos")},${n("scale","vec3","vec3(1.0)")},${n("repeat","vec3","vec3(1.0)")},int(floor(${n("pointCount","float","16.")})),${n("seed","float","0.0")},${i},${n("maxExpected","float","2.8")},${n("edgeWidth","float","5.0")});\n float ${e}=${e}_internal*2.-1.;\n`,outputType:"float"}}}),il({type:"PerlinWorleyFBM",label:"Perlin-Worley FBM",color:"blue",category:"Generators",description:"A specific FBM implementation that combines Perlin and Worley noise to create a unique organic, billowy texture. Can also output individual noise components or a final composite cloud shape.",params:()=>[{id:"outputType",label:"Output Type",type:"select",value:"cloudShape",options:[{value:"perlinWorley",label:"Perlin-Worley"},{value:"worleyF1",label:"Worley F1 (Low)"},{value:"worleyF2",label:"Worley F2 (Mid)"},{value:"worleyF3",label:"Worley F3 (High)"},{value:"cloudShape",label:"Cloud Shape"}]},{id:"scale",label:"Scale",type:"slider",value:5,min:.1,max:20,step:.1},{id:"octaves",label:"Octaves",type:"slider",value:4,min:1,max:8,step:1},{id:"persistence",label:"Persistence",type:"slider",value:.5,min:.1,max:1,step:.05},{id:"lacunarity",label:"Lacunarity",type:"slider",value:2,min:1,max:4,step:.1},{id:"seed",label:"Seed",type:"slider",value:0,min:0,max:100,step:.1},{id:"cloudScale",label:"Cloud Scale",type:"slider",value:.5,min:.1,max:2,step:.01},{id:"coverage",label:"Cloud Coverage",type:"slider",value:.85,min:0,max:1,step:.01}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>{var r;const i=(null==(r=t.params.find(e=>"outputType"===e.id))?void 0:r.value)||"cloudShape",a={perlinWorley:0,worleyF1:1,worleyF2:2,worleyF3:3,cloudShape:4}[i]??4,o=n("pos","vec3","pos"),s=n("offset","vec3","vec3(0.0)"),l=n("scale","float","5.0"),c=`int(floor(${n("octaves","float","4.")}))`,u=n("persistence","float","0.5"),d=n("lacunarity","float","2.0"),h=n("seed","float","0.0"),f=n("cloudScale","float","0.5"),p=n("coverage","float","0.85");return"perlinWorley"!==i||t.params.find(e=>"outputType"===e.id)?{code:`float ${e}=perlin_worley_cloud_generator(${o}+${s},${l},${c},${u},${d},${h},${a},${f},${p});\n`,outputType:"float"}:{code:`float ${e}=fbm(${o}+${s},${l},${c},${u},${d},${h});\n`,outputType:"float"}}}),il({type:"FBM",label:"FBM",color:"blue",category:"Generators",description:"A versatile Fractal Brownian Motion generator. Choose between Perlin or Worley noise as a base to create complex, detailed patterns across multiple octaves.",params:()=>[{id:"type",label:"Type",type:"select",value:"perlin",options:[{value:"perlin",label:"Perlin"},{value:"worley",label:"Worley"}]},{id:"scale",label:"Scale",type:"slider",value:5,min:.1,max:50,step:.1},{id:"octaves",label:"Octaves",type:"slider",value:4,min:1,max:10,step:1},{id:"persistence",label:"Persistence",type:"slider",value:.5,min:.1,max:1,step:.05},{id:"lacunarity",label:"Lacunarity",type:"slider",value:2,min:1,max:4,step:.1},{id:"seed",label:"Seed",type:"slider",value:0,min:0,max:100,step:.1}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"},{id:"in",label:"Input"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>{var r;const i=(null==(r=t.params.find(e=>"type"===e.id))?void 0:r.value)||"perlin",a=n("pos","vec3","pos"),o=n("offset","vec3","vec3(0.0)"),s=n("in","float","0.0"),l=n("scale","float","5.0"),c=`int(floor(${n("octaves","float","4.")}))`,u=n("persistence","float","0.5"),d=n("lacunarity","float","2.0"),h=n("seed","float","0.0");let f="";return f="perlin"===i?`perlinfbm(${a} + ${o} + ${s}, ${l}, ${c}, ${u}, ${d}, ${h})`:`genericWorleyFbm(${a} + ${o} + ${s}, ${l}, ${c}, ${d}, ${u}, ${h})`,{code:`float ${e}=${f};\n`,outputType:"float"}}}),il({type:"GaborNoise",label:"Gabor Noise",color:"blue",category:"Generators",description:"Generates anisotropic (directional) tileable Gabor noise. Two tiling modes: world-wrap (period = 1.0) and cell-periodic (period = floor(scale)). Configure impulses per cell to reduce blockiness.",params:()=>[{id:"scale",label:"Scale (cells / world unit)",type:"slider",value:8,min:.1,max:64,step:.1},{id:"frequency",label:"Frequency",type:"slider",value:.8,min:.1,max:4,step:.05},{id:"bandwidth",label:"Bandwidth",type:"slider",value:1,min:.05,max:8,step:.05},{id:"seed",label:"Seed",type:"slider",value:0,min:0,max:100,step:.1},{id:"mode",label:"Mode (0:World 1:Cell)",type:"slider",value:0,min:0,max:1,step:1},{id:"impulses",label:"Impulses per cell",type:"slider",value:3,min:1,max:8,step:1}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>{const r=n("scale","float","8.0"),i=n("frequency","float","0.8"),a=n("bandwidth","float","1.0"),o=n("seed","float","0.0"),s=n("mode","float","0.0"),l=n("impulses","float","3.0");return{preamble:"\nfloat gabor_hash1(float n){return fract(sin(n)*43758.5453123);}vec3 gabor_hash3(float n){return vec3(gabor_hash1(n),gabor_hash1(n+113.1),gabor_hash1(n+271.7));}vec3 gabor_mod_vec3(vec3 a,vec3 b){return a-b*floor(a/b);}float gabor_mod_float(float a,float b){return a-b*floor(a/b);}int gabor_abs_int(int x){return x<0?-x:x;}void eval_impulse(in vec3 impulse_world,in vec3 sample_world,in vec3 period,in float bandwidth,in float frequency,in float seed_offset,out float contrib,out float weight){vec3 halfPeriod=period*.5;vec3 dist_vec=impulse_world-sample_world;dist_vec=gabor_mod_vec3(dist_vec+halfPeriod,period)-halfPeriod;float bandwidth_sq=max(1e-6,bandwidth*bandwidth);float gauss=exp(-dot(dist_vec,dist_vec)/(2.*bandwidth_sq));vec3 orient_raw=gabor_hash3(seed_offset+.123);vec3 orientation=normalize(orient_raw*2.-1.);float phase=gabor_hash1(seed_offset+.456)*6.28318530718;float cosine_wave=cos(6.28318530718*frequency*dot(dist_vec,orientation)+phase);contrib=gauss*cosine_wave;weight=gauss;}float gabor_world_wrap(vec3 worldPos,float scale,float frequency,float bandwidth,float seed,int impulsesPerCell){vec3 worldWrapped=gabor_mod_vec3(worldPos+.5,vec3(1.))-.5;vec3 p=worldWrapped*scale;vec3 id=floor(p);vec3 f=fract(p);vec3 sample_world=id+f;float periodCountF=floor(max(1.,scale));float minFromBandwidth=ceil(6.*bandwidth);if(minFromBandwidth>periodCountF)periodCountF=minFromBandwidth;vec3 period=vec3(periodCountF);float noise=.0;float weightSum=.0;int radius=int(ceil(3.*bandwidth));if(radius<1)radius=1;if(radius>8)radius=8;for(int z=-8;z<=8;z++){if(gabor_abs_int(z)>radius)continue;for(int y=-8;y<=8;y++){if(gabor_abs_int(y)>radius)continue;for(int x=-8;x<=8;x++){if(gabor_abs_int(x)>radius)continue;vec3 cellOffset=vec3(float(x),float(y),float(z));vec3 neighbor_id=id+cellOffset;vec3 wrapped_id=gabor_mod_vec3(neighbor_id,period);for(int k=0;k<8;k++){if(k>=impulsesPerCell)break;float kf=float(k)*13.13;float cell_seed=seed+dot(wrapped_id+.5,vec3(1.,57.,113.))+kf;vec3 impulse_jitter=gabor_hash3(cell_seed);vec3 impulse_world=neighbor_id+impulse_jitter;float contrib;float weight;eval_impulse(impulse_world,sample_world,period,bandwidth,frequency,cell_seed,contrib,weight);noise+=contrib;weightSum+=weight;}}}}if(weightSum>.0)noise/=weightSum;return clamp(noise,-1.,1.);}float gabor_cell_periodic(vec3 worldPos,float scale,float frequency,float bandwidth,float seed,int impulsesPerCell){vec3 p=worldPos*scale;vec3 id=floor(p);vec3 f=fract(p);vec3 sample_world=id+f;float periodCountF=floor(max(1.,scale));float minFromBandwidth=ceil(6.*bandwidth);if(minFromBandwidth>periodCountF)periodCountF=minFromBandwidth;vec3 period=vec3(periodCountF);float noise=.0;float weightSum=.0;int radius=int(ceil(3.*bandwidth));if(radius<1)radius=1;if(radius>8)radius=8;for(int z=-8;z<=8;z++){if(gabor_abs_int(z)>radius)continue;for(int y=-8;y<=8;y++){if(gabor_abs_int(y)>radius)continue;for(int x=-8;x<=8;x++){if(gabor_abs_int(x)>radius)continue;vec3 cellOffset=vec3(float(x),float(y),float(z));vec3 neighbor_id=id+cellOffset;vec3 wrapped_id=gabor_mod_vec3(neighbor_id,period);for(int k=0;k<8;k++){if(k>=impulsesPerCell)break;float kf=float(k)*13.13;float cell_seed=seed+dot(wrapped_id+.5,vec3(1.,57.,113.))+kf;vec3 impulse_jitter=gabor_hash3(cell_seed);vec3 impulse_world=neighbor_id+impulse_jitter;float contrib;float weight;eval_impulse(impulse_world,sample_world,period,bandwidth,frequency,cell_seed,contrib,weight);noise+=contrib;weightSum+=weight;}}}}if(weightSum>.0)noise/=weightSum;return clamp(noise,-1.,1.);}float gabor_noise_3d(vec3 worldPos,float scale,float frequency,float bandwidth,float seed,float mode,float impulsesPerCellF){int impulsesPerCell=int(max(1.,floor(impulsesPerCellF)));if(mode<.5){return gabor_world_wrap(worldPos,scale,frequency,bandwidth,seed,impulsesPerCell);}else{return gabor_cell_periodic(worldPos,scale,frequency,bandwidth,seed,impulsesPerCell);}}",code:`float ${e}=gabor_noise_3d(${n("pos","vec3","pos")}+${n("offset","vec3","vec3(0.0)")},${r},${i},${a},${o},${s},${l});\n`,outputType:"float"}}}),il({type:"Pattern",label:"Pattern Generator",color:"blue",category:"Generators",description:'Creates simple, repeating geometric patterns like rings or checkers. Use "Sharpness" to control the transition between pattern elements.',params:()=>[{id:"frequency",label:"Frequency",type:"slider",value:10,min:1,max:50,step:.5},{id:"shape",label:"Shape",type:"select",value:"rings",options:[{value:"rings",label:"Rings"},{value:"checkers",label:"Checkers"}]},{id:"sharpness",label:"Sharpness",type:"slider",value:10,min:.1,max:50,step:.1}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>{var r;const i=n("pos","vec3","pos"),a=n("offset","vec3","vec3(0.0)"),o=n("frequency","float","10.0"),s=n("sharpness","float","10.0");let l="";return"rings"===((null==(r=t.params.find(e=>"shape"===e.id))?void 0:r.value)||"rings")?l=`float ${e} = sin(length(${i} + ${a}) * ${o});\n`:(l=`vec3 p_tanh_checkers = tanh(${s} * sin((${i} + ${a}) * ${o} * 3.14159265));\n`,l+=`float ${e} = p_tanh_checkers.x * p_tanh_checkers.y * p_tanh_checkers.z;\n`),{code:l,outputType:"float"}}}),il({type:"SimplexNoise",label:"Simplex Noise",color:"blue",category:"Generators",description:"A modern, high-performance gradient noise with seamless, axis-aligned tiling. OpenSimplex2 is generally faster but lower quality.",params:()=>[{id:"scale",label:"Scale",type:"slider",value:1,min:.1,max:20,step:.1},{id:"type",label:"Type",type:"select",value:"os2s",options:[{value:"os2",label:"OpenSimplex2"},{value:"os2s",label:"OpenSimplex2S"}]},{id:"seed",label:"Seed",type:"slider",value:0,min:0,max:100,step:.1}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>{var r;const i=(null==(r=t.params.find(e=>"type"===e.id))?void 0:r.value)||"os2s",a=`floor(max(1.0, ${n("scale","float","1.0")}))`;return{preamble:"\nvec4 os_permute(vec4 t){return t*(t*34.+133.);}vec3 os2_grad(float hash){vec3 cube=mod(floor(hash/vec3(1.,2.,4.)),2.)*2.-1.;vec3 cuboct=cube;cuboct[int(hash/16.)]=.0;float type=mod(floor(hash/8.),2.);vec3 rhomb=(1.-type)*cube+type*(cuboct+cross(cube,cuboct));vec3 grad=cuboct*1.22474487139+rhomb;grad*=(1.-.042942436724648037*type)*32.80201376986577;return grad;}vec3 os2s_grad(float hash){vec3 cube=mod(floor(hash/vec3(1.,2.,4.)),2.)*2.-1.;vec3 cuboct=cube;cuboct[int(hash/16.)]=.0;float type=mod(floor(hash/8.),2.);vec3 rhomb=(1.-type)*cube+type*(cuboct+cross(cube,cuboct));vec3 grad=cuboct*1.22474487139+rhomb;grad*=(1.-.042942436724648037*type)*3.5946317686139184;return grad;}vec4 os2_base_tileable(vec3 X,float seed,vec3 period){vec3 v1=round(X);vec3 d1=X-v1;vec3 score1=abs(d1);vec3 dir1=step(max(score1.yzx,score1.zxy),score1);vec3 v2=v1+dir1*sign(d1);vec3 d2=X-v2;vec3 X2=X+144.5;vec3 v3=round(X2);vec3 d3=X2-v3;vec3 score2=abs(d3);vec3 dir2=step(max(score2.yzx,score2.zxy),score2);vec3 v4=v3+dir2*sign(d3);vec3 d4=X2-v4;vec3 v1m=floor(mod(v1,period)+.5);vec3 v2m=floor(mod(v2,period)+.5);vec3 v3m=floor(mod(v3,period)+.5);vec3 v4m=floor(mod(v4,period)+.5);vec4 hashes=os_permute(mod(vec4(v1m.x,v2m.x,v3m.x,v4m.x),289.)+seed);hashes=os_permute(mod(hashes+vec4(v1m.y,v2m.y,v3m.y,v4m.y),289.)+seed);hashes=mod(os_permute(mod(hashes+vec4(v1m.z,v2m.z,v3m.z,v4m.z),289.)+seed),48.);vec4 a=max(.5-vec4(dot(d1,d1),dot(d2,d2),dot(d3,d3),dot(d4,d4)),.0);vec4 aa=a*a;vec4 aaaa=aa*aa;vec3 g1=os2_grad(hashes.x);vec3 g2=os2_grad(hashes.y);vec3 g3=os2_grad(hashes.z);vec3 g4=os2_grad(hashes.w);vec4 ext=vec4(dot(d1,g1),dot(d2,g2),dot(d3,g3),dot(d4,g4));return vec4(.0,.0,.0,dot(aaaa,ext));}vec4 os2s_part_tileable(vec3 X,float seed,vec3 period){vec3 b=floor(X);vec4 i4=vec4(X-b,2.5);vec3 v1=b+floor(dot(i4,vec4(.25)));vec3 v2=b+vec3(1,0,0)+vec3(-1,1,1)*floor(dot(i4,vec4(-.25,.25,.25,.35)));vec3 v3=b+vec3(0,1,0)+vec3(1,-1,1)*floor(dot(i4,vec4(.25,-.25,.25,.35)));vec3 v4=b+vec3(0,0,1)+vec3(1,1,-1)*floor(dot(i4,vec4(.25,.25,-.25,.35)));vec3 v1m=floor(mod(v1,period)+.5);vec3 v2m=floor(mod(v2,period)+.5);vec3 v3m=floor(mod(v3,period)+.5);vec3 v4m=floor(mod(v4,period)+.5);vec4 hashes=os_permute(mod(vec4(v1m.x,v2m.x,v3m.x,v4m.x),289.)+seed);hashes=os_permute(mod(hashes+vec4(v1m.y,v2m.y,v3m.y,v4m.y),289.)+seed);hashes=mod(os_permute(mod(hashes+vec4(v1m.z,v2m.z,v3m.z,v4m.z),289.)+seed),48.);vec3 d1=X-v1;vec3 d2=X-v2;vec3 d3=X-v3;vec3 d4=X-v4;vec4 a=max(.75-vec4(dot(d1,d1),dot(d2,d2),dot(d3,d3),dot(d4,d4)),.0);vec4 aa=a*a;vec4 aaaa=aa*aa;vec3 g1=os2s_grad(hashes.x);vec3 g2=os2s_grad(hashes.y);vec3 g3=os2s_grad(hashes.z);vec3 g4=os2s_grad(hashes.w);vec4 ext=vec4(dot(d1,g1),dot(d2,g2),dot(d3,g3),dot(d4,g4));return vec4(.0,.0,.0,dot(aaaa,ext));}float os2_tileable(vec3 X,float seed,vec3 period){return os2_base_tileable(X,seed,period).w;}float os2s_tileable(vec3 X,float seed,vec3 period){return(os2s_part_tileable(X,seed,period)+os2s_part_tileable(X+144.5,seed+42.123,period)).w;}",code:`float ${e}=${"os2"===i?"os2_tileable":"os2s_tileable"}((${n("pos","vec3","pos")} + ${n("offset","vec3","vec3(0.0)")}) * ${a},${n("seed","float","0.0")},vec3(${a}));\n`,outputType:"float"}}});const al="\nfloat value_noise_3d(vec3 pos, float scale, float seed) {\n    vec3 p = pos * scale;\n    vec3 i = floor(p);\n    vec3 f = fract(p);\n    vec3 u = quintic3(f);\n    vec3 period = vec3(scale);\n    \n    float n = mix(\n        mix(\n            mix(hash33(mod(i + vec3(0,0,0), period) + seed).x, hash33(mod(i + vec3(1,0,0), period) + seed).x, u.x),\n            mix(hash33(mod(i + vec3(0,1,0), period) + seed).x, hash33(mod(i + vec3(1,1,0), period) + seed).x, u.x),\n            u.y\n        ),\n        mix(\n            mix(hash33(mod(i + vec3(0,0,1), period) + seed).x, hash33(mod(i + vec3(1,0,1), period) + seed).x, u.x),\n            mix(hash33(mod(i + vec3(0,1,1), period) + seed).x, hash33(mod(i + vec3(1,1,1), period) + seed).x, u.x),\n            u.y\n        ),\n        u.z\n    );\n    return n;\n}\n",ol="\n// Returns vec4(F1, F2, cell_color_hash.r, cell_color_hash.g)\nvec4 cellular_noise_3d(vec3 pos, float scale, float jitter, float seed) {\n    vec3 p = pos * scale;\n    vec3 id = floor(p);\n    vec3 f = fract(p);\n    vec3 period = vec3(scale);\n    \n    float F1 = 1e10;\n    float F2 = 1e10;\n    vec3 closest_cell_id = vec3(0.0);\n\n    for (int z = -1; z <= 1; z++) {\n        for (int y = -1; y <= 1; y++) {\n            for (int x = -1; x <= 1; x++) {\n                vec3 neighbor = vec3(float(x), float(y), float(z));\n                vec3 cell_id = id + neighbor;\n                vec3 wrapped_cell_id = mod(cell_id, period);\n                \n                vec3 point_pos_in_cell = hash33(wrapped_cell_id + seed);\n                point_pos_in_cell = 0.5 + 0.5 * point_pos_in_cell;\n\n                vec3 point_pos = neighbor + point_pos_in_cell * jitter;\n                float d = distance(f, point_pos);\n\n                if (d < F1) {\n                    F2 = F1;\n                    F1 = d;\n                    closest_cell_id = wrapped_cell_id;\n                } else if (d < F2) {\n                    F2 = d;\n                }\n            }\n        }\n    }\n    vec3 cell_color = hash33(closest_cell_id + seed + 0.111);\n    return vec4(F1, F2, cell_color.xy);\n}\n",sl=ol+"\n// --- Cracks 3D ---\nfloat cracks_3d(vec3 pos, float scale, float jitter, float width, float smoothness, float warp, float warpScale, float seed)\n{\n    float int_warp_scale = floor(warpScale);\n    vec3 warped_pos = pos + gradientNoise(pos * int_warp_scale, int_warp_scale, seed * 1.73) * warp;\n    \n    vec4 cellular = cellular_noise_3d(warped_pos, floor(scale), jitter, seed);\n    float edge_dist = cellular.y - cellular.x;\n    \n    return (1.0 - smoothstep(width - smoothness, width, edge_dist)) * 2.0 - 1.0;\n}\n",ll=al+"\n// --- Random Lines 3D ---\nfloat random_lines_3d(vec3 pos, float scale, float count, float width, float jitter, float smoothness, float seed) {\n    float strength = jitter * 1.25;\n    float int_scale = floor(scale);\n    \n    // Create 3 sets of noise-displaced planes\n    float v_x = count * (strength * value_noise_3d(pos.yzx, int_scale, seed + 10.0) + pos.x);\n    float v_y = count * (strength * value_noise_3d(pos.xzy, int_scale, seed + 20.0) + pos.y);\n    float v_z = count * (strength * value_noise_3d(pos,       int_scale, seed + 30.0) + pos.z);\n\n    // Get fractional parts for each plane set\n    float w_x = fract(v_x);\n    float w_y = fract(v_y);\n    float w_z = fract(v_z);\n    \n    // Create ridges from fractional parts\n    float line_x = 1.0 - smoothstep(width, width + smoothness, abs(w_x - 0.5) * 2.0);\n    float line_y = 1.0 - smoothstep(width, width + smoothness, abs(w_y - 0.5) * 2.0);\n    float line_z = 1.0 - smoothstep(width, width + smoothness, abs(w_z - 0.5) * 2.0);\n    \n    return max(line_x, max(line_y, line_z)) * 2.0 - 1.0;\n}\n";il({type:"ValueNoise",label:"Value Noise",color:"blue",category:"Generators",description:"A simple, blocky noise. Faster than gradient noise but less smooth. Good for a crystalline or digital look.",params:()=>[{id:"scale",label:"Scale",type:"slider",value:8,min:.1,max:50,step:.1},{id:"seed",label:"Seed",type:"slider",value:0,min:0,max:100,step:.1}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>({preamble:al,code:`float ${e}=value_noise_3d(${n("pos","vec3","pos")}+${n("offset","vec3","vec3(.0)")},floor(${n("scale","float","8.")}),${n("seed","float",".0")});\n`,outputType:"float"})}),il({type:"ClassicPerlin",label:"Classic Perlin",color:"blue",category:"Generators",description:"The original gradient noise algorithm. A foundational building block for procedural textures, though modern variants like Simplex are often preferred.",params:()=>[{id:"scale",label:"Scale",type:"slider",value:8,min:.1,max:50,step:.1},{id:"seed",label:"Seed",type:"slider",value:0,min:0,max:100,step:.1}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>({code:`float int_scale_${e}=floor(${n("scale","float","8.0")});\n float ${e}=gradientNoise((${n("pos","vec3","pos")}+${n("offset","vec3","vec3(0.0)")})*int_scale_${e},int_scale_${e},${n("seed","float","0.0")});\n`,outputType:"float"})}),il({type:"Cellular",label:"Cellular",color:"orange",category:"Generators",description:"Generates patterns based on the distance to the nearest feature points. F1 creates circular cells, while F2-F1 highlights the edges between them.",params:()=>[{id:"scale",label:"Scale",type:"slider",value:8,min:.1,max:50,step:.1},{id:"jitter",label:"Jitter",type:"slider",value:1,min:0,max:1,step:.01},{id:"output",label:"Output",type:"select",value:"f1",options:[{value:"f1",label:"F1 (Closest)"},{value:"f2",label:"F2 (2nd Closest)"},{value:"f2_f1",label:"F2 - F1 (Edges)"}]},{id:"seed",label:"Seed",type:"slider",value:0,min:0,max:100,step:.1}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>{const r=t.params.find(e=>"output"===e.id).value;let i="result.x";return"f2"===r&&(i="result.y"),"f2_f1"===r&&(i="result.y - result.x"),{preamble:ol,code:`vec4 result=cellular_noise_3d(${n("pos","vec3","pos")}+${n("offset","vec3","vec3(.0)")},floor(${n("scale","float","8.")}),${n("jitter","float","1.")},${n("seed","float",".0")});\n float ${e}=(1.-(${i}))*2.-1.;\n`,outputType:"float"}}}),il({type:"VoronoiCells",label:"Voronoi Cells",color:"orange",category:"Generators",description:"Outputs a unique random color for each cell in a Voronoi/cellular pattern. Combine with Cellular F1/F2-F1 for detailed effects.",params:()=>[{id:"scale",label:"Scale",type:"slider",value:8,min:.1,max:50,step:.1},{id:"jitter",label:"Jitter",type:"slider",value:1,min:0,max:1,step:.01},{id:"seed",label:"Seed",type:"slider",value:0,min:0,max:100,step:.1}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Cell Color",type:"vec3"}],glsl:(e,t,n)=>({preamble:ol,code:`vec4 result_${e}=cellular_noise_3d(${n("pos","vec3","pos")}+${n("offset","vec3","vec3(.0)")},floor(${n("scale","float","8.")}),${n("jitter","float","1.")},${n("seed","float",".0")});\n vec3 ${e}=hash33(vec3(result_${e}.z,result_${e}.w,.456));\n`,outputType:"vec3"})}),il({type:"Organic",label:"Organic",color:"blue",category:"Generators",description:'Creates flowing, organic noise with a "billowy" feel, reminiscent of smoke or liquid. Adjust Density and Contrast to shape the effect.',params:()=>[{id:"scale",label:"Scale",type:"slider",value:8,min:.1,max:50,step:.1},{id:"density",label:"Density",type:"slider",value:1,min:0,max:1,step:.01},{id:"contrast",label:"Contrast",type:"slider",value:0,min:0,max:1,step:.01},{id:"highlights",label:"Highlights",type:"slider",value:.25,min:0,max:1,step:.01},{id:"shift",label:"Shift",type:"slider",value:.5,min:0,max:1,step:.01},{id:"seed",label:"Seed",type:"slider",value:0,min:0,max:100,step:.1}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>{const r=n("pos","vec3","pos"),i=n("offset","vec3","vec3(0.0)"),a=n("scale","float","8.0"),o=n("density","float","1.0"),s=n("contrast","float","0.0"),l=n("highlights","float","0.25"),c=n("shift","float","0.5"),u=n("seed","float","0.0");let d=`vec3 p_${e}=${r}+${i};\n`;return d+=`float scale_a_${e}=${a};\n`,d+=`float scale_b_${e}=mix(1.,scale_a_${e}-1.,${o});\n`,d+=`float int_scale_a_${e}=floor(scale_a_${e});\n`,d+=`float int_scale_b_${e}=floor(scale_b_${e});\n`,d+=`float nx_${e}=gradientNoise(p_${e}*int_scale_a_${e},int_scale_a_${e},${u});\n`,d+=`float ny_${e}=gradientNoise(p_${e}*int_scale_b_${e},int_scale_b_${e},${u}+11.3);\n`,d+=`float n_${e}=length(vec2(nx_${e},ny_${e})*mix(vec2(2.,.0),vec2(.0,2.),${c}));\n`,d+=`n_${e} = pow(n_${e}, 1.0 + 8.0 * ${s}) + (0.15 * ${l}) / max(0.001, n_${e});\n`,d+=`float ${e}=n_${e}*.5-1.;\n`,{code:d,outputType:"float"}}}),il({type:"Dots",label:"Dots",color:"orange",category:"Generators",description:'Fills space with spheres of varying sizes. Control the number of spheres with "Density" and their size with "Size" and "Size Variation".',params:()=>[{id:"scale",label:"Scale",type:"slider",value:8,min:.1,max:50,step:.1},{id:"density",label:"Density",type:"slider",value:.5,min:0,max:1,step:.01},{id:"size",label:"Size",type:"slider",value:.25,min:.01,max:1,step:.01},{id:"radiusVariation",label:"Size Variation",type:"slider",value:.7,min:0,max:1,step:.01},{id:"seed",label:"Seed",type:"slider",value:0,min:0,max:100,step:.1}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>({preamble:"\nfloat dots_noise_3d(vec3 pos, float scale, float density, float size, float radiusVariation, float seed) {\n    vec3 p = pos * scale;\n    vec3 id = floor(p);\n    vec3 f = fract(p);\n    vec3 period = vec3(scale);\n\n    float value = -1.0;\n\n    for (int z = -1; z <= 1; z++) {\n        for (int y = -1; y <= 1; y++) {\n            for (int x = -1; x <= 1; x++) {\n                vec3 neighbor = vec3(float(x), float(y), float(z));\n                vec3 cell_id = id + neighbor;\n                vec3 wrapped_cell_id = mod(cell_id, period);\n\n                vec3 h = hash33(wrapped_cell_id + seed);\n                float h_density = (h.z + 1.0) * 0.5;\n                if (h_density > density) continue;\n\n                vec3 point_offset_in_cell = h * 0.5 + 0.5;\n                vec3 point_pos = neighbor + point_offset_in_cell;\n                \n                float current_radius = size + (hash33(wrapped_cell_id + seed + 0.1).x * 0.5 + 0.5) * radiusVariation;\n\n                float d = distance(f, point_pos);\n                float sphere_sdf = d - current_radius;\n                \n                float falloff = 0.1;\n                value = max(value, (1.0 - smoothstep(-falloff, falloff, sphere_sdf)) * 2.0 - 1.0);\n            }\n        }\n    }\n    return value;\n}\n",code:`float ${e}=dots_noise_3d(${n("pos","vec3","pos")}+${n("offset","vec3","vec3(.0)")},floor(${n("scale","float","8.")}),${n("density","float",".5")},${n("size","float",".25")},${n("radiusVariation","float",".7")},${n("seed","float",".0")});\n`,outputType:"float"})}),il({type:"Metaballs",label:"Metaballs",color:"orange",category:"Generators",description:'Generates smooth, blobby shapes that merge into each other. Use "Threshold" to control how much the spheres blend together.',params:()=>[{id:"scale",label:"Scale",type:"slider",value:4,min:.1,max:20,step:.1},{id:"jitter",label:"Jitter",type:"slider",value:1,min:0,max:1,step:.01},{id:"radius",label:"Radius",type:"slider",value:1,min:.1,max:2,step:.01},{id:"threshold",label:"Threshold",type:"slider",value:.3,min:.01,max:2,step:.01},{id:"seed",label:"Seed",type:"slider",value:0,min:0,max:100,step:.1}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>({preamble:"\nfloat metaballs_3d(vec3 pos, float scale, float jitter, float radius, float threshold, float seed) {\n    vec3 p = pos * scale;\n    vec3 id = floor(p);\n    vec3 f = fract(p);\n    vec3 period = vec3(scale);\n    \n    float sum = 0.0;\n    float radius2 = radius * radius;\n\n    for (int z = -1; z <= 1; z++) {\n        for (int y = -1; y <= 1; y++) {\n            for (int x = -1; x <= 1; x++) {\n                vec3 neighbor = vec3(float(x), float(y), float(z));\n                vec3 cell_id = id + neighbor;\n                vec3 wrapped_cell_id = mod(cell_id, period);\n                \n                vec3 point_pos_in_cell = 0.5 + 0.5 * hash33(wrapped_cell_id + seed);\n                vec3 point_pos = neighbor + point_pos_in_cell * jitter;\n                \n                float d2 = dot(f - point_pos, f - point_pos);\n\n                if (d2 < radius2) {\n                   float t2 = d2 / radius2;\n                   float falloff = (1.0 - t2) * (1.0 - t2); // (1 - d^2/r^2)^2\n                   sum += falloff;\n                }\n            }\n        }\n    }\n    \n    return clamp(sum / threshold, 0.0, 1.0) * 2.0 - 1.0;\n}\n",code:`float ${e}=metaballs_3d(${n("pos","vec3","pos")}+${n("offset","vec3","vec3(.0)")},floor(${n("scale","float","4.")}),${n("jitter","float","1.")},${n("radius","float","1.")},${n("threshold","float",".3")},${n("seed","float",".0")});\n`,outputType:"float"})}),il({type:"Checkers",label:"Checkers",color:"blue",category:"Generators",description:'Creates a 3D checkerboard pattern. "Sharpness" controls the softness of the transition between cubes.',params:()=>[{id:"scale",label:"Scale",type:"slider",value:8,min:.1,max:50,step:.1},{id:"sharpness",label:"Sharpness",type:"slider",value:10,min:.1,max:50,step:.1}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>({preamble:"\nfloat checkers_3d(vec3 pos, float scale, float sharpness) {\n    vec3 p = pos * scale;\n    vec3 p_tanh = tanh(sharpness * sin(p * 3.14159265));\n    return p_tanh.x * p_tanh.y * p_tanh.z;\n}\n",code:`float ${e}=checkers_3d(${n("pos","vec3","pos")}+${n("offset","vec3","vec3(.0)")},floor(${n("scale","float","8.")}),${n("sharpness","float","10.")});\n`,outputType:"float"})}),il({type:"Weave",label:"Weave",color:"blue",category:"Generators",description:"Generates a 3D woven pattern. The pattern is projected onto the XY, XZ, or YZ plane depending on the coordinates.",params:()=>[{id:"scale",label:"Scale",type:"slider",value:4,min:.1,max:20,step:.1},{id:"count",label:"Count",type:"slider",value:3,min:1,max:10,step:1},{id:"width",label:"Width",type:"slider",value:.75,min:.01,max:2,step:.01},{id:"smoothness",label:"Smoothness",type:"slider",value:.5,min:0,max:1,step:.01}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>({preamble:"\n// --- Weave 3D ---\nfloat sdfLens_weave(vec2 p, float width)\n{\n    float d = 1.0 / width - width / 4.0;\n    float r = width / 2.0 + d;\n    p = abs(p);\n    float b = sqrt(r * r - d * d);\n    vec4 par = p.xyxy - vec4(0.0, b, -d, 0.0);\n    return (par.y * d > p.x * b) ? length(par.xy) : length(par.zw) - r;\n}\n\nfloat weave_2d_internal(vec2 pos, float scale, float count, float width, float smoothness)\n{\n    vec2 i = floor(pos * scale);    \n    float c = mod(i.x + i.y, 2.0);\n    vec2 p = fract(pos.st * scale);\n    p = mix(p.st, p.ts, c);\n    p = fract(p * vec2(count, 1.0));\n    width *= 2.0;\n    p = p * 2.0 - 1.0;\n    float d = sdfLens_weave(p, width);\n    return (1.0 - smoothstep(0.0, smoothness, -d)) * 2.0 - 1.0; \n}\n\nfloat weave_3d(vec3 pos, float scale, float count, float width, float smoothness)\n{\n    float int_scale = floor(scale);\n    vec3 i = floor(pos * int_scale);\n    float selector = mod(i.x + i.y + i.z, 3.0);\n    \n    vec2 uv;\n    if (selector < 1.0) {\n        uv = pos.xy;\n    } else if (selector < 2.0) {\n        uv = pos.xz;\n    } else {\n        uv = pos.yz;\n    }\n    \n    return weave_2d_internal(uv, int_scale, count, width, smoothness);\n}\n",code:`float ${e}=weave_3d(${n("pos","vec3","pos")}+${n("offset","vec3","vec3(.0)")},${n("scale","float","4.")},${n("count","float","3.")},${n("width","float",".75")},${n("smoothness","float",".5")});\n`,outputType:"float"})}),il({type:"Cracks",label:"Cracks",color:"orange",category:"Generators",description:'Simulates cracks or veins by warping a cellular noise pattern. "Width" and "Warp" are key parameters for controlling the look.',params:()=>[{id:"scale",label:"Scale",type:"slider",value:8,min:.1,max:50,step:.1},{id:"jitter",label:"Jitter",type:"slider",value:.5,min:0,max:1,step:.01},{id:"width",label:"Width",type:"slider",value:.1,min:.01,max:1,step:.01},{id:"smoothness",label:"Smoothness",type:"slider",value:.5,min:0,max:1,step:.01},{id:"warp",label:"Warp",type:"slider",value:.1,min:0,max:1,step:.01},{id:"warpScale",label:"Warp Scale",type:"slider",value:4,min:.1,max:20,step:.1},{id:"seed",label:"Seed",type:"slider",value:23,min:0,max:100,step:.1}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>({preamble:sl,code:`float ${e}=cracks_3d(${n("pos","vec3","pos")}+${n("offset","vec3","vec3(.0)")},${n("scale","float","8.")},${n("jitter","float",".5")},${n("width","float",".1")},${n("smoothness","float",".5")},${n("warp","float",".1")},${n("warpScale","float","4.")},${n("seed","float","23.")});\n`,outputType:"float"})}),il({type:"RandomLines",label:"Random Lines",color:"blue",category:"Generators",description:'Creates a network of intersecting lines with random orientations. "Count" controls line density, and "Jitter" adds irregularity.',params:()=>[{id:"scale",label:"Scale",type:"slider",value:8,min:.1,max:50,step:.1},{id:"count",label:"Count",type:"slider",value:14,min:1,max:50,step:1},{id:"width",label:"Width",type:"slider",value:.1,min:.01,max:1,step:.01},{id:"jitter",label:"Jitter",type:"slider",value:.2,min:0,max:1,step:.01},{id:"smoothness",label:"Smoothness",type:"slider",value:.1,min:0,max:1,step:.01},{id:"seed",label:"Seed",type:"slider",value:13,min:0,max:100,step:.1}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>({preamble:ll,code:`float ${e}=random_lines_3d(${n("pos","vec3","pos")}+${n("offset","vec3","vec3(.0)")},${n("scale","float","8.")},${n("count","float","14.")},${n("width","float",".1")},${n("jitter","float",".2")},${n("smoothness","float",".1")},${n("seed","float","13.")});\n`,outputType:"float"})}),il({type:"FlowPattern",label:"Flow Pattern",color:"orange",category:"Generators",description:"Creates a directional, flowing pattern by using Perlin noise to warp the coordinate space before drawing a pattern. Excellent for effects like flowing hair, fabric, or energy fields.",params:()=>[{id:"pattern",label:"Pattern",type:"select",value:"lines",options:[{value:"lines",label:"Lines"},{value:"rings",label:"Rings"},{value:"checkers",label:"Checkers"}]},{id:"tileable",label:"Tileable",type:"checkbox",value:!0},{id:"scale",label:"Field Scale",type:"slider",value:2,min:.1,max:20,step:.1},{id:"angle",label:"Angle",type:"slider",value:45,min:0,max:360,step:1},{id:"strength",label:"Strength",type:"slider",value:1,min:0,max:5,step:.1},{id:"iterations",label:"Iterations",type:"slider",value:3,min:1,max:8,step:1},{id:"frequency",label:"Frequency",type:"slider",value:30,min:1,max:100,step:1},{id:"seed",label:"Seed",type:"slider",value:0,min:0,max:100,step:.1}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>{const r=t.params.find(e=>"pattern"===e.id),i={lines:0,rings:1,checkers:2}[r?r.value:"lines"]??0,a=t.params.find(e=>"tileable"===e.id),o=!a||a.value,s=n("scale","float","2.0"),l=n("angle","float","45.0"),c=n("strength","float","1.0"),u=`int(floor(${n("iterations","float","3.")}))`,d=n("frequency","float","30.0"),h=n("seed","float","0.0");return{preamble:"\nfloat flow_pattern_generator(vec3 pos,int patternType,float scale,bool tileable,float angle,float strength,int iterations,float frequency,float seed){vec3 p=pos;float final_scale=scale;float angle_rad=angle*.0174533;mat2 rotation=mat2(cos(angle_rad),-sin(angle_rad),sin(angle_rad),cos(angle_rad));if(tileable){p=pos+.5;final_scale=max(1.,floor(scale));}for(int i=0;i<iterations;i++){float noise_val;if(tileable){noise_val=gradientNoise(p*final_scale,final_scale,seed+float(i));}else{noise_val=gradientNoise_nonTileable(p*final_scale,seed+float(i));}float flow_angle=noise_val*3.14159265;vec2 flow_vector=vec2(cos(flow_angle),sin(flow_angle));flow_vector=rotation*flow_vector;p.xy+=flow_vector*strength*.05;}if(patternType==0){return sin(p.y*frequency*6.28318530718);}else if(patternType==1){vec3 p_rings=p;if(tileable){p_rings=fract(p)-.5;}return sin(length(p_rings)*frequency);}else if(patternType==2){vec3 p_tanh_checkers=tanh(15.*sin((p)*frequency*.5*3.14159265));return p_tanh_checkers.x*p_tanh_checkers.y*p_tanh_checkers.z;}return .0;}",code:`float ${e}=flow_pattern_generator(${n("pos","vec3","pos")}+${n("offset","vec3","vec3(0.0)")},${i},${s},${o},${l},${c},${u},${d},${h});\n`,outputType:"float"}}}),il({type:"Constant",label:"Constant (Float)",color:"green",category:"Inputs",description:"Outputs a single, constant floating-point value in the [0, 1] range, where 0 represents black and 1 represents white.",params:()=>[{id:"value",label:"Value",type:"slider",value:.5,min:0,max:1,step:.01}],inputs:()=>[],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>({code:`float ${e} = ${n("value","float","0.5")};\n`,outputType:"float"})}),il({type:"ConstantColor",label:"Constant Color",color:"green",category:"Inputs",description:"Outputs a constant vec3 color value. Useful for providing base colors or other vector inputs.",params:()=>[{id:"value",label:"Color",type:"color",value:"#ffffff"}],inputs:()=>[],outputs:()=>[{id:"out",label:"Color",type:"vec3"}],glsl:(e,t,n)=>({code:`vec3 ${e} = ${n("value","vec3","vec3(1.0)")};\n`,outputType:"vec3"})}),il({type:"Time",label:"Time",color:"green",category:"Inputs",description:"Provides a continuously increasing value based on the application's clock. Use its output to animate other nodes by connecting it to parameters like 'Offset'.",params:()=>[{id:"speed",label:"Speed",type:"slider",value:.1,min:0,max:2,step:.01}],inputs:()=>[],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>({code:`float ${e} = u_time * ${n("speed","float","0.1")};\n`,outputType:"float"})}),il({type:"Absolute",label:"Absolute",color:"purple",category:"Modifiers",description:"Returns the absolute value of the input, effectively mirroring negative values into the positive range. Remaps the result from [0, 1] back to [-1, 1].",params:()=>[],inputs:()=>[{id:"in",label:"Input"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>({code:`float ${e} = abs(${n("in","float","0.0")}) * 2.0 - 1.0;\n`,outputType:"float"})}),il({type:"Clamp",label:"Clamp",color:"purple",category:"Modifiers",description:"Constrains the input value to a specified range by clamping it to a minimum and maximum value.",params:()=>[{id:"min",label:"Min",type:"slider",value:-1,min:-1,max:1,step:.01},{id:"max",label:"Max",type:"slider",value:1,min:-1,max:1,step:.01}],inputs:()=>[{id:"in",label:"Input"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>({code:`float ${e} = clamp(${n("in","float","0.0")}, ${n("min","float","-1.0")}, ${n("max","float","1.0")});\n`,outputType:"float"})}),il({type:"Curve",label:"Curve",color:"purple",category:"Modifiers",description:'Applies a power curve to the input, allowing for non-linear remapping. "Power" values less than 1 brighten the mid-tones, while values greater than 1 darken them.',params:()=>[{id:"power",label:"Power",type:"slider",value:2,min:.1,max:10,step:.1}],inputs:()=>[{id:"in",label:"Input"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>({code:`float ${e} = pow(${n("in","float","0.0")}, ${n("power","float","2.0")});\n`,outputType:"float"})}),il({type:"GradientMap",label:"Gradient Map",color:"purple",category:"Modifiers",description:"Remaps an input value from [Input Min, Input Max] to a color gradient. In Luminance mode, the input color is first converted to a [0, 1] luminance value.",params:()=>[{id:"mode",label:"Input Mode",type:"select",value:"value",options:[{value:"value",label:"Value (Float)"},{value:"luminance",label:"Luminance (Vec3)"}]},{id:"inMin",label:"Input Min",type:"slider",value:-1,min:-2,max:2,step:.01},{id:"inMax",label:"Input Max",type:"slider",value:1,min:-2,max:2,step:.01},{id:"gradient",label:"Gradient",type:"gradient",value:JSON.stringify([{pos:0,color:"#ff0000"},{pos:.5,color:"#ff00ff"},{pos:1,color:"#0000ff"}])}],inputs:()=>[{id:"in",label:"Input"}],outputs:()=>[{id:"out",label:"Color",type:"vec3"}],glsl:(e,t,n)=>{var r,i;const a=(null==(r=t.params.find(e=>"mode"===e.id))?void 0:r.value)||"value",o=(null==(i=t.params.find(e=>"gradient"===e.id))?void 0:i.value)||"[]";let s;try{s=JSON.parse(o),Array.isArray(s)&&0!==s.length||(s=[{pos:0,color:"#000000"},{pos:1,color:"#ffffff"}]),s.sort((e,t)=>e.pos-t.pos)}catch(f){s=[{pos:0,color:"#000000"},{pos:1,color:"#ffffff"}]}const l=n("inMin","float","0.0"),c=n("inMax","float","1.0");let u;u="luminance"===a?`dot((${n("in","vec3","vec3(0.0)")}+1.)*.5,vec3(.2126,.7152,.0722))`:n("in","float","0.0");const d=`remap(${u}, ${l}, ${c}, 0.0, 1.0)`,h=((e,t)=>{if(0===t.length)return`vec3 gradient_lookup_${e}(float t){return vec3(.0);}\n`;const n=e=>{const t=parseInt(e.substring(1,3),16)/255,n=parseInt(e.substring(3,5),16)/255,r=parseInt(e.substring(5,7),16)/255;return`vec3(${t.toFixed(4)},${n.toFixed(4)},${r.toFixed(4)})`};if(1===t.length)return`vec3 gradient_lookup_${e}(float t){return ${n(t[0].color)};}\n`;let r=`vec3 gradient_lookup_${e}(float t){\n`;r+="t=clamp(t,.0,1.);\n",r+=`if(t<=${t[0].pos.toFixed(4)})return ${n(t[0].color)};\n`;for(let i=0;i<t.length-1;i++){const e=t[i],a=t[i+1];r+=`if(t<=${a.pos.toFixed(4)}){\n`;const o=a.pos-e.pos;o>1e-5?(r+=`float inter=(t-${e.pos.toFixed(4)})/${o.toFixed(4)};\n`,r+=`return mix(${n(e.color)},${n(a.color)},inter);\n`):r+=`return ${n(e.color)};\n`,r+="  }\n"}return r+=`return ${n(t[t.length-1].color)};\n`,r+="}\n",r})(e,s);return{preamble:h,code:`vec3 ${e}=gradient_lookup_${e}(${d});\n`,outputType:"vec3"}}}),il({type:"Quantize",label:"Quantize",color:"purple",category:"Modifiers",description:'Reduces the number of continuous values in the input signal to a fixed number of "Steps". Creates a stepped or terraced appearance.',params:()=>[{id:"steps",label:"Steps",type:"slider",value:8,min:2,max:32,step:1}],inputs:()=>[{id:"in",label:"Input"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>{const r=n("in","float","0.0"),i=n("steps","float","8.0");let a=`float remapped_q_${e} = (${r} + 1.0) * 0.5;\n`;return a+=`  float quantized_${e} = floor(remapped_q_${e} * ${i}) / max(1.0, ${i} - 1.0);\n`,a+=`  float ${e} = quantized_${e} * 2.0 - 1.0;\n`,{code:a,outputType:"float"}}}),il({type:"Remap",label:"Remap",color:"purple",category:"Modifiers",description:"Linearly re-maps a value or color from an input range to a new output range. Handles float and vec3 inputs automatically.",params:()=>[{id:"inMin",label:"Input Min",type:"slider",value:0,min:-1,max:1,step:.01},{id:"inMax",label:"Input Max",type:"slider",value:1,min:-1,max:1,step:.01},{id:"outMin",label:"Output Min",type:"slider",value:0,min:-1,max:1,step:.01},{id:"outMax",label:"Output Max",type:"slider",value:1,min:-1,max:1,step:.01}],inputs:()=>[{id:"in",label:"Input"}],outputs:()=>[{id:"out",label:"Output",type:"vec3"}],glsl:(e,t,n)=>{const r=n("in","vec3","vec3(0.5)"),i=n("inMin","float","0.0"),a=n("inMax","float","1.0"),o=n("outMin","float","0.0"),s=n("outMax","float","1.0");return{code:`vec3 ${e} = vec3(\n    remap(${r}.r, ${i}, ${a}, ${o}, ${s}),\n    remap(${r}.g, ${i}, ${a}, ${o}, ${s}),\n    remap(${r}.b, ${i}, ${a}, ${o}, ${s})\n  );\n`,outputType:"vec3"}}}),il({type:"Saturate",label:"Saturate",color:"purple",category:"Modifiers",description:'Clamps the input signal to the visible [0, 1] range (black to white), preventing values from becoming "brighter than white" or "darker than black".',params:()=>[],inputs:()=>[{id:"in",label:"Input"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>({code:`float ${e} = clamp(${n("in","float","0.0")}, 0.0, 1.0);\n`,outputType:"float"})}),il({type:"SmoothStep",label:"SmoothStep",color:"purple",category:"Modifiers",description:'Creates a smooth transition between 0 and 1 as the input value moves between "Edge 0" and "Edge 1". Useful for creating soft masks.',params:()=>[{id:"edge0",label:"Edge 0",type:"slider",value:0,min:-1,max:1,step:.01},{id:"edge1",label:"Edge 1",type:"slider",value:1,min:-1,max:1,step:.01}],inputs:()=>[{id:"in",label:"Input"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>{const r=n("in","float","0.0");let i=`float ${e}_ss = smoothstep(${n("edge0","float","0.0")}, ${n("edge1","float","1.0")}, ${r});\n`;return i+=`  float ${e} = ${e}_ss * 2.0 - 1.0;\n`,{code:i,outputType:"float"}}}),il({type:"Trig",label:"Trigonometry",color:"purple",category:"Modifiers",description:'Applies a trigonometric function to the input. Creates wave-like patterns. "Frequency" controls the number of repetitions.',params:()=>[{id:"op",label:"Operation",type:"select",value:"sin",options:[{value:"sin",label:"Sine"},{value:"cos",label:"Cosine"},{value:"tan",label:"Tangent"},{value:"asin",label:"Arcsine"},{value:"acos",label:"Arccosine"},{value:"atan",label:"Arctangent"}]},{id:"frequency",label:"Frequency",type:"slider",value:1,min:0,max:20,step:.1}],inputs:()=>[{id:"in",label:"Input"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>{var r;const i=(null==(r=t.params.find(e=>"op"===e.id))?void 0:r.value)||"sin",a=n("in","float","0.0"),o=n("frequency","float","1.0");let s="";const l="3.14159265359",c="1.57079632679";switch(i){case"sin":s=`float ${e} = sin(${a} * ${l} * ${o});`;break;case"cos":s=`float ${e} = cos(${a} * ${l} * ${o});`;break;case"tan":s=`float ${e} = clamp(tan(${a} * ${l} * ${o}), -1.0, 1.0);`;break;case"asin":s=`float ${e} = asin(clamp(${a}, -1.0, 1.0)) / ${c};`;break;case"acos":s=`float ${e} = (acos(clamp(${a}, -1.0, 1.0)) / ${l}) * 2.0 - 1.0;`;break;case"atan":s=`float ${e} = atan(${a} * ${o}) / ${c};`;break;default:s=`float ${e} = 0.0;`}return{code:s+"\n",outputType:"float"}}}),il({type:"Turbulence",label:"Turbulence",color:"purple",category:"Modifiers",description:"Creates a turbulent effect by applying a power function to the absolute value of the input. Often used to create sharp ridges in noise.",params:()=>[{id:"power",label:"Power",type:"slider",value:1,min:.1,max:8,step:.1}],inputs:()=>[{id:"in",label:"Input"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>({code:`float ${e} = pow(1.0 - abs(${n("in","float","0.0")}), ${n("power","float","1.0")});\n`,outputType:"float"})}),il({type:"Tonemapper",label:"Tonemapper",color:"purple",category:"Modifiers",description:"Applies a tonemapping curve to the input. This is typically the last step before output, used to compress a high dynamic range (HDR) signal into a displayable low dynamic range (LDR) image.",params:e=>{var t,n;const r=[{id:"mapper",label:"Type",type:"select",value:"aces",options:[{value:"aces",label:"ACES"},{value:"agx",label:"AgX"},{value:"filmic",label:"Filmic"},{value:"lottes",label:"Lottes"},{value:"reinhard",label:"Reinhard"},{value:"uncharted2",label:"Uncharted 2"}]},{id:"exposure",label:"Exposure",type:"slider",value:1,min:0,max:10,step:.1}];switch((null==(n=null==(t=e.params)?void 0:t.find(e=>"mapper"===e.id))?void 0:n.value)||"aces"){case"agx":r.push({id:"agxSlope",label:"Slope (Tint)",type:"color",value:"#ffffff"},{id:"agxOffset",label:"Offset",type:"color",value:"#000000"},{id:"agxPower",label:"Power (Contrast)",type:"slider",value:1.35,min:.1,max:2.5,step:.01},{id:"agxSaturation",label:"Saturation",type:"slider",value:1.4,min:0,max:2,step:.01});break;case"filmic":r.push({id:"filmicGamma",label:"Gamma",type:"slider",value:2.2,min:1,max:3,step:.01});break;case"lottes":r.push({id:"lottesA",label:"Contrast",type:"slider",value:1.6,min:.1,max:3,step:.01},{id:"lottesD",label:"Shoulder",type:"slider",value:.977,min:.1,max:2,step:.001},{id:"lottesHdrMax",label:"HDR Max",type:"slider",value:8,min:1,max:16,step:.1});break;case"reinhard":r.push({id:"reinhardWhite",label:"White Point",type:"slider",value:1,min:.1,max:10,step:.1});break;case"uncharted2":r.push({id:"uncharted2White",label:"White Point",type:"slider",value:11.2,min:1,max:20,step:.1})}return r.push({id:"preserveWhite",label:"Preserve White Point",type:"checkbox",value:!0}),r},inputs:()=>[{id:"in",label:"Input"}],outputs:()=>[{id:"out",label:"Output",type:"vec3"}],glsl:(e,t,n)=>{var r,i;const a=(null==(r=t.params.find(e=>"mapper"===e.id))?void 0:r.value)||"aces",o=(null==(i=t.params.find(e=>"preserveWhite"===e.id))?void 0:i.value)??!0,s=n("in","vec3","vec3(0.5)"),l=n("exposure","float","1.0"),c=`max(vec3(.0),${s})`;let u,d;switch(a){case"agx":{const e=n("agxSlope","vec3","vec3(1.0)"),t=n("agxOffset","vec3","vec3(0.0)"),r=n("agxPower","float","1.35"),i=n("agxSaturation","float","1.4");u=`agx(${c}*${l},${e},${t},vec3(${r}),${i})`,d=`agx(vec3(1.)*${l},${e},${t},vec3(${r}),${i})`;break}case"filmic":{const e=n("filmicGamma","float","2.2");u=`filmic(${c} * ${l}, ${e})`,d=`filmic(vec3(1.)*${l},${e})`;break}case"lottes":{const e=n("lottesA","float","1.6"),t=n("lottesD","float","0.977"),r=n("lottesHdrMax","float","8.0");u=`lottes(${c} * ${l}, ${e}, ${t}, ${r})`,d=`lottes(vec3(1.)*${l},${e},${t},${r})`;break}case"reinhard":{const e=n("reinhardWhite","float","1.0");u=`reinhard(${c} * ${l}, ${e})`,d=`reinhard(vec3(1.)*${l},${e})`;break}case"uncharted2":{const e=n("uncharted2White","float","11.2");u=`uncharted2(${c}, ${l}, ${e})`,d=`uncharted2(vec3(1.),${l},${e})`;break}default:u=`aces(${c} * ${l})`,d=`aces(vec3(1.)*${l})`}let h=`vec3 ${e}_tonemapped=${u};\n`;return o?(h+=`vec3 ${e}_white=${d};\n`,h+=`vec3 ${e}=(${e}_white.x>.0001 || ${e}_white.y>.0001 || ${e}_white.z>.0001)?${e}_tonemapped/${e}_white:${e}_tonemapped;\n`):h+=`vec3 ${e}=${e}_tonemapped;\n`,{preamble:"\n#ifndef f\n#define f\nvec3 aces(vec3 x){const float a=2.51;const float b=.03;const float c=2.43;const float d=.59;const float e=.14;return clamp((x*(a*x+b))/(x*(c*x+d)+e),.0,1.);}const mat3 NOISETTE_LINEAR_REC2020_TO_LINEAR_SRGB=mat3(1.6605,-.1246,-.0182,-.5876,1.1329,-.1006,-.0728,-.0083,1.1187);const mat3 NOISETTE_LINEAR_SRGB_TO_LINEAR_REC2020=mat3(.6274,.0691,.0164,.3293,.9195,.0880,.0433,.0113,.8956);const mat3 AgXInsetMatrix=mat3(.856627153315983,.137318972929847,.11189821299995,.0951212405381588,.761241990602591,.0767994186031903,.0482516061458583,.101439036467562,.811302368396859);const mat3 AgXOutsetMatrix=mat3(1.1271005818144368,-.1413297634984383,-.14132976349843826,-.11060664309660323,1.157823702216272,-.11060664309660294,-.016493938717834573,-.016493938717834257,1.2519364065950405);const float AgxMinEv=-12.47393;const float AgxMaxEv=4.026069;vec3 agx(vec3 color,vec3 slope,vec3 offset,vec3 power,float saturation){color=NOISETTE_LINEAR_SRGB_TO_LINEAR_REC2020*color;color=AgXInsetMatrix*color;color=max(color,1e-10);color=clamp(log2(color),AgxMinEv,AgxMaxEv);color=(color-AgxMinEv)/(AgxMaxEv-AgxMinEv);color=clamp(color,.0,1.);vec3 x2=color*color;vec3 x4=x2*x2;color=+15.5*x4*x2-40.14*x4*color+31.96*x4-6.868*x2*color+.4298*x2+.1191*color-.00232;color=pow(color*slope+offset,power);const vec3 lw=vec3(.2126,.7152,.0722);float luma=dot(color,lw);color=luma+saturation*(color-luma);color=AgXOutsetMatrix*color;color=pow(max(vec3(.0),color),vec3(2.2));color=NOISETTE_LINEAR_REC2020_TO_LINEAR_SRGB*color;color=clamp(color,.0,1.);return color;}vec3 filmic(vec3 x,float gamma){vec3 X=max(vec3(.0),x-.004);vec3 result=(X*(6.2*X+.5))/(X*(6.2*X+1.7)+.06);return pow(result,vec3(gamma));}vec3 lottes(vec3 x,float a_in,float d_in,float hdrMax_in){vec3 a=vec3(a_in);vec3 d=vec3(d_in);vec3 hdrMax=vec3(hdrMax_in);const vec3 midIn=vec3(.18);const vec3 midOut=vec3(.267);vec3 b=(-pow(midIn,a)+pow(hdrMax,a)*midOut)/((pow(hdrMax,a*d)-pow(midIn,a*d))*midOut);vec3 c=(pow(hdrMax,a*d)*pow(midIn,a)-pow(hdrMax,a)*pow(midIn,a*d)*midOut)/((pow(hdrMax,a*d)-pow(midIn,a*d))*midOut);return pow(x,a)/(pow(x,a*d)*b+c);}vec3 reinhard(vec3 x,float whitePoint){return x/(whitePoint+x);}vec3 uncharted2Tonemap(vec3 x){float A=.15;float B=.50;float C=.10;float D=.20;float E=.02;float F=.30;return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 uncharted2(vec3 color,float exposure,float whitePoint){vec3 curr=uncharted2Tonemap(exposure*color);vec3 whiteScale=1./uncharted2Tonemap(vec3(whitePoint));return curr*whiteScale;}\n#endif\n",code:h,outputType:"vec3"}}}),il({type:"Warp",label:"Domain Warp",color:"purple",category:"Modifiers",description:"Distorts the input coordinates using another noise pattern. A powerful technique for adding detail and complexity to any generator.",params:()=>[{id:"amount",label:"Warp Amount",type:"slider",value:1,min:0,max:10,step:.1},{id:"scale",label:"Scale",type:"slider",value:5,min:.1,max:20,step:.1},{id:"octaves",label:"Octaves",type:"slider",value:4,min:1,max:8,step:1},{id:"persistence",label:"Persistence",type:"slider",value:.5,min:.1,max:1,step:.05},{id:"lacunarity",label:"Lacunarity",type:"slider",value:2,min:1,max:4,step:.1},{id:"seed",label:"Seed",type:"slider",value:0,min:0,max:100,step:.1}],inputs:()=>[{id:"pos",label:"Position"},{id:"offset",label:"Offset"},{id:"warp",label:"Warp Field"}],outputs:()=>[{id:"out",label:"Value",type:"float"}],glsl:(e,t,n)=>{const r=`warped_pos_${e}`;let i=`vec3 ${r} = ${n("pos","vec3","pos")} + ${n("offset","vec3","vec3(0.0)")} + vec3(${n("warp","float","0.0")} * ${n("amount","float","1.0")});\n`;return i+=`float ${e} = fbm(${r}, ${n("scale","float","5.0")}, int(floor(${n("octaves","float","4.0")})), ${n("persistence","float","0.5")}, ${n("lacunarity","float","2.0")}, ${n("seed","float","0.0")});\n`,{code:i,outputType:"float"}}}),il({type:"Colorizer",label:"Colorizer",color:"purple",category:"Modifiers",description:"A complex colorization node. It blends multiple colors based on layered noise inputs to create rich, organic palettes.",params:()=>[{id:"color1_base",label:"Color 1 (Base)",type:"color",value:"#331966"},{id:"color2_texture",label:"Color 2 (Texture)",type:"color",value:"#4c0c0c"},{id:"color3_highlight",label:"Color 3 (Highlight)",type:"color",value:"#e5e5e5"},{id:"color4_modulate",label:"Color 4 (Modulation)",type:"color",value:"#664d4d"},{id:"color5_edge",label:"Color 5 (Edge)",type:"color",value:"#003366"},{id:"edgeThreshold",label:"Edge Threshold",type:"slider",value:.8,min:0,max:2,step:.01},{id:"edgeWidth",label:"Edge Width",type:"slider",value:.4,min:.01,max:1,step:.01}],inputs:()=>[{id:"in_base",label:"Input (f)"},{id:"in_detail_x",label:"Detail (n.x)"},{id:"in_detail_y",label:"Detail (n.y)"},{id:"in_modulate_y",label:"Modulation (o.y)"}],outputs:()=>[{id:"out",label:"Color",type:"vec3"}],glsl:(e,t,n)=>({preamble:"\nvec3 colorize_final(float in_base,float in_detail_x,float in_detail_y,float in_modulate_y,vec3 color1,vec3 color2,vec3 color3,vec3 color4,vec3 color5,float edgeThreshold,float edgeWidth){float f=(in_base+1.)*.5;vec2 n=(vec2(in_detail_x,in_detail_y)+1.)*.5;float o_y=(in_modulate_y+1.)*.5;vec3 col=color1;col=mix(col,color2,f);col=mix(col,color3,dot(n,n));col=mix(col,color4,.2+.5*o_y*o_y);col=mix(col,color5,.5*smoothstep(edgeThreshold,edgeThreshold+edgeWidth,n.x+n.y));col=clamp(col*f*2.,.0,1.);col=1.-col;col=col*col*1.1;return clamp(col,.0,1.);}",code:`vec3 ${e}=colorize_final(${n("in_base","float","0.0")},${n("in_detail_x","float","0.0")},${n("in_detail_y","float","0.0")},${n("in_modulate_y","float","0.0")},${n("color1_base","vec3","vec3(0.2,0.1,0.4)")},${n("color2_texture","vec3","vec3(0.3,0.05,0.05)")},${n("color3_highlight","vec3","vec3(0.9,0.9,0.9)")},${n("color4_modulate","vec3","vec3(0.4,0.3,0.3)")},${n("color5_edge","vec3","vec3(0.0,0.2,0.4)")},${n("edgeThreshold","float","0.8")},${n("edgeWidth","float","0.4")});\n`,outputType:"vec3"})});il({type:"BrightnessContrast",label:"Brightness/Contrast",color:"purple",category:"Modifiers",description:"Adjusts the brightness and contrast of an input color. Operates on colors in the [0, 1] range.",params:()=>[{id:"brightness",label:"Brightness",type:"slider",value:0,min:-1,max:1,step:.01},{id:"contrast",label:"Contrast",type:"slider",value:1,min:0,max:3,step:.01}],inputs:()=>[{id:"in",label:"Input Color"}],outputs:()=>[{id:"out",label:"Color",type:"vec3"}],glsl:(e,t,n)=>{let r=`vec3 ${e}_bc_in=${n("in","vec3","vec3(0.5)")};\n`;return r+=`vec3 ${e}_bright=${e}_bc_in+vec3(${n("brightness","float","0.0")});\n`,r+=`vec3 ${e}=(${e}_bright-.5)*${n("contrast","float","1.0")}+.5;\n`,r+=`${e}=clamp(${e},.0,1.);\n`,{code:r,outputType:"vec3"}}}),il({type:"HSL",label:"HSL Adjust",color:"purple",category:"Modifiers",description:"Adjusts the Hue, Saturation, and Lightness of an input color.",params:()=>[{id:"hue",label:"Hue Shift",type:"slider",value:0,min:-.5,max:.5,step:.005},{id:"saturation",label:"Saturation",type:"slider",value:1,min:0,max:2,step:.01},{id:"lightness",label:"Lightness",type:"slider",value:0,min:-1,max:1,step:.01}],inputs:()=>[{id:"in",label:"Input Color"}],outputs:()=>[{id:"out",label:"Color",type:"vec3"}],glsl:(e,t,n)=>{let r=`vec3 ${e}_hsl_in=${n("in","vec3","vec3(0.5)")};\n`;return r+=`vec3 ${e}_hsl=rgb2hsl(${e}_hsl_in);\n`,r+=`${e}_hsl.x = fract(${e}_hsl.x + ${n("hue","float","0.0")});\n`,r+=`${e}_hsl.y=clamp(${e}_hsl.y*${n("saturation","float","1.0")},.0,1.);\n`,r+=`${e}_hsl.z=clamp(${e}_hsl.z+${n("lightness","float","0.0")},.0,1.);\n`,r+=`vec3 ${e}=hsl2rgb(${e}_hsl);\n`,{preamble:"\nvec3 rgb2hsl(vec3 c){float max_c=max(max(c.r,c.g),c.b);float min_c=min(min(c.r,c.g),c.b);float h=.0,s=.0,l=(max_c+min_c)/2.;if(max_c==min_c){h=s=.0;}else{float d=max_c-min_c;s=l>.5?d/(2.-max_c-min_c):d/(max_c+min_c);if(max_c==c.r){h=(c.g-c.b)/d+(c.g<c.b?6.:.0);}else if(max_c==c.g){h=(c.b-c.r)/d+2.;}else{h=(c.r-c.g)/d+4.;}h/=6.;}return vec3(h,s,l);}float hue2rgb(float p,float q,float t){if(t<.0)t+=1.;if(t>1.)t-=1.;if(t<1./6.)return p+(q-p)*6.*t;if(t<1./2.)return q;if(t<2./3.)return p+(q-p)*(2./3.-t)*6.;return p;}vec3 hsl2rgb(vec3 c){float r,g,b;if(c.y==.0){r=g=b=c.z;}else{float q=c.z<.5?c.z*(1.+c.y):c.z+c.y-c.z*c.y;float p=2.*c.z-q;r=hue2rgb(p,q,c.x+1./3.);g=hue2rgb(p,q,c.x);b=hue2rgb(p,q,c.x-1./3.);}return vec3(r,g,b);}",code:r,outputType:"vec3"}}}),il({type:"Output",label:"Output",color:"gray",category:"Output",description:"The final destination for the node graph. It combines four separate inputs into a single RGBA color value for the final texture.",params:()=>[],inputs:()=>[{id:"in_r",label:"Red (R)"},{id:"in_g",label:"Green (G)"},{id:"in_b",label:"Blue (B)"},{id:"in_a",label:"Alpha (A)"}],outputs:()=>[],glsl:(e,t,n)=>`return vec4(${n("in_r","float","0.0")}, ${n("in_g","float","0.0")}, ${n("in_b","float","0.0")}, ${n("in_a","float","1.0")});\n`}),il({type:"Comment",label:"Comment",color:"gray",category:"Utility",description:"A simple text box for leaving notes and organizing your graph. It does not affect the final output.",params:()=>[],inputs:()=>[],outputs:()=>[],glsl:()=>""}),il({type:"VectorSplit",label:"Split Vector",color:"gray",category:"Utility",description:"Separates a vec3 input (like a color or coordinate) into its three individual float components (X/R, Y/G, Z/B).",params:()=>[],inputs:e=>[{id:"in",label:"Input"}],outputs:e=>[{id:"x",label:"X (R)",type:"float"},{id:"y",label:"Y (G)",type:"float"},{id:"z",label:"Z (B)",type:"float"}],glsl:(e,t,n)=>({code:`vec3 ${e}_input = ${n("in","vec3","vec3(0.0)")};\n  float ${e}_x = ${e}_input.x;\n  float ${e}_y = ${e}_input.y;\n  float ${e}_z = ${e}_input.z;\n`,outputType:"vec3"})}),il({type:"VectorCombine",label:"Combine Vector",color:"gray",category:"Utility",description:"Constructs a vec3 output (like a color or coordinate) from three individual float inputs (X/R, Y/G, Z/B).",params:()=>[],inputs:e=>[{id:"x",label:"X (R)"},{id:"y",label:"Y (G)"},{id:"z",label:"Z (B)"}],outputs:e=>[{id:"out",label:"Output",type:"vec3"}],glsl:(e,t,n)=>({code:`vec3 ${e} = vec3(${n("x","float","0.0")}, ${n("y","float","0.0")}, ${n("z","float","0.0")});\n`,outputType:"vec3"})});const cl=rl,ul=new Map(cl.map(e=>[e.type,e])),dl=(e,t,n,r,i,a,o,s,l,c)=>{const u=r.find(n=>n.target===e&&n.targetHandle===t);if(u&&i.has(u.source)){let e=i.get(u.source);const t=o.get(u.source);t&&"VectorSplit"===t.data.type&&(e=`${e}_${u.sourceHandle}`);const n=`${u.source}-${u.sourceHandle}`,r=a.get(n)||"float";return r===s?e:"vec3"===r&&"float"===s?`length(${e})`:"float"===r&&"vec3"===s?`vec3(${e})`:e}const d=n.find(e=>e.id===t);if(d&&("slider"===d.type||"color"===d.type)){const t=((e,t)=>`u_${e.replace(/-/g,"_")}_${t}`)(e,d.id),n="color"===d.type?"vec3":"float";return c.has(t)||c.set(t,{type:n,value:d.value}),n===s?t:"vec3"===n&&"float"===s?`length(${t})`:"float"===n&&"vec3"===s?`vec3(${t})`:t}return l},hl=(e,t)=>{let n="\nvec3 hash33(vec3 p){p=vec3(dot(p,vec3(127.1,311.7,74.7)),dot(p,vec3(269.5,183.3,246.1)),dot(p,vec3(113.5,271.9,124.6)));return-1.+2.*fract(sin(p)*43758.5453123);}vec3 quintic3(vec3 w){return w*w*w*(w*(w*6.-15.)+10.);}float remap(float value,float inMin,float inMax,float outMin,float outMax){float t=clamp((value-inMin)/(inMax-inMin),.0,1.);return mix(outMin,outMax,t);}mat4 translationMatrix(vec3 t){return mat4(1.,.0,.0,.0,.0,1.,.0,.0,.0,.0,1.,.0,t.x,t.y,t.z,1.);}mat4 scaleMatrix(vec3 s){return mat4(s.x,.0,.0,.0,.0,s.y,.0,.0,.0,.0,s.z,.0,.0,.0,.0,1.);}mat4 rotationX(float angle){float c=cos(angle);float s=sin(angle);return mat4(1.,.0,.0,.0,.0,c,s,.0,.0,-s,c,.0,.0,.0,.0,1.);}mat4 rotationY(float angle){float c=cos(angle);float s=sin(angle);return mat4(c,.0,-s,.0,.0,1.,.0,.0,s,.0,c,.0,.0,.0,.0,1.);}mat4 rotationZ(float angle){float c=cos(angle);float s=sin(angle);return mat4(c,s,.0,.0,-s,c,.0,.0,.0,.0,1.,.0,.0,.0,.0,1.);}vec3 getPreviewColor(vec4 noise,vec4 mask){float active_channels=mask.r+mask.g+mask.b+mask.a;if(active_channels==.0){return vec3(.0);}if(active_channels==1.){float value=dot(noise,mask);return vec3(value);}float r=.0;float g=.0;float b=.0;int component_index=0;if(mask.r>.5){if(component_index==0)r=noise.r;else if(component_index==1)g=noise.r;else b=noise.r;component_index++;}if(component_index<3 && mask.g>.5){if(component_index==0)r=noise.g;else if(component_index==1)g=noise.g;else b=noise.g;component_index++;}if(component_index<3 && mask.b>.5){if(component_index==0)r=noise.b;else if(component_index==1)g=noise.b;else b=noise.b;component_index++;}if(component_index<3 && mask.a>.5){if(component_index==0)r=noise.a;else if(component_index==1)g=noise.a;else b=noise.a;component_index++;}return vec3(r,g,b);}vec4 cubic(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic(sampler3D sampler,vec3 uv,vec3 resolution){vec3 one=1./resolution;uv=uv*resolution-.5;vec3 iuv=floor(uv);vec3 fuv=fract(uv);vec4 x_coeffs=cubic(fuv.x);vec4 y_coeffs=cubic(fuv.y);vec4 z_coeffs=cubic(fuv.z);vec4 sample_val=vec4(.0);for(int k=0;k<4;++k){float z_weight=z_coeffs[k];if(z_weight==.0)continue;float z_coord=iuv.z+float(k)-1.;for(int j=0;j<4;++j){float y_weight=y_coeffs[j];if(y_weight==.0)continue;float y_coord=iuv.y+float(j)-1.;for(int i=0;i<4;++i){float x_weight=x_coeffs[i];if(x_weight==.0)continue;float x_coord=iuv.x+float(i)-1.;vec3 sample_uv=(vec3(x_coord,y_coord,z_coord)+.5)*one;sample_val+=texture(sampler,sample_uv)*(x_weight*y_weight*z_weight);}}}return sample_val;}\n";const r=new Set;e.some(e=>"PerlinWorleyFBM"===e.data.type||"FBM"===e.data.type||"Warp"===e.data.type||"Cracks3D"===e.data.type||"ClassicPerlin3D"===e.data.type||"Organic3D"===e.data.type||"FlowPattern"===e.data.type||"FlowWarp"===e.data.type)&&(n+="\nfloat gradientNoise(vec3 x,float freq,float seed){vec3 p=floor(x);vec3 w=fract(x);vec3 u=quintic3(w);vec3 ga=hash33(mod(p+vec3(.0,.0,.0),freq)+seed);vec3 gb=hash33(mod(p+vec3(1.,.0,.0),freq)+seed);vec3 gc=hash33(mod(p+vec3(.0,1.,.0),freq)+seed);vec3 gd=hash33(mod(p+vec3(1.,1.,.0),freq)+seed);vec3 ge=hash33(mod(p+vec3(.0,.0,1.),freq)+seed);vec3 gf=hash33(mod(p+vec3(1.,.0,1.),freq)+seed);vec3 gg=hash33(mod(p+vec3(.0,1.,1.),freq)+seed);vec3 gh=hash33(mod(p+vec3(1.,1.,1.),freq)+seed);float va=dot(ga,w-vec3(.0,.0,.0));float vb=dot(gb,w-vec3(1.,.0,.0));float vc=dot(gc,w-vec3(.0,1.,.0));float vd=dot(gd,w-vec3(1.,1.,.0));float ve=dot(ge,w-vec3(.0,.0,1.));float vf=dot(gf,w-vec3(1.,.0,1.));float vg=dot(gg,w-vec3(.0,1.,1.));float vh=dot(gh,w-vec3(1.,1.,1.));return va+u.x*(vb-va)+u.y*(vc-va)+u.z*(ve-va)+u.x*u.y*(va-vb-vc+vd)+u.y*u.z*(va-vc-ve+vg)+u.z*u.x*(va-vb-ve+vf)+u.x*u.y*u.z*(-va+vb+vc-vd+ve-vf-vg+vh);}float gradientNoise_nonTileable(vec3 x,float seed){vec3 p=floor(x);vec3 w=fract(x);vec3 u=quintic3(w);vec3 ga=hash33(p+vec3(.0,.0,.0)+seed);vec3 gb=hash33(p+vec3(1.,.0,.0)+seed);vec3 gc=hash33(p+vec3(.0,1.,.0)+seed);vec3 gd=hash33(p+vec3(1.,1.,.0)+seed);vec3 ge=hash33(p+vec3(.0,.0,1.)+seed);vec3 gf=hash33(p+vec3(1.,.0,1.)+seed);vec3 gg=hash33(p+vec3(.0,1.,1.)+seed);vec3 gh=hash33(p+vec3(1.,1.,1.)+seed);float va=dot(ga,w-vec3(.0,.0,.0));float vb=dot(gb,w-vec3(1.,.0,.0));float vc=dot(gc,w-vec3(.0,1.,.0));float vd=dot(gd,w-vec3(1.,1.,.0));float ve=dot(ge,w-vec3(.0,.0,1.));float vf=dot(gf,w-vec3(1.,.0,1.));float vg=dot(gg,w-vec3(.0,1.,1.));float vh=dot(gh,w-vec3(1.,1.,1.));return va+u.x*(vb-va)+u.y*(vc-va)+u.z*(ve-va)+u.x*u.y*(va-vb-vc+vd)+u.y*u.z*(va-vc-ve+vg)+u.z*u.x*(va-vb-ve+vf)+u.x*u.y*u.z*(-va+vb+vc-vd+ve-vf-vg+vh);}float worleyNoise(vec3 uv,float freq,float seed){vec3 id=floor(uv);vec3 p=fract(uv);float minDist=100.;for(float x=-1.;x<=1.;x+=1.){for(float y=-1.;y<=1.;y+=1.){for(float z=-1.;z<=1.;z+=1.){vec3 offset=vec3(x,y,z);vec3 cell=mod(id+offset,freq);vec3 h=hash33(cell+seed)*.5+.5;h+=offset;vec3 d=p-h;float dd=dot(d,d);minDist=min(minDist,dd);}}}return 1.-minDist;}float perlinfbm(vec3 p,float freq,int octaves,float persistence,float lacunarity,float seed){float amp=1.;float baseFreq=floor(freq);if(baseFreq<1.)baseFreq=1.;float currentFreq=baseFreq;float noise=.0;float maxValue=.0;for(int i=0;i<octaves;++i){float tileableFreq=floor(currentFreq);if(tileableFreq<1.)tileableFreq=1.;noise+=amp*gradientNoise(p*tileableFreq,tileableFreq,seed+float(i)*7.7);maxValue+=amp;currentFreq*=lacunarity;amp*=persistence;}return noise/maxValue;}float worleyFbm(vec3 p,float freq,float seed){float baseFreq=floor(freq);if(baseFreq<1.)baseFreq=1.;return worleyNoise(p*baseFreq,baseFreq,seed)*.625+worleyNoise(p*baseFreq*2.,baseFreq*2.,seed+13.3)*.25+worleyNoise(p*baseFreq*4.,baseFreq*4.,seed+27.1)*.125;}float genericWorleyFbm(vec3 p,float freq,int octaves,float lacunarity,float persistence,float seed){float amp=1.;float baseFreq=floor(freq);if(baseFreq<1.)baseFreq=1.;float currentFreq=baseFreq;float noise=.0;float maxValue=.0;for(int i=0;i<octaves;++i){float tileableFreq=floor(currentFreq);if(tileableFreq<1.)tileableFreq=1.;noise+=amp*(worleyNoise(p*tileableFreq,tileableFreq,seed+float(i)*13.3)*2.-1.);maxValue+=amp;currentFreq*=lacunarity;amp*=persistence;}if(maxValue==.0)return .0;return noise/maxValue;}float fbm(vec3 p,float freq,int octaves,float persistence,float lacunarity,float seed){float worley_base=worleyFbm(p,freq,seed);float perlin_base=perlinfbm(p,freq,octaves,persistence,lacunarity,seed);float pfbm=mix(1.,perlin_base,.5);pfbm=abs(pfbm*2.-1.);float final_noise=remap(pfbm,.0,1.,worley_base,1.);return final_noise*2.-1.;}float unclamped_remap(float value,float inMin,float inMax,float outMin,float outMax){if(inMax-inMin==.0)return outMin;float t=(value-inMin)/(inMax-inMin);return mix(outMin,outMax,t);}float perlinfbm_cloud(vec3 p,float freq,int octaves,float persistence,float lacunarity,float seed){float amp=1.;float baseFreq=floor(freq);if(baseFreq<1.)baseFreq=1.;float currentFreq=baseFreq;float noise=.0;for(int i=0;i<octaves;++i){float tileableFreq=floor(currentFreq);if(tileableFreq<1.)tileableFreq=1.;noise+=amp*gradientNoise(p*tileableFreq,tileableFreq,seed+float(i)*7.7);currentFreq*=lacunarity;amp*=persistence;}return noise;}float perlin_worley_cloud_generator(vec3 p,float scale,int octaves,float persistence,float lacunarity,float seed,int outputType,float cloudScale,float coverage){float worley_f1=worleyFbm(p,scale,seed);if(outputType==1)return worley_f1*2.-1.;if(outputType==0){float perlin_base=perlinfbm_cloud(p,scale,octaves,.5543107485,2.,seed);float pfbm=(1.+perlin_base)*.5;pfbm=abs(pfbm*2.-1.);float perlin_worley_val=unclamped_remap(pfbm,.0,1.,worley_f1,1.);return clamp(perlin_worley_val,.0,1.)*2.-1.;}float worley_f2=worleyFbm(p,scale*2.,seed);if(outputType==2)return worley_f2*2.-1.;float worley_f3=worleyFbm(p,scale*4.,seed);if(outputType==3)return worley_f3*2.-1.;if(outputType==4){vec3 p_scaled=p*cloudScale;float perlin_base_scaled=perlinfbm_cloud(p_scaled,scale,octaves,persistence,lacunarity,seed);float pfbm_scaled=(1.+perlin_base_scaled)*.5;pfbm_scaled=abs(pfbm_scaled*2.-1.);float worley_f1_scaled=worleyFbm(p_scaled,scale,seed);float perlin_worley_scaled=unclamped_remap(pfbm_scaled,.0,1.,worley_f1_scaled,1.);float wfbm_combo=worley_f1*.625+worley_f2*.125+worley_f3*.25;float cloud=unclamped_remap(perlin_worley_scaled,wfbm_combo-1.,1.,.0,1.);cloud=unclamped_remap(cloud,coverage,1.,.0,1.);return cloud*2.-1.;}return .0;}\n");const i=new Map,a=new Map(e.map(e=>[e.id,e])),o=new Map,s=e.find(e=>"Output"===e.data.type);if(!s)return{preamble:n,noiseFunction:"vec4 getNoise(vec3 pos) { return vec4(0.5, 0.5, 0.5, 1.0); }",handleTypes:o,uniforms:i,usedNodeIds:new Set};const l=[],c=new Set;!function e(n){if(c.has(n))return;c.add(n);const r=(e=>t.filter(t=>t.target===e))(n);for(const t of r)a.has(t.source)&&e(t.source);l.push(n)}(s.id);let u="vec4 getNoise(vec3 pos) {\n";const d=new Map;for(const f of l){const e=a.get(f);if(!e)continue;const s=ul.get(e.data.type);if(!s)continue;const l=`val_${f.replace(/-/g,"_")}`,c=(n,r,s)=>dl(f,n,e.data.params,t,d,o,a,r,s,i),h=s.glsl(l,e.data,c);"string"==typeof h?u+=`  ${h}`:h&&(h.preamble&&!r.has(e.data.type)&&(n+=h.preamble,r.add(e.data.type)),u+=`  ${h.code}`,d.set(f,l),s.outputs(e.data).forEach(e=>{o.set(`${f}-${e.id}`,e.type)}))}u.includes("return")||(u+="  return vec4(0.0, 0.0, 0.0, 1.0);\n"),u+="}\n";let h="\n// --- UNIFORMS ---\n";for(const[f,p]of i.entries())h+=`uniform ${p.type} ${f};\n`;return n=h+n,{preamble:n,noiseFunction:u,handleTypes:o,uniforms:i,usedNodeIds:new Set(l)}},fl={viewportHeight:450,sidebarWidth:250,rightPanelWidth:450},pl=el(e=>({name:"unnamed",setName:t=>e({name:t}),isDraggingNode:!1,setIsDraggingNode:t=>e({isDraggingNode:t}),...fl,setViewportHeight:t=>e(e=>({viewportHeight:"function"==typeof t?t(e.viewportHeight):t})),setSidebarWidth:t=>e(e=>({sidebarWidth:"function"==typeof t?t(e.sidebarWidth):t})),setRightPanelWidth:t=>e(e=>({rightPanelWidth:"function"==typeof t?t(e.rightPanelWidth):t})),resetAppLayout:()=>e(fl)})),ml=(e,t)=>{const n=e.find(e=>"Output"===e.data.type);if(!n)return{usedNodes:new Map,usedEdges:new Set};const r=new Map(e.map(e=>[e.id,e])),i=[],a=new Set,o=e=>`${e.source}|${e.sourceHandle||""}|${e.target}|${e.targetHandle||""}`;!function e(n){if(a.has(n))return;a.add(n);const o=t.filter(e=>e.target===n);for(const t of o)r.has(t.source)&&e(t.source);i.push(n)}(n.id);const s=new Map,l=new Set,c=new Set(i);for(const u of i){const e=r.get(u);e&&s.set(e.id,e.data)}for(const u of t)u.source&&u.target&&c.has(u.source)&&c.has(u.target)&&l.add(o(u));return{usedNodes:s,usedEdges:l}},gl=(e,t)=>{const n=ml(e.nodes,e.edges),r=ml(t.nodes,t.edges);if(n.usedNodes.size!==r.usedNodes.size||n.usedEdges.size!==r.usedEdges.size)return!1;for(const[i,a]of r.usedNodes.entries()){const e=n.usedNodes.get(i);if(!e)return!1;if(e.type!==a.type)return!1;if(JSON.stringify(e.params)!==JSON.stringify(a.params))return!1}for(const i of r.usedEdges)if(!n.usedEdges.has(i))return!1;return!0},vl=e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},yl=(e,t,n)=>`hsl(${Math.round(e)} ${Math.round(t)}% ${Math.round(n)}%)`,bl=(e,t)=>"undefined"!=typeof window&&localStorage.getItem(e)||t,xl=el(e=>({accentColor:bl("app-accent-color","#855b3d"),themeMode:bl("app-theme-mode","dark"),brightness:parseInt(bl("app-theme-brightness","10"),10),saturation:parseInt(bl("app-theme-saturation","0"),10),setAccentColor:t=>{/^#[0-9A-F]{6}$/i.test(t)&&(localStorage.setItem("app-accent-color",t),e({accentColor:t}))},setThemeMode:t=>{localStorage.setItem("app-theme-mode",t),e({themeMode:t})},setBrightness:t=>{const n=Math.max(0,Math.min(100,t));localStorage.setItem("app-theme-brightness",String(n)),e({brightness:n})},setSaturation:t=>{const n=Math.max(0,Math.min(100,t));localStorage.setItem("app-theme-saturation",String(n)),e({saturation:n})}}));const _l={version:2,workspaceName:"unnamed",nodes:[{i:"output-1",t:"Output",pos:{x:1856,y:992},size:[182,144]},{i:"constant-alpha",t:"Constant",pos:{x:1632,y:1152},size:[182,95],p:{value:1}},{i:"iq-color",t:"Colorizer",pos:{x:736,y:896},z:10,size:[182,340],p:{color1_base:"#1189e7",color2_texture:"#883b52",color3_highlight:"#f7cb05",color4_modulate:"#fbe1c4",color5_edge:"#042d48",edgeThreshold:0,edgeWidth:1}},{i:"pp-bc",t:"BrightnessContrast",pos:{x:960,y:1056},z:10,size:[182,144],p:{brightness:0,contrast:1.3}},{i:"pp-hsl",t:"HSL",pos:{x:1184,y:1056},z:10,size:[182,169],p:{hue:-.02,saturation:1.47,lightness:0}},{i:"dnd-node_19",t:"VectorSplit",pos:{x:1632,y:992},z:10,size:[182,144]},{i:"dnd-node_21",t:"Transform",pos:{x:256,y:416},z:10,size:[182,316],p:{translateX:0,translateY:0,translateZ:0,rotateX:0,rotateY:0,rotateZ:0,scaleX:1,scaleY:1,scaleZ:1}},{i:"dnd-node_22",t:"FlowWarp",pos:{x:32,y:352},z:10,size:[182,242],p:{tileable:!0,scale:2.2,angle:27,strength:2,iterations:8,seed:0}},{i:"dnd-node_28",t:"PerlinWorleyFBM",pos:{x:-640,y:256},z:10,size:[182,291],p:{outputType:"cloudShape",scale:12,octaves:2,persistence:.85,lacunarity:1.6,seed:31.1,cloudScale:1,coverage:0}},{i:"dnd-node_30",t:"Math",pos:{x:32,y:640},z:10,size:[182,120],p:{op:"multiply"}},{i:"dnd-node_31",t:"Time",pos:{x:-864,y:288},z:10,size:[182,95],p:{speed:.01}},{i:"dnd-node_32",t:"FBM",pos:{x:-192,y:768},z:10,size:[182,267],p:{type:"worley",scale:.1,octaves:10,persistence:.35,lacunarity:3.5,seed:0}},{i:"dnd-node_33",t:"Math",pos:{x:-416,y:512},z:10,size:[182,120],p:{op:"multiply"}},{i:"dnd-node_34",t:"Constant",pos:{x:-640,y:576},z:10,size:[182,95],p:{value:.23}},{i:"dnd-node_36",t:"Constant",pos:{x:-192,y:640},z:10,size:[182,95],p:{value:.48}},{i:"dnd-node_37",t:"SimplexNoise",pos:{x:480,y:736},z:10,size:[182,169],p:{scale:9.4,type:"os2s",seed:0}},{i:"dnd-node_38",t:"SimplexNoise",pos:{x:480,y:544},z:10,size:[182,169],p:{scale:6.5,type:"os2s",seed:14.1}},{i:"dnd-node_39",t:"SimplexNoise",pos:{x:480,y:352},z:10,size:[182,169],p:{scale:2.9,type:"os2s",seed:86.2}},{i:"dnd-node_40",t:"Tonemapper",pos:{x:1408,y:1024},z:10,size:[182,218],p:{mapper:"agx",exposure:1,agxSlope:"#ffffff",agxOffset:"#000000",agxPower:1.06,agxSaturation:1,preserveWhite:!0}}],edges:[{i:"e-const_alpha-output1-a",s:"constant-alpha",t:"output-1",sh:"out",th:"in_a"},{i:"e-pwfbm-math",s:"dnd-node_28",t:"dnd-node_33",sh:"out",th:"in_a"},{i:"e-time-pwfbm",s:"dnd-node_31",t:"dnd-node_28",sh:"out",th:"offset"},{i:"e-const-math1",s:"dnd-node_34",t:"dnd-node_33",sh:"out",th:"in_b"},{i:"e-math2-transformx",s:"dnd-node_30",t:"dnd-node_21",sh:"out",th:"translateX"},{i:"e-math2-transformy",s:"dnd-node_30",t:"dnd-node_21",sh:"out",th:"translateY"},{i:"e-math2-transformz",s:"dnd-node_30",t:"dnd-node_21",sh:"out",th:"translateZ"},{i:"e-const2-math2",s:"dnd-node_36",t:"dnd-node_30",sh:"out",th:"in_a"},{i:"e-flow-transform",s:"dnd-node_22",t:"dnd-node_21",sh:"out",th:"in"},{i:"e-fbm-math2",s:"dnd-node_32",t:"dnd-node_30",sh:"out",th:"in_b"},{i:"e-math1-flow",s:"dnd-node_33",t:"dnd-node_22",sh:"out",th:"angle"},{i:"e-math1-fbm",s:"dnd-node_33",t:"dnd-node_32",sh:"out",th:"in"},{i:"e-fbm-iq",s:"dnd-node_32",t:"iq-color",sh:"out",th:"in_modulate_y"},{i:"e-iq-ppbc",s:"iq-color",t:"pp-bc",sh:"out",th:"in"},{i:"e-ppbc-pphsl",s:"pp-bc",t:"pp-hsl",sh:"out",th:"in"},{i:"e-split-outr",s:"dnd-node_19",t:"output-1",sh:"x",th:"in_r"},{i:"e-split-outg",s:"dnd-node_19",t:"output-1",sh:"y",th:"in_g"},{i:"e-split-outb",s:"dnd-node_19",t:"output-1",sh:"z",th:"in_b"},{i:"reactflow__edge-dnd-node_21out-dnd-node_37pos",s:"dnd-node_21",t:"dnd-node_37",sh:"out",th:"pos"},{i:"reactflow__edge-dnd-node_21out-dnd-node_38pos",s:"dnd-node_21",t:"dnd-node_38",sh:"out",th:"pos"},{i:"reactflow__edge-dnd-node_21out-dnd-node_39pos",s:"dnd-node_21",t:"dnd-node_39",sh:"out",th:"pos"},{i:"reactflow__edge-dnd-node_37out-iq-colorin_detail_y",s:"dnd-node_37",t:"iq-color",sh:"out",th:"in_detail_y"},{i:"reactflow__edge-dnd-node_38out-iq-colorin_detail_x",s:"dnd-node_38",t:"iq-color",sh:"out",th:"in_detail_x"},{i:"reactflow__edge-dnd-node_39out-iq-colorin_base",s:"dnd-node_39",t:"iq-color",sh:"out",th:"in_base"},{i:"reactflow__edge-pp-hslout-dnd-node_40in",s:"pp-hsl",t:"dnd-node_40",sh:"out",th:"in"},{i:"reactflow__edge-dnd-node_40out-dnd-node_19in",s:"dnd-node_40",t:"dnd-node_19",sh:"out",th:"in"}],theme:{accentColor:"#855b3d",themeMode:"dark",brightness:10,saturation:0}},wl="noisette-settings",Sl={saveLayout:!1,edgeType:"default",edgeColorStyle:"subtle",edgeLineStyle:"solid",floatStrokeWidth:1.5,vec3StrokeWidth:3},Ml=()=>{try{const e=localStorage.getItem(wl);if(e){const t=JSON.parse(e);return{...Sl,...t}}}catch(e){console.error("Could not load settings from localStorage",e)}return Sl},El=e=>{const{setSaveLayout:t,setEdgeType:n,setEdgeColorStyle:r,setEdgeLineStyle:i,setFloatStrokeWidth:a,setVec3StrokeWidth:o,reset:s,...l}=e;try{localStorage.setItem(wl,JSON.stringify(l))}catch(c){console.error("Could not save settings to localStorage",c)}},Tl=el((e,t)=>({...Ml(),setSaveLayout:n=>{e({saveLayout:n}),n||localStorage.removeItem("noisette-saved-layout"),El(t())},setEdgeType:n=>{e({edgeType:n}),El(t())},setEdgeColorStyle:n=>{e({edgeColorStyle:n}),El(t())},setEdgeLineStyle:n=>{e({edgeLineStyle:n}),El(t())},setFloatStrokeWidth:n=>{e({floatStrokeWidth:n}),El(t())},setVec3StrokeWidth:n=>{e({vec3StrokeWidth:n}),El(t())},reset:()=>{e(Sl),El({...t(),...Sl})}})),Cl={x:.5,y:.5,z:.5},Al={x:0,y:0},kl=()=>({isPlaying:!0,displayMode:"surface",shape:"cube",slice:{...Cl},density:5,tiling:1,raymarchSteps:16,fpsLimit:60,channelMask:{r:!0,g:!0,b:!0,a:!1},filteringMode:"tricubic",sliceAxis2D:"z",slicePosition2D:.5,zoom2D:1,offset2D:{...Al},hasInitiallyRendered:!1}),Rl=el(e=>({...kl(),setHasInitiallyRendered:t=>e({hasInitiallyRendered:t}),togglePlay:()=>e(e=>({isPlaying:!e.isPlaying,hasInitiallyRendered:!1})),setDisplayMode:t=>e({displayMode:t}),setShape:t=>e({shape:t}),setSlice:(t,n)=>e(e=>({slice:{...e.slice,[t]:n}})),setDensity:t=>e({density:t}),setTiling:t=>e({tiling:t}),setRaymarchSteps:t=>e({raymarchSteps:t}),setFpsLimit:t=>e({fpsLimit:t}),setChannelMask:t=>e(e=>({channelMask:{...e.channelMask,[t]:!e.channelMask[t]}})),setFilteringMode:t=>e({filteringMode:t}),setSliceAxis2D:t=>e({sliceAxis2D:t}),setSlicePosition2D:t=>e({slicePosition2D:t}),setZoom2D:t=>e(e=>({zoom2D:t(e.zoom2D)})),setOffset2D:t=>e(e=>({offset2D:t(e.offset2D)})),resetSlice:()=>e({slice:{...Cl}}),resetDensity:()=>e({density:5}),resetRaymarchSteps:()=>e({raymarchSteps:16}),resetSlice2D:()=>e({sliceAxis2D:"z",slicePosition2D:.5}),resetView2D:()=>e({zoom2D:1,offset2D:{...Al}}),reset:()=>e(kl())})),Nl="180",Pl={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Il={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Ll=0,Dl=1,zl=2,Ol=100,Ul=101,Fl=102,Bl=200,jl=201,Hl=202,Vl=203,Gl=204,Wl=205,$l=206,Xl=207,ql=208,Yl=209,Zl=210,Kl=211,Jl=212,Ql=213,ec=214,tc=0,nc=1,rc=2,ic=3,ac=4,oc=5,sc=6,lc=7,cc="attached",uc="detached",dc=300,hc=301,fc=302,pc=303,mc=304,gc=306,vc=1e3,yc=1001,bc=1002,xc=1003,_c=1004,wc=1005,Sc=1006,Mc=1007,Ec=1008,Tc=1009,Cc=1010,Ac=1011,kc=1012,Rc=1013,Nc=1014,Pc=1015,Ic=1016,Lc=1017,Dc=1018,zc=1020,Oc=35902,Uc=35899,Fc=1021,Bc=1022,jc=1023,Hc=1026,Vc=1027,Gc=1028,Wc=1029,$c=1030,Xc=1031,qc=1033,Yc=33776,Zc=33777,Kc=33778,Jc=33779,Qc=35840,eu=35841,tu=35842,nu=35843,ru=36196,iu=37492,au=37496,ou=37808,su=37809,lu=37810,cu=37811,uu=37812,du=37813,hu=37814,fu=37815,pu=37816,mu=37817,gu=37818,vu=37819,yu=37820,bu=37821,xu=36492,_u=36494,wu=36495,Su=36283,Mu=36284,Eu=36285,Tu=36286,Cu=2300,Au=2301,ku=2302,Ru=2400,Nu=2401,Pu=2402,Iu=2501,Lu="",Du="srgb",zu="srgb-linear",Ou="linear",Uu="srgb",Fu=7680,Bu=512,ju=513,Hu=514,Vu=515,Gu=516,Wu=517,$u=518,Xu=519,qu=35044,Yu="300 es",Zu=2e3,Ku=2001;let Ju=class{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return void 0!==n&&void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){const n=this._listeners;if(void 0===n)return;const r=n[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){const t=this._listeners;if(void 0===t)return;const n=t[e.type];if(void 0!==n){e.target=this;const t=n.slice(0);for(let n=0,r=t.length;n<r;n++)t[n].call(this,e);e.target=null}}};const Qu=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let ed=1234567;const td=Math.PI/180,nd=180/Math.PI;function rd(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Qu[255&e]+Qu[e>>8&255]+Qu[e>>16&255]+Qu[e>>24&255]+"-"+Qu[255&t]+Qu[t>>8&255]+"-"+Qu[t>>16&15|64]+Qu[t>>24&255]+"-"+Qu[63&n|128]+Qu[n>>8&255]+"-"+Qu[n>>16&255]+Qu[n>>24&255]+Qu[255&r]+Qu[r>>8&255]+Qu[r>>16&255]+Qu[r>>24&255]).toLowerCase()}function id(e,t,n){return Math.max(t,Math.min(n,e))}function ad(e,t){return(e%t+t)%t}function od(e,t,n){return(1-n)*e+n*t}function sd(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function ld(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const cd={DEG2RAD:td,RAD2DEG:nd,generateUUID:rd,clamp:id,euclideanModulo:ad,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:od,damp:function(e,t,n,r){return od(e,t,1-Math.exp(-n*r))},pingpong:function(e,t=1){return t-Math.abs(ad(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(ed=e);let t=ed+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*td},radToDeg:function(e){return e*nd},isPowerOfTwo:function(e){return!(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,r,i){const a=Math.cos,o=Math.sin,s=a(n/2),l=o(n/2),c=a((t+r)/2),u=o((t+r)/2),d=a((t-r)/2),h=o((t-r)/2),f=a((r-t)/2),p=o((r-t)/2);switch(i){case"XYX":e.set(s*u,l*d,l*h,s*c);break;case"YZY":e.set(l*h,s*u,l*d,s*c);break;case"ZXZ":e.set(l*d,l*h,s*u,s*c);break;case"XZX":e.set(s*u,l*p,l*f,s*c);break;case"YXY":e.set(l*f,s*u,l*p,s*c);break;case"ZYZ":e.set(l*p,l*f,s*u,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:ld,denormalize:sd};class ud{constructor(e=0,t=0){ud.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=id(this.x,e.x,t.x),this.y=id(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=id(this.x,e,t),this.y=id(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(id(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(id(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class dd{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,i,a,o){let s=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const d=i[a+0],h=i[a+1],f=i[a+2],p=i[a+3];if(0===o)return e[t+0]=s,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===o)return e[t+0]=d,e[t+1]=h,e[t+2]=f,void(e[t+3]=p);if(u!==p||s!==d||l!==h||c!==f){let e=1-o;const t=s*d+l*h+c*f+u*p,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),a=Math.atan2(i,t*n);e=Math.sin(e*a)/i,o=Math.sin(o*a)/i}const i=o*n;if(s=s*e+d*i,l=l*e+h*i,c=c*e+f*i,u=u*e+p*i,e===1-o){const e=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=e,l*=e,c*=e,u*=e}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,a){const o=n[r],s=n[r+1],l=n[r+2],c=n[r+3],u=i[a],d=i[a+1],h=i[a+2],f=i[a+3];return e[t]=o*f+c*u+s*h-l*d,e[t+1]=s*f+c*d+l*u-o*h,e[t+2]=l*f+c*h+o*d-s*u,e[t+3]=c*f-o*u-s*d-l*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,i=e._z,a=e._order,o=Math.cos,s=Math.sin,l=o(n/2),c=o(r/2),u=o(i/2),d=s(n/2),h=s(r/2),f=s(i/2);switch(a){case"XYZ":this._x=d*c*u+l*h*f,this._y=l*h*u-d*c*f,this._z=l*c*f+d*h*u,this._w=l*c*u-d*h*f;break;case"YXZ":this._x=d*c*u+l*h*f,this._y=l*h*u-d*c*f,this._z=l*c*f-d*h*u,this._w=l*c*u+d*h*f;break;case"ZXY":this._x=d*c*u-l*h*f,this._y=l*h*u+d*c*f,this._z=l*c*f+d*h*u,this._w=l*c*u-d*h*f;break;case"ZYX":this._x=d*c*u-l*h*f,this._y=l*h*u+d*c*f,this._z=l*c*f-d*h*u,this._w=l*c*u+d*h*f;break;case"YZX":this._x=d*c*u+l*h*f,this._y=l*h*u+d*c*f,this._z=l*c*f-d*h*u,this._w=l*c*u-d*h*f;break;case"XZY":this._x=d*c*u-l*h*f,this._y=l*h*u-d*c*f,this._z=l*c*f+d*h*u,this._w=l*c*u+d*h*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],o=t[5],s=t[9],l=t[2],c=t[6],u=t[10],d=n+o+u;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-s)*e,this._y=(i-l)*e,this._z=(a-r)*e}else if(n>o&&n>u){const e=2*Math.sqrt(1+n-o-u);this._w=(c-s)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(i+l)/e}else if(o>u){const e=2*Math.sqrt(1+o-n-u);this._w=(i-l)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(s+c)/e}else{const e=2*Math.sqrt(1+u-n-o);this._w=(a-r)/e,this._x=(i+l)/e,this._y=(s+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(id(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+a*o+r*l-i*s,this._y=r*c+a*s+i*o-n*l,this._z=i*c+a*l+n*s-r*o,this._w=a*c-n*o-r*s-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,a=this._w;let o=a*e._w+n*e._x+r*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;const s=1-o*o;if(s<=Number.EPSILON){const e=1-t;return this._w=e*a+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this}const l=Math.sqrt(s),c=Math.atan2(l,o),u=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=a*u+this._w*d,this._x=n*u+this._x*d,this._y=r*u+this._y*d,this._z=i*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),i*Math.sin(t),i*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class hd{constructor(e=0,t=0,n=0){hd.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(pd.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(pd.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=2*(a*r-o*n),c=2*(o*t-i*r),u=2*(i*n-a*t);return this.x=t+s*l+a*u-o*c,this.y=n+s*c+o*l-i*u,this.z=r+s*u+i*c-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=id(this.x,e.x,t.x),this.y=id(this.y,e.y,t.y),this.z=id(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=id(this.x,e,t),this.y=id(this.y,e,t),this.z=id(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(id(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return fd.copy(this).projectOnVector(e),this.sub(fd)}reflect(e){return this.sub(fd.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(id(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const fd=new hd,pd=new dd;class md{constructor(e,t,n,r,i,a,o,s,l){md.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,a,o,s,l)}set(e,t,n,r,i,a,o,s,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=i,c[5]=s,c[6]=n,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],c=n[4],u=n[7],d=n[2],h=n[5],f=n[8],p=r[0],m=r[3],g=r[6],v=r[1],y=r[4],b=r[7],x=r[2],_=r[5],w=r[8];return i[0]=a*p+o*v+s*x,i[3]=a*m+o*y+s*_,i[6]=a*g+o*b+s*w,i[1]=l*p+c*v+u*x,i[4]=l*m+c*y+u*_,i[7]=l*g+c*b+u*w,i[2]=d*p+h*v+f*x,i[5]=d*m+h*y+f*_,i[8]=d*g+h*b+f*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-n*i*c+n*o*s+r*i*l-r*a*s}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=c*a-o*l,d=o*s-c*i,h=l*i-a*s,f=t*u+n*d+r*h;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);const p=1/f;return e[0]=u*p,e[1]=(r*l-c*n)*p,e[2]=(o*n-r*a)*p,e[3]=d*p,e[4]=(c*t-r*s)*p,e[5]=(r*i-o*t)*p,e[6]=h*p,e[7]=(n*s-l*t)*p,e[8]=(a*t-n*i)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,a,o){const s=Math.cos(i),l=Math.sin(i);return this.set(n*s,n*l,-n*(s*a+l*o)+a+e,-r*l,r*s,-r*(-l*a+s*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(gd.makeScale(e,t)),this}rotate(e){return this.premultiply(gd.makeRotation(-e)),this}translate(e,t){return this.premultiply(gd.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const gd=new md;function vd(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const yd={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function bd(e,t){return new yd[e](t)}function xd(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function _d(){const e=xd("canvas");return e.style.display="block",e}const wd={};function Sd(e){e in wd||(wd[e]=!0,console.warn(e))}const Md=(new md).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Ed=(new md).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Td(){const e={enabled:!0,workingColorSpace:zu,spaces:{},convert:function(e,t,n){return!1!==this.enabled&&t!==n&&t&&n?(this.spaces[t].transfer===Uu&&(e.r=Ad(e.r),e.g=Ad(e.g),e.b=Ad(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Uu&&(e.r=kd(e.r),e.g=kd(e.g),e.b=kd(e.b)),e):e},workingToColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},colorSpaceToWorking:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===Lu?Ou:this.spaces[e].transfer},getToneMappingMode:function(e){return this.spaces[e].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(t,n){return Sd("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),e.workingToColorSpace(t,n)},toWorkingColorSpace:function(t,n){return Sd("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),e.colorSpaceToWorking(t,n)}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[zu]:{primaries:t,whitePoint:r,transfer:Ou,toXYZ:Md,fromXYZ:Ed,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:Du},outputColorSpaceConfig:{drawingBufferColorSpace:Du}},[Du]:{primaries:t,whitePoint:r,transfer:Uu,toXYZ:Md,fromXYZ:Ed,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:Du}}}),e}const Cd=Td();function Ad(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function kd(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let Rd;class Nd{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{void 0===Rd&&(Rd=xd("canvas")),Rd.width=e.width,Rd.height=e.height;const t=Rd.getContext("2d");e instanceof ImageData?t.putImageData(e,0,0):t.drawImage(e,0,0,e.width,e.height),n=Rd}return n.toDataURL(t)}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=xd("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*Ad(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Ad(t[e]/255)):t[e]=Ad(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Pd=0;class Id{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Pd++}),this.uuid=rd(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):null!==t?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(Ld(r[t].image)):e.push(Ld(r[t]))}else e=Ld(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function Ld(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Nd.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Dd=0;const zd=new hd;class Od extends Ju{constructor(e=Od.DEFAULT_IMAGE,t=Od.DEFAULT_MAPPING,n=1001,r=1001,i=1006,a=1008,o=1023,s=1009,l=Od.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Dd++}),this.uuid=rd(),this.name="",this.source=new Id(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new ud(0,0),this.repeat=new ud(1,1),this.center=new ud(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new md,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(zd).x}get height(){return this.source.getSize(zd).y}get depth(){return this.source.getSize(zd).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const r=this[t];void 0!==r?r&&n&&r.isVector2&&n.isVector2||r&&n&&r.isVector3&&n.isVector3||r&&n&&r.isMatrix3&&n.isMatrix3?r.copy(n):this[t]=n:console.warn(`THREE.Texture.setValues(): property '${t}' does not exist.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==dc)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case vc:e.x=e.x-Math.floor(e.x);break;case yc:e.x=e.x<0?0:1;break;case bc:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case vc:e.y=e.y-Math.floor(e.y);break;case yc:e.y=e.y<0?0:1;break;case bc:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}Od.DEFAULT_IMAGE=null,Od.DEFAULT_MAPPING=dc,Od.DEFAULT_ANISOTROPY=1;class Ud{constructor(e=0,t=0,n=0,r=1){Ud.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const a=.01,o=.1,s=e.elements,l=s[0],c=s[4],u=s[8],d=s[1],h=s[5],f=s[9],p=s[2],m=s[6],g=s[10];if(Math.abs(c-d)<a&&Math.abs(u-p)<a&&Math.abs(f-m)<a){if(Math.abs(c+d)<o&&Math.abs(u+p)<o&&Math.abs(f+m)<o&&Math.abs(l+h+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,s=(h+1)/2,v=(g+1)/2,y=(c+d)/4,b=(u+p)/4,x=(f+m)/4;return e>s&&e>v?e<a?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=y/n,i=b/n):s>v?s<a?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(s),n=y/r,i=x/r):v<a?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=b/i,r=x/i),this.set(n,r,i,t),this}let v=Math.sqrt((m-f)*(m-f)+(u-p)*(u-p)+(d-c)*(d-c));return Math.abs(v)<.001&&(v=1),this.x=(m-f)/v,this.y=(u-p)/v,this.z=(d-c)/v,this.w=Math.acos((l+h+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=id(this.x,e.x,t.x),this.y=id(this.y,e.y,t.y),this.z=id(this.z,e.z,t.z),this.w=id(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=id(this.x,e,t),this.y=id(this.y,e,t),this.z=id(this.z,e,t),this.w=id(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(id(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Fd extends Ju{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Sc,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new Ud(0,0,e,t),this.scissorTest=!1,this.viewport=new Ud(0,0,e,t);const r={width:e,height:t,depth:n.depth},i=new Od(r);this.textures=[];const a=n.count;for(let o=0;o<a;o++)this.textures[o]=i.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:Sc,generateMipmaps:!1,flipY:!1,internalFormat:null};void 0!==e.mapping&&(t.mapping=e.mapping),void 0!==e.wrapS&&(t.wrapS=e.wrapS),void 0!==e.wrapT&&(t.wrapT=e.wrapT),void 0!==e.wrapR&&(t.wrapR=e.wrapR),void 0!==e.magFilter&&(t.magFilter=e.magFilter),void 0!==e.minFilter&&(t.minFilter=e.minFilter),void 0!==e.format&&(t.format=e.format),void 0!==e.type&&(t.type=e.type),void 0!==e.anisotropy&&(t.anisotropy=e.anisotropy),void 0!==e.colorSpace&&(t.colorSpace=e.colorSpace),void 0!==e.flipY&&(t.flipY=e.flipY),void 0!==e.generateMipmaps&&(t.generateMipmaps=e.generateMipmaps),void 0!==e.internalFormat&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n,this.textures[r].isArrayTexture=this.textures[r].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const n=Object.assign({},e.textures[t].image);this.textures[t].source=new Id(n)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Bd extends Fd{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class jd extends Od{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=xc,this.minFilter=xc,this.wrapR=yc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Hd extends Od{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=xc,this.minFilter=xc,this.wrapR=yc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Vd{constructor(e=new hd(1/0,1/0,1/0),t=new hd(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Wd.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Wd.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Wd.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===t&&void 0!==r&&!0!==e.isInstancedMesh)for(let t=0,n=r.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,Wd):Wd.fromBufferAttribute(r,t),Wd.applyMatrix4(e.matrixWorld),this.expandByPoint(Wd);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),$d.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),$d.copy(n.boundingBox)),$d.applyMatrix4(e.matrixWorld),this.union($d)}const r=e.children;for(let i=0,a=r.length;i<a;i++)this.expandByObject(r[i],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Wd),Wd.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Qd),eh.subVectors(this.max,Qd),Xd.subVectors(e.a,Qd),qd.subVectors(e.b,Qd),Yd.subVectors(e.c,Qd),Zd.subVectors(qd,Xd),Kd.subVectors(Yd,qd),Jd.subVectors(Xd,Yd);let t=[0,-Zd.z,Zd.y,0,-Kd.z,Kd.y,0,-Jd.z,Jd.y,Zd.z,0,-Zd.x,Kd.z,0,-Kd.x,Jd.z,0,-Jd.x,-Zd.y,Zd.x,0,-Kd.y,Kd.x,0,-Jd.y,Jd.x,0];return!!rh(t,Xd,qd,Yd,eh)&&(t=[1,0,0,0,1,0,0,0,1],!!rh(t,Xd,qd,Yd,eh)&&(th.crossVectors(Zd,Kd),t=[th.x,th.y,th.z],rh(t,Xd,qd,Yd,eh)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Wd).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Wd).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Gd[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Gd[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Gd[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Gd[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Gd[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Gd[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Gd[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Gd[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Gd)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Gd=[new hd,new hd,new hd,new hd,new hd,new hd,new hd,new hd],Wd=new hd,$d=new Vd,Xd=new hd,qd=new hd,Yd=new hd,Zd=new hd,Kd=new hd,Jd=new hd,Qd=new hd,eh=new hd,th=new hd,nh=new hd;function rh(e,t,n,r,i){for(let a=0,o=e.length-3;a<=o;a+=3){nh.fromArray(e,a);const o=i.x*Math.abs(nh.x)+i.y*Math.abs(nh.y)+i.z*Math.abs(nh.z),s=t.dot(nh),l=n.dot(nh),c=r.dot(nh);if(Math.max(-Math.max(s,l,c),Math.min(s,l,c))>o)return!1}return!0}const ih=new Vd,ah=new hd,oh=new hd;class sh{constructor(e=new hd,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):ih.setFromPoints(e).getCenter(n);let r=0;for(let i=0,a=e.length;i<a;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;ah.subVectors(e,this.center);const t=ah.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(ah,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(oh.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(ah.copy(e.center).add(oh)),this.expandByPoint(ah.copy(e.center).sub(oh))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const lh=new hd,ch=new hd,uh=new hd,dh=new hd,hh=new hd,fh=new hd,ph=new hd;class mh{constructor(e=new hd,t=new hd(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,lh)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=lh.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(lh.copy(this.origin).addScaledVector(this.direction,t),lh.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){ch.copy(e).add(t).multiplyScalar(.5),uh.copy(t).sub(e).normalize(),dh.copy(this.origin).sub(ch);const i=.5*e.distanceTo(t),a=-this.direction.dot(uh),o=dh.dot(this.direction),s=-dh.dot(uh),l=dh.lengthSq(),c=Math.abs(1-a*a);let u,d,h,f;if(c>0)if(u=a*s-o,d=a*o-s,f=i*c,u>=0)if(d>=-f)if(d<=f){const e=1/c;u*=e,d*=e,h=u*(u+a*d+2*o)+d*(a*u+d+2*s)+l}else d=i,u=Math.max(0,-(a*d+o)),h=-u*u+d*(d+2*s)+l;else d=-i,u=Math.max(0,-(a*d+o)),h=-u*u+d*(d+2*s)+l;else d<=-f?(u=Math.max(0,-(-a*i+o)),d=u>0?-i:Math.min(Math.max(-i,-s),i),h=-u*u+d*(d+2*s)+l):d<=f?(u=0,d=Math.min(Math.max(-i,-s),i),h=d*(d+2*s)+l):(u=Math.max(0,-(a*i+o)),d=u>0?i:Math.min(Math.max(-i,-s),i),h=-u*u+d*(d+2*s)+l);else d=a>0?-i:i,u=Math.max(0,-(a*d+o)),h=-u*u+d*(d+2*s)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(ch).addScaledVector(uh,d),h}intersectSphere(e,t){lh.subVectors(e.center,this.origin);const n=lh.dot(this.direction),r=lh.dot(lh)-n*n,i=e.radius*e.radius;if(r>i)return null;const a=Math.sqrt(i-r),o=n-a,s=n+a;return s<0?null:o<0?this.at(s,t):this.at(o,t)}intersectsSphere(e){return!(e.radius<0)&&this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,a,o,s;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,d=this.origin;return l>=0?(n=(e.min.x-d.x)*l,r=(e.max.x-d.x)*l):(n=(e.max.x-d.x)*l,r=(e.min.x-d.x)*l),c>=0?(i=(e.min.y-d.y)*c,a=(e.max.y-d.y)*c):(i=(e.max.y-d.y)*c,a=(e.min.y-d.y)*c),n>a||i>r?null:((i>n||isNaN(n))&&(n=i),(a<r||isNaN(r))&&(r=a),u>=0?(o=(e.min.z-d.z)*u,s=(e.max.z-d.z)*u):(o=(e.max.z-d.z)*u,s=(e.min.z-d.z)*u),n>s||o>r?null:((o>n||n!=n)&&(n=o),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,lh)}intersectTriangle(e,t,n,r,i){hh.subVectors(t,e),fh.subVectors(n,e),ph.crossVectors(hh,fh);let a,o=this.direction.dot(ph);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}dh.subVectors(this.origin,e);const s=a*this.direction.dot(fh.crossVectors(dh,fh));if(s<0)return null;const l=a*this.direction.dot(hh.cross(dh));if(l<0)return null;if(s+l>o)return null;const c=-a*dh.dot(ph);return c<0?null:this.at(c/o,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class gh{constructor(e,t,n,r,i,a,o,s,l,c,u,d,h,f,p,m){gh.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,a,o,s,l,c,u,d,h,f,p,m)}set(e,t,n,r,i,a,o,s,l,c,u,d,h,f,p,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=d,g[3]=h,g[7]=f,g[11]=p,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new gh).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/vh.setFromMatrixColumn(e,0).length(),i=1/vh.setFromMatrixColumn(e,1).length(),a=1/vh.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=a*c,n=a*u,r=o*c,i=o*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-o*s,t[2]=i-e*l,t[6]=r+n*l,t[10]=a*s}else if("YXZ"===e.order){const e=s*c,n=s*u,r=l*c,i=l*u;t[0]=e+i*o,t[4]=r*o-n,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-o,t[2]=n*o-r,t[6]=i+e*o,t[10]=a*s}else if("ZXY"===e.order){const e=s*c,n=s*u,r=l*c,i=l*u;t[0]=e-i*o,t[4]=-a*u,t[8]=r+n*o,t[1]=n+r*o,t[5]=a*c,t[9]=i-e*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){const e=a*c,n=a*u,r=o*c,i=o*u;t[0]=s*c,t[4]=r*l-n,t[8]=e*l+i,t[1]=s*u,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){const e=a*s,n=a*l,r=o*s,i=o*l;t[0]=s*c,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=a*c,t[9]=-o*c,t[2]=-l*c,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){const e=a*s,n=a*l,r=o*s,i=o*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=e*u+i,t[5]=a*c,t[9]=n*u-r,t[2]=r*u-n,t[6]=o*c,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(bh,e,xh)}lookAt(e,t,n){const r=this.elements;return Sh.subVectors(e,t),0===Sh.lengthSq()&&(Sh.z=1),Sh.normalize(),_h.crossVectors(n,Sh),0===_h.lengthSq()&&(1===Math.abs(n.z)?Sh.x+=1e-4:Sh.z+=1e-4,Sh.normalize(),_h.crossVectors(n,Sh)),_h.normalize(),wh.crossVectors(Sh,_h),r[0]=_h.x,r[4]=wh.x,r[8]=Sh.x,r[1]=_h.y,r[5]=wh.y,r[9]=Sh.y,r[2]=_h.z,r[6]=wh.z,r[10]=Sh.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],c=n[1],u=n[5],d=n[9],h=n[13],f=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],_=r[0],w=r[4],S=r[8],M=r[12],E=r[1],T=r[5],C=r[9],A=r[13],k=r[2],R=r[6],N=r[10],P=r[14],I=r[3],L=r[7],D=r[11],z=r[15];return i[0]=a*_+o*E+s*k+l*I,i[4]=a*w+o*T+s*R+l*L,i[8]=a*S+o*C+s*N+l*D,i[12]=a*M+o*A+s*P+l*z,i[1]=c*_+u*E+d*k+h*I,i[5]=c*w+u*T+d*R+h*L,i[9]=c*S+u*C+d*N+h*D,i[13]=c*M+u*A+d*P+h*z,i[2]=f*_+p*E+m*k+g*I,i[6]=f*w+p*T+m*R+g*L,i[10]=f*S+p*C+m*N+g*D,i[14]=f*M+p*A+m*P+g*z,i[3]=v*_+y*E+b*k+x*I,i[7]=v*w+y*T+b*R+x*L,i[11]=v*S+y*C+b*N+x*D,i[15]=v*M+y*A+b*P+x*z,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],d=e[10],h=e[14];return e[3]*(+i*s*u-r*l*u-i*o*d+n*l*d+r*o*h-n*s*h)+e[7]*(+t*s*h-t*l*d+i*a*d-r*a*h+r*l*c-i*s*c)+e[11]*(+t*l*u-t*o*h-i*a*u+n*a*h+i*o*c-n*l*c)+e[15]*(-r*o*c-t*s*u+t*o*d+r*a*u-n*a*d+n*s*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],f=e[12],p=e[13],m=e[14],g=e[15],v=u*m*l-p*d*l+p*s*h-o*m*h-u*s*g+o*d*g,y=f*d*l-c*m*l-f*s*h+a*m*h+c*s*g-a*d*g,b=c*p*l-f*u*l+f*o*h-a*p*h-c*o*g+a*u*g,x=f*u*s-c*p*s-f*o*d+a*p*d+c*o*m-a*u*m,_=t*v+n*y+r*b+i*x;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/_;return e[0]=v*w,e[1]=(p*d*i-u*m*i-p*r*h+n*m*h+u*r*g-n*d*g)*w,e[2]=(o*m*i-p*s*i+p*r*l-n*m*l-o*r*g+n*s*g)*w,e[3]=(u*s*i-o*d*i-u*r*l+n*d*l+o*r*h-n*s*h)*w,e[4]=y*w,e[5]=(c*m*i-f*d*i+f*r*h-t*m*h-c*r*g+t*d*g)*w,e[6]=(f*s*i-a*m*i-f*r*l+t*m*l+a*r*g-t*s*g)*w,e[7]=(a*d*i-c*s*i+c*r*l-t*d*l-a*r*h+t*s*h)*w,e[8]=b*w,e[9]=(f*u*i-c*p*i-f*n*h+t*p*h+c*n*g-t*u*g)*w,e[10]=(a*p*i-f*o*i+f*n*l-t*p*l-a*n*g+t*o*g)*w,e[11]=(c*o*i-a*u*i-c*n*l+t*u*l+a*n*h-t*o*h)*w,e[12]=x*w,e[13]=(c*p*r-f*u*r+f*n*d-t*p*d-c*n*m+t*u*m)*w,e[14]=(f*o*r-a*p*r-f*n*s+t*p*s+a*n*m-t*o*m)*w,e[15]=(a*u*r-c*o*r+c*n*s-t*u*s-a*n*d+t*o*d)*w,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,l=i*a,c=i*o;return this.set(l*a+n,l*o-r*s,l*s+r*o,0,l*o+r*s,c*o+n,c*s-r*a,0,l*s-r*o,c*s+r*a,i*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,a){return this.set(1,n,i,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,l=i+i,c=a+a,u=o+o,d=i*l,h=i*c,f=i*u,p=a*c,m=a*u,g=o*u,v=s*l,y=s*c,b=s*u,x=n.x,_=n.y,w=n.z;return r[0]=(1-(p+g))*x,r[1]=(h+b)*x,r[2]=(f-y)*x,r[3]=0,r[4]=(h-b)*_,r[5]=(1-(d+g))*_,r[6]=(m+v)*_,r[7]=0,r[8]=(f+y)*w,r[9]=(m-v)*w,r[10]=(1-(d+p))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=vh.set(r[0],r[1],r[2]).length();const a=vh.set(r[4],r[5],r[6]).length(),o=vh.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],yh.copy(this);const s=1/i,l=1/a,c=1/o;return yh.elements[0]*=s,yh.elements[1]*=s,yh.elements[2]*=s,yh.elements[4]*=l,yh.elements[5]*=l,yh.elements[6]*=l,yh.elements[8]*=c,yh.elements[9]*=c,yh.elements[10]*=c,t.setFromRotationMatrix(yh),n.x=i,n.y=a,n.z=o,this}makePerspective(e,t,n,r,i,a,o=2e3,s=!1){const l=this.elements,c=2*i/(t-e),u=2*i/(n-r),d=(t+e)/(t-e),h=(n+r)/(n-r);let f,p;if(s)f=i/(a-i),p=a*i/(a-i);else if(o===Zu)f=-(a+i)/(a-i),p=-2*a*i/(a-i);else{if(o!==Ku)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);f=-a/(a-i),p=-a*i/(a-i)}return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=u,l[9]=h,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,r,i,a,o=2e3,s=!1){const l=this.elements,c=2/(t-e),u=2/(n-r),d=-(t+e)/(t-e),h=-(n+r)/(n-r);let f,p;if(s)f=1/(a-i),p=a/(a-i);else if(o===Zu)f=-2/(a-i),p=-(a+i)/(a-i);else{if(o!==Ku)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);f=-1/(a-i),p=-i/(a-i)}return l[0]=c,l[4]=0,l[8]=0,l[12]=d,l[1]=0,l[5]=u,l[9]=0,l[13]=h,l[2]=0,l[6]=0,l[10]=f,l[14]=p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const vh=new hd,yh=new gh,bh=new hd(0,0,0),xh=new hd(1,1,1),_h=new hd,wh=new hd,Sh=new hd,Mh=new gh,Eh=new dd;class Th{constructor(e=0,t=0,n=0,r=Th.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,i=r[0],a=r[4],o=r[8],s=r[1],l=r[5],c=r[9],u=r[2],d=r[6],h=r[10];switch(t){case"XYZ":this._y=Math.asin(id(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-id(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,h),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(id(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,h),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-id(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(id(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(o,h));break;case"XZY":this._z=Math.asin(-id(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-c,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Mh.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Mh,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Eh.setFromEuler(this),this.setFromQuaternion(Eh,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Th.DEFAULT_ORDER="XYZ";class Ch{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let Ah=0;const kh=new hd,Rh=new dd,Nh=new gh,Ph=new hd,Ih=new hd,Lh=new hd,Dh=new dd,zh=new hd(1,0,0),Oh=new hd(0,1,0),Uh=new hd(0,0,1),Fh={type:"added"},Bh={type:"removed"},jh={type:"childadded",child:null},Hh={type:"childremoved",child:null};class Vh extends Ju{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ah++}),this.uuid=rd(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Vh.DEFAULT_UP.clone();const e=new hd,t=new Th,n=new dd,r=new hd(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new gh},normalMatrix:{value:new md}}),this.matrix=new gh,this.matrixWorld=new gh,this.matrixAutoUpdate=Vh.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Vh.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Ch,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Rh.setFromAxisAngle(e,t),this.quaternion.multiply(Rh),this}rotateOnWorldAxis(e,t){return Rh.setFromAxisAngle(e,t),this.quaternion.premultiply(Rh),this}rotateX(e){return this.rotateOnAxis(zh,e)}rotateY(e){return this.rotateOnAxis(Oh,e)}rotateZ(e){return this.rotateOnAxis(Uh,e)}translateOnAxis(e,t){return kh.copy(e).applyQuaternion(this.quaternion),this.position.add(kh.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(zh,e)}translateY(e){return this.translateOnAxis(Oh,e)}translateZ(e){return this.translateOnAxis(Uh,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Nh.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Ph.copy(e):Ph.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Ih.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Nh.lookAt(Ih,Ph,this.up):Nh.lookAt(Ph,Ih,this.up),this.quaternion.setFromRotationMatrix(Nh),r&&(Nh.extractRotation(r.matrixWorld),Rh.setFromRotationMatrix(Nh),this.quaternion.premultiply(Rh.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Fh),jh.child=e,this.dispatchEvent(jh),jh.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Bh),Hh.child=e,this.dispatchEvent(Hh),Hh.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Nh.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Nh.multiply(e.parent.matrixWorld)),e.applyMatrix4(Nh),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Fh),jh.child=e,this.dispatchEvent(jh),jh.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let i=0,a=r.length;i<a;i++)r[i].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ih,e,Lh),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ih,Dh,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(e=>({...e,boundingBox:e.boundingBox?e.boundingBox.toJSON():void 0,boundingSphere:e.boundingSphere?e.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(e=>({...e})),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),null!==this._colorsTexture&&(r.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(r.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(r.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=a(e.geometries),r=a(e.materials),i=a(e.textures),o=a(e.images),s=a(e.shapes),l=a(e.skeletons),c=a(e.animations),u=a(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),o.length>0&&(n.images=o),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=r,n;function a(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}Vh.DEFAULT_UP=new hd(0,1,0),Vh.DEFAULT_MATRIX_AUTO_UPDATE=!0,Vh.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Gh=new hd,Wh=new hd,$h=new hd,Xh=new hd,qh=new hd,Yh=new hd,Zh=new hd,Kh=new hd,Jh=new hd,Qh=new hd,ef=new Ud,tf=new Ud,nf=new Ud;class rf{constructor(e=new hd,t=new hd,n=new hd){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Gh.subVectors(e,t),r.cross(Gh);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){Gh.subVectors(r,t),Wh.subVectors(n,t),$h.subVectors(e,t);const a=Gh.dot(Gh),o=Gh.dot(Wh),s=Gh.dot($h),l=Wh.dot(Wh),c=Wh.dot($h),u=a*l-o*o;if(0===u)return i.set(0,0,0),null;const d=1/u,h=(l*s-o*c)*d,f=(a*c-o*s)*d;return i.set(1-h-f,f,h)}static containsPoint(e,t,n,r){return null!==this.getBarycoord(e,t,n,r,Xh)&&Xh.x>=0&&Xh.y>=0&&Xh.x+Xh.y<=1}static getInterpolation(e,t,n,r,i,a,o,s){return null===this.getBarycoord(e,t,n,r,Xh)?(s.x=0,s.y=0,"z"in s&&(s.z=0),"w"in s&&(s.w=0),null):(s.setScalar(0),s.addScaledVector(i,Xh.x),s.addScaledVector(a,Xh.y),s.addScaledVector(o,Xh.z),s)}static getInterpolatedAttribute(e,t,n,r,i,a){return ef.setScalar(0),tf.setScalar(0),nf.setScalar(0),ef.fromBufferAttribute(e,t),tf.fromBufferAttribute(e,n),nf.fromBufferAttribute(e,r),a.setScalar(0),a.addScaledVector(ef,i.x),a.addScaledVector(tf,i.y),a.addScaledVector(nf,i.z),a}static isFrontFacing(e,t,n,r){return Gh.subVectors(n,t),Wh.subVectors(e,t),Gh.cross(Wh).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Gh.subVectors(this.c,this.b),Wh.subVectors(this.a,this.b),.5*Gh.cross(Wh).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return rf.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return rf.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,i){return rf.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return rf.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return rf.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let a,o;qh.subVectors(r,n),Yh.subVectors(i,n),Kh.subVectors(e,n);const s=qh.dot(Kh),l=Yh.dot(Kh);if(s<=0&&l<=0)return t.copy(n);Jh.subVectors(e,r);const c=qh.dot(Jh),u=Yh.dot(Jh);if(c>=0&&u<=c)return t.copy(r);const d=s*u-c*l;if(d<=0&&s>=0&&c<=0)return a=s/(s-c),t.copy(n).addScaledVector(qh,a);Qh.subVectors(e,i);const h=qh.dot(Qh),f=Yh.dot(Qh);if(f>=0&&h<=f)return t.copy(i);const p=h*l-s*f;if(p<=0&&l>=0&&f<=0)return o=l/(l-f),t.copy(n).addScaledVector(Yh,o);const m=c*f-h*u;if(m<=0&&u-c>=0&&h-f>=0)return Zh.subVectors(i,r),o=(u-c)/(u-c+(h-f)),t.copy(r).addScaledVector(Zh,o);const g=1/(m+p+d);return a=p*g,o=d*g,t.copy(n).addScaledVector(qh,a).addScaledVector(Yh,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const af={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},of={h:0,s:0,l:0},sf={h:0,s:0,l:0};function lf(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class cf{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Du){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Cd.colorSpaceToWorking(this,t),this}setRGB(e,t,n,r=Cd.workingColorSpace){return this.r=e,this.g=t,this.b=n,Cd.colorSpaceToWorking(this,r),this}setHSL(e,t,n,r=Cd.workingColorSpace){if(e=ad(e,1),t=id(t,0,1),n=id(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=lf(i,r,e+1/3),this.g=lf(i,r,e),this.b=lf(i,r,e-1/3)}return Cd.colorSpaceToWorking(this,r),this}setStyle(e,t=Du){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const a=r[1],o=r[2];switch(a){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const n=r[1],i=n.length;if(3===i)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===i)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Du){const n=af[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ad(e.r),this.g=Ad(e.g),this.b=Ad(e.b),this}copyLinearToSRGB(e){return this.r=kd(e.r),this.g=kd(e.g),this.b=kd(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Du){return Cd.workingToColorSpace(uf.copy(this),e),65536*Math.round(id(255*uf.r,0,255))+256*Math.round(id(255*uf.g,0,255))+Math.round(id(255*uf.b,0,255))}getHexString(e=Du){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Cd.workingColorSpace){Cd.workingToColorSpace(uf.copy(this),t);const n=uf.r,r=uf.g,i=uf.b,a=Math.max(n,r,i),o=Math.min(n,r,i);let s,l;const c=(o+a)/2;if(o===a)s=0,l=0;else{const e=a-o;switch(l=c<=.5?e/(a+o):e/(2-a-o),a){case n:s=(r-i)/e+(r<i?6:0);break;case r:s=(i-n)/e+2;break;case i:s=(n-r)/e+4}s/=6}return e.h=s,e.s=l,e.l=c,e}getRGB(e,t=Cd.workingColorSpace){return Cd.workingToColorSpace(uf.copy(this),t),e.r=uf.r,e.g=uf.g,e.b=uf.b,e}getStyle(e=Du){Cd.workingToColorSpace(uf.copy(this),e);const t=uf.r,n=uf.g,r=uf.b;return e!==Du?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(e,t,n){return this.getHSL(of),this.setHSL(of.h+e,of.s+t,of.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(of),e.getHSL(sf);const n=od(of.h,sf.h,t),r=od(of.s,sf.s,t),i=od(of.l,sf.l,t);return this.setHSL(n,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,i=e.elements;return this.r=i[0]*t+i[3]*n+i[6]*r,this.g=i[1]*t+i[4]*n+i[7]*r,this.b=i[2]*t+i[5]*n+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const uf=new cf;cf.NAMES=af;let df=0;class hf extends Ju{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:df++}),this.uuid=rd(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Gl,this.blendDst=Wl,this.blendEquation=Ol,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new cf(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Fu,this.stencilZFail=Fu,this.stencilZPass=Fu,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==Gl&&(n.blendSrc=this.blendSrc),this.blendDst!==Wl&&(n.blendDst=this.blendDst),this.blendEquation!==Ol&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Fu&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Fu&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Fu&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class ff extends hf{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new cf(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Th,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const pf=mf();function mf(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),i=new Uint32Array(512);for(let l=0;l<256;++l){const e=l-127;e<-27?(r[l]=0,r[256|l]=32768,i[l]=24,i[256|l]=24):e<-14?(r[l]=1024>>-e-14,r[256|l]=1024>>-e-14|32768,i[l]=-e-1,i[256|l]=-e-1):e<=15?(r[l]=e+15<<10,r[256|l]=e+15<<10|32768,i[l]=13,i[256|l]=13):e<128?(r[l]=31744,r[256|l]=64512,i[l]=24,i[256|l]=24):(r[l]=31744,r[256|l]=64512,i[l]=13,i[256|l]=13)}const a=new Uint32Array(2048),o=new Uint32Array(64),s=new Uint32Array(64);for(let l=1;l<1024;++l){let e=l<<13,t=0;for(;!(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,a[l]=e|t}for(let l=1024;l<2048;++l)a[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(s[l]=1024);return{floatView:t,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:a,exponentTable:o,offsetTable:s}}function gf(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=id(e,-65504,65504),pf.floatView[0]=e;const t=pf.uint32View[0],n=t>>23&511;return pf.baseTable[n]+((8388607&t)>>pf.shiftTable[n])}function vf(e){const t=e>>10;return pf.uint32View[0]=pf.mantissaTable[pf.offsetTable[t]+(1023&e)]+pf.exponentTable[t],pf.floatView[0]}class yf{static toHalfFloat(e){return gf(e)}static fromHalfFloat(e){return vf(e)}}const bf=new hd,xf=new ud;let _f=0;class wf{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:_f++}),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=qu,this.updateRanges=[],this.gpuType=Pc,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)xf.fromBufferAttribute(this,t),xf.applyMatrix3(e),this.setXY(t,xf.x,xf.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)bf.fromBufferAttribute(this,t),bf.applyMatrix3(e),this.setXYZ(t,bf.x,bf.y,bf.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)bf.fromBufferAttribute(this,t),bf.applyMatrix4(e),this.setXYZ(t,bf.x,bf.y,bf.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)bf.fromBufferAttribute(this,t),bf.applyNormalMatrix(e),this.setXYZ(t,bf.x,bf.y,bf.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)bf.fromBufferAttribute(this,t),bf.transformDirection(e),this.setXYZ(t,bf.x,bf.y,bf.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=sd(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=ld(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=sd(t,this.array)),t}setX(e,t){return this.normalized&&(t=ld(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=sd(t,this.array)),t}setY(e,t){return this.normalized&&(t=ld(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=sd(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ld(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=sd(t,this.array)),t}setW(e,t){return this.normalized&&(t=ld(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=ld(t,this.array),n=ld(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=ld(t,this.array),n=ld(n,this.array),r=ld(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=ld(t,this.array),n=ld(n,this.array),r=ld(r,this.array),i=ld(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==qu&&(e.usage=this.usage),e}}class Sf extends wf{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Mf extends wf{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Ef extends wf{constructor(e,t,n){super(new Float32Array(e),t,n)}}let Tf=0;const Cf=new gh,Af=new Vh,kf=new hd,Rf=new Vd,Nf=new Vd,Pf=new hd;class If extends Ju{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Tf++}),this.uuid=rd(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(vd(e)?Mf:Sf)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new md).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Cf.makeRotationFromQuaternion(e),this.applyMatrix4(Cf),this}rotateX(e){return Cf.makeRotationX(e),this.applyMatrix4(Cf),this}rotateY(e){return Cf.makeRotationY(e),this.applyMatrix4(Cf),this}rotateZ(e){return Cf.makeRotationZ(e),this.applyMatrix4(Cf),this}translate(e,t,n){return Cf.makeTranslation(e,t,n),this.applyMatrix4(Cf),this}scale(e,t,n){return Cf.makeScale(e,t,n),this.applyMatrix4(Cf),this}lookAt(e){return Af.lookAt(e),Af.updateMatrix(),this.applyMatrix4(Af.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(kf).negate(),this.translate(kf.x,kf.y,kf.z),this}setFromPoints(e){const t=this.getAttribute("position");if(void 0===t){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}this.setAttribute("position",new Ef(t,3))}else{const n=Math.min(e.length,t.count);for(let r=0;r<n;r++){const n=e[r];t.setXYZ(r,n.x,n.y,n.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Vd);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new hd(-1/0,-1/0,-1/0),new hd(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const e=t[n];Rf.setFromBufferAttribute(e),this.morphTargetsRelative?(Pf.addVectors(this.boundingBox.min,Rf.min),this.boundingBox.expandByPoint(Pf),Pf.addVectors(this.boundingBox.max,Rf.max),this.boundingBox.expandByPoint(Pf)):(this.boundingBox.expandByPoint(Rf.min),this.boundingBox.expandByPoint(Rf.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new sh);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new hd,1/0);if(e){const n=this.boundingSphere.center;if(Rf.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const n=t[e];Nf.setFromBufferAttribute(n),this.morphTargetsRelative?(Pf.addVectors(Rf.min,Nf.min),Rf.expandByPoint(Pf),Pf.addVectors(Rf.max,Nf.max),Rf.expandByPoint(Pf)):(Rf.expandByPoint(Nf.min),Rf.expandByPoint(Nf.max))}Rf.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)Pf.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(Pf));if(t)for(let i=0,a=t.length;i<a;i++){const a=t[i],o=this.morphTargetsRelative;for(let t=0,i=a.count;t<i;t++)Pf.fromBufferAttribute(a,t),o&&(kf.fromBufferAttribute(e,t),Pf.add(kf)),r=Math.max(r,n.distanceToSquared(Pf))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.position,r=t.normal,i=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new wf(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),o=[],s=[];for(let S=0;S<n.count;S++)o[S]=new hd,s[S]=new hd;const l=new hd,c=new hd,u=new hd,d=new ud,h=new ud,f=new ud,p=new hd,m=new hd;function g(e,t,r){l.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),u.fromBufferAttribute(n,r),d.fromBufferAttribute(i,e),h.fromBufferAttribute(i,t),f.fromBufferAttribute(i,r),c.sub(l),u.sub(l),h.sub(d),f.sub(d);const a=1/(h.x*f.y-f.x*h.y);isFinite(a)&&(p.copy(c).multiplyScalar(f.y).addScaledVector(u,-h.y).multiplyScalar(a),m.copy(u).multiplyScalar(h.x).addScaledVector(c,-f.x).multiplyScalar(a),o[e].add(p),o[t].add(p),o[r].add(p),s[e].add(m),s[t].add(m),s[r].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let S=0,M=v.length;S<M;++S){const t=v[S],n=t.start;for(let r=n,i=n+t.count;r<i;r+=3)g(e.getX(r+0),e.getX(r+1),e.getX(r+2))}const y=new hd,b=new hd,x=new hd,_=new hd;function w(e){x.fromBufferAttribute(r,e),_.copy(x);const t=o[e];y.copy(t),y.sub(x.multiplyScalar(x.dot(t))).normalize(),b.crossVectors(_,t);const n=b.dot(s[e])<0?-1:1;a.setXYZW(e,y.x,y.y,y.z,n)}for(let S=0,M=v.length;S<M;++S){const t=v[S],n=t.start;for(let r=n,i=n+t.count;r<i;r+=3)w(e.getX(r+0)),w(e.getX(r+1)),w(e.getX(r+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new wf(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new hd,i=new hd,a=new hd,o=new hd,s=new hd,l=new hd,c=new hd,u=new hd;if(e)for(let d=0,h=e.count;d<h;d+=3){const h=e.getX(d+0),f=e.getX(d+1),p=e.getX(d+2);r.fromBufferAttribute(t,h),i.fromBufferAttribute(t,f),a.fromBufferAttribute(t,p),c.subVectors(a,i),u.subVectors(r,i),c.cross(u),o.fromBufferAttribute(n,h),s.fromBufferAttribute(n,f),l.fromBufferAttribute(n,p),o.add(c),s.add(c),l.add(c),n.setXYZ(h,o.x,o.y,o.z),n.setXYZ(f,s.x,s.y,s.z),n.setXYZ(p,l.x,l.y,l.z)}else for(let e=0,d=t.count;e<d;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),c.subVectors(a,i),u.subVectors(r,i),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Pf.fromBufferAttribute(e,t),Pf.normalize(),e.setXYZ(t,Pf.x,Pf.y,Pf.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,a=new n.constructor(t.length*r);let o=0,s=0;for(let l=0,c=t.length;l<c;l++){o=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*r;for(let e=0;e<r;e++)a[s++]=n[o++]}return new wf(a,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new If,n=this.index.array,r=this.attributes;for(const o in r){const i=e(r[o],n);t.setAttribute(o,i)}const i=this.morphAttributes;for(const o in i){const r=[],a=i[o];for(let t=0,i=a.length;t<i;t++){const i=e(a[t],n);r.push(i)}t.morphAttributes[o]=r}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,s=a.length;o<s;o++){const e=a[o];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const s in n){const t=n[s];e.data.attributes[s]=t.toJSON(e.data)}const r={};let i=!1;for(const s in this.morphAttributes){const t=this.morphAttributes[s],n=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];n.push(i.toJSON(e.data))}n.length>0&&(r[s]=n,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere=o.toJSON()),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone());const r=e.attributes;for(const l in r){const e=r[l];this.setAttribute(l,e.clone(t))}const i=e.morphAttributes;for(const l in i){const e=[],n=i[l];for(let r=0,i=n.length;r<i;r++)e.push(n[r].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let l=0,c=a.length;l<c;l++){const e=a[l];this.addGroup(e.start,e.count,e.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Lf=new gh,Df=new mh,zf=new sh,Of=new hd,Uf=new hd,Ff=new hd,Bf=new hd,jf=new hd,Hf=new hd,Vf=new hd,Gf=new hd;class Wf extends Vh{constructor(e=new If,t=new ff){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const o=this.morphTargetInfluences;if(i&&o){Hf.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=o[n],s=i[n];0!==r&&(jf.fromBufferAttribute(s,e),a?Hf.addScaledVector(jf,r):Hf.addScaledVector(jf.sub(t),r))}t.add(Hf)}return t}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),zf.copy(n.boundingSphere),zf.applyMatrix4(i),Df.copy(e.ray).recast(e.near),!1===zf.containsPoint(Df.origin)){if(null===Df.intersectSphere(zf,Of))return;if(Df.origin.distanceToSquared(Of)>(e.far-e.near)**2)return}Lf.copy(i).invert(),Df.copy(e.ray).applyMatrix4(Lf),null!==n.boundingBox&&!1===Df.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,Df)}}_computeIntersections(e,t,n){let r;const i=this.geometry,a=this.material,o=i.index,s=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv1,u=i.attributes.normal,d=i.groups,h=i.drawRange;if(null!==o)if(Array.isArray(a))for(let f=0,p=d.length;f<p;f++){const i=d[f],s=a[i.materialIndex];for(let a=Math.max(i.start,h.start),d=Math.min(o.count,Math.min(i.start+i.count,h.start+h.count));a<d;a+=3)r=$f(this,s,e,n,l,c,u,o.getX(a),o.getX(a+1),o.getX(a+2)),r&&(r.faceIndex=Math.floor(a/3),r.face.materialIndex=i.materialIndex,t.push(r))}else for(let f=Math.max(0,h.start),p=Math.min(o.count,h.start+h.count);f<p;f+=3)r=$f(this,a,e,n,l,c,u,o.getX(f),o.getX(f+1),o.getX(f+2)),r&&(r.faceIndex=Math.floor(f/3),t.push(r));else if(void 0!==s)if(Array.isArray(a))for(let f=0,p=d.length;f<p;f++){const i=d[f],o=a[i.materialIndex];for(let a=Math.max(i.start,h.start),d=Math.min(s.count,Math.min(i.start+i.count,h.start+h.count));a<d;a+=3)r=$f(this,o,e,n,l,c,u,a,a+1,a+2),r&&(r.faceIndex=Math.floor(a/3),r.face.materialIndex=i.materialIndex,t.push(r))}else for(let f=Math.max(0,h.start),p=Math.min(s.count,h.start+h.count);f<p;f+=3)r=$f(this,a,e,n,l,c,u,f,f+1,f+2),r&&(r.faceIndex=Math.floor(f/3),t.push(r))}}function $f(e,t,n,r,i,a,o,s,l,c){e.getVertexPosition(s,Uf),e.getVertexPosition(l,Ff),e.getVertexPosition(c,Bf);const u=function(e,t,n,r,i,a,o,s){let l;if(l=1===t.side?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,0===t.side,s),null===l)return null;Gf.copy(s),Gf.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(Gf);return c<n.near||c>n.far?null:{distance:c,point:Gf.clone(),object:e}}(e,t,n,r,Uf,Ff,Bf,Vf);if(u){const e=new hd;rf.getBarycoord(Vf,Uf,Ff,Bf,e),i&&(u.uv=rf.getInterpolatedAttribute(i,s,l,c,e,new ud)),a&&(u.uv1=rf.getInterpolatedAttribute(a,s,l,c,e,new ud)),o&&(u.normal=rf.getInterpolatedAttribute(o,s,l,c,e,new hd),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const t={a:s,b:l,c:c,normal:new hd,materialIndex:0};rf.getNormal(Uf,Ff,Bf,t.normal),u.face=t,u.barycoord=e}return u}class Xf extends If{constructor(e=1,t=1,n=1,r=1,i=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a};const o=this;r=Math.floor(r),i=Math.floor(i),a=Math.floor(a);const s=[],l=[],c=[],u=[];let d=0,h=0;function f(e,t,n,r,i,a,f,p,m,g,v){const y=a/m,b=f/g,x=a/2,_=f/2,w=p/2,S=m+1,M=g+1;let E=0,T=0;const C=new hd;for(let o=0;o<M;o++){const a=o*b-_;for(let s=0;s<S;s++){const d=s*y-x;C[e]=d*r,C[t]=a*i,C[n]=w,l.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[n]=p>0?1:-1,c.push(C.x,C.y,C.z),u.push(s/m),u.push(1-o/g),E+=1}}for(let o=0;o<g;o++)for(let e=0;e<m;e++){const t=d+e+S*o,n=d+e+S*(o+1),r=d+(e+1)+S*(o+1),i=d+(e+1)+S*o;s.push(t,n,i),s.push(n,r,i),T+=6}o.addGroup(h,T,v),h+=T,d+=E}f("z","y","x",-1,-1,n,t,e,a,i,0),f("z","y","x",1,-1,n,t,-e,a,i,1),f("x","z","y",1,1,e,n,t,r,a,2),f("x","z","y",1,-1,e,n,-t,r,a,3),f("x","y","z",1,-1,e,t,n,r,i,4),f("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(s),this.setAttribute("position",new Ef(l,3)),this.setAttribute("normal",new Ef(c,3)),this.setAttribute("uv",new Ef(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xf(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function qf(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][r]=null):t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function Yf(e){const t={};for(let n=0;n<e.length;n++){const r=qf(e[n]);for(const e in r)t[e]=r[e]}return t}function Zf(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:Cd.workingColorSpace}const Kf={clone:qf,merge:Yf};class Jf extends hf{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=qf(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)!0===this.extensions[r]&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Qf extends Vh{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new gh,this.projectionMatrix=new gh,this.projectionMatrixInverse=new gh,this.coordinateSystem=Zu,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const ep=new hd,tp=new ud,np=new ud;class rp extends Qf{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*nd*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*td*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*nd*Math.atan(Math.tan(.5*td*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){ep.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(ep.x,ep.y).multiplyScalar(-e/ep.z),ep.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(ep.x,ep.y).multiplyScalar(-e/ep.z)}getViewSize(e,t){return this.getViewBounds(e,tp,np),t.subVectors(np,tp)}setViewOffset(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*td*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const a=this.view;if(null!==this.view&&this.view.enabled){const e=a.fullWidth,o=a.fullHeight;i+=a.offsetX*r/e,t-=a.offsetY*n/o,r*=a.width/e,n*=a.height/o}const o=this.filmOffset;0!==o&&(i+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const ip=-90;class ap extends Vh{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new rp(ip,1,e,t);r.layers=this.layers,this.add(r);const i=new rp(ip,1,e,t);i.layers=this.layers,this.add(i);const a=new rp(ip,1,e,t);a.layers=this.layers,this.add(a);const o=new rp(ip,1,e,t);o.layers=this.layers,this.add(o);const s=new rp(ip,1,e,t);s.layers=this.layers,this.add(s);const l=new rp(ip,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,i,a,o,s]=t;for(const l of t)this.remove(l);if(e===Zu)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),s.up.set(0,1,0),s.lookAt(0,0,-1);else{if(e!==Ku)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),s.up.set(0,-1,0),s.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,a,o,s,l,c]=this.children,u=e.getRenderTarget(),d=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;const p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,i),e.setRenderTarget(n,1,r),e.render(t,a),e.setRenderTarget(n,2,r),e.render(t,o),e.setRenderTarget(n,3,r),e.render(t,s),e.setRenderTarget(n,4,r),e.render(t,l),n.texture.generateMipmaps=p,e.setRenderTarget(n,5,r),e.render(t,c),e.setRenderTarget(u,d,h),e.xr.enabled=f,n.texture.needsPMREMUpdate=!0}}class op extends Od{constructor(e=[],t=301,n,r,i,a,o,s,l,c){super(e,t,n,r,i,a,o,s,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class sp extends Bd{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new op(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new Xf(5,5,5),o=new Jf({name:"CubemapFromEquirect",uniforms:qf(n),vertexShader:r,fragmentShader:i,side:1,blending:0});o.uniforms.tEquirect.value=t;const s=new Wf(a,o),l=t.minFilter;return t.minFilter===Ec&&(t.minFilter=Sc),new ap(1,10,this).update(e,s),t.minFilter=l,s.geometry.dispose(),s.material.dispose(),this}clear(e,t=!0,n=!0,r=!0){const i=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,r);e.setRenderTarget(i)}}class lp extends Vh{constructor(){super(),this.isGroup=!0,this.type="Group"}}const cp={type:"move"};class up{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new lp,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new lp,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new hd,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new hd),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new lp,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new hd,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new hd),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,a=null;const o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;for(const a of e.hand.values()){const e=t.getJointPose(a,n),r=this._getHandJoint(l,a);null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=e.radius),r.visible=null!==e}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],o=r.position.distanceTo(i.position),s=.02,c=.005;l.inputState.pinching&&o>s+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=s-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1));null!==o&&(r=t.getPose(e.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(cp)))}return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==i),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new lp;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class dp{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new cf(e),this.density=t}clone(){return new dp(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class hp{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new cf(e),this.near=t,this.far=n}clone(){return new hp(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class fp extends Vh{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Th,this.environmentIntensity=1,this.environmentRotation=new Th,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class pp{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=qu,this.updateRanges=[],this.version=0,this.uuid=rd()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=rd()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=rd()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const mp=new hd;class gp{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)mp.fromBufferAttribute(this,t),mp.applyMatrix4(e),this.setXYZ(t,mp.x,mp.y,mp.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)mp.fromBufferAttribute(this,t),mp.applyNormalMatrix(e),this.setXYZ(t,mp.x,mp.y,mp.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)mp.fromBufferAttribute(this,t),mp.transformDirection(e),this.setXYZ(t,mp.x,mp.y,mp.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=sd(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=ld(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=ld(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=ld(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=ld(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=ld(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=sd(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=sd(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=sd(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=sd(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=ld(t,this.array),n=ld(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=ld(t,this.array),n=ld(n,this.array),r=ld(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=ld(t,this.array),n=ld(n,this.array),r=ld(r,this.array),i=ld(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new wf(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new gp(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class vp extends hf{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new cf(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let yp;const bp=new hd,xp=new hd,_p=new hd,wp=new ud,Sp=new ud,Mp=new gh,Ep=new hd,Tp=new hd,Cp=new hd,Ap=new ud,kp=new ud,Rp=new ud;class Np extends Vh{constructor(e=new vp){if(super(),this.isSprite=!0,this.type="Sprite",void 0===yp){yp=new If;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new pp(e,5);yp.setIndex([0,1,2,0,2,3]),yp.setAttribute("position",new gp(t,3,0,!1)),yp.setAttribute("uv",new gp(t,2,3,!1))}this.geometry=yp,this.material=e,this.center=new ud(.5,.5),this.count=1}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),xp.setFromMatrixScale(this.matrixWorld),Mp.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),_p.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&xp.multiplyScalar(-_p.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const a=this.center;Pp(Ep.set(-.5,-.5,0),_p,a,xp,r,i),Pp(Tp.set(.5,-.5,0),_p,a,xp,r,i),Pp(Cp.set(.5,.5,0),_p,a,xp,r,i),Ap.set(0,0),kp.set(1,0),Rp.set(1,1);let o=e.ray.intersectTriangle(Ep,Tp,Cp,!1,bp);if(null===o&&(Pp(Tp.set(-.5,.5,0),_p,a,xp,r,i),kp.set(0,1),o=e.ray.intersectTriangle(Ep,Cp,Tp,!1,bp),null===o))return;const s=e.ray.origin.distanceTo(bp);s<e.near||s>e.far||t.push({distance:s,point:bp.clone(),uv:rf.getInterpolation(bp,Ep,Tp,Cp,Ap,kp,Rp,new ud),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Pp(e,t,n,r,i,a){wp.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(Sp.x=a*wp.x-i*wp.y,Sp.y=i*wp.x+a*wp.y):Sp.copy(wp),e.copy(t),e.x+=Sp.x,e.y+=Sp.y,e.applyMatrix4(Mp)}const Ip=new hd,Lp=new hd;class Dp extends Vh{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,r=t.length;n<r;n++){const e=t[n];this.addLevel(e.object.clone(),e.distance,e.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const r=this.levels;let i;for(i=0;i<r.length&&!(t<r[i].distance);i++);return r.splice(i,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const e=t.splice(n,1);return this.remove(e[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r;n++){let r=t[n].distance;if(t[n].object.visible&&(r-=r*t[n].hysteresis),e<r)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Ip.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Ip);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Ip.setFromMatrixPosition(e.matrixWorld),Lp.setFromMatrixPosition(this.matrixWorld);const n=Ip.distanceTo(Lp)/e.zoom;let r,i;for(t[0].object.visible=!0,r=1,i=t.length;r<i;r++){let e=t[r].distance;if(t[r].object.visible&&(e-=e*t[r].hysteresis),!(n>=e))break;t[r-1].object.visible=!1,t[r].object.visible=!0}for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let r=0,i=n.length;r<i;r++){const e=n[r];t.object.levels.push({object:e.object.uuid,distance:e.distance,hysteresis:e.hysteresis})}return t}}const zp=new hd,Op=new Ud,Up=new Ud,Fp=new hd,Bp=new gh,jp=new hd,Hp=new sh,Vp=new gh,Gp=new mh;class Wp extends Wf{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=cc,this.bindMatrix=new gh,this.bindMatrixInverse=new gh,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Vd),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,jp),this.boundingBox.expandByPoint(jp)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new sh),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,jp),this.boundingSphere.expandByPoint(jp)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,r=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),Hp.copy(this.boundingSphere),Hp.applyMatrix4(r),!1!==e.ray.intersectsSphere(Hp)&&(Vp.copy(r).invert(),Gp.copy(e.ray).applyMatrix4(Vp),null!==this.boundingBox&&!1===Gp.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,Gp)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ud,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===cc?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===uc?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,r=this.geometry;Op.fromBufferAttribute(r.attributes.skinIndex,e),Up.fromBufferAttribute(r.attributes.skinWeight,e),zp.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let i=0;i<4;i++){const e=Up.getComponent(i);if(0!==e){const r=Op.getComponent(i);Bp.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),t.addScaledVector(Fp.copy(zp).applyMatrix4(Bp),e)}}return t.applyMatrix4(this.bindMatrixInverse)}}class $p extends Vh{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Xp extends Od{constructor(e=null,t=1,n=1,r,i,a,o,s,l=1003,c=1003,u,d){super(null,a,o,s,l,c,r,i,u,d),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const qp=new gh,Yp=new gh;class Zp{constructor(e=[],t=[]){this.uuid=rd(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new gh)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new gh;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let i=0,a=e.length;i<a;i++){const r=e[i]?e[i].matrixWorld:Yp;qp.multiplyMatrices(r,t[i]),qp.toArray(n,16*i)}null!==r&&(r.needsUpdate=!0)}clone(){return new Zp(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Xp(t,e,e,jc,Pc);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const r=e.bones[n];let i=t[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new $p),this.bones.push(i),this.boneInverses.push((new gh).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const i=t[r];e.bones.push(i.uuid);const a=n[r];e.boneInverses.push(a.toArray())}return e}}class Kp extends wf{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Jp=new gh,Qp=new gh,em=[],tm=new Vd,nm=new gh,rm=new Wf,im=new sh;class am extends Wf{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Kp(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<n;r++)this.setMatrixAt(r,nm)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Vd),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Jp),tm.copy(e.boundingBox).applyMatrix4(Jp),this.boundingBox.union(tm)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new sh),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Jp),im.copy(e.boundingSphere).applyMatrix4(Jp),this.boundingSphere.union(im)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const n=t.morphTargetInfluences,r=this.morphTexture.source.data.data,i=e*(n.length+1)+1;for(let a=0;a<n.length;a++)n[a]=r[i+a]}raycast(e,t){const n=this.matrixWorld,r=this.count;if(rm.geometry=this.geometry,rm.material=this.material,void 0!==rm.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),im.copy(this.boundingSphere),im.applyMatrix4(n),!1!==e.ray.intersectsSphere(im)))for(let i=0;i<r;i++){this.getMatrixAt(i,Jp),Qp.multiplyMatrices(n,Jp),rm.matrixWorld=Qp,rm.raycast(e,em);for(let e=0,n=em.length;e<n;e++){const n=em[e];n.instanceId=i,n.object=this,t.push(n)}em.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Kp(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const n=t.morphTargetInfluences,r=n.length+1;null===this.morphTexture&&(this.morphTexture=new Xp(new Float32Array(r*this.count),r,this.count,Gc,Pc));const i=this.morphTexture.source.data.data;let a=0;for(let l=0;l<n.length;l++)a+=n[l];const o=this.geometry.morphTargetsRelative?1:1-a,s=r*e;i[s]=o,i.set(n,s+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null)}}const om=new hd,sm=new hd,lm=new md;let cm=class{constructor(e=new hd(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=om.subVectors(n,t).cross(sm.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(om),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||lm.getNormalMatrix(e),r=this.coplanarPoint(om).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}};const um=new sh,dm=new ud(.5,.5),hm=new hd;class fm{constructor(e=new cm,t=new cm,n=new cm,r=new cm,i=new cm,a=new cm){this.planes=[e,t,n,r,i,a]}set(e,t,n,r,i,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3,n=!1){const r=this.planes,i=e.elements,a=i[0],o=i[1],s=i[2],l=i[3],c=i[4],u=i[5],d=i[6],h=i[7],f=i[8],p=i[9],m=i[10],g=i[11],v=i[12],y=i[13],b=i[14],x=i[15];if(r[0].setComponents(l-a,h-c,g-f,x-v).normalize(),r[1].setComponents(l+a,h+c,g+f,x+v).normalize(),r[2].setComponents(l+o,h+u,g+p,x+y).normalize(),r[3].setComponents(l-o,h-u,g-p,x-y).normalize(),n)r[4].setComponents(s,d,m,b).normalize(),r[5].setComponents(l-s,h-d,g-m,x-b).normalize();else if(r[4].setComponents(l-s,h-d,g-m,x-b).normalize(),t===Zu)r[5].setComponents(l+s,h+d,g+m,x+b).normalize();else{if(t!==Ku)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);r[5].setComponents(s,d,m,b).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),um.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),um.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(um)}intersectsSprite(e){um.center.set(0,0,0);const t=dm.distanceTo(e.center);return um.radius=.7071067811865476+t,um.applyMatrix4(e.matrixWorld),this.intersectsSphere(um)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let i=0;i<6;i++)if(t[i].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(hm.x=r.normal.x>0?e.max.x:e.min.x,hm.y=r.normal.y>0?e.max.y:e.min.y,hm.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(hm)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const pm=new gh,mm=new fm;class gm{constructor(){this.coordinateSystem=Zu}intersectsObject(e,t){if(!t.isArrayCamera||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(pm.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),mm.setFromProjectionMatrix(pm,r.coordinateSystem,r.reversedDepth),mm.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(pm.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),mm.setFromProjectionMatrix(pm,r.coordinateSystem,r.reversedDepth),mm.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(pm.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),mm.setFromProjectionMatrix(pm,r.coordinateSystem,r.reversedDepth),mm.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(pm.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),mm.setFromProjectionMatrix(pm,r.coordinateSystem,r.reversedDepth),mm.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||0===t.cameras.length)return!1;for(let n=0;n<t.cameras.length;n++){const r=t.cameras[n];if(pm.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),mm.setFromProjectionMatrix(pm,r.coordinateSystem,r.reversedDepth),mm.containsPoint(e))return!0}return!1}clone(){return new gm}}function vm(e,t){return e-t}function ym(e,t){return e.z-t.z}function bm(e,t){return t.z-e.z}class xm{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,r){const i=this.pool,a=this.list;this.index>=i.length&&i.push({start:-1,count:-1,z:-1,index:-1});const o=i[this.index];a.push(o),this.index++,o.start=e,o.count=t,o.z=n,o.index=r}reset(){this.list.length=0,this.index=0}}const _m=new gh,wm=new cf(1,1,1),Sm=new fm,Mm=new gm,Em=new Vd,Tm=new sh,Cm=new hd,Am=new hd,km=new hd,Rm=new xm,Nm=new Wf,Pm=[];function Im(e,t,n=0){const r=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const i=e.count;for(let a=0;a<i;a++)for(let i=0;i<r;i++)t.setComponent(a+n,i,e.getComponent(a,i))}else t.array.set(e.array,n*r);t.needsUpdate=!0}function Lm(e,t){if(e.constructor!==t.constructor){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++)t[r]=e[r]}else{const n=Math.min(e.length,t.length);t.set(new e.constructor(e.buffer,0,n))}}class Dm extends Wf{constructor(e,t,n=2*t,r){super(new If,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(4*this._maxInstanceCount);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new Xp(t,e,e,jc,Pc);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new Xp(t,e,e,Wc,Nc);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new Xp(t,e,e,jc,Pc);n.colorSpace=Cd.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,r=this._maxIndexCount;if(!1===this._geometryInitialized){for(const r in e.attributes){const i=e.getAttribute(r),{array:a,itemSize:o,normalized:s}=i,l=new a.constructor(n*o),c=new wf(l,o,s);t.setAttribute(r,c)}if(null!==e.getIndex()){const e=n>65535?new Uint32Array(r):new Uint16Array(r);t.setIndex(new wf(e,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(Boolean(e.getIndex())!==Boolean(t.getIndex()))throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const r=e.getAttribute(n),i=t.getAttribute(n);if(r.itemSize!==i.itemSize||r.normalized!==i.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Vd);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,r=t.length;n<r;n++){if(!1===t[n].active)continue;const r=t[n].geometryIndex;this.getMatrixAt(n,_m),this.getBoundingBoxAt(r,Em).applyMatrix4(_m),e.union(Em)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new sh);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,r=t.length;n<r;n++){if(!1===t[n].active)continue;const r=t[n].geometryIndex;this.getMatrixAt(n,_m),this.getBoundingSphereAt(r,Tm).applyMatrix4(_m),e.union(Tm)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const t={visible:!0,active:!0,geometryIndex:e};let n=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(vm),n=this._availableInstanceIds.shift(),this._instanceInfo[n]=t):(n=this._instanceInfo.length,this._instanceInfo.push(t));const r=this._matricesTexture;_m.identity().toArray(r.image.data,16*n),r.needsUpdate=!0;const i=this._colorsTexture;return i&&(wm.toArray(i.image.data,4*n),i.needsUpdate=!0),this._visibilityChanged=!0,n}addGeometry(e,t=-1,n=-1){this._initializeGeometry(e),this._validateGeometry(e);const r={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},i=this._geometryInfo;r.vertexStart=this._nextVertexStart,r.reservedVertexCount=-1===t?e.getAttribute("position").count:t;const a=e.getIndex();if(null!==a&&(r.indexStart=this._nextIndexStart,r.reservedIndexCount=-1===n?a.count:n),-1!==r.indexStart&&r.indexStart+r.reservedIndexCount>this._maxIndexCount||r.vertexStart+r.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let o;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(vm),o=this._availableGeometryIds.shift(),i[o]=r):(o=this._geometryCount,this._geometryCount++,i.push(r)),this.setGeometryAt(o,e),this._nextIndexStart=r.indexStart+r.reservedIndexCount,this._nextVertexStart=r.vertexStart+r.reservedVertexCount,o}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,r=null!==n.getIndex(),i=n.getIndex(),a=t.getIndex(),o=this._geometryInfo[e];if(r&&a.count>o.reservedIndexCount||t.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const s=o.vertexStart,l=o.reservedVertexCount;o.vertexCount=t.getAttribute("position").count;for(const c in n.attributes){const e=t.getAttribute(c),r=n.getAttribute(c);Im(e,r,s);const i=e.itemSize;for(let t=e.count,n=l;t<n;t++){const e=s+t;for(let t=0;t<i;t++)r.setComponent(e,t,0)}r.needsUpdate=!0,r.addUpdateRange(s*i,l*i)}if(r){const e=o.indexStart,n=o.reservedIndexCount;o.indexCount=t.getIndex().count;for(let t=0;t<a.count;t++)i.setX(e+t,s+a.getX(t));for(let t=a.count,r=n;t<r;t++)i.setX(e+t,s);i.needsUpdate=!0,i.addUpdateRange(e,o.reservedIndexCount)}return o.start=r?o.indexStart:o.vertexStart,o.count=r?o.indexCount:o.vertexCount,o.boundingBox=null,null!==t.boundingBox&&(o.boundingBox=t.boundingBox.clone()),o.boundingSphere=null,null!==t.boundingSphere&&(o.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||!1===t[e].active)return this;const n=this._instanceInfo;for(let r=0,i=n.length;r<i;r++)n[r].active&&n[r].geometryIndex===e&&this.deleteInstance(r);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,r=n.map((e,t)=>t).sort((e,t)=>n[e].vertexStart-n[t].vertexStart),i=this.geometry;for(let a=0,o=n.length;a<o;a++){const o=r[a],s=n[o];if(!1!==s.active){if(null!==i.index){if(s.indexStart!==t){const{indexStart:n,vertexStart:r,reservedIndexCount:a}=s,o=i.index,l=o.array,c=e-r;for(let e=n;e<n+a;e++)l[e]=l[e]+c;o.array.copyWithin(t,n,n+a),o.addUpdateRange(t,a),s.indexStart=t}t+=s.reservedIndexCount}if(s.vertexStart!==e){const{vertexStart:t,reservedVertexCount:n}=s,r=i.attributes;for(const i in r){const a=r[i],{array:o,itemSize:s}=a;o.copyWithin(e*s,t*s,(t+n)*s),a.addUpdateRange(e*s,n*s)}s.vertexStart=e}e+=s.reservedVertexCount,s.start=i.index?s.indexStart:s.vertexStart,this._nextIndexStart=i.index?s.indexStart+s.reservedIndexCount:0,this._nextVertexStart=s.vertexStart+s.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[e];if(null===r.boundingBox){const e=new Vd,t=n.index,i=n.attributes.position;for(let n=r.start,a=r.start+r.count;n<a;n++){let r=n;t&&(r=t.getX(r)),e.expandByPoint(Cm.fromBufferAttribute(i,r))}r.boundingBox=e}return t.copy(r.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[e];if(null===r.boundingSphere){const t=new sh;this.getBoundingBoxAt(e,Em),Em.getCenter(t.center);const i=n.index,a=n.attributes.position;let o=0;for(let e=r.start,n=r.start+r.count;e<n;e++){let n=e;i&&(n=i.getX(n)),Cm.fromBufferAttribute(a,n),o=Math.max(o,t.center.distanceToSquared(Cm))}t.radius=Math.sqrt(o),r.boundingSphere=t}return t.copy(r.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,r=this._matricesTexture.image.data;return t.toArray(r,16*e),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,16*e)}setColorAt(e,t){return this.validateInstanceId(e),null===this._colorsTexture&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,4*e),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,4*e)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t||(this._instanceInfo[e].visible=t,this._visibilityChanged=!0),this}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(vm);t[t.length-1]===n.length-1;)n.pop(),t.pop();if(e<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const r=new Int32Array(e),i=new Int32Array(e);Lm(this._multiDrawCounts,r),Lm(this._multiDrawStarts,i),this._multiDrawCounts=r,this._multiDrawStarts=i,this._maxInstanceCount=e;const a=this._indirectTexture,o=this._matricesTexture,s=this._colorsTexture;a.dispose(),this._initIndirectTexture(),Lm(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),Lm(o.image.data,this._matricesTexture.image.data),s&&(s.dispose(),this._initColorsTexture(),Lm(s.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter(e=>e.active);if(Math.max(...n.map(e=>e.vertexStart+e.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...n.map(e=>e.indexStart+e.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const r=this.geometry;r.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new If,this._initializeGeometry(r));const i=this.geometry;r.index&&Lm(r.index.array,i.index.array);for(const a in r.attributes)Lm(r.attributes[a].array,i.attributes[a].array)}raycast(e,t){const n=this._instanceInfo,r=this._geometryInfo,i=this.matrixWorld,a=this.geometry;Nm.material=this.material,Nm.geometry.index=a.index,Nm.geometry.attributes=a.attributes,null===Nm.geometry.boundingBox&&(Nm.geometry.boundingBox=new Vd),null===Nm.geometry.boundingSphere&&(Nm.geometry.boundingSphere=new sh);for(let o=0,s=n.length;o<s;o++){if(!n[o].visible||!n[o].active)continue;const a=n[o].geometryIndex,s=r[a];Nm.geometry.setDrawRange(s.start,s.count),this.getMatrixAt(o,Nm.matrixWorld).premultiply(i),this.getBoundingBoxAt(a,Nm.geometry.boundingBox),this.getBoundingSphereAt(a,Nm.geometry.boundingSphere),Nm.raycast(e,Pm);for(let e=0,n=Pm.length;e<n;e++){const n=Pm[e];n.object=this,n.batchId=o,t.push(n)}Pm.length=0}Nm.material=null,Nm.geometry.index=null,Nm.geometry.attributes={},Nm.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(e=>({...e,boundingBox:null!==e.boundingBox?e.boundingBox.clone():null,boundingSphere:null!==e.boundingSphere?e.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(e=>({...e})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,n,r,i){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=r.getIndex(),o=null===a?1:a.array.BYTES_PER_ELEMENT,s=this._instanceInfo,l=this._multiDrawStarts,c=this._multiDrawCounts,u=this._geometryInfo,d=this.perObjectFrustumCulled,h=this._indirectTexture,f=h.image.data,p=n.isArrayCamera?Mm:Sm;d&&!n.isArrayCamera&&(_m.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),Sm.setFromProjectionMatrix(_m,n.coordinateSystem,n.reversedDepth));let m=0;if(this.sortObjects){_m.copy(this.matrixWorld).invert(),Cm.setFromMatrixPosition(n.matrixWorld).applyMatrix4(_m),Am.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(_m);for(let r=0,i=s.length;r<i;r++)if(s[r].visible&&s[r].active){const e=s[r].geometryIndex;this.getMatrixAt(r,_m),this.getBoundingSphereAt(e,Tm).applyMatrix4(_m);let t=!1;if(d&&(t=!p.intersectsSphere(Tm,n)),!t){const t=u[e],n=km.subVectors(Tm.center,Cm).dot(Am);Rm.push(t.start,t.count,n,r)}}const e=Rm.list,t=this.customSort;null===t?e.sort(i.transparent?bm:ym):t.call(this,e,n);for(let n=0,r=e.length;n<r;n++){const t=e[n];l[m]=t.start*o,c[m]=t.count,f[m]=t.index,m++}Rm.reset()}else for(let g=0,v=s.length;g<v;g++)if(s[g].visible&&s[g].active){const e=s[g].geometryIndex;let t=!1;if(d&&(this.getMatrixAt(g,_m),this.getBoundingSphereAt(e,Tm).applyMatrix4(_m),t=!p.intersectsSphere(Tm,n)),!t){const t=u[e];l[m]=t.start*o,c[m]=t.count,f[m]=g,m++}}h.needsUpdate=!0,this._multiDrawCount=m,this._visibilityChanged=!1}onBeforeShadow(e,t,n,r,i,a){this.onBeforeRender(e,null,r,i,a)}}class zm extends hf{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new cf(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Om=new hd,Um=new hd,Fm=new gh,Bm=new mh,jm=new sh,Hm=new hd,Vm=new hd;class Gm extends Vh{constructor(e=new If,t=new zm){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)Om.fromBufferAttribute(t,e-1),Um.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Om.distanceTo(Um);e.setAttribute("lineDistance",new Ef(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),jm.copy(n.boundingSphere),jm.applyMatrix4(r),jm.radius+=i,!1===e.ray.intersectsSphere(jm))return;Fm.copy(r).invert(),Bm.copy(e.ray).applyMatrix4(Fm);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=this.isLineSegments?2:1,c=n.index,u=n.attributes.position;if(null!==c){const n=Math.max(0,a.start),r=Math.min(c.count,a.start+a.count);for(let i=n,a=r-1;i<a;i+=l){const n=c.getX(i),r=c.getX(i+1),a=Wm(this,e,Bm,s,n,r,i);a&&t.push(a)}if(this.isLineLoop){const i=c.getX(r-1),a=c.getX(n),o=Wm(this,e,Bm,s,i,a,r-1);o&&t.push(o)}}else{const n=Math.max(0,a.start),r=Math.min(u.count,a.start+a.count);for(let i=n,a=r-1;i<a;i+=l){const n=Wm(this,e,Bm,s,i,i+1,i);n&&t.push(n)}if(this.isLineLoop){const i=Wm(this,e,Bm,s,r-1,n,r-1);i&&t.push(i)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Wm(e,t,n,r,i,a,o){const s=e.geometry.attributes.position;if(Om.fromBufferAttribute(s,i),Um.fromBufferAttribute(s,a),n.distanceSqToSegment(Om,Um,Hm,Vm)>r)return;Hm.applyMatrix4(e.matrixWorld);const l=t.ray.origin.distanceTo(Hm);return l<t.near||l>t.far?void 0:{distance:l,point:Vm.clone().applyMatrix4(e.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:e}}const $m=new hd,Xm=new hd;class qm extends Gm{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)$m.fromBufferAttribute(t,e),Xm.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+$m.distanceTo(Xm);e.setAttribute("lineDistance",new Ef(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Ym extends Gm{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Zm extends hf{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new cf(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Km=new gh,Jm=new mh,Qm=new sh,eg=new hd;class tg extends Vh{constructor(e=new If,t=new Zm){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Qm.copy(n.boundingSphere),Qm.applyMatrix4(r),Qm.radius+=i,!1===e.ray.intersectsSphere(Qm))return;Km.copy(r).invert(),Jm.copy(e.ray).applyMatrix4(Km);const o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=n.index,c=n.attributes.position;if(null!==l)for(let u=Math.max(0,a.start),d=Math.min(l.count,a.start+a.count);u<d;u++){const n=l.getX(u);eg.fromBufferAttribute(c,n),ng(eg,n,s,r,e,t,this)}else for(let u=Math.max(0,a.start),d=Math.min(c.count,a.start+a.count);u<d;u++)eg.fromBufferAttribute(c,u),ng(eg,u,s,r,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function ng(e,t,n,r,i,a,o){const s=Jm.distanceSqToPoint(e);if(s<n){const n=new hd;Jm.closestPointToPoint(e,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,faceIndex:null,barycoord:null,object:o})}}class rg extends Od{constructor(e,t,n,r,i=1006,a=1006,o,s,l){super(e,t,n,r,i,a,o,s,l),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const c=this;"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(function t(){c.needsUpdate=!0,c._requestVideoFrameCallbackId=e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){0!==this._requestVideoFrameCallbackId&&this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),super.dispose()}}class ig extends Od{constructor(e,t,n,r,i,a,o,s,l,c,u,d){super(null,a,o,s,l,c,r,i,u,d),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class ag extends Od{constructor(e,t,n=1014,r,i,a,o=1003,s=1003,l,c=1026,u=1){if(c!==Hc&&c!==Vc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:e,height:t,depth:u},r,i,a,o,s,c,n,l),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Id(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class og extends Od{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class sg extends If{constructor(e=1,t=1,n=4,r=8,i=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:r,heightSegments:i},t=Math.max(0,t),n=Math.max(1,Math.floor(n)),r=Math.max(3,Math.floor(r)),i=Math.max(1,Math.floor(i));const a=[],o=[],s=[],l=[],c=t/2,u=Math.PI/2*e,d=t,h=2*u+d,f=2*n+i,p=r+1,m=new hd,g=new hd;for(let v=0;v<=f;v++){let y=0,b=0,x=0,_=0;if(v<=n){const t=v/n,r=t*Math.PI/2;b=-c-e*Math.cos(r),x=e*Math.sin(r),_=-e*Math.cos(r),y=t*u}else if(v<=n+i){const r=(v-n)/i;b=r*t-c,x=e,_=0,y=u+r*d}else{const t=(v-n-i)/n,r=t*Math.PI/2;b=c+e*Math.sin(r),x=e*Math.cos(r),_=e*Math.sin(r),y=u+d+t*u}const w=Math.max(0,Math.min(1,y/h));let S=0;0===v?S=.5/r:v===f&&(S=-.5/r);for(let e=0;e<=r;e++){const t=e/r,n=t*Math.PI*2,i=Math.sin(n),a=Math.cos(n);g.x=-x*a,g.y=b,g.z=x*i,o.push(g.x,g.y,g.z),m.set(-x*a,_,x*i),m.normalize(),s.push(m.x,m.y,m.z),l.push(t+S,w)}if(v>0){const e=(v-1)*p;for(let t=0;t<r;t++){const n=e+t,r=e+t+1,i=v*p+t,o=v*p+t+1;a.push(n,r,i),a.push(r,o,i)}}}this.setIndex(a),this.setAttribute("position",new Ef(o,3)),this.setAttribute("normal",new Ef(s,3)),this.setAttribute("uv",new Ef(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sg(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class lg extends If{constructor(e=1,t=32,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const i=[],a=[],o=[],s=[],l=new hd,c=new ud;a.push(0,0,0),o.push(0,0,1),s.push(.5,.5);for(let u=0,d=3;u<=t;u++,d+=3){const i=n+u/t*r;l.x=e*Math.cos(i),l.y=e*Math.sin(i),a.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(a[d]/e+1)/2,c.y=(a[d+1]/e+1)/2,s.push(c.x,c.y)}for(let u=1;u<=t;u++)i.push(u,u+1,0);this.setIndex(i),this.setAttribute("position",new Ef(a,3)),this.setAttribute("normal",new Ef(o,3)),this.setAttribute("uv",new Ef(s,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new lg(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class cg extends If{constructor(e=1,t=1,n=1,r=32,i=1,a=!1,o=0,s=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s};const l=this;r=Math.floor(r),i=Math.floor(i);const c=[],u=[],d=[],h=[];let f=0;const p=[],m=n/2;let g=0;function v(n){const i=f,a=new ud,p=new hd;let v=0;const y=!0===n?e:t,b=!0===n?1:-1;for(let e=1;e<=r;e++)u.push(0,m*b,0),d.push(0,b,0),h.push(.5,.5),f++;const x=f;for(let e=0;e<=r;e++){const t=e/r*s+o,n=Math.cos(t),i=Math.sin(t);p.x=y*i,p.y=m*b,p.z=y*n,u.push(p.x,p.y,p.z),d.push(0,b,0),a.x=.5*n+.5,a.y=.5*i*b+.5,h.push(a.x,a.y),f++}for(let e=0;e<r;e++){const t=i+e,r=x+e;!0===n?c.push(r,r+1,t):c.push(r+1,r,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const a=new hd,v=new hd;let y=0;const b=(t-e)/n;for(let l=0;l<=i;l++){const c=[],g=l/i,y=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*s+o,l=Math.sin(i),p=Math.cos(i);v.x=y*l,v.y=-g*n+m,v.z=y*p,u.push(v.x,v.y,v.z),a.set(l,b,p).normalize(),d.push(a.x,a.y,a.z),h.push(t,1-g),c.push(f++)}p.push(c)}for(let n=0;n<r;n++)for(let r=0;r<i;r++){const a=p[r][n],o=p[r+1][n],s=p[r+1][n+1],l=p[r][n+1];(e>0||0!==r)&&(c.push(a,o,l),y+=3),(t>0||r!==i-1)&&(c.push(o,s,l),y+=3)}l.addGroup(g,y,0),g+=y}(),!1===a&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new Ef(u,3)),this.setAttribute("normal",new Ef(d,3)),this.setAttribute("uv",new Ef(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cg(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ug extends cg{constructor(e=1,t=1,n=32,r=1,i=!1,a=0,o=2*Math.PI){super(0,e,t,n,r,i,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:a,thetaLength:o}}static fromJSON(e){return new ug(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class dg extends If{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const i=[],a=[];function o(e,t,n,r){const i=r+1,a=[];for(let o=0;o<=i;o++){a[o]=[];const r=e.clone().lerp(n,o/i),s=t.clone().lerp(n,o/i),l=i-o;for(let e=0;e<=l;e++)a[o][e]=0===e&&o===i?r:r.clone().lerp(s,e/l)}for(let o=0;o<i;o++)for(let e=0;e<2*(i-o)-1;e++){const t=Math.floor(e/2);e%2==0?(s(a[o][t+1]),s(a[o+1][t]),s(a[o][t])):(s(a[o][t+1]),s(a[o+1][t+1]),s(a[o+1][t]))}}function s(e){i.push(e.x,e.y,e.z)}function l(t,n){const r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function c(e,t,n,r){r<0&&1===e.x&&(a[t]=e.x-1),0===n.x&&0===n.z&&(a[t]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}function d(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){const n=new hd,r=new hd,i=new hd;for(let a=0;a<t.length;a+=3)l(t[a+0],n),l(t[a+1],r),l(t[a+2],i),o(n,r,i,e)}(r),function(e){const t=new hd;for(let n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){const e=new hd;for(let t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];const n=u(e)/2/Math.PI+.5,r=d(e)/Math.PI+.5;a.push(n,1-r)}(function(){const e=new hd,t=new hd,n=new hd,r=new hd,o=new ud,s=new ud,l=new ud;for(let d=0,h=0;d<i.length;d+=9,h+=6){e.set(i[d+0],i[d+1],i[d+2]),t.set(i[d+3],i[d+4],i[d+5]),n.set(i[d+6],i[d+7],i[d+8]),o.set(a[h+0],a[h+1]),s.set(a[h+2],a[h+3]),l.set(a[h+4],a[h+5]),r.copy(e).add(t).add(n).divideScalar(3);const f=u(r);c(o,h+0,e,f),c(s,h+2,t,f),c(l,h+4,n,f)}})(),function(){for(let e=0;e<a.length;e+=6){const t=a[e+0],n=a[e+2],r=a[e+4],i=Math.max(t,n,r),o=Math.min(t,n,r);i>.9&&o<.1&&(t<.2&&(a[e+0]+=1),n<.2&&(a[e+2]+=1),r<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new Ef(i,3)),this.setAttribute("normal",new Ef(i.slice(),3)),this.setAttribute("uv",new Ef(a,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new dg(e.vertices,e.indices,e.radius,e.details)}}class hg extends dg{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new hg(e.radius,e.detail)}}const fg=new hd,pg=new hd,mg=new hd,gg=new rf;class vg extends If{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,r=Math.pow(10,n),i=Math.cos(td*t),a=e.getIndex(),o=e.getAttribute("position"),s=a?a.count:o.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),d={},h=[];for(let e=0;e<s;e+=3){a?(l[0]=a.getX(e),l[1]=a.getX(e+1),l[2]=a.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:s}=gg;if(t.fromBufferAttribute(o,l[0]),n.fromBufferAttribute(o,l[1]),s.fromBufferAttribute(o,l[2]),gg.getNormal(mg),u[0]=`${Math.round(t.x*r)},${Math.round(t.y*r)},${Math.round(t.z*r)}`,u[1]=`${Math.round(n.x*r)},${Math.round(n.y*r)},${Math.round(n.z*r)}`,u[2]=`${Math.round(s.x*r)},${Math.round(s.y*r)},${Math.round(s.z*r)}`,u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=u[e],r=u[t],a=gg[c[e]],o=gg[c[t]],s=`${n}_${r}`,f=`${r}_${n}`;f in d&&d[f]?(mg.dot(d[f].normal)<=i&&(h.push(a.x,a.y,a.z),h.push(o.x,o.y,o.z)),d[f]=null):s in d||(d[s]={index0:l[e],index1:l[t],normal:mg.clone()})}}for(const e in d)if(d[e]){const{index0:t,index1:n}=d[e];fg.fromBufferAttribute(o,t),pg.fromBufferAttribute(o,n),h.push(fg.x,fg.y,fg.z),h.push(pg.x,pg.y,pg.z)}this.setAttribute("position",new Ef(h,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class yg{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let r=0;const i=n.length;let a;a=t||e*n[i-1];let o,s=0,l=i-1;for(;s<=l;)if(r=Math.floor(s+(l-s)/2),o=n[r]-a,o<0)s=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(r=l,n[r]===a)return r/(i-1);const c=n[r];return(r+(a-c)/(n[r+1]-c))/(i-1)}getTangent(e,t){const n=1e-4;let r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);const a=this.getPoint(r),o=this.getPoint(i),s=t||(a.isVector2?new ud:new hd);return s.copy(o).sub(a).normalize(),s}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new hd,r=[],i=[],a=[],o=new hd,s=new gh;for(let h=0;h<=e;h++){const t=h/e;r[h]=this.getTangentAt(t,new hd)}i[0]=new hd,a[0]=new hd;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),d=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),d<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),a[0].crossVectors(r[0],i[0]);for(let h=1;h<=e;h++){if(i[h]=i[h-1].clone(),a[h]=a[h-1].clone(),o.crossVectors(r[h-1],r[h]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(id(r[h-1].dot(r[h]),-1,1));i[h].applyMatrix4(s.makeRotationAxis(o,e))}a[h].crossVectors(r[h],i[h])}if(!0===t){let t=Math.acos(id(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(o.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(s.makeRotationAxis(r[n],t*n)),a[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class bg extends yg{constructor(e=0,t=0,n=1,r=1,i=0,a=2*Math.PI,o=!1,s=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=a,this.aClockwise=o,this.aRotation=s}getPoint(e,t=new ud){const n=t,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const a=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=a?0:r),!0!==this.aClockwise||a||(i===r?i=-r:i-=r);const o=this.aStartAngle+e*i;let s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=s-this.aX,r=l-this.aY;s=n*e-r*t+this.aX,l=n*t+r*e+this.aY}return n.set(s,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class xg extends bg{constructor(e,t,n,r,i,a){super(e,t,n,n,r,i,a),this.isArcCurve=!0,this.type="ArcCurve"}}function _g(){let e=0,t=0,n=0,r=0;function i(i,a,o,s){e=i,t=o,n=-3*i+3*a-2*o-s,r=2*i-2*a+o+s}return{initCatmullRom:function(e,t,n,r,a){i(t,n,a*(n-e),a*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,a,o,s){let l=(t-e)/a-(n-e)/(a+o)+(n-t)/o,c=(n-t)/o-(r-t)/(o+s)+(r-n)/s;l*=o,c*=o,i(t,n,l,c)},calc:function(i){const a=i*i;return e+t*i+n*a+r*(a*i)}}}const wg=new hd,Sg=new _g,Mg=new _g,Eg=new _g;class Tg extends yg{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new hd){const n=t,r=this.points,i=r.length,a=(i-(this.closed?0:1))*e;let o,s,l=Math.floor(a),c=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===c&&l===i-1&&(l=i-2,c=1),this.closed||l>0?o=r[(l-1)%i]:(wg.subVectors(r[0],r[1]).add(r[0]),o=wg);const u=r[l%i],d=r[(l+1)%i];if(this.closed||l+2<i?s=r[(l+2)%i]:(wg.subVectors(r[i-1],r[i-2]).add(r[i-1]),s=wg),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(u),e),n=Math.pow(u.distanceToSquared(d),e),r=Math.pow(d.distanceToSquared(s),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),Sg.initNonuniformCatmullRom(o.x,u.x,d.x,s.x,t,n,r),Mg.initNonuniformCatmullRom(o.y,u.y,d.y,s.y,t,n,r),Eg.initNonuniformCatmullRom(o.z,u.z,d.z,s.z,t,n,r)}else"catmullrom"===this.curveType&&(Sg.initCatmullRom(o.x,u.x,d.x,s.x,this.tension),Mg.initCatmullRom(o.y,u.y,d.y,s.y,this.tension),Eg.initCatmullRom(o.z,u.z,d.z,s.z,this.tension));return n.set(Sg.calc(c),Mg.calc(c),Eg.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new hd).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Cg(e,t,n,r,i){const a=.5*(r-t),o=.5*(i-n),s=e*e;return(2*n-2*r+a+o)*(e*s)+(-3*n+3*r-2*a-o)*s+a*e+n}function Ag(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function kg(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}class Rg extends yg{constructor(e=new ud,t=new ud,n=new ud,r=new ud){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new ud){const n=t,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(kg(e,r.x,i.x,a.x,o.x),kg(e,r.y,i.y,a.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Ng extends yg{constructor(e=new hd,t=new hd,n=new hd,r=new hd){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new hd){const n=t,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(kg(e,r.x,i.x,a.x,o.x),kg(e,r.y,i.y,a.y,o.y),kg(e,r.z,i.z,a.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Pg extends yg{constructor(e=new ud,t=new ud){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ud){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ud){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ig extends yg{constructor(e=new hd,t=new hd){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new hd){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new hd){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Lg extends yg{constructor(e=new ud,t=new ud,n=new ud){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new ud){const n=t,r=this.v0,i=this.v1,a=this.v2;return n.set(Ag(e,r.x,i.x,a.x),Ag(e,r.y,i.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Dg extends yg{constructor(e=new hd,t=new hd,n=new hd){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new hd){const n=t,r=this.v0,i=this.v1,a=this.v2;return n.set(Ag(e,r.x,i.x,a.x),Ag(e,r.y,i.y,a.y),Ag(e,r.z,i.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class zg extends yg{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ud){const n=t,r=this.points,i=(r.length-1)*e,a=Math.floor(i),o=i-a,s=r[0===a?a:a-1],l=r[a],c=r[a>r.length-2?r.length-1:a+1],u=r[a>r.length-3?r.length-1:a+2];return n.set(Cg(o,s.x,l.x,c.x,u.x),Cg(o,s.y,l.y,c.y,u.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new ud).fromArray(n))}return this}}var Og=Object.freeze({__proto__:null,ArcCurve:xg,CatmullRomCurve3:Tg,CubicBezierCurve:Rg,CubicBezierCurve3:Ng,EllipseCurve:bg,LineCurve:Pg,LineCurve3:Ig,QuadraticBezierCurve:Lg,QuadraticBezierCurve3:Dg,SplineCurve:zg});class Ug extends yg{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Og[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let i=0;for(;i<r.length;){if(r[i]>=n){const e=r[i]-n,a=this.curves[i],o=a.getLength(),s=0===o?0:1-e/o;return a.getPointAt(s,t)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const a=i[r],o=a.isEllipseCurve?2*e:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o);for(let e=0;e<s.length;e++){const r=s[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new Og[n.type]).fromJSON(n))}return this}}class Fg extends Ug{constructor(e){super(),this.type="Path",this.currentPoint=new ud,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Pg(this.currentPoint.clone(),new ud(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const i=new Lg(this.currentPoint.clone(),new ud(e,t),new ud(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,a){const o=new Rg(this.currentPoint.clone(),new ud(e,t),new ud(n,r),new ud(i,a));return this.curves.push(o),this.currentPoint.set(i,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new zg(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,a){const o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,r,i,a),this}absarc(e,t,n,r,i,a){return this.absellipse(e,t,n,n,r,i,a),this}ellipse(e,t,n,r,i,a,o,s){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,r,i,a,o,s),this}absellipse(e,t,n,r,i,a,o,s){const l=new bg(e,t,n,r,i,a,o,s);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Bg extends Fg{constructor(e){super(e),this.uuid=rd(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new Fg).fromJSON(n))}return this}}function jg(e,t,n,r,i){let a;if(i===function(e,t,n,r){let i=0;for(let a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}(e,t,n,r)>0)for(let o=t;o<n;o+=r)a=cv(o/r|0,e[o],e[o+1],a);else for(let o=n-r;o>=t;o-=r)a=cv(o/r|0,e[o],e[o+1],a);return a&&rv(a,a.next)&&(uv(a),a=a.next),a}function Hg(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!rv(r,r.next)&&0!==nv(r.prev,r,r.next))r=r.next;else{if(uv(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function Vg(e,t,n,r,i,a,o){if(!e)return;!o&&a&&function(e,t,n,r){let i=e;do{0===i.z&&(i.z=Kg(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n=1;do{let r,i=e;e=null;let a=null;for(t=0;i;){t++;let o=i,s=0;for(let e=0;e<n&&(s++,o=o.nextZ,o);e++);let l=n;for(;s>0||l>0&&o;)0!==s&&(0===l||!o||i.z<=o.z)?(r=i,i=i.nextZ,s--):(r=o,o=o.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;i=o}a.nextZ=null,n*=2}while(t>1)}(i)}(e,r,i,a);let s=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(a?Wg(e,r,i,a):Gg(e))t.push(l.i,e.i,c.i),uv(e),e=c.next,s=c.next;else if((e=c)===s){o?1===o?Vg(e=$g(Hg(e),t),t,n,r,i,a,2):2===o&&Xg(e,t,n,r,i,a):Vg(Hg(e),t,n,r,i,a,1);break}}}function Gg(e){const t=e.prev,n=e,r=e.next;if(nv(t,n,r)>=0)return!1;const i=t.x,a=n.x,o=r.x,s=t.y,l=n.y,c=r.y,u=Math.min(i,a,o),d=Math.min(s,l,c),h=Math.max(i,a,o),f=Math.max(s,l,c);let p=r.next;for(;p!==t;){if(p.x>=u&&p.x<=h&&p.y>=d&&p.y<=f&&ev(i,s,a,l,o,c,p.x,p.y)&&nv(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Wg(e,t,n,r){const i=e.prev,a=e,o=e.next;if(nv(i,a,o)>=0)return!1;const s=i.x,l=a.x,c=o.x,u=i.y,d=a.y,h=o.y,f=Math.min(s,l,c),p=Math.min(u,d,h),m=Math.max(s,l,c),g=Math.max(u,d,h),v=Kg(f,p,t,n,r),y=Kg(m,g,t,n,r);let b=e.prevZ,x=e.nextZ;for(;b&&b.z>=v&&x&&x.z<=y;){if(b.x>=f&&b.x<=m&&b.y>=p&&b.y<=g&&b!==i&&b!==o&&ev(s,u,l,d,c,h,b.x,b.y)&&nv(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==i&&x!==o&&ev(s,u,l,d,c,h,x.x,x.y)&&nv(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;b&&b.z>=v;){if(b.x>=f&&b.x<=m&&b.y>=p&&b.y<=g&&b!==i&&b!==o&&ev(s,u,l,d,c,h,b.x,b.y)&&nv(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=y;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==i&&x!==o&&ev(s,u,l,d,c,h,x.x,x.y)&&nv(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function $g(e,t){let n=e;do{const r=n.prev,i=n.next.next;!rv(r,i)&&iv(r,n,n.next,i)&&sv(r,i)&&sv(i,r)&&(t.push(r.i,n.i,i.i),uv(n),uv(n.next),n=e=i),n=n.next}while(n!==e);return Hg(n)}function Xg(e,t,n,r,i,a){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&tv(o,e)){let s=lv(o,e);return o=Hg(o,o.next),s=Hg(s,s.next),Vg(o,t,n,r,i,a,0),void Vg(s,t,n,r,i,a,0)}e=e.next}o=o.next}while(o!==e)}function qg(e,t){let n=e.x-t.x;return 0===n&&(n=e.y-t.y,0===n)&&(n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function Yg(e,t){const n=function(e,t){let n=t;const r=e.x,i=e.y;let a,o=-1/0;if(rv(e,n))return n;do{if(rv(e,n.next))return n.next;if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>o&&(o=e,a=n.x<n.next.x?n:n.next,e===r))return a}n=n.next}while(n!==t);if(!a)return null;const s=a,l=a.x,c=a.y;let u=1/0;n=a;do{if(r>=n.x&&n.x>=l&&r!==n.x&&Qg(i<c?r:o,i,l,c,i<c?o:r,i,n.x,n.y)){const t=Math.abs(i-n.y)/(r-n.x);sv(n,e)&&(t<u||t===u&&(n.x>a.x||n.x===a.x&&Zg(a,n)))&&(a=n,u=t)}n=n.next}while(n!==s);return a}(e,t);if(!n)return t;const r=lv(n,e);return Hg(r,r.next),Hg(n,n.next)}function Zg(e,t){return nv(e.prev,e,t.prev)<0&&nv(t.next,e,e.next)<0}function Kg(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Jg(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Qg(e,t,n,r,i,a,o,s){return(i-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(r-s)>=(n-o)*(t-s)&&(n-o)*(a-s)>=(i-o)*(r-s)}function ev(e,t,n,r,i,a,o,s){return!(e===o&&t===s)&&Qg(e,t,n,r,i,a,o,s)}function tv(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&iv(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(sv(e,t)&&sv(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(nv(e.prev,e,t.prev)||nv(e,t.prev,t))||rv(e,t)&&nv(e.prev,e,e.next)>0&&nv(t.prev,t,t.next)>0)}function nv(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function rv(e,t){return e.x===t.x&&e.y===t.y}function iv(e,t,n,r){const i=ov(nv(e,t,n)),a=ov(nv(e,t,r)),o=ov(nv(n,r,e)),s=ov(nv(n,r,t));return i!==a&&o!==s||!(0!==i||!av(e,n,t))||!(0!==a||!av(e,r,t))||!(0!==o||!av(n,e,r))||!(0!==s||!av(n,t,r))}function av(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function ov(e){return e>0?1:e<0?-1:0}function sv(e,t){return nv(e.prev,e,e.next)<0?nv(e,t,e.next)>=0&&nv(e,e.prev,t)>=0:nv(e,t,e.prev)<0||nv(e,e.next,t)<0}function lv(e,t){const n=dv(e.i,e.x,e.y),r=dv(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function cv(e,t,n,r){const i=dv(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function uv(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function dv(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class hv{static triangulate(e,t,n=2){return function(e,t,n=2){const r=t&&t.length,i=r?t[0]*n:e.length;let a=jg(e,0,i,n,!0);const o=[];if(!a||a.next===a.prev)return o;let s,l,c;if(r&&(a=function(e,t,n,r){const i=[];for(let a=0,o=t.length;a<o;a++){const n=jg(e,t[a]*r,a<o-1?t[a+1]*r:e.length,r,!1);n===n.next&&(n.steiner=!0),i.push(Jg(n))}i.sort(qg);for(let a=0;a<i.length;a++)n=Yg(i[a],n);return n}(e,t,a,n)),e.length>80*n){s=1/0,l=1/0;let t=-1/0,r=-1/0;for(let a=n;a<i;a+=n){const n=e[a],i=e[a+1];n<s&&(s=n),i<l&&(l=i),n>t&&(t=n),i>r&&(r=i)}c=Math.max(t-s,r-l),c=0!==c?32767/c:0}return Vg(a,o,n,s,l,c,0),o}(e,t,n)}}class fv{static area(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}static isClockWise(e){return fv.area(e)<0}static triangulateShape(e,t){const n=[],r=[],i=[];pv(e),mv(n,e);let a=e.length;t.forEach(pv);for(let s=0;s<t.length;s++)r.push(a),a+=t[s].length,mv(n,t[s]);const o=hv.triangulate(n,r);for(let s=0;s<o.length;s+=3)i.push(o.slice(s,s+3));return i}}function pv(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function mv(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class gv extends If{constructor(e=new Bg([new ud(.5,.5),new ud(-.5,.5),new ud(-.5,-.5),new ud(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let o=0,s=e.length;o<s;o++)a(e[o]);function a(e){const a=[],o=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,d=void 0!==t.bevelSize?t.bevelSize:u-.1,h=void 0!==t.bevelOffset?t.bevelOffset:0,f=void 0!==t.bevelSegments?t.bevelSegments:3;const p=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:vv;let g,v,y,b,x,_=!1;p&&(g=p.getSpacedPoints(s),_=!0,c=!1,v=p.computeFrenetFrames(s,!1),y=new hd,b=new hd,x=new hd),c||(f=0,u=0,d=0,h=0);const w=e.extractPoints(o);let S=w.shape;const M=w.holes;if(!fv.isClockWise(S)){S=S.reverse();for(let e=0,t=M.length;e<t;e++){const t=M[e];fv.isClockWise(t)&&(M[e]=t.reverse())}}function E(e){const t=1e-10*1e-10;let n=e[0];for(let r=1;r<=e.length;r++){const i=r%e.length,a=e[i],o=a.x-n.x,s=a.y-n.y,l=o*o+s*s,c=Math.max(Math.abs(a.x),Math.abs(a.y),Math.abs(n.x),Math.abs(n.y));l<=t*c*c?(e.splice(i,1),r--):n=a}}E(S),M.forEach(E);const T=M.length,C=S;for(let t=0;t<T;t++){const e=M[t];S=S.concat(e)}function A(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const k=S.length;function R(e,t,n){let r,i,a;const o=e.x-t.x,s=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=o*o+s*s,d=o*c-s*l;if(Math.abs(d)>Number.EPSILON){const d=Math.sqrt(u),h=Math.sqrt(l*l+c*c),f=t.x-s/d,p=t.y+o/d,m=((n.x-c/h-f)*c-(n.y+l/h-p)*l)/(o*c-s*l);r=f+o*m-e.x,i=p+s*m-e.y;const g=r*r+i*i;if(g<=2)return new ud(r,i);a=Math.sqrt(g/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(c)&&(e=!0),e?(r=-s,i=o,a=Math.sqrt(u)):(r=o,i=s,a=Math.sqrt(u/2))}return new ud(r/a,i/a)}const N=[];for(let t=0,n=C.length,r=n-1,i=t+1;t<n;t++,r++,i++)r===n&&(r=0),i===n&&(i=0),N[t]=R(C[t],C[r],C[i]);const P=[];let I,L,D=N.concat();for(let t=0,n=T;t<n;t++){const e=M[t];I=[];for(let t=0,n=e.length,r=n-1,i=t+1;t<n;t++,r++,i++)r===n&&(r=0),i===n&&(i=0),I[t]=R(e[t],e[r],e[i]);P.push(I),D=D.concat(I)}if(0===f)L=fv.triangulateShape(C,M);else{const e=[],t=[];for(let n=0;n<f;n++){const r=n/f,i=u*Math.cos(r*Math.PI/2),a=d*Math.sin(r*Math.PI/2)+h;for(let t=0,n=C.length;t<n;t++){const n=A(C[t],N[t],a);F(n.x,n.y,-i),0===r&&e.push(n)}for(let e=0,n=T;e<n;e++){const n=M[e];I=P[e];const o=[];for(let e=0,t=n.length;e<t;e++){const t=A(n[e],I[e],a);F(t.x,t.y,-i),0===r&&o.push(t)}0===r&&t.push(o)}}L=fv.triangulateShape(e,t)}const z=L.length,O=d+h;for(let t=0;t<k;t++){const e=c?A(S[t],D[t],O):S[t];_?(b.copy(v.normals[0]).multiplyScalar(e.x),y.copy(v.binormals[0]).multiplyScalar(e.y),x.copy(g[0]).add(b).add(y),F(x.x,x.y,x.z)):F(e.x,e.y,0)}for(let t=1;t<=s;t++)for(let e=0;e<k;e++){const n=c?A(S[e],D[e],O):S[e];_?(b.copy(v.normals[t]).multiplyScalar(n.x),y.copy(v.binormals[t]).multiplyScalar(n.y),x.copy(g[t]).add(b).add(y),F(x.x,x.y,x.z)):F(n.x,n.y,l/s*t)}for(let t=f-1;t>=0;t--){const e=t/f,n=u*Math.cos(e*Math.PI/2),r=d*Math.sin(e*Math.PI/2)+h;for(let t=0,i=C.length;t<i;t++){const e=A(C[t],N[t],r);F(e.x,e.y,l+n)}for(let t=0,i=M.length;t<i;t++){const e=M[t];I=P[t];for(let t=0,i=e.length;t<i;t++){const i=A(e[t],I[t],r);_?F(i.x,i.y+g[s-1].y,g[s-1].x+n):F(i.x,i.y,l+n)}}}function U(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=s+2*f;e<n;e++){const n=k*e,a=k*(e+1);j(t+r+n,t+i+n,t+i+a,t+r+a)}}}function F(e,t,n){a.push(e),a.push(t),a.push(n)}function B(e,t,i){H(e),H(t),H(i);const a=r.length/3,o=m.generateTopUV(n,r,a-3,a-2,a-1);V(o[0]),V(o[1]),V(o[2])}function j(e,t,i,a){H(e),H(t),H(a),H(t),H(i),H(a);const o=r.length/3,s=m.generateSideWallUV(n,r,o-6,o-3,o-2,o-1);V(s[0]),V(s[1]),V(s[3]),V(s[1]),V(s[2]),V(s[3])}function H(e){r.push(a[3*e+0]),r.push(a[3*e+1]),r.push(a[3*e+2])}function V(e){i.push(e.x),i.push(e.y)}!function(){const e=r.length/3;if(c){let e=0,t=k*e;for(let n=0;n<z;n++){const e=L[n];B(e[2]+t,e[1]+t,e[0]+t)}e=s+2*f,t=k*e;for(let n=0;n<z;n++){const e=L[n];B(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<z;e++){const t=L[e];B(t[2],t[1],t[0])}for(let e=0;e<z;e++){const t=L[e];B(t[0]+k*s,t[1]+k*s,t[2]+k*s)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;U(C,t),t+=C.length;for(let n=0,r=M.length;n<r;n++){const e=M[n];U(e,t),t+=e.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new Ef(r,3)),this.setAttribute("uv",new Ef(i,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let r=0,i=e.length;r<i;r++){const t=e[r];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);return n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let i=0,a=e.shapes.length;i<a;i++){const r=t[e.shapes[i]];n.push(r)}const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new Og[r.type]).fromJSON(r)),new gv(n,e.options)}}const vv={generateTopUV:function(e,t,n,r,i){const a=t[3*n],o=t[3*n+1],s=t[3*r],l=t[3*r+1],c=t[3*i],u=t[3*i+1];return[new ud(a,o),new ud(s,l),new ud(c,u)]},generateSideWallUV:function(e,t,n,r,i,a){const o=t[3*n],s=t[3*n+1],l=t[3*n+2],c=t[3*r],u=t[3*r+1],d=t[3*r+2],h=t[3*i],f=t[3*i+1],p=t[3*i+2],m=t[3*a],g=t[3*a+1],v=t[3*a+2];return Math.abs(s-u)<Math.abs(o-c)?[new ud(o,1-l),new ud(c,1-d),new ud(h,1-p),new ud(m,1-v)]:[new ud(s,1-l),new ud(u,1-d),new ud(f,1-p),new ud(g,1-v)]}};class yv extends dg{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new yv(e.radius,e.detail)}}class bv extends If{constructor(e=[new ud(0,-.5),new ud(.5,0),new ud(0,.5)],t=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=id(r,0,2*Math.PI);const i=[],a=[],o=[],s=[],l=[],c=1/t,u=new hd,d=new ud,h=new hd,f=new hd,p=new hd;let m=0,g=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,h.x=1*g,h.y=-m,h.z=0*g,p.copy(h),h.normalize(),s.push(h.x,h.y,h.z);break;case e.length-1:s.push(p.x,p.y,p.z);break;default:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,h.x=1*g,h.y=-m,h.z=0*g,f.copy(h),h.x+=p.x,h.y+=p.y,h.z+=p.z,h.normalize(),s.push(h.x,h.y,h.z),p.copy(f)}for(let v=0;v<=t;v++){const i=n+v*c*r,h=Math.sin(i),f=Math.cos(i);for(let n=0;n<=e.length-1;n++){u.x=e[n].x*h,u.y=e[n].y,u.z=e[n].x*f,a.push(u.x,u.y,u.z),d.x=v/t,d.y=n/(e.length-1),o.push(d.x,d.y);const r=s[3*n+0]*h,i=s[3*n+1],c=s[3*n+0]*f;l.push(r,i,c)}}for(let v=0;v<t;v++)for(let t=0;t<e.length-1;t++){const n=t+v*e.length,r=n,a=n+e.length,o=n+e.length+1,s=n+1;i.push(r,a,s),i.push(o,s,a)}this.setIndex(i),this.setAttribute("position",new Ef(a,3)),this.setAttribute("uv",new Ef(o,2)),this.setAttribute("normal",new Ef(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bv(e.points,e.segments,e.phiStart,e.phiLength)}}class xv extends dg{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new xv(e.radius,e.detail)}}class _v extends If{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,a=t/2,o=Math.floor(n),s=Math.floor(r),l=o+1,c=s+1,u=e/o,d=t/s,h=[],f=[],p=[],m=[];for(let g=0;g<c;g++){const e=g*d-a;for(let t=0;t<l;t++){const n=t*u-i;f.push(n,-e,0),p.push(0,0,1),m.push(t/o),m.push(1-g/s)}}for(let g=0;g<s;g++)for(let e=0;e<o;e++){const t=e+l*g,n=e+l*(g+1),r=e+1+l*(g+1),i=e+1+l*g;h.push(t,n,i),h.push(n,r,i)}this.setIndex(h),this.setAttribute("position",new Ef(f,3)),this.setAttribute("normal",new Ef(p,3)),this.setAttribute("uv",new Ef(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _v(e.width,e.height,e.widthSegments,e.heightSegments)}}class wv extends If{constructor(e=.5,t=1,n=32,r=1,i=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:a},n=Math.max(3,n);const o=[],s=[],l=[],c=[];let u=e;const d=(t-e)/(r=Math.max(1,r)),h=new hd,f=new ud;for(let p=0;p<=r;p++){for(let e=0;e<=n;e++){const r=i+e/n*a;h.x=u*Math.cos(r),h.y=u*Math.sin(r),s.push(h.x,h.y,h.z),l.push(0,0,1),f.x=(h.x/t+1)/2,f.y=(h.y/t+1)/2,c.push(f.x,f.y)}u+=d}for(let p=0;p<r;p++){const e=p*(n+1);for(let t=0;t<n;t++){const r=t+e,i=r,a=r+n+1,s=r+n+2,l=r+1;o.push(i,a,l),o.push(a,s,l)}}this.setIndex(o),this.setAttribute("position",new Ef(s,3)),this.setAttribute("normal",new Ef(l,3)),this.setAttribute("uv",new Ef(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wv(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Sv extends If{constructor(e=new Bg([new ud(0,.5),new ud(-.5,-.5),new ud(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],i=[],a=[];let o=0,s=0;if(!1===Array.isArray(e))l(e);else for(let c=0;c<e.length;c++)l(e[c]),this.addGroup(o,s,c),o+=s,s=0;function l(e){const o=r.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===fv.isClockWise(c)&&(c=c.reverse());for(let t=0,n=u.length;t<n;t++){const e=u[t];!0===fv.isClockWise(e)&&(u[t]=e.reverse())}const d=fv.triangulateShape(c,u);for(let t=0,n=u.length;t<n;t++){const e=u[t];c=c.concat(e)}for(let t=0,n=c.length;t<n;t++){const e=c[t];r.push(e.x,e.y,0),i.push(0,0,1),a.push(e.x,e.y)}for(let t=0,r=d.length;t<r;t++){const e=d[t],r=e[0]+o,i=e[1]+o,a=e[2]+o;n.push(r,i,a),s+=3}}this.setIndex(n),this.setAttribute("position",new Ef(r,3)),this.setAttribute("normal",new Ef(i,3)),this.setAttribute("uv",new Ef(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}return new Sv(n,e.curveSegments)}}class Mv extends If{constructor(e=1,t=32,n=16,r=0,i=2*Math.PI,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const s=Math.min(a+o,Math.PI);let l=0;const c=[],u=new hd,d=new hd,h=[],f=[],p=[],m=[];for(let g=0;g<=n;g++){const h=[],v=g/n;let y=0;0===g&&0===a?y=.5/t:g===n&&s===Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const s=n/t;u.x=-e*Math.cos(r+s*i)*Math.sin(a+v*o),u.y=e*Math.cos(a+v*o),u.z=e*Math.sin(r+s*i)*Math.sin(a+v*o),f.push(u.x,u.y,u.z),d.copy(u).normalize(),p.push(d.x,d.y,d.z),m.push(s+y,1-v),h.push(l++)}c.push(h)}for(let g=0;g<n;g++)for(let e=0;e<t;e++){const t=c[g][e+1],r=c[g][e],i=c[g+1][e],o=c[g+1][e+1];(0!==g||a>0)&&h.push(t,r,o),(g!==n-1||s<Math.PI)&&h.push(r,i,o)}this.setIndex(h),this.setAttribute("position",new Ef(f,3)),this.setAttribute("normal",new Ef(p,3)),this.setAttribute("uv",new Ef(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Mv(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Ev extends dg{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Ev(e.radius,e.detail)}}class Tv extends If{constructor(e=1,t=.4,n=12,r=48,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const a=[],o=[],s=[],l=[],c=new hd,u=new hd,d=new hd;for(let h=0;h<=n;h++)for(let a=0;a<=r;a++){const f=a/r*i,p=h/n*Math.PI*2;u.x=(e+t*Math.cos(p))*Math.cos(f),u.y=(e+t*Math.cos(p))*Math.sin(f),u.z=t*Math.sin(p),o.push(u.x,u.y,u.z),c.x=e*Math.cos(f),c.y=e*Math.sin(f),d.subVectors(u,c).normalize(),s.push(d.x,d.y,d.z),l.push(a/r),l.push(h/n)}for(let h=1;h<=n;h++)for(let e=1;e<=r;e++){const t=(r+1)*h+e-1,n=(r+1)*(h-1)+e-1,i=(r+1)*(h-1)+e,o=(r+1)*h+e;a.push(t,n,o),a.push(n,i,o)}this.setIndex(a),this.setAttribute("position",new Ef(o,3)),this.setAttribute("normal",new Ef(s,3)),this.setAttribute("uv",new Ef(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Tv(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Cv extends If{constructor(e=1,t=.4,n=64,r=8,i=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:a},n=Math.floor(n),r=Math.floor(r);const o=[],s=[],l=[],c=[],u=new hd,d=new hd,h=new hd,f=new hd,p=new hd,m=new hd,g=new hd;for(let y=0;y<=n;++y){const o=y/n*i*Math.PI*2;v(o,i,a,e,h),v(o+.01,i,a,e,f),m.subVectors(f,h),g.addVectors(f,h),p.crossVectors(m,g),g.crossVectors(p,m),p.normalize(),g.normalize();for(let e=0;e<=r;++e){const i=e/r*Math.PI*2,a=-t*Math.cos(i),o=t*Math.sin(i);u.x=h.x+(a*g.x+o*p.x),u.y=h.y+(a*g.y+o*p.y),u.z=h.z+(a*g.z+o*p.z),s.push(u.x,u.y,u.z),d.subVectors(u,h).normalize(),l.push(d.x,d.y,d.z),c.push(y/n),c.push(e/r)}}for(let y=1;y<=n;y++)for(let e=1;e<=r;e++){const t=(r+1)*(y-1)+(e-1),n=(r+1)*y+(e-1),i=(r+1)*y+e,a=(r+1)*(y-1)+e;o.push(t,n,a),o.push(n,i,a)}function v(e,t,n,r,i){const a=Math.cos(e),o=Math.sin(e),s=n/t*e,l=Math.cos(s);i.x=r*(2+l)*.5*a,i.y=r*(2+l)*o*.5,i.z=r*Math.sin(s)*.5}this.setIndex(o),this.setAttribute("position",new Ef(s,3)),this.setAttribute("normal",new Ef(l,3)),this.setAttribute("uv",new Ef(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Cv(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Av extends If{constructor(e=new Dg(new hd(-1,-1,0),new hd(-1,1,0),new hd(1,1,0)),t=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};const a=e.computeFrenetFrames(t,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new hd,s=new hd,l=new ud;let c=new hd;const u=[],d=[],h=[],f=[];function p(i){c=e.getPointAt(i/t,c);const l=a.normals[i],h=a.binormals[i];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,i=Math.sin(t),a=-Math.cos(t);s.x=a*l.x+i*h.x,s.y=a*l.y+i*h.y,s.z=a*l.z+i*h.z,s.normalize(),d.push(s.x,s.y,s.z),o.x=c.x+n*s.x,o.y=c.y+n*s.y,o.z=c.z+n*s.z,u.push(o.x,o.y,o.z)}}!function(){for(let e=0;e<t;e++)p(e);p(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)l.x=e/t,l.y=n/r,h.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),a=(r+1)*e+t,o=(r+1)*(e-1)+t;f.push(n,i,o),f.push(i,a,o)}}()}(),this.setIndex(f),this.setAttribute("position",new Ef(u,3)),this.setAttribute("normal",new Ef(d,3)),this.setAttribute("uv",new Ef(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Av((new Og[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class kv extends If{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,r=new hd,i=new hd;if(null!==e.index){const a=e.attributes.position,o=e.index;let s=e.groups;0===s.length&&(s=[{start:0,count:o.count,materialIndex:0}]);for(let e=0,l=s.length;e<l;++e){const l=s[e],c=l.start;for(let e=c,s=c+l.count;e<s;e+=3)for(let l=0;l<3;l++){const s=o.getX(e+l),c=o.getX(e+(l+1)%3);r.fromBufferAttribute(a,s),i.fromBufferAttribute(a,c),!0===Rv(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}}else{const a=e.attributes.position;for(let e=0,o=a.count/3;e<o;e++)for(let s=0;s<3;s++){const o=3*e+s,l=3*e+(s+1)%3;r.fromBufferAttribute(a,o),i.fromBufferAttribute(a,l),!0===Rv(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}this.setAttribute("position",new Ef(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function Rv(e,t,n){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(r)&&!0!==n.has(i)&&(n.add(r),n.add(i),!0)}var Nv=Object.freeze({__proto__:null,BoxGeometry:Xf,CapsuleGeometry:sg,CircleGeometry:lg,ConeGeometry:ug,CylinderGeometry:cg,DodecahedronGeometry:hg,EdgesGeometry:vg,ExtrudeGeometry:gv,IcosahedronGeometry:yv,LatheGeometry:bv,OctahedronGeometry:xv,PlaneGeometry:_v,PolyhedronGeometry:dg,RingGeometry:wv,ShapeGeometry:Sv,SphereGeometry:Mv,TetrahedronGeometry:Ev,TorusGeometry:Tv,TorusKnotGeometry:Cv,TubeGeometry:Av,WireframeGeometry:kv});class Pv extends hf{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new cf(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Iv extends Jf{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Lv extends hf{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new cf(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new cf(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ud(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Th,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Dv extends Lv{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ud(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return id(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new cf(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new cf(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new cf(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class zv extends hf{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new cf(16777215),this.specular=new cf(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new cf(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ud(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Th,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Ov extends hf{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new cf(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new cf(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ud(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class Uv extends hf{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ud(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Fv extends hf{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new cf(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new cf(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ud(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Th,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Bv extends hf{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class jv extends hf{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class Hv extends hf{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new cf(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ud(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Vv extends zm{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Gv(e,t){return e&&e.constructor!==t?"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e}function Wv(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function $v(e){const t=e.length,n=new Array(t);for(let r=0;r!==t;++r)n[r]=r;return n.sort(function(t,n){return e[t]-e[n]}),n}function Xv(e,t,n){const r=e.length,i=new e.constructor(r);for(let a=0,o=0;o!==r;++a){const r=n[a]*t;for(let n=0;n!==t;++n)i[o++]=e[r+n]}return i}function qv(e,t,n,r){let i=1,a=e[0];for(;void 0!==a&&void 0===a[r];)a=e[i++];if(void 0===a)return;let o=a[r];if(void 0!==o)if(Array.isArray(o))do{o=a[r],void 0!==o&&(t.push(a.time),n.push(...o)),a=e[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{o=a[r],void 0!==o&&(t.push(a.time),o.toArray(n,n.length)),a=e[i++]}while(void 0!==a);else do{o=a[r],void 0!==o&&(t.push(a.time),n.push(o)),a=e[i++]}while(void 0!==a)}class Yv{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let a;n:{r:if(!(e<r)){for(let a=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(i=r,r=t[++n],e<r)break t}a=t.length;break n}if(!(e>=i)){const o=t[1];e<o&&(n=2,i=o);for(let a=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===a)break;if(r=i,i=t[--n-1],e>=i)break t}a=n,n=0;break n}break e}for(;n<a;){const r=n+a>>>1;e<t[r]?a=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let a=0;a!==r;++a)t[a]=n[i+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Zv extends Yv{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Ru,endingEnd:Ru}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,a=e+1,o=r[i],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case Nu:i=e,o=2*t-n;break;case Pu:i=r.length-2,o=t+r[i]-r[i+1];break;default:i=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case Nu:a=e,s=2*n-t;break;case Pu:a=1,s=n+r[1]-r[0];break;default:a=e-1,s=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-n),this._offsetPrev=i*c,this._offsetNext=a*c}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,h=this._weightNext,f=(n-t)/(r-t),p=f*f,m=p*f,g=-d*m+2*d*p-d*f,v=(1+d)*m+(-1.5-2*d)*p+(-.5+d)*f+1,y=(-1-h)*m+(1.5+h)*p+.5*f,b=h*m-h*p;for(let x=0;x!==o;++x)i[x]=g*a[c+x]+v*a[l+x]+y*a[s+x]+b*a[u+x];return i}}class Kv extends Yv{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=(n-t)/(r-t),u=1-c;for(let d=0;d!==o;++d)i[d]=a[l+d]*u+a[s+d]*c;return i}}class Jv extends Yv{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Qv{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Gv(t,this.TimeBufferType),this.values=Gv(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Gv(e.times,Array),values:Gv(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Jv(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Kv(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Zv(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Cu:t=this.InterpolantFactoryMethodDiscrete;break;case Au:t=this.InterpolantFactoryMethodLinear;break;case ku:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Cu;case this.InterpolantFactoryMethodLinear:return Au;case this.InterpolantFactoryMethodSmooth:return ku}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,a=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==i||a!==r){i>=a&&(a=Math.max(a,1),i=a-1);const e=this.getValueSize();this.times=n.slice(i,a),this.values=this.values.slice(i*e,a*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==i;o++){const t=n[o];if("number"==typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,t),e=!1;break}if(null!==a&&a>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,t,a),e=!1;break}a=t}if(void 0!==r&&Wv(r))for(let o=0,s=r.length;o!==s;++o){const t=r[o];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,t),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===ku,i=e.length-1;let a=1;for(let o=1;o<i;++o){let i=!1;const s=e[o];if(s!==e[o+1]&&(1!==o||s!==e[0]))if(r)i=!0;else{const e=o*n,r=e-n,a=e+n;for(let o=0;o!==n;++o){const n=t[e+o];if(n!==t[r+o]||n!==t[a+o]){i=!0;break}}}if(i){if(o!==a){e[a]=e[o];const r=o*n,i=a*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++a}}if(i>0){e[a]=e[i];for(let e=i*n,r=a*n,o=0;o!==n;++o)t[r+o]=t[e+o];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Qv.prototype.ValueTypeName="",Qv.prototype.TimeBufferType=Float32Array,Qv.prototype.ValueBufferType=Float32Array,Qv.prototype.DefaultInterpolation=Au;class ey extends Qv{constructor(e,t,n){super(e,t,n)}}ey.prototype.ValueTypeName="bool",ey.prototype.ValueBufferType=Array,ey.prototype.DefaultInterpolation=Cu,ey.prototype.InterpolantFactoryMethodLinear=void 0,ey.prototype.InterpolantFactoryMethodSmooth=void 0;class ty extends Qv{constructor(e,t,n,r){super(e,t,n,r)}}ty.prototype.ValueTypeName="color";class ny extends Qv{constructor(e,t,n,r){super(e,t,n,r)}}ny.prototype.ValueTypeName="number";class ry extends Yv{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(r-t);let l=e*o;for(let c=l+o;l!==c;l+=4)dd.slerpFlat(i,0,a,l-o,a,l,s);return i}}class iy extends Qv{constructor(e,t,n,r){super(e,t,n,r)}InterpolantFactoryMethodLinear(e){return new ry(this.times,this.values,this.getValueSize(),e)}}iy.prototype.ValueTypeName="quaternion",iy.prototype.InterpolantFactoryMethodSmooth=void 0;class ay extends Qv{constructor(e,t,n){super(e,t,n)}}ay.prototype.ValueTypeName="string",ay.prototype.ValueBufferType=Array,ay.prototype.DefaultInterpolation=Cu,ay.prototype.InterpolantFactoryMethodLinear=void 0,ay.prototype.InterpolantFactoryMethodSmooth=void 0;class oy extends Qv{constructor(e,t,n,r){super(e,t,n,r)}}oy.prototype.ValueTypeName="vector";class sy{constructor(e="",t=-1,n=[],r=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=rd(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let a=0,o=n.length;a!==o;++a)t.push(ly(n[a]).scale(r));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i.userData=JSON.parse(e.userData||"{}"),i}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let i=0,a=n.length;i!==a;++i)t.push(Qv.toJSON(n[i]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const i=t.length,a=[];for(let o=0;o<i;o++){let e=[],s=[];e.push((o+i-1)%i,o,(o+1)%i),s.push(0,1,0);const l=$v(e);e=Xv(e,1,l),s=Xv(s,1,l),r||0!==e[0]||(e.push(i),s.push(s[0])),a.push(new ny(".morphTargetInfluences["+t[o].name+"]",e,s).scale(1/n))}return new this(e,-1,a)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let o=0,s=e.length;o<s;o++){const t=e[o],n=t.name.match(i);if(n&&n.length>1){const e=n[1];let i=r[e];i||(r[e]=i=[]),i.push(t)}}const a=[];for(const o in r)a.push(this.CreateFromMorphTargetSequence(o,r[o],t,n));return a}static parseAnimation(e,t){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,r,i){if(0!==n.length){const a=[],o=[];qv(n,a,o,r),0!==a.length&&i.push(new e(t,a,o))}},r=[],i=e.name||"default",a=e.fps||30,o=e.blendMode;let s=e.length||-1;const l=e.hierarchy||[];for(let c=0;c<l.length;c++){const e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let r=0;r<e[n].morphTargets.length;r++)t[e[n].morphTargets[r]]=-1;for(const i in t){const t=[],a=[];for(let r=0;r!==e[n].morphTargets.length;++r){const r=e[n];t.push(r.time),a.push(r.morphTarget===i?1:0)}r.push(new ny(".morphTargetInfluence["+i+"]",t,a))}s=t.length*a}else{const i=".bones["+t[c].name+"]";n(oy,i+".position",e,"pos",r),n(iy,i+".quaternion",e,"rot",r),n(oy,i+".scale",e,"scl",r)}}return 0===r.length?null:new this(i,s,r,o)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());const t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}function ly(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ny;case"vector":case"vector2":case"vector3":case"vector4":return oy;case"color":return ty;case"quaternion":return iy;case"bool":case"boolean":return ey;case"string":return ay}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];qv(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const cy={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class uy{constructor(e,t,n){const r=this;let i,a=!1,o=0,s=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.abortController=new AbortController,this.itemStart=function(e){s++,!1===a&&void 0!==r.onStart&&r.onStart(e,o,s),a=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,s),o===s&&(a=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],r=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const dy=new uy;class hy{constructor(e){this.manager=void 0!==e?e:dy,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,i){n.load(e,r,t,i)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}hy.DEFAULT_MATERIAL_NAME="__DEFAULT";const fy={};class py extends Error{constructor(e,t){super(e),this.response=t}}class my extends hy{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=cy.get(`file:${e}`);if(void 0!==i)return this.manager.itemStart(e),setTimeout(()=>{t&&t(i),this.manager.itemEnd(e)},0),i;if(void 0!==fy[e])return void fy[e].push({onLoad:t,onProgress:n,onError:r});fy[e]=[],fy[e].push({onLoad:t,onProgress:n,onError:r});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:"function"==typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,s=this.responseType;fetch(a).then(t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=fy[e],r=t.body.getReader(),i=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),a=i?parseInt(i):0,o=0!==a;let s=0;const l=new ReadableStream({start(e){!function t(){r.read().then(({done:r,value:i})=>{if(r)e.close();else{s+=i.byteLength;const r=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:a});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(r)}e.enqueue(i),t()}},t=>{e.error(t)})}()}});return new Response(l)}throw new py(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)}).then(e=>{switch(s){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>(new DOMParser).parseFromString(e,o));case"json":return e.json();default:if(""===o)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(o),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then(e=>r.decode(e))}}}).then(t=>{cy.add(`file:${e}`,t);const n=fy[e];delete fy[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onLoad&&r.onLoad(t)}}).catch(t=>{const n=fy[e];if(void 0===n)throw this.manager.itemError(e),t;delete fy[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}const gy=new WeakMap;class vy extends hy{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=cy.get(`image:${e}`);if(void 0!==a){if(!0===a.complete)i.manager.itemStart(e),setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0);else{let e=gy.get(a);void 0===e&&(e=[],gy.set(a,e)),e.push({onLoad:t,onError:r})}return a}const o=xd("img");function s(){c(),t&&t(this);const n=gy.get(this)||[];for(let e=0;e<n.length;e++){const t=n[e];t.onLoad&&t.onLoad(this)}gy.delete(this),i.manager.itemEnd(e)}function l(t){c(),r&&r(t),cy.remove(`image:${e}`);const n=gy.get(this)||[];for(let e=0;e<n.length;e++){const r=n[e];r.onError&&r.onError(t)}gy.delete(this),i.manager.itemError(e),i.manager.itemEnd(e)}function c(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),cy.add(`image:${e}`,o),i.manager.itemStart(e),o.src=e,o}}class yy extends Vh{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new cf(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}class by extends yy{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Vh.DEFAULT_UP),this.updateMatrix(),this.groundColor=new cf(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const xy=new gh,_y=new hd,wy=new hd;class Sy{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ud(512,512),this.mapType=Tc,this.map=null,this.mapPass=null,this.matrix=new gh,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new fm,this._frameExtents=new ud(1,1),this._viewportCount=1,this._viewports=[new Ud(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;_y.setFromMatrixPosition(e.matrixWorld),t.position.copy(_y),wy.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(wy),t.updateMatrixWorld(),xy.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(xy,t.coordinateSystem,t.reversedDepth),t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(xy)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class My extends Sy{constructor(){super(new rp(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=2*nd*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height*this.aspect,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Ey extends yy{constructor(e,t,n=0,r=Math.PI/3,i=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Vh.DEFAULT_UP),this.updateMatrix(),this.target=new Vh,this.distance=n,this.angle=r,this.penumbra=i,this.decay=a,this.map=null,this.shadow=new My}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Ty=new gh,Cy=new hd,Ay=new hd;class ky extends Sy{constructor(){super(new rp(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ud(4,2),this._viewportCount=6,this._viewports=[new Ud(2,1,1,1),new Ud(0,1,1,1),new Ud(3,1,1,1),new Ud(1,1,1,1),new Ud(3,0,1,1),new Ud(1,0,1,1)],this._cubeDirections=[new hd(1,0,0),new hd(-1,0,0),new hd(0,0,1),new hd(0,0,-1),new hd(0,1,0),new hd(0,-1,0)],this._cubeUps=[new hd(0,1,0),new hd(0,1,0),new hd(0,1,0),new hd(0,1,0),new hd(0,0,1),new hd(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),Cy.setFromMatrixPosition(e.matrixWorld),n.position.copy(Cy),Ay.copy(n.position),Ay.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Ay),n.updateMatrixWorld(),r.makeTranslation(-Cy.x,-Cy.y,-Cy.z),Ty.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ty,n.coordinateSystem,n.reversedDepth)}}class Ry extends yy{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new ky}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Ny extends Qf{constructor(e=-1,t=1,n=1,r=-1,i=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,a=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,a=i+e*this.view.width,o-=t*this.view.offsetY,s=o-t*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}class Py extends Sy{constructor(){super(new Ny(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Iy extends yy{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Vh.DEFAULT_UP),this.updateMatrix(),this.target=new Vh,this.shadow=new Py}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Ly extends yy{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Dy extends yy{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class zy{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new hd)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*r),t.addScaledVector(a[2],.488603*i),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*r*1.092548),t.addScaledVector(a[5],r*i*1.092548),t.addScaledVector(a[6],.315392*(3*i*i-1)),t.addScaledVector(a[7],n*i*1.092548),t.addScaledVector(a[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*r),t.addScaledVector(a[2],1.023328*i),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*r),t.addScaledVector(a[5],.858086*r*i),t.addScaledVector(a[6],.743125*i*i-.247708),t.addScaledVector(a[7],.858086*n*i),t.addScaledVector(a[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}class Oy extends yy{constructor(e=new zy,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Uy extends hy{constructor(e){super(e),this.textures={}}load(e,t,n,r){const i=this,a=new my(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,function(n){try{t(i.parse(JSON.parse(n)))}catch(a){r?r(a):console.error(a),i.manager.itemError(e)}},n,r)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const r=this.createMaterialFromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=(new cf).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.dispersion&&(r.dispersion=e.dispersion),void 0!==e.iridescence&&(r.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(r.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(r.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(r.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(r.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(r.depthFunc=e.depthFunc),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(r.blendSrc=e.blendSrc),void 0!==e.blendDst&&(r.blendDst=e.blendDst),void 0!==e.blendEquation&&(r.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(r.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(r.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(r.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==r.blendColor&&r.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(r.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),void 0!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(r.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const i in e.uniforms){const t=e.uniforms[i];switch(r.uniforms[i]={},t.type){case"t":r.uniforms[i].value=n(t.value);break;case"c":r.uniforms[i].value=(new cf).setHex(t.value);break;case"v2":r.uniforms[i].value=(new ud).fromArray(t.value);break;case"v3":r.uniforms[i].value=(new hd).fromArray(t.value);break;case"v4":r.uniforms[i].value=(new Ud).fromArray(t.value);break;case"m3":r.uniforms[i].value=(new md).fromArray(t.value);break;case"m4":r.uniforms[i].value=(new gh).fromArray(t.value);break;default:r.uniforms[i].value=t.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(r.glslVersion=e.glslVersion),void 0!==e.extensions)for(const i in e.extensions)r.extensions[i]=e.extensions[i];if(void 0!==e.lights&&(r.lights=e.lights),void 0!==e.clipping&&(r.clipping=e.clipping),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new ud).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapRotation&&r.envMapRotation.fromArray(e.envMapRotation),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new ud).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(r.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(r.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(r.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return Uy.createMaterialFromType(e)}static createMaterialFromType(e){return new{ShadowMaterial:Pv,SpriteMaterial:vp,RawShaderMaterial:Iv,ShaderMaterial:Jf,PointsMaterial:Zm,MeshPhysicalMaterial:Dv,MeshStandardMaterial:Lv,MeshPhongMaterial:zv,MeshToonMaterial:Ov,MeshNormalMaterial:Uv,MeshLambertMaterial:Fv,MeshDepthMaterial:Bv,MeshDistanceMaterial:jv,MeshBasicMaterial:ff,MeshMatcapMaterial:Hv,LineDashedMaterial:Vv,LineBasicMaterial:zm,Material:hf}[e]}}class Fy{static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class By extends If{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class jy extends hy{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new my(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,function(n){try{t(i.parse(JSON.parse(n)))}catch(a){r?r(a):console.error(a),i.manager.itemError(e)}},n,r)}parse(e){const t={},n={};function r(e,r){if(void 0!==t[r])return t[r];const i=e.interleavedBuffers[r],a=function(e,t){if(void 0!==n[t])return n[t];const r=e.arrayBuffers[t],i=new Uint32Array(r).buffer;return n[t]=i,i}(e,i.buffer),o=bd(i.type,a),s=new pp(o,i.stride);return s.uuid=i.uuid,t[r]=s,s}const i=e.isInstancedBufferGeometry?new By:new If,a=e.data.index;if(void 0!==a){const e=bd(a.type,a.array);i.setIndex(new wf(e,1))}const o=e.data.attributes;for(const u in o){const t=o[u];let n;if(t.isInterleavedBufferAttribute){const i=r(e.data,t.data);n=new gp(i,t.itemSize,t.offset,t.normalized)}else{const e=bd(t.type,t.array);n=new(t.isInstancedBufferAttribute?Kp:wf)(e,t.itemSize,t.normalized)}void 0!==t.name&&(n.name=t.name),void 0!==t.usage&&n.setUsage(t.usage),i.setAttribute(u,n)}const s=e.data.morphAttributes;if(s)for(const u in s){const t=s[u],n=[];for(let i=0,a=t.length;i<a;i++){const a=t[i];let o;if(a.isInterleavedBufferAttribute){const t=r(e.data,a.data);o=new gp(t,a.itemSize,a.offset,a.normalized)}else{const e=bd(a.type,a.array);o=new wf(e,a.itemSize,a.normalized)}void 0!==a.name&&(o.name=a.name),n.push(o)}i.morphAttributes[u]=n}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let u=0,d=l.length;u!==d;++u){const e=l[u];i.addGroup(e.start,e.count,e.materialIndex)}const c=e.data.boundingSphere;return void 0!==c&&(i.boundingSphere=(new sh).fromJSON(c)),e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}}const Hy={UVMapping:dc,CubeReflectionMapping:hc,CubeRefractionMapping:fc,EquirectangularReflectionMapping:pc,EquirectangularRefractionMapping:mc,CubeUVReflectionMapping:gc},Vy={RepeatWrapping:vc,ClampToEdgeWrapping:yc,MirroredRepeatWrapping:bc},Gy={NearestFilter:xc,NearestMipmapNearestFilter:_c,NearestMipmapLinearFilter:wc,LinearFilter:Sc,LinearMipmapNearestFilter:Mc,LinearMipmapLinearFilter:Ec},Wy=new WeakMap;let $y;class Xy{static getContext(){return void 0===$y&&($y=new(window.AudioContext||window.webkitAudioContext)),$y}static setContext(e){$y=e}}const qy=new gh,Yy=new gh,Zy=new gh;class Ky extends rp{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class Jy{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const Qy=new hd,eb=new dd,tb=new hd,nb=new hd,rb=new hd;class ib extends Vh{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(e=0){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),"buffer"!==e.sourceType?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const ab=new hd,ob=new dd,sb=new hd,lb=new hd;class cb{constructor(e,t,n){let r,i,a;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let a=this.cumulativeWeight;if(0===a){for(let e=0;e!==r;++e)n[i+e]=n[e];a=t}else{a+=t;const e=t/a;this._mixBufferRegion(n,i,0,e,r)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const e=t*this._origIndex;this._mixBufferRegion(n,r,e,1-i,t)}a>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let s=t,l=t+t;s!==l;++s)if(n[s]!==n[s+t]){o.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let i=n,a=r;i!==a;++i)t[i]=t[r+i%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,i){if(r>=.5)for(let a=0;a!==i;++a)e[t+a]=e[n+a]}_slerp(e,t,n,r){dd.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,i){const a=this._workIndex*i;dd.multiplyQuaternionsFlat(e,a,e,t,e,n),dd.slerpFlat(e,t,e,t,e,a,r)}_lerp(e,t,n,r,i){const a=1-r;for(let o=0;o!==i;++o){const i=t+o;e[i]=e[i]*a+e[n+o]*r}}_lerpAdditive(e,t,n,r,i){for(let a=0;a!==i;++a){const i=t+a;e[i]=e[i]+e[n+a]*r}}}const ub="\\[\\]\\.:\\/",db=new RegExp("["+ub+"]","g"),hb="[^"+ub+"]",fb="[^"+ub.replace("\\.","")+"]",pb=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",hb)+/(WCOD+)?/.source.replace("WCOD",fb)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",hb)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",hb)+"$"),mb=["material","materials","bones","map"];class gb{constructor(e,t,n){this.path=t,this.parsedPath=n||gb.parseTrackName(t),this.node=gb.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new gb.Composite(e,t,n):new gb(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(db,"")}static parseTrackName(e){const t=pb.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==mb.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const a=n(i.children);if(a)return a}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=gb.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const a=e[r];if(void 0===a){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,!0===e.isMaterial?o=this.Versioning.NeedsUpdate:!0===e.isObject3D&&(o=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}s=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(s=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}gb.Composite=class{constructor(e,t,n){const r=n||gb.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},gb.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},gb.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},gb.prototype.GetterByBindingType=[gb.prototype._getValue_direct,gb.prototype._getValue_array,gb.prototype._getValue_arrayElement,gb.prototype._getValue_toArray],gb.prototype.SetterByBindingTypeAndVersioning=[[gb.prototype._setValue_direct,gb.prototype._setValue_direct_setNeedsUpdate,gb.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[gb.prototype._setValue_array,gb.prototype._setValue_array_setNeedsUpdate,gb.prototype._setValue_array_setMatrixWorldNeedsUpdate],[gb.prototype._setValue_arrayElement,gb.prototype._setValue_arrayElement_setNeedsUpdate,gb.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[gb.prototype._setValue_fromArray,gb.prototype._setValue_fromArray_setNeedsUpdate,gb.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class vb{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,a=i.length,o=new Array(a),s={endingStart:Ru,endingEnd:Ru};for(let l=0;l!==a;++l){const e=i[l].createInterpolant(null);o[l]=e,e.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n=!1){if(e.fadeOut(t),this.fadeIn(t),!0===n){const n=this._clip.duration,r=e._clip.duration,i=r/n,a=n/r;e.warp(1,i,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n=!1){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,a=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);const s=o.parameterPositions,l=o.sampleValues;return s[0]=i,s[1]=i+n,l[0]=e/a,l[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const r=(e-i)*n;r<0||0===n?t=0:(this._startTime=null,t=n*r)}t*=this._updateTimeScale(e);const a=this._updateTime(t),o=this._updateWeight(e);if(o>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Iu)for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(a),t[n].accumulateAdditive(o);else for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(a),t[n].accumulate(r,o)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,i=this._loopCount;const a=2202===n;if(0===e)return-1===i||!a||1&~i?r:t-r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),r>=t||r<0){const n=Math.floor(r/t);r-=t*n,i+=Math.abs(n);const o=this.repetitions-i;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===o){const t=e<0;this._setEndings(t,!t,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(a&&!(1&~i))return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=Nu,r.endingEnd=Nu):(r.endingStart=e?this.zeroSlopeAtStart?Nu:Ru:Pu,r.endingEnd=t?this.zeroSlopeAtEnd?Nu:Ru:Pu)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let a=this._weightInterpolant;null===a&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,s=a.sampleValues;return o[0]=i,s[0]=t,o[1]=i+e,s[1]=n,this}}const yb=new Float32Array(1);class bb{constructor(e){this.value=e}clone(){return new bb(void 0===this.value.clone?this.value:this.value.clone())}}let xb=0;const _b=new gh;class wb{constructor(e,t,n=0,r=1/0){this.ray=new mh(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new Ch,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return _b.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(_b),this}intersectObject(e,t=!0,n=[]){return Mb(e,this,n,t),n.sort(Sb),n}intersectObjects(e,t=!0,n=[]){for(let r=0,i=e.length;r<i;r++)Mb(e[r],this,n,t);return n.sort(Sb),n}}function Sb(e,t){return e.distance-t.distance}function Mb(e,t,n,r){let i=!0;if(e.layers.test(t.layers)&&!1===e.raycast(t,n)&&(i=!1),!0===i&&!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)Mb(r[e],t,n,!0)}}function Eb(){!1===this._document.hidden&&this.reset()}class Tb{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=id(this.phi,e,Math.PI-e),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(id(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Cb{constructor(e,t,n,r){Cb.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==e&&this.set(e,t,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,r){const i=this.elements;return i[0]=e,i[2]=t,i[1]=n,i[3]=r,this}}const Ab=new ud,kb=new hd,Rb=new hd,Nb=new hd,Pb=new hd,Ib=new hd,Lb=new hd,Db=new hd,zb=new hd,Ob=new hd,Ub=new gh,Fb=new gh;function Bb(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push(...Bb(e.children[n]));return t}const jb=new hd,Hb=new cf,Vb=new cf,Gb=new hd,Wb=new hd,$b=new hd,Xb=new hd,qb=new Qf;function Yb(e,t,n,r,i,a,o){Xb.set(i,a,o).unproject(r);const s=t[e];if(void 0!==s){const e=n.getAttribute("position");for(let t=0,n=s.length;t<n;t++)e.setXYZ(s[t],Xb.x,Xb.y,Xb.z)}}const Zb=new Vd,Kb=new hd;let Jb,Qb;function ex(e,t,n,r){const i=function(e){switch(e){case Tc:case Cc:return{byteLength:1,components:1};case kc:case Ac:case Ic:return{byteLength:2,components:1};case Lc:case Dc:return{byteLength:2,components:4};case Nc:case Rc:case Pc:return{byteLength:4,components:1};case Oc:case Uc:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)}(r);switch(n){case Fc:return e*t;case Gc:case Wc:return e*t/i.components*i.byteLength;case $c:case Xc:return e*t*2/i.components*i.byteLength;case Bc:return e*t*3/i.components*i.byteLength;case jc:case qc:return e*t*4/i.components*i.byteLength;case Yc:case Zc:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case Kc:case Jc:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case eu:case nu:return Math.max(e,16)*Math.max(t,8)/4;case Qc:case tu:return Math.max(e,8)*Math.max(t,8)/2;case ru:case iu:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case au:case ou:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case su:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case lu:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case cu:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case uu:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case du:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case hu:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case fu:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case pu:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case mu:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case gu:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case vu:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case yu:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case bu:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case xu:case _u:case wu:return Math.ceil(e/4)*Math.ceil(t/4)*16;case Su:case Mu:return Math.ceil(e/4)*Math.ceil(t/4)*8;case Eu:case Tu:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}
/**
* @license
* Copyright 2010-2025 Three.js Authors
* SPDX-License-Identifier: MIT
*/
function tx(){let e=null,t=!1,n=null,r=null;function i(t,a){n(t,a),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function nx(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const r=t.get(n);r&&(e.deleteBuffer(r.buffer),t.delete(n))},update:function(n,r){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const e=t.get(n);return void((!e||e.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const i=t.get(n);if(void 0===i)t.set(n,function(t,n){const r=t.array,i=t.usage,a=r.byteLength,o=e.createBuffer();let s;if(e.bindBuffer(n,o),e.bufferData(n,r,i),t.onUploadCallback(),r instanceof Float32Array)s=e.FLOAT;else if("undefined"!=typeof Float16Array&&r instanceof Float16Array)s=e.HALF_FLOAT;else if(r instanceof Uint16Array)s=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(r instanceof Int16Array)s=e.SHORT;else if(r instanceof Uint32Array)s=e.UNSIGNED_INT;else if(r instanceof Int32Array)s=e.INT;else if(r instanceof Int8Array)s=e.BYTE;else if(r instanceof Uint8Array)s=e.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);s=e.UNSIGNED_BYTE}return{buffer:o,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version,size:a}}(n,r));else if(i.version<n.version){if(i.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,r){const i=n.array,a=n.updateRanges;if(e.bindBuffer(r,t),0===a.length)e.bufferSubData(r,0,i);else{a.sort((e,t)=>e.start-t.start);let t=0;for(let e=1;e<a.length;e++){const n=a[t],r=a[e];r.start<=n.start+n.count+1?n.count=Math.max(n.count,r.start+r.count-n.start):(++t,a[t]=r)}a.length=t+1;for(let n=0,o=a.length;n<o;n++){const t=a[n];e.bufferSubData(r,t.start*i.BYTES_PER_ELEMENT,i,t.start,t.count)}n.clearUpdateRanges()}n.onUploadCallback()}(i.buffer,n,r),i.version=n.version}}}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Nl}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Nl);const rx={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGARITHMIC_DEPTH_BUFFER\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\tfloat depth = unpackRGBAToDepth( texture2D( depths, uv ) );\n\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\treturn step( depth, compare );\n\t\t#else\n\t\t\treturn step( compare, depth );\n\t\t#endif\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow( sampler2D shadow, vec2 uv, float compare ) {\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\t\tfloat hard_shadow = step( distribution.x, compare );\n\t\t#else\n\t\t\tfloat hard_shadow = step( compare, distribution.x );\n\t\t#endif\n\t\tif ( hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\t#ifdef USE_REVERSED_DEPTH_BUFFER\n\t\tfloat fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];\n\t#else\n\t\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;\n\t#endif\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},ix={common:{diffuse:{value:new cf(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new md},alphaMap:{value:null},alphaMapTransform:{value:new md},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new md}},envmap:{envMap:{value:null},envMapRotation:{value:new md},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new md}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new md}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new md},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new md},normalScale:{value:new ud(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new md},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new md}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new md}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new md}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new cf(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new cf(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new md},alphaTest:{value:0},uvTransform:{value:new md}},sprite:{diffuse:{value:new cf(16777215)},opacity:{value:1},center:{value:new ud(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new md},alphaMap:{value:null},alphaMapTransform:{value:new md},alphaTest:{value:0}}},ax={basic:{uniforms:Yf([ix.common,ix.specularmap,ix.envmap,ix.aomap,ix.lightmap,ix.fog]),vertexShader:rx.meshbasic_vert,fragmentShader:rx.meshbasic_frag},lambert:{uniforms:Yf([ix.common,ix.specularmap,ix.envmap,ix.aomap,ix.lightmap,ix.emissivemap,ix.bumpmap,ix.normalmap,ix.displacementmap,ix.fog,ix.lights,{emissive:{value:new cf(0)}}]),vertexShader:rx.meshlambert_vert,fragmentShader:rx.meshlambert_frag},phong:{uniforms:Yf([ix.common,ix.specularmap,ix.envmap,ix.aomap,ix.lightmap,ix.emissivemap,ix.bumpmap,ix.normalmap,ix.displacementmap,ix.fog,ix.lights,{emissive:{value:new cf(0)},specular:{value:new cf(1118481)},shininess:{value:30}}]),vertexShader:rx.meshphong_vert,fragmentShader:rx.meshphong_frag},standard:{uniforms:Yf([ix.common,ix.envmap,ix.aomap,ix.lightmap,ix.emissivemap,ix.bumpmap,ix.normalmap,ix.displacementmap,ix.roughnessmap,ix.metalnessmap,ix.fog,ix.lights,{emissive:{value:new cf(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:rx.meshphysical_vert,fragmentShader:rx.meshphysical_frag},toon:{uniforms:Yf([ix.common,ix.aomap,ix.lightmap,ix.emissivemap,ix.bumpmap,ix.normalmap,ix.displacementmap,ix.gradientmap,ix.fog,ix.lights,{emissive:{value:new cf(0)}}]),vertexShader:rx.meshtoon_vert,fragmentShader:rx.meshtoon_frag},matcap:{uniforms:Yf([ix.common,ix.bumpmap,ix.normalmap,ix.displacementmap,ix.fog,{matcap:{value:null}}]),vertexShader:rx.meshmatcap_vert,fragmentShader:rx.meshmatcap_frag},points:{uniforms:Yf([ix.points,ix.fog]),vertexShader:rx.points_vert,fragmentShader:rx.points_frag},dashed:{uniforms:Yf([ix.common,ix.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:rx.linedashed_vert,fragmentShader:rx.linedashed_frag},depth:{uniforms:Yf([ix.common,ix.displacementmap]),vertexShader:rx.depth_vert,fragmentShader:rx.depth_frag},normal:{uniforms:Yf([ix.common,ix.bumpmap,ix.normalmap,ix.displacementmap,{opacity:{value:1}}]),vertexShader:rx.meshnormal_vert,fragmentShader:rx.meshnormal_frag},sprite:{uniforms:Yf([ix.sprite,ix.fog]),vertexShader:rx.sprite_vert,fragmentShader:rx.sprite_frag},background:{uniforms:{uvTransform:{value:new md},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:rx.background_vert,fragmentShader:rx.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new md}},vertexShader:rx.backgroundCube_vert,fragmentShader:rx.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:rx.cube_vert,fragmentShader:rx.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:rx.equirect_vert,fragmentShader:rx.equirect_frag},distanceRGBA:{uniforms:Yf([ix.common,ix.displacementmap,{referencePosition:{value:new hd},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:rx.distanceRGBA_vert,fragmentShader:rx.distanceRGBA_frag},shadow:{uniforms:Yf([ix.lights,ix.fog,{color:{value:new cf(0)},opacity:{value:1}}]),vertexShader:rx.shadow_vert,fragmentShader:rx.shadow_frag}};ax.physical={uniforms:Yf([ax.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new md},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new md},clearcoatNormalScale:{value:new ud(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new md},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new md},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new md},sheen:{value:0},sheenColor:{value:new cf(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new md},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new md},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new md},transmissionSamplerSize:{value:new ud},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new md},attenuationDistance:{value:0},attenuationColor:{value:new cf(0)},specularColor:{value:new cf(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new md},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new md},anisotropyVector:{value:new ud},anisotropyMap:{value:null},anisotropyMapTransform:{value:new md}}]),vertexShader:rx.meshphysical_vert,fragmentShader:rx.meshphysical_frag};const ox={r:0,b:0,g:0},sx=new Th,lx=new gh;function cx(e,t,n,r,i,a,o){const s=new cf(0);let l,c,u=!0===a?0:1,d=null,h=0,f=null;function p(e){let r=!0===e.isScene?e.background:null;return r&&r.isTexture&&(r=(e.backgroundBlurriness>0?n:t).get(r)),r}function m(t,n){t.getRGB(ox,Zf(e)),r.buffers.color.setClear(ox.r,ox.g,ox.b,n,o)}return{getClearColor:function(){return s},setClearColor:function(e,t=1){s.set(e),u=t,m(s,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,m(s,u)},render:function(t){let n=!1;const i=p(t);null===i?m(s,u):i&&i.isColor&&(m(i,1),n=!0);const a=e.xr.getEnvironmentBlendMode();"additive"===a?r.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===a&&r.buffers.color.setClear(0,0,0,0,o),(e.autoClear||n)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){const r=p(n);r&&(r.isCubeTexture||r.mapping===gc)?(void 0===c&&(c=new Wf(new Xf(1,1,1),new Jf({name:"BackgroundCubeMaterial",uniforms:qf(ax.backgroundCube.uniforms),vertexShader:ax.backgroundCube.vertexShader,fragmentShader:ax.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),sx.copy(n.backgroundRotation),sx.x*=-1,sx.y*=-1,sx.z*=-1,r.isCubeTexture&&!1===r.isRenderTargetTexture&&(sx.y*=-1,sx.z*=-1),c.material.uniforms.envMap.value=r,c.material.uniforms.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(lx.makeRotationFromEuler(sx)),c.material.toneMapped=Cd.getTransfer(r.colorSpace)!==Uu,d===r&&h===r.version&&f===e.toneMapping||(c.material.needsUpdate=!0,d=r,h=r.version,f=e.toneMapping),c.layers.enableAll(),t.unshift(c,c.geometry,c.material,0,0,null)):r&&r.isTexture&&(void 0===l&&(l=new Wf(new _v(2,2),new Jf({name:"BackgroundMaterial",uniforms:qf(ax.background.uniforms),vertexShader:ax.background.vertexShader,fragmentShader:ax.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=r,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=Cd.getTransfer(r.colorSpace)!==Uu,!0===r.matrixAutoUpdate&&r.updateMatrix(),l.material.uniforms.uvTransform.value.copy(r.matrix),d===r&&h===r.version&&f===e.toneMapping||(l.material.needsUpdate=!0,d=r,h=r.version,f=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null))},dispose:function(){void 0!==c&&(c.geometry.dispose(),c.material.dispose(),c=void 0),void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}}}function ux(e,t){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),r={},i=c(null);let a=i,o=!1;function s(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function c(e){const t=[],r=[],i=[];for(let a=0;a<n;a++)t[a]=0,r[a]=0,i[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:i,object:e,attributes:{},index:null}}function u(){const e=a.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function d(e){h(e,0)}function h(t,n){const r=a.newAttributes,i=a.enabledAttributes,o=a.attributeDivisors;r[t]=1,0===i[t]&&(e.enableVertexAttribArray(t),i[t]=1),o[t]!==n&&(e.vertexAttribDivisor(t,n),o[t]=n)}function f(){const t=a.newAttributes,n=a.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function p(t,n,r,i,a,o,s){!0===s?e.vertexAttribIPointer(t,n,r,a,o):e.vertexAttribPointer(t,n,r,i,a,o)}function m(){g(),o=!0,a!==i&&(a=i,s(a.object))}function g(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:function(n,i,l,m,g){let v=!1;const y=function(t,n,i){const a=!0===i.wireframe;let o=r[t.id];void 0===o&&(o={},r[t.id]=o);let s=o[n.id];void 0===s&&(s={},o[n.id]=s);let l=s[a];return void 0===l&&(l=c(e.createVertexArray()),s[a]=l),l}(m,l,i);a!==y&&(a=y,s(a.object)),v=function(e,t,n,r){const i=a.attributes,o=t.attributes;let s=0;const l=n.getAttributes();for(const a in l)if(l[a].location>=0){const t=i[a];let n=o[a];if(void 0===n&&("instanceMatrix"===a&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===a&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;s++}return a.attributesNum!==s||a.index!==r}(n,m,l,g),v&&function(e,t,n,r){const i={},o=t.attributes;let s=0;const l=n.getAttributes();for(const a in l)if(l[a].location>=0){let t=o[a];void 0===t&&("instanceMatrix"===a&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===a&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),i[a]=n,s++}a.attributes=i,a.attributesNum=s,a.index=r}(n,m,l,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(v||o)&&(o=!1,function(n,r,i,a){u();const o=a.attributes,s=i.getAttributes(),l=r.defaultAttributeValues;for(const c in s){const r=s[c];if(r.location>=0){let i=o[c];if(void 0===i&&("instanceMatrix"===c&&n.instanceMatrix&&(i=n.instanceMatrix),"instanceColor"===c&&n.instanceColor&&(i=n.instanceColor)),void 0!==i){const o=i.normalized,s=i.itemSize,l=t.get(i);if(void 0===l)continue;const c=l.buffer,u=l.type,f=l.bytesPerElement,m=u===e.INT||u===e.UNSIGNED_INT||i.gpuType===Rc;if(i.isInterleavedBufferAttribute){const t=i.data,l=t.stride,g=i.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<r.locationSize;e++)h(r.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<r.locationSize;e++)d(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<r.locationSize;e++)p(r.location+e,s/r.locationSize,u,o,l*f,(g+s/r.locationSize*e)*f,m)}else{if(i.isInstancedBufferAttribute){for(let e=0;e<r.locationSize;e++)h(r.location+e,i.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<r.locationSize;e++)d(r.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<r.locationSize;e++)p(r.location+e,s/r.locationSize,u,o,s*f,s/r.locationSize*e*f,m)}}else if(void 0!==l){const t=l[c];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(r.location,t);break;case 3:e.vertexAttrib3fv(r.location,t);break;case 4:e.vertexAttrib4fv(r.location,t);break;default:e.vertexAttrib1fv(r.location,t)}}}}f()}(n,i,l,m),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const e in r){const t=r[e];for(const e in t){const n=t[e];for(const e in n)l(n[e].object),delete n[e];delete t[e]}delete r[e]}},releaseStatesOfGeometry:function(e){if(void 0===r[e.id])return;const t=r[e.id];for(const n in t){const e=t[n];for(const t in e)l(e[t].object),delete e[t];delete t[n]}delete r[e.id]},releaseStatesOfProgram:function(e){for(const t in r){const n=r[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)l(i[e].object),delete i[e];delete n[e.id]}},initAttributes:u,enableAttribute:d,disableUnusedAttributes:f}}function dx(e,t,n){let r;function i(t,i,a){0!==a&&(e.drawArraysInstanced(r,t,i,a),n.update(i,r,a))}this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=i,this.renderMultiDraw=function(e,i,a){if(0===a)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,e,0,i,0,a);let o=0;for(let t=0;t<a;t++)o+=i[t];n.update(o,r,1)},this.renderMultiDrawInstances=function(e,a,o,s){if(0===o)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)i(e[t],a[t],s[t]);else{l.multiDrawArraysInstancedWEBGL(r,e,0,a,0,s,0,o);let t=0;for(let e=0;e<o;e++)t+=a[e]*s[e];n.update(t,r,1)}}}function hx(e,t,n,r){let i;function a(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let o=void 0!==n.precision?n.precision:"highp";const s=a(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);const l=!0===n.logarithmicDepthBuffer,c=!0===n.reversedDepthBuffer&&t.has("EXT_clip_control"),u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:a,textureFormatReadable:function(t){return t===jc||r.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const i=n===Ic&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(n!==Tc&&r.convert(n)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==Pc&&!i)},precision:o,logarithmicDepthBuffer:l,reversedDepthBuffer:c,maxTextures:u,maxVertexTextures:d,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:d>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function fx(e){const t=this;let n=null,r=0,i=!1,a=!1;const o=new cm,s=new md,l={value:null,needsUpdate:!1};function c(e,n,r,i){const a=null!==e?e.length:0;let c=null;if(0!==a){if(c=l.value,!0!==i||null===c){const t=r+4*a,i=n.matrixWorldInverse;s.getNormalMatrix(i),(null===c||c.length<t)&&(c=new Float32Array(t));for(let n=0,l=r;n!==a;++n,l+=4)o.copy(e[n]).applyMatrix4(i,s),o.normal.toArray(c,l),c[l+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==r||i;return i=t,r=e.length,n},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(o,s,u){const d=o.clippingPlanes,h=o.clipIntersection,f=o.clipShadows,p=e.get(o);if(!i||null===d||0===d.length||a&&!f)a?c(null):(l.value!==n&&(l.value=n,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0);else{const e=a?0:r,t=4*e;let i=p.clippingState||null;l.value=i,i=c(d,s,t,u);for(let r=0;r!==t;++r)i[r]=n[r];p.clippingState=i,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=e}}}function px(e){let t=new WeakMap;function n(e,t){return t===pc?e.mapping=hc:t===mc&&(e.mapping=fc),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const a=i.mapping;if(a===pc||a===mc){if(t.has(i))return n(t.get(i).texture,i.mapping);{const a=i.image;if(a&&a.height>0){const o=new sp(a.height);return o.fromEquirectangularTexture(e,i),t.set(i,o),i.addEventListener("dispose",r),n(o.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}const mx=[.125,.215,.35,.446,.526,.582],gx=new Ny,vx=new cf;let yx=null,bx=0,xx=0,_x=!1;const wx=(1+Math.sqrt(5))/2,Sx=1/wx,Mx=[new hd(-wx,Sx,0),new hd(wx,Sx,0),new hd(-Sx,0,wx),new hd(Sx,0,wx),new hd(0,wx,-Sx),new hd(0,wx,Sx),new hd(-1,1,-1),new hd(1,1,-1),new hd(-1,1,1),new hd(1,1,1)],Ex=new hd;class Tx{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100,i={}){const{size:a=256,position:o=Ex}=i;yx=this._renderer.getRenderTarget(),bx=this._renderer.getActiveCubeFace(),xx=this._renderer.getActiveMipmapLevel(),_x=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,r,s,o),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Rx(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=kx(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(yx,bx,xx),this._renderer.xr.enabled=_x,e.scissorTest=!1,Ax(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===hc||e.mapping===fc?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),yx=this._renderer.getRenderTarget(),bx=this._renderer.getActiveCubeFace(),xx=this._renderer.getActiveMipmapLevel(),_x=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Sc,minFilter:Sc,generateMipmaps:!1,type:Ic,format:jc,colorSpace:zu,depthBuffer:!1},r=Cx(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Cx(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let i=e;const a=e-4+1+mx.length;for(let o=0;o<a;o++){const a=Math.pow(2,i);n.push(a);let s=1/a;o>e-4?s=mx[o-e+4-1]:0===o&&(s=0),r.push(s);const l=1/(a-2),c=-l,u=1+l,d=[c,c,u,c,u,u,c,c,u,u,c,u],h=6,f=6,p=3,m=2,g=1,v=new Float32Array(p*f*h),y=new Float32Array(m*f*h),b=new Float32Array(g*f*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(r,p*f*e),y.set(d,m*f*e);const i=[e,e,e,e,e,e];b.set(i,g*f*e)}const x=new If;x.setAttribute("position",new wf(v,p)),x.setAttribute("uv",new wf(y,m)),x.setAttribute("faceIndex",new wf(b,g)),t.push(x),i>4&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array(20),i=new hd(0,1,0);return new Jf({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(r,e,t)}return r}_compileMaterial(e){const t=new Wf(this._lodPlanes[0],e);this._renderer.compile(t,gx)}_sceneToCubeUV(e,t,n,r,i){const a=new rp(90,1,t,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,u=l.toneMapping;l.getClearColor(vx),l.toneMapping=0,l.autoClear=!1,l.state.buffers.depth.getReversed()&&(l.setRenderTarget(r),l.clearDepth(),l.setRenderTarget(null));const d=new ff({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new Wf(new Xf,d);let f=!1;const p=e.background;p?p.isColor&&(d.color.copy(p),e.background=null,f=!0):(d.color.copy(vx),f=!0);for(let m=0;m<6;m++){const t=m%3;0===t?(a.up.set(0,o[m],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x+s[m],i.y,i.z)):1===t?(a.up.set(0,0,o[m]),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y+s[m],i.z)):(a.up.set(0,o[m],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y,i.z+s[m]));const n=this._cubeSize;Ax(r,t*n,m>2?n:0,n,n),l.setRenderTarget(r),f&&l.render(h,a),l.render(e,a)}h.geometry.dispose(),h.material.dispose(),l.toneMapping=u,l.autoClear=c,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===hc||e.mapping===fc;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=Rx()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=kx());const i=r?this._cubemapMaterial:this._equirectMaterial,a=new Wf(this._lodPlanes[0],i);i.uniforms.envMap.value=e;const o=this._cubeSize;Ax(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,gx)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let i=1;i<r;i++){const t=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),n=Mx[(r-i-1)%Mx.length];this._blur(e,i-1,i,t,n)}t.autoClear=n}_blur(e,t,n,r,i){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",i),this._halfBlur(a,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,a,o){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Wf(this._lodPlanes[r],l),u=l.uniforms,d=this._sizeLods[n]-1,h=isFinite(i)?Math.PI/(2*d):2*Math.PI/39,f=i/h,p=isFinite(i)?1+Math.floor(3*f):20;p>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${p} samples when the maximum is set to 20`);const m=[];let g=0;for(let b=0;b<20;++b){const e=b/f,t=Math.exp(-e*e/2);m.push(t),0===b?g+=t:b<p&&(g+=2*t)}for(let b=0;b<m.length;b++)m[b]=m[b]/g;u.envMap.value=e.texture,u.samples.value=p,u.weights.value=m,u.latitudinal.value="latitudinal"===a,o&&(u.poleAxis.value=o);const{_lodMax:v}=this;u.dTheta.value=h,u.mipInt.value=v-n;const y=this._sizeLods[r];Ax(t,3*y*(r>v-4?r-v+4:0),4*(this._cubeSize-y),3*y,2*y),s.setRenderTarget(t),s.render(c,gx)}}function Cx(e,t,n){const r=new Bd(e,t,n);return r.texture.mapping=gc,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Ax(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function kx(){return new Jf({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Rx(){return new Jf({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Nx(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const a=i.mapping,o=a===pc||a===mc,s=a===hc||a===fc;if(o||s){let a=t.get(i);const l=void 0!==a?a.texture.pmremVersion:0;if(i.isRenderTargetTexture&&i.pmremVersion!==l)return null===n&&(n=new Tx(e)),a=o?n.fromEquirectangular(i,a):n.fromCubemap(i,a),a.texture.pmremVersion=i.pmremVersion,t.set(i,a),a.texture;if(void 0!==a)return a.texture;{const l=i.image;return o&&l&&l.height>0||s&&l&&function(e){let t=0;for(let n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(l)?(null===n&&(n=new Tx(e)),a=o?n.fromEquirectangular(i):n.fromCubemap(i),a.texture.pmremVersion=i.pmremVersion,t.set(i,a),i.addEventListener("dispose",r),a.texture):null}}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Px(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){const t=n(e);return null===t&&Sd("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Ix(e,t,n,r){const i={},a=new WeakMap;function o(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const n in s.attributes)t.remove(s.attributes[n]);s.removeEventListener("dispose",o),delete i[s.id];const l=a.get(s);l&&(t.remove(l),a.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){const n=[],r=e.index,i=e.attributes.position;let o=0;if(null!==r){const e=r.array;o=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],a=e[t+2];n.push(r,i,i,a,a,r)}}else{if(void 0===i)return;{const e=i.array;o=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}}const s=new(vd(n)?Mf:Sf)(n,1);s.version=o;const l=a.get(e);l&&t.remove(l),a.set(e,s)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",o),i[t.id]=!0,n.memory.geometries++),t},update:function(n){const r=n.attributes;for(const i in r)t.update(r[i],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){const t=a.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function Lx(e,t,n){let r,i,a;function o(t,o,s){0!==s&&(e.drawElementsInstanced(r,o,i,t*a,s),n.update(o,r,s))}this.setMode=function(e){r=e},this.setIndex=function(e){i=e.type,a=e.bytesPerElement},this.render=function(t,o){e.drawElements(r,o,i,t*a),n.update(o,r,1)},this.renderInstances=o,this.renderMultiDraw=function(e,a,o){if(0===o)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,a,0,i,e,0,o);let s=0;for(let t=0;t<o;t++)s+=a[t];n.update(s,r,1)},this.renderMultiDrawInstances=function(e,s,l,c){if(0===l)return;const u=t.get("WEBGL_multi_draw");if(null===u)for(let t=0;t<e.length;t++)o(e[t]/a,s[t],c[t]);else{u.multiDrawElementsInstancedWEBGL(r,s,0,i,e,0,c,0,l);let t=0;for(let e=0;e<l;e++)t+=s[e]*c[e];n.update(t,r,1)}}}function Dx(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,i){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function zx(e,t,n){const r=new WeakMap,i=new Ud;return{update:function(a,o,s){const l=a.morphTargetInfluences,c=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,u=void 0!==c?c.length:0;let d=r.get(o);if(void 0===d||d.count!==u){let e=function(){v.dispose(),r.delete(o),o.removeEventListener("dispose",e)};void 0!==d&&d.texture.dispose();const n=void 0!==o.morphAttributes.position,a=void 0!==o.morphAttributes.normal,s=void 0!==o.morphAttributes.color,l=o.morphAttributes.position||[],c=o.morphAttributes.normal||[],h=o.morphAttributes.color||[];let f=0;!0===n&&(f=1),!0===a&&(f=2),!0===s&&(f=3);let p=o.attributes.position.count*f,m=1;p>t.maxTextureSize&&(m=Math.ceil(p/t.maxTextureSize),p=t.maxTextureSize);const g=new Float32Array(p*m*4*u),v=new jd(g,p,m,u);v.type=Pc,v.needsUpdate=!0;const y=4*f;for(let t=0;t<u;t++){const e=l[t],r=c[t],o=h[t],u=p*m*4*t;for(let t=0;t<e.count;t++){const l=t*y;!0===n&&(i.fromBufferAttribute(e,t),g[u+l+0]=i.x,g[u+l+1]=i.y,g[u+l+2]=i.z,g[u+l+3]=0),!0===a&&(i.fromBufferAttribute(r,t),g[u+l+4]=i.x,g[u+l+5]=i.y,g[u+l+6]=i.z,g[u+l+7]=0),!0===s&&(i.fromBufferAttribute(o,t),g[u+l+8]=i.x,g[u+l+9]=i.y,g[u+l+10]=i.z,g[u+l+11]=4===o.itemSize?i.w:1)}}d={count:u,texture:v,size:new ud(p,m)},r.set(o,d),o.addEventListener("dispose",e)}if(!0===a.isInstancedMesh&&null!==a.morphTexture)s.getUniforms().setValue(e,"morphTexture",a.morphTexture,n);else{let t=0;for(let e=0;e<l.length;e++)t+=l[e];const n=o.morphTargetsRelative?1:1-t;s.getUniforms().setValue(e,"morphTargetBaseInfluence",n),s.getUniforms().setValue(e,"morphTargetInfluences",l)}s.getUniforms().setValue(e,"morphTargetsTexture",d.texture,n),s.getUniforms().setValue(e,"morphTargetsTextureSize",d.size)}}}function Ox(e,t,n,r){let i=new WeakMap;function a(e){const t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(o){const s=r.render.frame,l=o.geometry,c=t.get(o,l);if(i.get(c)!==s&&(t.update(c),i.set(c,s)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",a)&&o.addEventListener("dispose",a),i.get(o)!==s&&(n.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,e.ARRAY_BUFFER),i.set(o,s))),o.isSkinnedMesh){const e=o.skeleton;i.get(e)!==s&&(e.update(),i.set(e,s))}return c},dispose:function(){i=new WeakMap}}}const Ux=new Od,Fx=new ag(1,1),Bx=new jd,jx=new Hd,Hx=new op,Vx=[],Gx=[],Wx=new Float32Array(16),$x=new Float32Array(9),Xx=new Float32Array(4);function qx(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let a=Vx[i];if(void 0===a&&(a=new Float32Array(i),Vx[i]=a),0!==t){r.toArray(a,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(a,i)}return a}function Yx(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Zx(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function Kx(e,t){let n=Gx[t];void 0===n&&(n=new Int32Array(t),Gx[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Jx(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Qx(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Yx(n,t))return;e.uniform2fv(this.addr,t),Zx(n,t)}}function e_(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Yx(n,t))return;e.uniform3fv(this.addr,t),Zx(n,t)}}function t_(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Yx(n,t))return;e.uniform4fv(this.addr,t),Zx(n,t)}}function n_(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Yx(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Zx(n,t)}else{if(Yx(n,r))return;Xx.set(r),e.uniformMatrix2fv(this.addr,!1,Xx),Zx(n,r)}}function r_(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Yx(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Zx(n,t)}else{if(Yx(n,r))return;$x.set(r),e.uniformMatrix3fv(this.addr,!1,$x),Zx(n,r)}}function i_(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Yx(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Zx(n,t)}else{if(Yx(n,r))return;Wx.set(r),e.uniformMatrix4fv(this.addr,!1,Wx),Zx(n,r)}}function a_(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function o_(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Yx(n,t))return;e.uniform2iv(this.addr,t),Zx(n,t)}}function s_(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Yx(n,t))return;e.uniform3iv(this.addr,t),Zx(n,t)}}function l_(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Yx(n,t))return;e.uniform4iv(this.addr,t),Zx(n,t)}}function c_(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function u_(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Yx(n,t))return;e.uniform2uiv(this.addr,t),Zx(n,t)}}function d_(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Yx(n,t))return;e.uniform3uiv(this.addr,t),Zx(n,t)}}function h_(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Yx(n,t))return;e.uniform4uiv(this.addr,t),Zx(n,t)}}function f_(e,t,n){const r=this.cache,i=n.allocateTextureUnit();let a;r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),this.type===e.SAMPLER_2D_SHADOW?(Fx.compareFunction=515,a=Fx):a=Ux,n.setTexture2D(t||a,i)}function p_(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||jx,i)}function m_(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||Hx,i)}function g_(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||Bx,i)}function v_(e,t){e.uniform1fv(this.addr,t)}function y_(e,t){const n=qx(t,this.size,2);e.uniform2fv(this.addr,n)}function b_(e,t){const n=qx(t,this.size,3);e.uniform3fv(this.addr,n)}function x_(e,t){const n=qx(t,this.size,4);e.uniform4fv(this.addr,n)}function __(e,t){const n=qx(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function w_(e,t){const n=qx(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function S_(e,t){const n=qx(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function M_(e,t){e.uniform1iv(this.addr,t)}function E_(e,t){e.uniform2iv(this.addr,t)}function T_(e,t){e.uniform3iv(this.addr,t)}function C_(e,t){e.uniform4iv(this.addr,t)}function A_(e,t){e.uniform1uiv(this.addr,t)}function k_(e,t){e.uniform2uiv(this.addr,t)}function R_(e,t){e.uniform3uiv(this.addr,t)}function N_(e,t){e.uniform4uiv(this.addr,t)}function P_(e,t,n){const r=this.cache,i=t.length,a=Kx(n,i);Yx(r,a)||(e.uniform1iv(this.addr,a),Zx(r,a));for(let o=0;o!==i;++o)n.setTexture2D(t[o]||Ux,a[o])}function I_(e,t,n){const r=this.cache,i=t.length,a=Kx(n,i);Yx(r,a)||(e.uniform1iv(this.addr,a),Zx(r,a));for(let o=0;o!==i;++o)n.setTexture3D(t[o]||jx,a[o])}function L_(e,t,n){const r=this.cache,i=t.length,a=Kx(n,i);Yx(r,a)||(e.uniform1iv(this.addr,a),Zx(r,a));for(let o=0;o!==i;++o)n.setTextureCube(t[o]||Hx,a[o])}function D_(e,t,n){const r=this.cache,i=t.length,a=Kx(n,i);Yx(r,a)||(e.uniform1iv(this.addr,a),Zx(r,a));for(let o=0;o!==i;++o)n.setTexture2DArray(t[o]||Bx,a[o])}class z_{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return Jx;case 35664:return Qx;case 35665:return e_;case 35666:return t_;case 35674:return n_;case 35675:return r_;case 35676:return i_;case 5124:case 35670:return a_;case 35667:case 35671:return o_;case 35668:case 35672:return s_;case 35669:case 35673:return l_;case 5125:return c_;case 36294:return u_;case 36295:return d_;case 36296:return h_;case 35678:case 36198:case 36298:case 36306:case 35682:return f_;case 35679:case 36299:case 36307:return p_;case 35680:case 36300:case 36308:case 36293:return m_;case 36289:case 36303:case 36311:case 36292:return g_}}(t.type)}}class O_{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return v_;case 35664:return y_;case 35665:return b_;case 35666:return x_;case 35674:return __;case 35675:return w_;case 35676:return S_;case 5124:case 35670:return M_;case 35667:case 35671:return E_;case 35668:case 35672:return T_;case 35669:case 35673:return C_;case 5125:return A_;case 36294:return k_;case 36295:return R_;case 36296:return N_;case 35678:case 36198:case 36298:case 36306:case 35682:return P_;case 35679:case 36299:case 36307:return I_;case 35680:case 36300:case 36308:case 36293:return L_;case 36289:case 36303:case 36311:case 36292:return D_}}(t.type)}}class U_{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let i=0,a=r.length;i!==a;++i){const a=r[i];a.setValue(e,t[a.id],n)}}}const F_=/(\w+)(\])?(\[|\.)?/g;function B_(e,t){e.seq.push(t),e.map[t.id]=t}function j_(e,t,n){const r=e.name,i=r.length;for(F_.lastIndex=0;;){const a=F_.exec(r),o=F_.lastIndex;let s=a[1];const l="]"===a[2],c=a[3];if(l&&(s|=0),void 0===c||"["===c&&o+2===i){B_(n,void 0===c?new z_(s,e,t):new O_(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new U_(s),B_(n,e)),n=e}}}class H_{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);j_(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let i=0,a=t.length;i!==a;++i){const a=t[i],o=n[a.id];!1!==o.needsUpdate&&a.setValue(e,o.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n}}function V_(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}let G_=0;const W_=new md;function $_(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=(e.getShaderInfoLog(t)||"").trim();if(r&&""===i)return"";const a=/ERROR: 0:(\d+)/.exec(i);if(a){const r=parseInt(a[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(e,t){const n=e.split("\n"),r=[],i=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let o=i;o<a;o++){const e=o+1;r.push(`${e===t?">":" "} ${e}: ${n[o]}`)}return r.join("\n")}(e.getShaderSource(t),r)}return i}function X_(e,t){const n=function(e){Cd._getMatrix(W_,Cd.workingColorSpace,e);const t=`mat3( ${W_.elements.map(e=>e.toFixed(4))} )`;switch(Cd.getTransfer(e)){case Ou:return[t,"LinearTransferOETF"];case Uu:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",e),[t,"LinearTransferOETF"]}}(t);return[`vec4 ${e}( vec4 value ) {`,`\treturn ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join("\n")}function q_(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="Cineon";break;case 4:n="ACESFilmic";break;case 6:n="AgX";break;case 7:n="Neutral";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const Y_=new hd;function Z_(e){return""!==e}function K_(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function J_(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Q_=/^[ \t]*#include +<([\w\d./]+)>/gm;function ew(e){return e.replace(Q_,nw)}const tw=new Map;function nw(e,t){let n=rx[t];if(void 0===n){const e=tw.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=rx[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return ew(n)}const rw=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function iw(e){return e.replace(rw,aw)}function aw(e,t,n,r){let i="";for(let a=parseInt(t);a<parseInt(n);a++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function ow(e){let t=`precision ${e.precision} float;\n\tprecision ${e.precision} int;\n\tprecision ${e.precision} sampler2D;\n\tprecision ${e.precision} samplerCube;\n\tprecision ${e.precision} sampler3D;\n\tprecision ${e.precision} sampler2DArray;\n\tprecision ${e.precision} sampler2DShadow;\n\tprecision ${e.precision} samplerCubeShadow;\n\tprecision ${e.precision} sampler2DArrayShadow;\n\tprecision ${e.precision} isampler2D;\n\tprecision ${e.precision} isampler3D;\n\tprecision ${e.precision} isamplerCube;\n\tprecision ${e.precision} isampler2DArray;\n\tprecision ${e.precision} usampler2D;\n\tprecision ${e.precision} usampler3D;\n\tprecision ${e.precision} usamplerCube;\n\tprecision ${e.precision} usampler2DArray;\n\t`;return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function sw(e,t,n,r){const i=e.getContext(),a=n.defines;let o=n.vertexShader,s=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case hc:case fc:t="ENVMAP_TYPE_CUBE";break;case gc:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";return e.envMap&&e.envMapMode===fc&&(t="ENVMAP_MODE_REFRACTION"),t}(n),d=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),h=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),f=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Z_).join("\n")}(n),p=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(a),m=i.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(Z_).join("\n"),g.length>0&&(g+="\n"),v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(Z_).join("\n"),v.length>0&&(v+="\n")):(g=[ow(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Z_).join("\n"),v=[ow(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?rx.tonemapping_pars_fragment:"",0!==n.toneMapping?q_("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",rx.colorspace_pars_fragment,X_("linearToOutputTexel",n.outputColorSpace),(Cd.getLuminanceCoefficients(Y_),["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${Y_.x.toFixed(4)}, ${Y_.y.toFixed(4)}, ${Y_.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Z_).join("\n")),o=ew(o),o=K_(o,n),o=J_(o,n),s=ew(s),s=K_(s,n),s=J_(s,n),o=iw(o),s=iw(s),!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=[f,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===Yu?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Yu?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const b=y+g+o,x=y+v+s,_=V_(i,i.VERTEX_SHADER,b),w=V_(i,i.FRAGMENT_SHADER,x);function S(t){if(e.debug.checkShaderErrors){const n=i.getProgramInfoLog(m)||"",r=i.getShaderInfoLog(_)||"",a=i.getShaderInfoLog(w)||"",o=n.trim(),s=r.trim(),l=a.trim();let c=!0,u=!0;if(!1===i.getProgramParameter(m,i.LINK_STATUS))if(c=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(i,m,_,w);else{const e=$_(i,_,"vertex"),n=$_(i,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,i.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+o+"\n"+e+"\n"+n)}else""!==o?console.warn("THREE.WebGLProgram: Program Info Log:",o):""!==s&&""!==l||(u=!1);u&&(t.diagnostics={runnable:c,programLog:o,vertexShader:{log:s,prefix:g},fragmentShader:{log:l,prefix:v}})}i.deleteShader(_),i.deleteShader(w),M=new H_(i,m),E=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i),a=r.name;let o=1;r.type===e.FLOAT_MAT2&&(o=2),r.type===e.FLOAT_MAT3&&(o=3),r.type===e.FLOAT_MAT4&&(o=4),n[a]={type:r.type,location:e.getAttribLocation(t,a),locationSize:o}}return n}(i,m)}let M,E;i.attachShader(m,_),i.attachShader(m,w),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),this.getUniforms=function(){return void 0===M&&S(this),M},this.getAttributes=function(){return void 0===E&&S(this),E};let T=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===T&&(T=i.getProgramParameter(m,37297)),T},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=G_++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=_,this.fragmentShader=w,this}let lw=0;class cw{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(r)&&(a.add(r),r.usedTimes++),!1===a.has(i)&&(a.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new uw(e),t.set(e,n)),n}}class uw{constructor(e){this.id=lw++,this.code=e,this.usedTimes=0}}function dw(e,t,n,r,i,a,o){const s=new Ch,l=new cw,c=new Set,u=[],d=i.logarithmicDepthBuffer,h=i.vertexTextures;let f=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return c.add(e),0===e?"uv":`uv${e}`}return{getParameters:function(a,s,u,g,v){const y=g.fog,b=v.geometry,x=a.isMeshStandardMaterial?g.environment:null,_=(a.isMeshStandardMaterial?n:t).get(a.envMap||x),w=_&&_.mapping===gc?_.image.height:null,S=p[a.type];null!==a.precision&&(f=i.getMaxPrecision(a.precision),f!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",f,"instead."));const M=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,E=void 0!==M?M.length:0;let T,C,A,k,R=0;if(void 0!==b.morphAttributes.position&&(R=1),void 0!==b.morphAttributes.normal&&(R=2),void 0!==b.morphAttributes.color&&(R=3),S){const e=ax[S];T=e.vertexShader,C=e.fragmentShader}else T=a.vertexShader,C=a.fragmentShader,l.update(a),A=l.getVertexShaderID(a),k=l.getFragmentShaderID(a);const N=e.getRenderTarget(),P=e.state.buffers.depth.getReversed(),I=!0===v.isInstancedMesh,L=!0===v.isBatchedMesh,D=!!a.map,z=!!a.matcap,O=!!_,U=!!a.aoMap,F=!!a.lightMap,B=!!a.bumpMap,j=!!a.normalMap,H=!!a.displacementMap,V=!!a.emissiveMap,G=!!a.metalnessMap,W=!!a.roughnessMap,$=a.anisotropy>0,X=a.clearcoat>0,q=a.dispersion>0,Y=a.iridescence>0,Z=a.sheen>0,K=a.transmission>0,J=$&&!!a.anisotropyMap,Q=X&&!!a.clearcoatMap,ee=X&&!!a.clearcoatNormalMap,te=X&&!!a.clearcoatRoughnessMap,ne=Y&&!!a.iridescenceMap,re=Y&&!!a.iridescenceThicknessMap,ie=Z&&!!a.sheenColorMap,ae=Z&&!!a.sheenRoughnessMap,oe=!!a.specularMap,se=!!a.specularColorMap,le=!!a.specularIntensityMap,ce=K&&!!a.transmissionMap,ue=K&&!!a.thicknessMap,de=!!a.gradientMap,he=!!a.alphaMap,fe=a.alphaTest>0,pe=!!a.alphaHash,me=!!a.extensions;let ge=0;a.toneMapped&&(null!==N&&!0!==N.isXRRenderTarget||(ge=e.toneMapping));const ve={shaderID:S,shaderType:a.type,shaderName:a.name,vertexShader:T,fragmentShader:C,defines:a.defines,customVertexShaderID:A,customFragmentShaderID:k,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:f,batching:L,batchingColor:L&&null!==v._colorsTexture,instancing:I,instancingColor:I&&null!==v.instanceColor,instancingMorph:I&&null!==v.morphTexture,supportsVertexTextures:h,outputColorSpace:null===N?e.outputColorSpace:!0===N.isXRRenderTarget?N.texture.colorSpace:zu,alphaToCoverage:!!a.alphaToCoverage,map:D,matcap:z,envMap:O,envMapMode:O&&_.mapping,envMapCubeUVHeight:w,aoMap:U,lightMap:F,bumpMap:B,normalMap:j,displacementMap:h&&H,emissiveMap:V,normalMapObjectSpace:j&&1===a.normalMapType,normalMapTangentSpace:j&&0===a.normalMapType,metalnessMap:G,roughnessMap:W,anisotropy:$,anisotropyMap:J,clearcoat:X,clearcoatMap:Q,clearcoatNormalMap:ee,clearcoatRoughnessMap:te,dispersion:q,iridescence:Y,iridescenceMap:ne,iridescenceThicknessMap:re,sheen:Z,sheenColorMap:ie,sheenRoughnessMap:ae,specularMap:oe,specularColorMap:se,specularIntensityMap:le,transmission:K,transmissionMap:ce,thicknessMap:ue,gradientMap:de,opaque:!1===a.transparent&&1===a.blending&&!1===a.alphaToCoverage,alphaMap:he,alphaTest:fe,alphaHash:pe,combine:a.combine,mapUv:D&&m(a.map.channel),aoMapUv:U&&m(a.aoMap.channel),lightMapUv:F&&m(a.lightMap.channel),bumpMapUv:B&&m(a.bumpMap.channel),normalMapUv:j&&m(a.normalMap.channel),displacementMapUv:H&&m(a.displacementMap.channel),emissiveMapUv:V&&m(a.emissiveMap.channel),metalnessMapUv:G&&m(a.metalnessMap.channel),roughnessMapUv:W&&m(a.roughnessMap.channel),anisotropyMapUv:J&&m(a.anisotropyMap.channel),clearcoatMapUv:Q&&m(a.clearcoatMap.channel),clearcoatNormalMapUv:ee&&m(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:te&&m(a.clearcoatRoughnessMap.channel),iridescenceMapUv:ne&&m(a.iridescenceMap.channel),iridescenceThicknessMapUv:re&&m(a.iridescenceThicknessMap.channel),sheenColorMapUv:ie&&m(a.sheenColorMap.channel),sheenRoughnessMapUv:ae&&m(a.sheenRoughnessMap.channel),specularMapUv:oe&&m(a.specularMap.channel),specularColorMapUv:se&&m(a.specularColorMap.channel),specularIntensityMapUv:le&&m(a.specularIntensityMap.channel),transmissionMapUv:ce&&m(a.transmissionMap.channel),thicknessMapUv:ue&&m(a.thicknessMap.channel),alphaMapUv:he&&m(a.alphaMap.channel),vertexTangents:!!b.attributes.tangent&&(j||$),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!b.attributes.uv&&(D||he),fog:!!y,useFog:!0===a.fog,fogExp2:!!y&&y.isFogExp2,flatShading:!0===a.flatShading&&!1===a.wireframe,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:d,reversedDepthBuffer:P,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:E,morphTextureStride:R,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numLightProbes:s.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:ge,decodeVideoTexture:D&&!0===a.map.isVideoTexture&&Cd.getTransfer(a.map.colorSpace)===Uu,decodeVideoTextureEmissive:V&&!0===a.emissiveMap.isVideoTexture&&Cd.getTransfer(a.emissiveMap.colorSpace)===Uu,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionClipCullDistance:me&&!0===a.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(me&&!0===a.extensions.multiDraw||L)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()};return ve.vertexUv1s=c.has(1),ve.vertexUv2s=c.has(2),ve.vertexUv3s=c.has(3),c.clear(),ve},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.supportsVertexTextures&&s.enable(0),t.instancing&&s.enable(1),t.instancingColor&&s.enable(2),t.instancingMorph&&s.enable(3),t.matcap&&s.enable(4),t.envMap&&s.enable(5),t.normalMapObjectSpace&&s.enable(6),t.normalMapTangentSpace&&s.enable(7),t.clearcoat&&s.enable(8),t.iridescence&&s.enable(9),t.alphaTest&&s.enable(10),t.vertexColors&&s.enable(11),t.vertexAlphas&&s.enable(12),t.vertexUv1s&&s.enable(13),t.vertexUv2s&&s.enable(14),t.vertexUv3s&&s.enable(15),t.vertexTangents&&s.enable(16),t.anisotropy&&s.enable(17),t.alphaHash&&s.enable(18),t.batching&&s.enable(19),t.dispersion&&s.enable(20),t.batchingColor&&s.enable(21),t.gradientMap&&s.enable(22),e.push(s.mask),s.disableAll(),t.fog&&s.enable(0),t.useFog&&s.enable(1),t.flatShading&&s.enable(2),t.logarithmicDepthBuffer&&s.enable(3),t.reversedDepthBuffer&&s.enable(4),t.skinning&&s.enable(5),t.morphTargets&&s.enable(6),t.morphNormals&&s.enable(7),t.morphColors&&s.enable(8),t.premultipliedAlpha&&s.enable(9),t.shadowMapEnabled&&s.enable(10),t.doubleSided&&s.enable(11),t.flipSided&&s.enable(12),t.useDepthPacking&&s.enable(13),t.dithering&&s.enable(14),t.transmission&&s.enable(15),t.sheen&&s.enable(16),t.opaque&&s.enable(17),t.pointsUvs&&s.enable(18),t.decodeVideoTexture&&s.enable(19),t.decodeVideoTextureEmissive&&s.enable(20),t.alphaToCoverage&&s.enable(21),e.push(s.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=p[e.type];let n;if(t){const e=ax[t];n=Kf.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,i=u.length;e<i;e++){const t=u[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new sw(e,n,t,a),u.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function hw(){let e=new WeakMap;return{has:function(t){return e.has(t)},get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function fw(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function pw(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function mw(){const e=[];let t=0;const n=[],r=[],i=[];function a(n,r,i,a,o,s){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:r,material:i,groupOrder:a,renderOrder:n.renderOrder,z:o,group:s},e[t]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=i,l.groupOrder=a,l.renderOrder=n.renderOrder,l.z=o,l.group=s),t++,l}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,o,s,l,c){const u=a(e,t,o,s,l,c);o.transmission>0?r.push(u):!0===o.transparent?i.push(u):n.push(u)},unshift:function(e,t,o,s,l,c){const u=a(e,t,o,s,l,c);o.transmission>0?r.unshift(u):!0===o.transparent?i.unshift(u):n.unshift(u)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||fw),r.length>1&&r.sort(t||pw),i.length>1&&i.sort(t||pw)}}}function gw(){let e=new WeakMap;return{get:function(t,n){const r=e.get(t);let i;return void 0===r?(i=new mw,e.set(t,[i])):n>=r.length?(i=new mw,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function vw(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new hd,color:new cf};break;case"SpotLight":n={position:new hd,direction:new hd,color:new cf,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new hd,color:new cf,distance:0,decay:0};break;case"HemisphereLight":n={direction:new hd,skyColor:new cf,groundColor:new cf};break;case"RectAreaLight":n={color:new cf,position:new hd,halfWidth:new hd,halfHeight:new hd}}return e[t.id]=n,n}}}let yw=0;function bw(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function xw(e){const t=new vw,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ud};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ud,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let s=0;s<9;s++)r.probe.push(new hd);const i=new hd,a=new gh,o=new gh;return{setup:function(i){let a=0,o=0,s=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let l=0,c=0,u=0,d=0,h=0,f=0,p=0,m=0,g=0,v=0,y=0;i.sort(bw);for(let e=0,x=i.length;e<x;e++){const b=i[e],x=b.color,_=b.intensity,w=b.distance,S=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)a+=x.r*_,o+=x.g*_,s+=x.b*_;else if(b.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(b.sh.coefficients[e],_);y++}else if(b.isDirectionalLight){const e=t.get(b);if(e.color.copy(b.color).multiplyScalar(b.intensity),b.castShadow){const e=b.shadow,t=n.get(b);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,r.directionalShadow[l]=t,r.directionalShadowMap[l]=S,r.directionalShadowMatrix[l]=b.shadow.matrix,f++}r.directional[l]=e,l++}else if(b.isSpotLight){const e=t.get(b);e.position.setFromMatrixPosition(b.matrixWorld),e.color.copy(x).multiplyScalar(_),e.distance=w,e.coneCos=Math.cos(b.angle),e.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),e.decay=b.decay,r.spot[u]=e;const i=b.shadow;if(b.map&&(r.spotLightMap[g]=b.map,g++,i.updateMatrices(b),b.castShadow&&v++),r.spotLightMatrix[u]=i.matrix,b.castShadow){const e=n.get(b);e.shadowIntensity=i.intensity,e.shadowBias=i.bias,e.shadowNormalBias=i.normalBias,e.shadowRadius=i.radius,e.shadowMapSize=i.mapSize,r.spotShadow[u]=e,r.spotShadowMap[u]=S,m++}u++}else if(b.isRectAreaLight){const e=t.get(b);e.color.copy(x).multiplyScalar(_),e.halfWidth.set(.5*b.width,0,0),e.halfHeight.set(0,.5*b.height,0),r.rectArea[d]=e,d++}else if(b.isPointLight){const e=t.get(b);if(e.color.copy(b.color).multiplyScalar(b.intensity),e.distance=b.distance,e.decay=b.decay,b.castShadow){const e=b.shadow,t=n.get(b);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,r.pointShadow[c]=t,r.pointShadowMap[c]=S,r.pointShadowMatrix[c]=b.shadow.matrix,p++}r.point[c]=e,c++}else if(b.isHemisphereLight){const e=t.get(b);e.skyColor.copy(b.color).multiplyScalar(_),e.groundColor.copy(b.groundColor).multiplyScalar(_),r.hemi[h]=e,h++}}d>0&&(!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=ix.LTC_FLOAT_1,r.rectAreaLTC2=ix.LTC_FLOAT_2):(r.rectAreaLTC1=ix.LTC_HALF_1,r.rectAreaLTC2=ix.LTC_HALF_2)),r.ambient[0]=a,r.ambient[1]=o,r.ambient[2]=s;const b=r.hash;b.directionalLength===l&&b.pointLength===c&&b.spotLength===u&&b.rectAreaLength===d&&b.hemiLength===h&&b.numDirectionalShadows===f&&b.numPointShadows===p&&b.numSpotShadows===m&&b.numSpotMaps===g&&b.numLightProbes===y||(r.directional.length=l,r.spot.length=u,r.rectArea.length=d,r.point.length=c,r.hemi.length=h,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=p,r.pointShadowMap.length=p,r.spotShadow.length=m,r.spotShadowMap.length=m,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=p,r.spotLightMatrix.length=m+g-v,r.spotLightMap.length=g,r.numSpotLightShadowsWithMaps=v,r.numLightProbes=y,b.directionalLength=l,b.pointLength=c,b.spotLength=u,b.rectAreaLength=d,b.hemiLength=h,b.numDirectionalShadows=f,b.numPointShadows=p,b.numSpotShadows=m,b.numSpotMaps=g,b.numLightProbes=y,r.version=yw++)},setupView:function(e,t){let n=0,s=0,l=0,c=0,u=0;const d=t.matrixWorldInverse;for(let h=0,f=e.length;h<f;h++){const t=e[h];if(t.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),i.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(d),n++}else if(t.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(t.matrixWorld),i.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(d),l++}else if(t.isRectAreaLight){const e=r.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),o.identity(),a.copy(t.matrixWorld),a.premultiply(d),o.extractRotation(a),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),c++}else if(t.isPointLight){const e=r.point[s];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),s++}else if(t.isHemisphereLight){const e=r.hemi[u];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(d),u++}}},state:r}}function _w(e){const t=new xw(e),n=[],r=[],i={lightsArray:n,shadowsArray:r,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){i.camera=e,n.length=0,r.length=0},state:i,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function ww(e){let t=new WeakMap;return{get:function(n,r=0){const i=t.get(n);let a;return void 0===i?(a=new _w(e),t.set(n,[a])):r>=i.length?(a=new _w(e),i.push(a)):a=i[r],a},dispose:function(){t=new WeakMap}}}function Sw(e,t,n){let r=new fm;const i=new ud,a=new ud,o=new Ud,s=new Bv({depthPacking:3201}),l=new jv,c={},u=n.maxTextureSize,d={[Ll]:1,[Dl]:0,[zl]:2},h=new Jf({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ud},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=h.clone();f.defines.HORIZONTAL_PASS=1;const p=new If;p.setAttribute("position",new wf(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Wf(p,h),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let v=this.type;function y(n,r){const a=t.update(m);h.defines.VSM_SAMPLES!==n.blurSamples&&(h.defines.VSM_SAMPLES=n.blurSamples,f.defines.VSM_SAMPLES=n.blurSamples,h.needsUpdate=!0,f.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Bd(i.x,i.y)),h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,a,h,m,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,a,f,m,null)}function b(t,n,r,i){let a=null;const o=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==o)a=o;else if(a=!0===r.isPointLight?l:s,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0||!0===n.alphaToCoverage){const e=a.uuid,t=n.uuid;let r=c[e];void 0===r&&(r={},c[e]=r);let i=r[t];void 0===i&&(i=a.clone(),r[t]=i,n.addEventListener("dispose",_)),a=i}return a.visible=n.visible,a.wireframe=n.wireframe,a.side=3===i?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],a.alphaMap=n.alphaMap,a.alphaTest=!0===n.alphaToCoverage?.5:n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===r.isPointLight&&!0===a.isMeshDistanceMaterial&&(e.properties.get(a).light=r),a}function x(n,i,a,o,s){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);const r=t.update(n),l=n.material;if(Array.isArray(l)){const t=r.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],d=l[u.materialIndex];if(d&&d.visible){const t=b(n,d,o,s);n.onBeforeShadow(e,n,i,a,r,t,u),e.renderBufferDirect(a,null,r,t,n,u),n.onAfterShadow(e,n,i,a,r,t,u)}}}else if(l.visible){const t=b(n,l,o,s);n.onBeforeShadow(e,n,i,a,r,t,null),e.renderBufferDirect(a,null,r,t,n,null),n.onAfterShadow(e,n,i,a,r,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)x(l[e],i,a,o,s)}function _(e){e.target.removeEventListener("dispose",_);for(const t in c){const n=c[t],r=e.target.uuid;r in n&&(n[r].dispose(),delete n[r])}}this.render=function(t,n,s){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),h=e.state;h.setBlending(0),!0===h.buffers.depth.getReversed()?h.buffers.color.setClear(0,0,0,0):h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);const f=3!==v&&3===this.type,p=3===v&&3!==this.type;for(let m=0,g=t.length;m<g;m++){const l=t[m],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;i.copy(c.mapSize);const d=c.getFrameExtents();if(i.multiply(d),a.copy(c.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(a.x=Math.floor(u/d.x),i.x=a.x*d.x,c.mapSize.x=a.x),i.y>u&&(a.y=Math.floor(u/d.y),i.y=a.y*d.y,c.mapSize.y=a.y)),null===c.map||!0===f||!0===p){const e=3!==this.type?{minFilter:xc,magFilter:xc}:{};null!==c.map&&c.map.dispose(),c.map=new Bd(i.x,i.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const g=c.getViewportCount();for(let e=0;e<g;e++){const t=c.getViewport(e);o.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),h.viewport(o),c.updateMatrices(l,e),r=c.getFrustum(),x(n,s,c.camera,l,this.type)}!0!==c.isPointLightShadow&&3===this.type&&y(c,s),c.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,d)}}const Mw={[tc]:1,[rc]:6,[ac]:7,[ic]:5,[nc]:0,[sc]:2,[lc]:4,[oc]:3};function Ew(e,t){const n=new function(){let t=!1;const n=new Ud;let r=null;const i=new Ud(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){!0===s&&(t*=o,r*=o,a*=o),n.set(t,r,a,o),!1===i.equals(n)&&(e.clearColor(t,r,a,o),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},r=new function(){let n=!1,r=!1,i=null,a=null,o=null;return{setReversed:function(e){if(r!==e){const n=t.get("EXT_clip_control");e?n.clipControlEXT(n.LOWER_LEFT_EXT,n.ZERO_TO_ONE_EXT):n.clipControlEXT(n.LOWER_LEFT_EXT,n.NEGATIVE_ONE_TO_ONE_EXT),r=e;const i=o;o=null,this.setClear(i)}},getReversed:function(){return r},setTest:function(t){t?B(e.DEPTH_TEST):j(e.DEPTH_TEST)},setMask:function(t){i===t||n||(e.depthMask(t),i=t)},setFunc:function(t){if(r&&(t=Mw[t]),a!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}a=t}},setLocked:function(e){n=e},setClear:function(t){o!==t&&(r&&(t=1-t),e.clearDepth(t),o=t)},reset:function(){n=!1,i=null,a=null,o=null,r=!1}}},i=new function(){let t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(n){t||(n?B(e.STENCIL_TEST):j(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&i===n&&a===o||(e.stencilFunc(t,n,o),r=t,i=n,a=o)},setOp:function(t,n,r){o===t&&s===n&&l===r||(e.stencilOp(t,n,r),o=t,s=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,c=null}}},a=new WeakMap,o=new WeakMap;let s={},l={},c=new WeakMap,u=[],d=null,h=!1,f=null,p=null,m=null,g=null,v=null,y=null,b=null,x=new cf(0,0,0),_=0,w=!1,S=null,M=null,E=null,T=null,C=null;const A=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let k=!1,R=0;const N=e.getParameter(e.VERSION);-1!==N.indexOf("WebGL")?(R=parseFloat(/^WebGL (\d)/.exec(N)[1]),k=R>=1):-1!==N.indexOf("OpenGL ES")&&(R=parseFloat(/^OpenGL ES (\d)/.exec(N)[1]),k=R>=2);let P=null,I={};const L=e.getParameter(e.SCISSOR_BOX),D=e.getParameter(e.VIEWPORT),z=(new Ud).fromArray(L),O=(new Ud).fromArray(D);function U(t,n,r,i){const a=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let s=0;s<r;s++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,i,0,e.RGBA,e.UNSIGNED_BYTE,a):e.texImage2D(n+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,a);return o}const F={};function B(t){!0!==s[t]&&(e.enable(t),s[t]=!0)}function j(t){!1!==s[t]&&(e.disable(t),s[t]=!1)}F[e.TEXTURE_2D]=U(e.TEXTURE_2D,e.TEXTURE_2D,1),F[e.TEXTURE_CUBE_MAP]=U(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),F[e.TEXTURE_2D_ARRAY]=U(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),F[e.TEXTURE_3D]=U(e.TEXTURE_3D,e.TEXTURE_3D,1,1),n.setClear(0,0,0,1),r.setClear(1),i.setClear(0),B(e.DEPTH_TEST),r.setFunc(3),W(!1),$(1),B(e.CULL_FACE),G(0);const H={[Ol]:e.FUNC_ADD,[Ul]:e.FUNC_SUBTRACT,[Fl]:e.FUNC_REVERSE_SUBTRACT};H[103]=e.MIN,H[104]=e.MAX;const V={[Bl]:e.ZERO,[jl]:e.ONE,[Hl]:e.SRC_COLOR,[Gl]:e.SRC_ALPHA,[Zl]:e.SRC_ALPHA_SATURATE,[ql]:e.DST_COLOR,[$l]:e.DST_ALPHA,[Vl]:e.ONE_MINUS_SRC_COLOR,[Wl]:e.ONE_MINUS_SRC_ALPHA,[Yl]:e.ONE_MINUS_DST_COLOR,[Xl]:e.ONE_MINUS_DST_ALPHA,[Kl]:e.CONSTANT_COLOR,[Jl]:e.ONE_MINUS_CONSTANT_COLOR,[Ql]:e.CONSTANT_ALPHA,[ec]:e.ONE_MINUS_CONSTANT_ALPHA};function G(t,n,r,i,a,o,s,l,c,u){if(0!==t){if(!1===h&&(B(e.BLEND),h=!0),5===t)a=a||n,o=o||r,s=s||i,n===p&&a===v||(e.blendEquationSeparate(H[n],H[a]),p=n,v=a),r===m&&i===g&&o===y&&s===b||(e.blendFuncSeparate(V[r],V[i],V[o],V[s]),m=r,g=i,y=o,b=s),!1!==l.equals(x)&&c===_||(e.blendColor(l.r,l.g,l.b,c),x.copy(l),_=c),f=t,w=!1;else if(t!==f||u!==w){if(p===Ol&&v===Ol||(e.blendEquation(e.FUNC_ADD),p=Ol,v=Ol),u)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ZERO,e.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE,e.ONE,e.ONE);break;case 3:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case 4:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}m=null,g=null,y=null,b=null,x.set(0,0,0),_=0,f=t,w=u}}else!0===h&&(j(e.BLEND),h=!1)}function W(t){S!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),S=t)}function $(t){0!==t?(B(e.CULL_FACE),t!==M&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):j(e.CULL_FACE),M=t}function X(t,n,r){t?(B(e.POLYGON_OFFSET_FILL),T===n&&C===r||(e.polygonOffset(n,r),T=n,C=r)):j(e.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:r,stencil:i},enable:B,disable:j,bindFramebuffer:function(t,n){return l[t]!==n&&(e.bindFramebuffer(t,n),l[t]=n,t===e.DRAW_FRAMEBUFFER&&(l[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(l[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let r=u,i=!1;if(t){r=c.get(n),void 0===r&&(r=[],c.set(n,r));const a=t.textures;if(r.length!==a.length||r[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=a.length;t<n;t++)r[t]=e.COLOR_ATTACHMENT0+t;r.length=a.length,i=!0}}else r[0]!==e.BACK&&(r[0]=e.BACK,i=!0);i&&e.drawBuffers(r)},useProgram:function(t){return d!==t&&(e.useProgram(t),d=t,!0)},setBlending:G,setMaterial:function(t,a){2===t.side?j(e.CULL_FACE):B(e.CULL_FACE);let o=1===t.side;a&&(o=!o),W(o),1===t.blending&&!1===t.transparent?G(0):G(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),r.setFunc(t.depthFunc),r.setTest(t.depthTest),r.setMask(t.depthWrite),n.setMask(t.colorWrite);const s=t.stencilWrite;i.setTest(s),s&&(i.setMask(t.stencilWriteMask),i.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),i.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),X(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?B(e.SAMPLE_ALPHA_TO_COVERAGE):j(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:W,setCullFace:$,setLineWidth:function(t){t!==E&&(k&&e.lineWidth(t),E=t)},setPolygonOffset:X,setScissorTest:function(t){t?B(e.SCISSOR_TEST):j(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+A-1),P!==t&&(e.activeTexture(t),P=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===P?e.TEXTURE0+A-1:P);let i=I[r];void 0===i&&(i={type:void 0,texture:void 0},I[r]=i),i.type===t&&i.texture===n||(P!==r&&(e.activeTexture(r),P=r),e.bindTexture(t,n||F[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=I[P];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{e.compressedTexImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(t,n){let r=o.get(n);void 0===r&&(r=new WeakMap,o.set(n,r));let i=r.get(t);void 0===i&&(i=e.getUniformBlockIndex(n,t.name),r.set(t,i))},uniformBlockBinding:function(t,n){const r=o.get(n).get(t);a.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),a.set(n,r))},texStorage2D:function(){try{e.texStorage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D(...arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===z.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),z.copy(t))},viewport:function(t){!1===O.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),O.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),r.setReversed(!1),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),s={},P=null,I={},l={},c=new WeakMap,u=[],d=null,h=!1,f=null,p=null,m=null,g=null,v=null,y=null,b=null,x=new cf(0,0,0),_=0,w=!1,S=null,M=null,E=null,T=null,C=null,z.set(0,0,e.canvas.width,e.canvas.height),O.set(0,0,e.canvas.width,e.canvas.height),n.reset(),r.reset(),i.reset()}}}function Tw(e,t,n,r,i,a,o){const s=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new ud,u=new WeakMap;let d;const h=new WeakMap;let f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(G){}function p(e,t){return f?new OffscreenCanvas(e,t):xd("canvas")}function m(e,t,n){let r=1;const i=V(e);if((i.width>n||i.height>n)&&(r=n/Math.max(i.width,i.height)),r<1){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame){const n=Math.floor(r*i.width),a=Math.floor(r*i.height);void 0===d&&(d=p(n,a));const o=t?p(n,a):d;return o.width=n,o.height=a,o.getContext("2d").drawImage(e,0,0,n,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+i.width+"x"+i.height+") to ("+n+"x"+a+")."),o}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+i.width+"x"+i.height+")."),e}return e}function g(e){return e.generateMipmaps}function v(t){e.generateMipmap(t)}function y(t){return t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:t.isWebGL3DRenderTarget?e.TEXTURE_3D:t.isWebGLArrayRenderTarget||t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D}function b(n,r,i,a,o=!1){if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let s=r;if(r===e.RED&&(i===e.FLOAT&&(s=e.R32F),i===e.HALF_FLOAT&&(s=e.R16F),i===e.UNSIGNED_BYTE&&(s=e.R8)),r===e.RED_INTEGER&&(i===e.UNSIGNED_BYTE&&(s=e.R8UI),i===e.UNSIGNED_SHORT&&(s=e.R16UI),i===e.UNSIGNED_INT&&(s=e.R32UI),i===e.BYTE&&(s=e.R8I),i===e.SHORT&&(s=e.R16I),i===e.INT&&(s=e.R32I)),r===e.RG&&(i===e.FLOAT&&(s=e.RG32F),i===e.HALF_FLOAT&&(s=e.RG16F),i===e.UNSIGNED_BYTE&&(s=e.RG8)),r===e.RG_INTEGER&&(i===e.UNSIGNED_BYTE&&(s=e.RG8UI),i===e.UNSIGNED_SHORT&&(s=e.RG16UI),i===e.UNSIGNED_INT&&(s=e.RG32UI),i===e.BYTE&&(s=e.RG8I),i===e.SHORT&&(s=e.RG16I),i===e.INT&&(s=e.RG32I)),r===e.RGB_INTEGER&&(i===e.UNSIGNED_BYTE&&(s=e.RGB8UI),i===e.UNSIGNED_SHORT&&(s=e.RGB16UI),i===e.UNSIGNED_INT&&(s=e.RGB32UI),i===e.BYTE&&(s=e.RGB8I),i===e.SHORT&&(s=e.RGB16I),i===e.INT&&(s=e.RGB32I)),r===e.RGBA_INTEGER&&(i===e.UNSIGNED_BYTE&&(s=e.RGBA8UI),i===e.UNSIGNED_SHORT&&(s=e.RGBA16UI),i===e.UNSIGNED_INT&&(s=e.RGBA32UI),i===e.BYTE&&(s=e.RGBA8I),i===e.SHORT&&(s=e.RGBA16I),i===e.INT&&(s=e.RGBA32I)),r===e.RGB&&(i===e.UNSIGNED_INT_5_9_9_9_REV&&(s=e.RGB9_E5),i===e.UNSIGNED_INT_10F_11F_11F_REV&&(s=e.R11F_G11F_B10F)),r===e.RGBA){const t=o?Ou:Cd.getTransfer(a);i===e.FLOAT&&(s=e.RGBA32F),i===e.HALF_FLOAT&&(s=e.RGBA16F),i===e.UNSIGNED_BYTE&&(s=t===Uu?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(s=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(s=e.RGB5_A1)}return s!==e.R16F&&s!==e.R32F&&s!==e.RG16F&&s!==e.RG32F&&s!==e.RGBA16F&&s!==e.RGBA32F||t.get("EXT_color_buffer_float"),s}function x(t,n){let r;return t?null===n||n===Nc||n===zc?r=e.DEPTH24_STENCIL8:n===Pc?r=e.DEPTH32F_STENCIL8:n===kc&&(r=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===Nc||n===zc?r=e.DEPTH_COMPONENT24:n===Pc?r=e.DEPTH_COMPONENT32F:n===kc&&(r=e.DEPTH_COMPONENT16),r}function _(e,t){return!0===g(e)||e.isFramebufferTexture&&e.minFilter!==xc&&e.minFilter!==Sc?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function w(e){const t=e.target;t.removeEventListener("dispose",w),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,i=h.get(n);if(i){const r=i[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&M(e),0===Object.keys(i).length&&h.delete(n)}r.remove(e)}(t),t.isVideoTexture&&u.delete(t)}function S(t){const n=t.target;n.removeEventListener("dispose",S),function(t){const n=r.get(t);if(t.depthTexture&&(t.depthTexture.dispose(),r.remove(t.depthTexture)),t.isWebGLCubeRenderTarget)for(let r=0;r<6;r++){if(Array.isArray(n.__webglFramebuffer[r]))for(let t=0;t<n.__webglFramebuffer[r].length;t++)e.deleteFramebuffer(n.__webglFramebuffer[r][t]);else e.deleteFramebuffer(n.__webglFramebuffer[r]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[r])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const i=t.textures;for(let a=0,s=i.length;a<s;a++){const t=r.get(i[a]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),o.memory.textures--),r.remove(i[a])}r.remove(t)}(n)}function M(t){const n=r.get(t);e.deleteTexture(n.__webglTexture);const i=t.source;delete h.get(i)[n.__cacheKey],o.memory.textures--}let E=0;function T(t,i){const a=r.get(t);if(t.isVideoTexture&&function(e){const t=o.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&!0!==t.isExternalTexture&&t.version>0&&a.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void I(a,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}else t.isExternalTexture&&(a.__webglTexture=t.sourceTexture?t.sourceTexture:null);n.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+i)}const C={[vc]:e.REPEAT,[yc]:e.CLAMP_TO_EDGE,[bc]:e.MIRRORED_REPEAT},A={[xc]:e.NEAREST,[_c]:e.NEAREST_MIPMAP_NEAREST,[wc]:e.NEAREST_MIPMAP_LINEAR,[Sc]:e.LINEAR,[Mc]:e.LINEAR_MIPMAP_NEAREST,[Ec]:e.LINEAR_MIPMAP_LINEAR},k={[Bu]:e.NEVER,[Xu]:e.ALWAYS,[ju]:e.LESS,[Vu]:e.LEQUAL,[Hu]:e.EQUAL,[$u]:e.GEQUAL,[Gu]:e.GREATER,[Wu]:e.NOTEQUAL};function R(n,a){if(a.type!==Pc||!1!==t.has("OES_texture_float_linear")||a.magFilter!==Sc&&a.magFilter!==Mc&&a.magFilter!==wc&&a.magFilter!==Ec&&a.minFilter!==Sc&&a.minFilter!==Mc&&a.minFilter!==wc&&a.minFilter!==Ec||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(n,e.TEXTURE_WRAP_S,C[a.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,C[a.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,C[a.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,A[a.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,A[a.minFilter]),a.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,k[a.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(a.magFilter===xc)return;if(a.minFilter!==wc&&a.minFilter!==Ec)return;if(a.type===Pc&&!1===t.has("OES_texture_float_linear"))return;if(a.anisotropy>1||r.get(a).__currentAnisotropy){const o=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy}}}function N(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w));const i=n.source;let a=h.get(i);void 0===a&&(a={},h.set(i,a));const s=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(s!==t.__cacheKey){void 0===a[s]&&(a[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,r=!0),a[s].usedTimes++;const i=a[t.__cacheKey];void 0!==i&&(a[t.__cacheKey].usedTimes--,0===i.usedTimes&&M(n)),t.__cacheKey=s,t.__webglTexture=a[s].texture}return r}function P(e,t,n){return Math.floor(Math.floor(e/n)/t)}function I(t,o,s){let l=e.TEXTURE_2D;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),o.isData3DTexture&&(l=e.TEXTURE_3D);const c=N(t,o),u=o.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+s);const d=r.get(u);if(u.version!==d.__version||!0===c){n.activeTexture(e.TEXTURE0+s);const t=Cd.getPrimaries(Cd.workingColorSpace),r=o.colorSpace===Lu?null:Cd.getPrimaries(o.colorSpace),h=o.colorSpace===Lu||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,o.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,o.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);let f=m(o.image,!1,i.maxTextureSize);f=H(o,f);const p=a.convert(o.format,o.colorSpace),y=a.convert(o.type);let w,S=b(o.internalFormat,p,y,o.colorSpace,o.isVideoTexture);R(l,o);const M=o.mipmaps,E=!0!==o.isVideoTexture,T=void 0===d.__version||!0===c,C=u.dataReady,A=_(o,f);if(o.isDepthTexture)S=x(o.format===Vc,o.type),T&&(E?n.texStorage2D(e.TEXTURE_2D,1,S,f.width,f.height):n.texImage2D(e.TEXTURE_2D,0,S,f.width,f.height,0,p,y,null));else if(o.isDataTexture)if(M.length>0){E&&T&&n.texStorage2D(e.TEXTURE_2D,A,S,M[0].width,M[0].height);for(let t=0,r=M.length;t<r;t++)w=M[t],E?C&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,p,y,w.data):n.texImage2D(e.TEXTURE_2D,t,S,w.width,w.height,0,p,y,w.data);o.generateMipmaps=!1}else E?(T&&n.texStorage2D(e.TEXTURE_2D,A,S,f.width,f.height),C&&function(t,r,i,a){const o=t.updateRanges;if(0===o.length)n.texSubImage2D(e.TEXTURE_2D,0,0,0,r.width,r.height,i,a,r.data);else{o.sort((e,t)=>e.start-t.start);let s=0;for(let e=1;e<o.length;e++){const t=o[s],n=o[e],i=t.start+t.count,a=P(n.start,r.width,4),l=P(t.start,r.width,4);n.start<=i+1&&a===l&&P(n.start+n.count-1,r.width,4)===a?t.count=Math.max(t.count,n.start+n.count-t.start):(++s,o[s]=n)}o.length=s+1;const l=e.getParameter(e.UNPACK_ROW_LENGTH),c=e.getParameter(e.UNPACK_SKIP_PIXELS),u=e.getParameter(e.UNPACK_SKIP_ROWS);e.pixelStorei(e.UNPACK_ROW_LENGTH,r.width);for(let t=0,d=o.length;t<d;t++){const s=o[t],l=Math.floor(s.start/4),c=Math.ceil(s.count/4),u=l%r.width,d=Math.floor(l/r.width),h=c,f=1;e.pixelStorei(e.UNPACK_SKIP_PIXELS,u),e.pixelStorei(e.UNPACK_SKIP_ROWS,d),n.texSubImage2D(e.TEXTURE_2D,0,u,d,h,f,i,a,r.data)}t.clearUpdateRanges(),e.pixelStorei(e.UNPACK_ROW_LENGTH,l),e.pixelStorei(e.UNPACK_SKIP_PIXELS,c),e.pixelStorei(e.UNPACK_SKIP_ROWS,u)}}(o,f,p,y)):n.texImage2D(e.TEXTURE_2D,0,S,f.width,f.height,0,p,y,f.data);else if(o.isCompressedTexture)if(o.isCompressedArrayTexture){E&&T&&n.texStorage3D(e.TEXTURE_2D_ARRAY,A,S,M[0].width,M[0].height,f.depth);for(let t=0,r=M.length;t<r;t++)if(w=M[t],o.format!==jc)if(null!==p)if(E){if(C)if(o.layerUpdates.size>0){const r=ex(w.width,w.height,o.format,o.type);for(const i of o.layerUpdates){const a=w.data.subarray(i*r/w.data.BYTES_PER_ELEMENT,(i+1)*r/w.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,i,w.width,w.height,1,p,a)}o.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,w.width,w.height,f.depth,p,w.data)}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,S,w.width,w.height,f.depth,0,w.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else E?C&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,w.width,w.height,f.depth,p,y,w.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,S,w.width,w.height,f.depth,0,p,y,w.data)}else{E&&T&&n.texStorage2D(e.TEXTURE_2D,A,S,M[0].width,M[0].height);for(let t=0,r=M.length;t<r;t++)w=M[t],o.format!==jc?null!==p?E?C&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,p,w.data):n.compressedTexImage2D(e.TEXTURE_2D,t,S,w.width,w.height,0,w.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):E?C&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,w.width,w.height,p,y,w.data):n.texImage2D(e.TEXTURE_2D,t,S,w.width,w.height,0,p,y,w.data)}else if(o.isDataArrayTexture)if(E){if(T&&n.texStorage3D(e.TEXTURE_2D_ARRAY,A,S,f.width,f.height,f.depth),C)if(o.layerUpdates.size>0){const t=ex(f.width,f.height,o.format,o.type);for(const r of o.layerUpdates){const i=f.data.subarray(r*t/f.data.BYTES_PER_ELEMENT,(r+1)*t/f.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,r,f.width,f.height,1,p,y,i)}o.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,f.width,f.height,f.depth,p,y,f.data)}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,S,f.width,f.height,f.depth,0,p,y,f.data);else if(o.isData3DTexture)E?(T&&n.texStorage3D(e.TEXTURE_3D,A,S,f.width,f.height,f.depth),C&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,f.width,f.height,f.depth,p,y,f.data)):n.texImage3D(e.TEXTURE_3D,0,S,f.width,f.height,f.depth,0,p,y,f.data);else if(o.isFramebufferTexture){if(T)if(E)n.texStorage2D(e.TEXTURE_2D,A,S,f.width,f.height);else{let t=f.width,r=f.height;for(let i=0;i<A;i++)n.texImage2D(e.TEXTURE_2D,i,S,t,r,0,p,y,null),t>>=1,r>>=1}}else if(M.length>0){if(E&&T){const t=V(M[0]);n.texStorage2D(e.TEXTURE_2D,A,S,t.width,t.height)}for(let t=0,r=M.length;t<r;t++)w=M[t],E?C&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,p,y,w):n.texImage2D(e.TEXTURE_2D,t,S,p,y,w);o.generateMipmaps=!1}else if(E){if(T){const t=V(f);n.texStorage2D(e.TEXTURE_2D,A,S,t.width,t.height)}C&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,p,y,f)}else n.texImage2D(e.TEXTURE_2D,0,S,p,y,f);g(o)&&v(l),d.__version=u.version,o.onUpdate&&o.onUpdate(o)}t.__version=o.version}function L(t,i,o,l,c,u){const d=a.convert(o.format,o.colorSpace),h=a.convert(o.type),f=b(o.internalFormat,d,h,o.colorSpace),p=r.get(i),m=r.get(o);if(m.__renderTarget=i,!p.__hasExternalTextures){const t=Math.max(1,i.width>>u),r=Math.max(1,i.height>>u);c===e.TEXTURE_3D||c===e.TEXTURE_2D_ARRAY?n.texImage3D(c,u,f,t,r,i.depth,0,d,h,null):n.texImage2D(c,u,f,t,r,0,d,h,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),j(i)?s.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,l,c,m.__webglTexture,0,B(i)):(c===e.TEXTURE_2D||c>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,l,c,m.__webglTexture,u),n.bindFramebuffer(e.FRAMEBUFFER,null)}function D(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer){const i=n.depthTexture,a=i&&i.isDepthTexture?i.type:null,o=x(n.stencilBuffer,a),l=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=B(n);j(n)?s.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,c,o,n.width,n.height):r?e.renderbufferStorageMultisample(e.RENDERBUFFER,c,o,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,o,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,t)}else{const t=n.textures;for(let i=0;i<t.length;i++){const o=t[i],l=a.convert(o.format,o.colorSpace),c=a.convert(o.type),u=b(o.internalFormat,l,c,o.colorSpace),d=B(n);r&&!1===j(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,d,u,n.width,n.height):j(n)?s.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,d,u,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,u,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function z(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const a=r.get(i.depthTexture);a.__renderTarget=i,a.__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),T(i.depthTexture,0);const o=a.__webglTexture,l=B(i);if(i.depthTexture.format===Hc)j(i)?s.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);else{if(i.depthTexture.format!==Vc)throw new Error("Unknown depthTexture format");j(i)?s.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0)}}function O(t){const i=r.get(t),a=!0===t.isWebGLCubeRenderTarget;if(i.__boundDepthTexture!==t.depthTexture){const e=t.depthTexture;if(i.__depthDisposeCallback&&i.__depthDisposeCallback(),e){const t=()=>{delete i.__boundDepthTexture,delete i.__depthDisposeCallback,e.removeEventListener("dispose",t)};e.addEventListener("dispose",t),i.__depthDisposeCallback=t}i.__boundDepthTexture=e}if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");const e=t.texture.mipmaps;e&&e.length>0?z(i.__webglFramebuffer[0],t):z(i.__webglFramebuffer,t)}else if(a){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)if(n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[r]),void 0===i.__webglDepthbuffer[r])i.__webglDepthbuffer[r]=e.createRenderbuffer(),D(i.__webglDepthbuffer[r],t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,a=i.__webglDepthbuffer[r];e.bindRenderbuffer(e.RENDERBUFFER,a),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,a)}}else{const r=t.texture.mipmaps;if(r&&r.length>0?n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[0]):n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),void 0===i.__webglDepthbuffer)i.__webglDepthbuffer=e.createRenderbuffer(),D(i.__webglDepthbuffer,t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,r=i.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,r)}}n.bindFramebuffer(e.FRAMEBUFFER,null)}const U=[],F=[];function B(e){return Math.min(i.maxSamples,e.samples)}function j(e){const n=r.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function H(e,t){const n=e.colorSpace,r=e.format,i=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==zu&&n!==Lu&&(Cd.getTransfer(n)===Uu?r===jc&&i===Tc||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),t}function V(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(c.width=e.naturalWidth||e.width,c.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(c.width=e.displayWidth,c.height=e.displayHeight):(c.width=e.width,c.height=e.height),c}this.allocateTextureUnit=function(){const e=E;return e>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+i.maxTextures),E+=1,e},this.resetTextureUnits=function(){E=0},this.setTexture2D=T,this.setTexture2DArray=function(t,i){const a=r.get(t);!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version?I(a,t,i):n.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+i)},this.setTexture3D=function(t,i){const a=r.get(t);!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version?I(a,t,i):n.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+i)},this.setTextureCube=function(t,o){const s=r.get(t);t.version>0&&s.__version!==t.version?function(t,o,s){if(6!==o.image.length)return;const l=N(t,o),c=o.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+s);const u=r.get(c);if(c.version!==u.__version||!0===l){n.activeTexture(e.TEXTURE0+s);const t=Cd.getPrimaries(Cd.workingColorSpace),r=o.colorSpace===Lu?null:Cd.getPrimaries(o.colorSpace),d=o.colorSpace===Lu||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,o.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,o.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);const h=o.isCompressedTexture||o.image[0].isCompressedTexture,f=o.image[0]&&o.image[0].isDataTexture,p=[];for(let e=0;e<6;e++)p[e]=h||f?f?o.image[e].image:o.image[e]:m(o.image[e],!0,i.maxCubemapSize),p[e]=H(o,p[e]);const y=p[0],x=a.convert(o.format,o.colorSpace),w=a.convert(o.type),S=b(o.internalFormat,x,w,o.colorSpace),M=!0!==o.isVideoTexture,E=void 0===u.__version||!0===l,T=c.dataReady;let C,A=_(o,y);if(R(e.TEXTURE_CUBE_MAP,o),h){M&&E&&n.texStorage2D(e.TEXTURE_CUBE_MAP,A,S,y.width,y.height);for(let t=0;t<6;t++){C=p[t].mipmaps;for(let r=0;r<C.length;r++){const i=C[r];o.format!==jc?null!==x?M?T&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,x,i.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,S,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):M?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,x,w,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,S,i.width,i.height,0,x,w,i.data)}}}else{if(C=o.mipmaps,M&&E){C.length>0&&A++;const t=V(p[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,A,S,t.width,t.height)}for(let t=0;t<6;t++)if(f){M?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,p[t].width,p[t].height,x,w,p[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,S,p[t].width,p[t].height,0,x,w,p[t].data);for(let r=0;r<C.length;r++){const i=C[r].image[t].image;M?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,i.width,i.height,x,w,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,S,i.width,i.height,0,x,w,i.data)}}else{M?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,x,w,p[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,S,x,w,p[t]);for(let r=0;r<C.length;r++){const i=C[r];M?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,x,w,i.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,S,x,w,i.image[t])}}}g(o)&&v(e.TEXTURE_CUBE_MAP),u.__version=c.version,o.onUpdate&&o.onUpdate(o)}t.__version=o.version}(s,t,o):n.bindTexture(e.TEXTURE_CUBE_MAP,s.__webglTexture,e.TEXTURE0+o)},this.rebindTextures=function(t,n,i){const a=r.get(t);void 0!==n&&L(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==i&&O(t)},this.setupRenderTarget=function(t){const i=t.texture,s=r.get(t),l=r.get(i);t.addEventListener("dispose",S);const c=t.textures,u=!0===t.isWebGLCubeRenderTarget,d=c.length>1;if(d||(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=i.version,o.memory.textures++),u){s.__webglFramebuffer=[];for(let t=0;t<6;t++)if(i.mipmaps&&i.mipmaps.length>0){s.__webglFramebuffer[t]=[];for(let n=0;n<i.mipmaps.length;n++)s.__webglFramebuffer[t][n]=e.createFramebuffer()}else s.__webglFramebuffer[t]=e.createFramebuffer()}else{if(i.mipmaps&&i.mipmaps.length>0){s.__webglFramebuffer=[];for(let t=0;t<i.mipmaps.length;t++)s.__webglFramebuffer[t]=e.createFramebuffer()}else s.__webglFramebuffer=e.createFramebuffer();if(d)for(let t=0,n=c.length;t<n;t++){const n=r.get(c[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),o.memory.textures++)}if(t.samples>0&&!1===j(t)){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,s.__webglMultisampledFramebuffer);for(let n=0;n<c.length;n++){const r=c[n];s.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,s.__webglColorRenderbuffer[n]);const i=a.convert(r.format,r.colorSpace),o=a.convert(r.type),l=b(r.internalFormat,i,o,r.colorSpace,!0===t.isXRRenderTarget),u=B(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,s.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),D(s.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),R(e.TEXTURE_CUBE_MAP,i);for(let n=0;n<6;n++)if(i.mipmaps&&i.mipmaps.length>0)for(let r=0;r<i.mipmaps.length;r++)L(s.__webglFramebuffer[n][r],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else L(s.__webglFramebuffer[n],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(i)&&v(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(d){for(let i=0,a=c.length;i<a;i++){const a=c[i],o=r.get(a);let l=e.TEXTURE_2D;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(l,o.__webglTexture),R(l,a),L(s.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0+i,l,0),g(a)&&v(l)}n.unbindTexture()}else{let r=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(r,l.__webglTexture),R(r,i),i.mipmaps&&i.mipmaps.length>0)for(let n=0;n<i.mipmaps.length;n++)L(s.__webglFramebuffer[n],t,i,e.COLOR_ATTACHMENT0,r,n);else L(s.__webglFramebuffer,t,i,e.COLOR_ATTACHMENT0,r,0);g(i)&&v(r),n.unbindTexture()}t.depthBuffer&&O(t)},this.updateRenderTargetMipmap=function(e){const t=e.textures;for(let i=0,a=t.length;i<a;i++){const a=t[i];if(g(a)){const t=y(e),i=r.get(a).__webglTexture;n.bindTexture(t,i),v(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===j(t)){const i=t.textures,a=t.width,o=t.height;let s=e.COLOR_BUFFER_BIT;const c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=r.get(t),d=i.length>1;if(d)for(let t=0;t<i.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer);const h=t.texture.mipmaps;h&&h.length>0?n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer[0]):n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<i.length;n++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(s|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(s|=e.STENCIL_BUFFER_BIT)),d){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]);const t=r.get(i[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,a,o,0,0,a,o,s,e.NEAREST),!0===l&&(U.length=0,F.length=0,U.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&!1===t.resolveDepthBuffer&&(U.push(c),F.push(c),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,F)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,U))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),d)for(let t=0;t<i.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const a=r.get(i[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,a,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&l){const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=O,this.setupFrameBufferTexture=L,this.useMultisampledRTT=j}function Cw(e,t){return{convert:function(n,r=""){let i;const a=Cd.getTransfer(r);if(n===Tc)return e.UNSIGNED_BYTE;if(n===Lc)return e.UNSIGNED_SHORT_4_4_4_4;if(n===Dc)return e.UNSIGNED_SHORT_5_5_5_1;if(n===Oc)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===Uc)return e.UNSIGNED_INT_10F_11F_11F_REV;if(n===Cc)return e.BYTE;if(n===Ac)return e.SHORT;if(n===kc)return e.UNSIGNED_SHORT;if(n===Rc)return e.INT;if(n===Nc)return e.UNSIGNED_INT;if(n===Pc)return e.FLOAT;if(n===Ic)return e.HALF_FLOAT;if(n===Fc)return e.ALPHA;if(n===Bc)return e.RGB;if(n===jc)return e.RGBA;if(n===Hc)return e.DEPTH_COMPONENT;if(n===Vc)return e.DEPTH_STENCIL;if(n===Gc)return e.RED;if(n===Wc)return e.RED_INTEGER;if(n===$c)return e.RG;if(n===Xc)return e.RG_INTEGER;if(n===qc)return e.RGBA_INTEGER;if(n===Yc||n===Zc||n===Kc||n===Jc)if(a===Uu){if(i=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(n===Yc)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Zc)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Kc)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Jc)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===Yc)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Zc)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Kc)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Jc)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Qc||n===eu||n===tu||n===nu){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(n===Qc)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===eu)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===tu)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===nu)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===ru||n===iu||n===au){if(i=t.get("WEBGL_compressed_texture_etc"),null===i)return null;if(n===ru||n===iu)return a===Uu?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(n===au)return a===Uu?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(n===ou||n===su||n===lu||n===cu||n===uu||n===du||n===hu||n===fu||n===pu||n===mu||n===gu||n===vu||n===yu||n===bu){if(i=t.get("WEBGL_compressed_texture_astc"),null===i)return null;if(n===ou)return a===Uu?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===su)return a===Uu?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===lu)return a===Uu?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===cu)return a===Uu?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===uu)return a===Uu?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===du)return a===Uu?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===hu)return a===Uu?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===fu)return a===Uu?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===pu)return a===Uu?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===mu)return a===Uu?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===gu)return a===Uu?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===vu)return a===Uu?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===yu)return a===Uu?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===bu)return a===Uu?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===xu||n===_u||n===wu){if(i=t.get("EXT_texture_compression_bptc"),null===i)return null;if(n===xu)return a===Uu?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===_u)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===wu)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===Su||n===Mu||n===Eu||n===Tu){if(i=t.get("EXT_texture_compression_rgtc"),null===i)return null;if(n===Su)return i.COMPRESSED_RED_RGTC1_EXT;if(n===Mu)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Eu)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Tu)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===zc?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}class Aw{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(null===this.texture){const n=new og(e.texture);e.depthNear===t.depthNear&&e.depthFar===t.depthFar||(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,n=new Jf({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Wf(new _v(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class kw extends Ju{constructor(e,t){super();const n=this;let r=null,i=1,a=null,o="local-floor",s=1,l=null,c=null,u=null,d=null,h=null,f=null;const p="undefined"!=typeof XRWebGLBinding,m=new Aw,g={},v=t.getContextAttributes();let y=null,b=null;const x=[],_=[],w=new ud;let S=null;const M=new rp;M.viewport=new Ud;const E=new rp;E.viewport=new Ud;const T=[M,E],C=new Ky;let A=null,k=null;function R(e){const t=_.indexOf(e.inputSource);if(-1===t)return;const n=x[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||a),n.dispatchEvent({type:e.type,data:e.inputSource}))}function N(){r.removeEventListener("select",R),r.removeEventListener("selectstart",R),r.removeEventListener("selectend",R),r.removeEventListener("squeeze",R),r.removeEventListener("squeezestart",R),r.removeEventListener("squeezeend",R),r.removeEventListener("end",N),r.removeEventListener("inputsourceschange",P);for(let e=0;e<x.length;e++){const t=_[e];null!==t&&(_[e]=null,x[e].disconnect(t))}A=null,k=null,m.reset();for(const e in g)delete g[e];e.setRenderTarget(y),h=null,d=null,u=null,r=null,b=null,O.stop(),n.isPresenting=!1,e.setPixelRatio(S),e.setSize(w.width,w.height,!1),n.dispatchEvent({type:"sessionend"})}function P(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=_.indexOf(n);r>=0&&(_[r]=null,x[r].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let r=_.indexOf(n);if(-1===r){for(let e=0;e<x.length;e++){if(e>=_.length){_.push(n),r=e;break}if(null===_[e]){_[e]=n,r=e;break}}if(-1===r)break}const i=x[r];i&&i.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=x[e];return void 0===t&&(t=new up,x[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=x[e];return void 0===t&&(t=new up,x[e]=t),t.getGripSpace()},this.getHand=function(e){let t=x[e];return void 0===t&&(t=new up,x[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==d?d:h},this.getBinding=function(){return null===u&&p&&(u=new XRWebGLBinding(r,t)),u},this.getFrame=function(){return f},this.getSession=function(){return r},this.setSession=async function(c){if(r=c,null!==r){if(y=e.getRenderTarget(),r.addEventListener("select",R),r.addEventListener("selectstart",R),r.addEventListener("selectend",R),r.addEventListener("squeeze",R),r.addEventListener("squeezestart",R),r.addEventListener("squeezeend",R),r.addEventListener("end",N),r.addEventListener("inputsourceschange",P),!0!==v.xrCompatible&&await t.makeXRCompatible(),S=e.getPixelRatio(),e.getSize(w),p&&"createProjectionLayer"in XRWebGLBinding.prototype){let n=null,a=null,o=null;v.depth&&(o=v.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=v.stencil?Vc:Hc,a=v.stencil?zc:Nc);const s={colorFormat:t.RGBA8,depthFormat:o,scaleFactor:i};u=this.getBinding(),d=u.createProjectionLayer(s),r.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),b=new Bd(d.textureWidth,d.textureHeight,{format:jc,type:Tc,depthTexture:new ag(d.textureWidth,d.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0,resolveDepthBuffer:!1===d.ignoreDepthValues,resolveStencilBuffer:!1===d.ignoreDepthValues})}else{const n={antialias:v.antialias,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:i};h=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:h}),e.setPixelRatio(1),e.setSize(h.framebufferWidth,h.framebufferHeight,!1),b=new Bd(h.framebufferWidth,h.framebufferHeight,{format:jc,type:Tc,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil,resolveDepthBuffer:!1===h.ignoreDepthValues,resolveStencilBuffer:!1===h.ignoreDepthValues})}b.isXRRenderTarget=!0,this.setFoveation(s),l=null,a=await r.requestReferenceSpace(o),O.setContext(r),O.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode},this.getDepthTexture=function(){return m.getDepthTexture()};const I=new hd,L=new hd;function D(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;let t=e.near,n=e.far;null!==m.texture&&(m.depthNear>0&&(t=m.depthNear),m.depthFar>0&&(n=m.depthFar)),C.near=E.near=M.near=t,C.far=E.far=M.far=n,A===C.near&&k===C.far||(r.updateRenderState({depthNear:C.near,depthFar:C.far}),A=C.near,k=C.far),C.layers.mask=6|e.layers.mask,M.layers.mask=3&C.layers.mask,E.layers.mask=5&C.layers.mask;const i=e.parent,a=C.cameras;D(C,i);for(let r=0;r<a.length;r++)D(a[r],i);2===a.length?function(e,t,n){I.setFromMatrixPosition(t.matrixWorld),L.setFromMatrixPosition(n.matrixWorld);const r=I.distanceTo(L),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],d=(a[8]+1)/a[0],h=o*u,f=o*d,p=r/(-u+d),m=p*-u;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===i[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=o+p,n=s+p,i=h-m,a=f+(r-m),u=l*s/n*t,d=c*s/n*t;e.projectionMatrix.makePerspective(i,a,u,d,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(C,M,E):C.projectionMatrix.copy(M.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld)),e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*nd*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,C,i)},this.getCamera=function(){return C},this.getFoveation=function(){if(null!==d||null!==h)return s},this.setFoveation=function(e){s=e,null!==d&&(d.fixedFoveation=e),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==m.texture},this.getDepthSensingMesh=function(){return m.getMesh(C)},this.getCameraTexture=function(e){return g[e]};let z=null;const O=new tx;O.setAnimationLoop(function(t,i){if(c=i.getViewerPose(l||a),f=i,null!==c){const t=c.views;null!==h&&(e.setRenderTargetFramebuffer(b,h.framebuffer),e.setRenderTarget(b));let i=!1;t.length!==C.cameras.length&&(C.cameras.length=0,i=!0);for(let n=0;n<t.length;n++){const r=t[n];let a=null;if(null!==h)a=h.getViewport(r);else{const t=u.getViewSubImage(d,r);a=t.viewport,0===n&&(e.setRenderTargetTextures(b,t.colorTexture,t.depthStencilTexture),e.setRenderTarget(b))}let o=T[n];void 0===o&&(o=new rp,o.layers.enable(n),o.viewport=new Ud,T[n]=o),o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(r.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(a.x,a.y,a.width,a.height),0===n&&(C.matrix.copy(o.matrix),C.matrix.decompose(C.position,C.quaternion,C.scale)),!0===i&&C.cameras.push(o)}const a=r.enabledFeatures;if(a&&a.includes("depth-sensing")&&"gpu-optimized"==r.depthUsage&&p){u=n.getBinding();const e=u.getDepthInformation(t[0]);e&&e.isValid&&e.texture&&m.init(e,r.renderState)}if(a&&a.includes("camera-access")&&p){e.state.unbindTexture(),u=n.getBinding();for(let e=0;e<t.length;e++){const n=t[e].camera;if(n){let e=g[n];e||(e=new og,g[n]=e);const t=u.getCameraImage(n);e.sourceTexture=t}}}}for(let e=0;e<x.length;e++){const t=_[e],n=x[e];null!==t&&void 0!==n&&n.update(t,i,l||a)}z&&z(t,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),f=null}),this.setAnimationLoop=function(e){z=e},this.dispose=function(){}}}const Rw=new Th,Nw=new gh;function Pw(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(e,r){e.opacity.value=r.opacity,r.color&&e.diffuse.value.copy(r.color),r.emissive&&e.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(e.map.value=r.map,n(r.map,e.mapTransform)),r.alphaMap&&(e.alphaMap.value=r.alphaMap,n(r.alphaMap,e.alphaMapTransform)),r.bumpMap&&(e.bumpMap.value=r.bumpMap,n(r.bumpMap,e.bumpMapTransform),e.bumpScale.value=r.bumpScale,1===r.side&&(e.bumpScale.value*=-1)),r.normalMap&&(e.normalMap.value=r.normalMap,n(r.normalMap,e.normalMapTransform),e.normalScale.value.copy(r.normalScale),1===r.side&&e.normalScale.value.negate()),r.displacementMap&&(e.displacementMap.value=r.displacementMap,n(r.displacementMap,e.displacementMapTransform),e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias),r.emissiveMap&&(e.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,e.emissiveMapTransform)),r.specularMap&&(e.specularMap.value=r.specularMap,n(r.specularMap,e.specularMapTransform)),r.alphaTest>0&&(e.alphaTest.value=r.alphaTest);const i=t.get(r),a=i.envMap,o=i.envMapRotation;a&&(e.envMap.value=a,Rw.copy(o),Rw.x*=-1,Rw.y*=-1,Rw.z*=-1,a.isCubeTexture&&!1===a.isRenderTargetTexture&&(Rw.y*=-1,Rw.z*=-1),e.envMapRotation.value.setFromMatrix4(Nw.makeRotationFromEuler(Rw)),e.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,e.reflectivity.value=r.reflectivity,e.ior.value=r.ior,e.refractionRatio.value=r.refractionRatio),r.lightMap&&(e.lightMap.value=r.lightMap,e.lightMapIntensity.value=r.lightMapIntensity,n(r.lightMap,e.lightMapTransform)),r.aoMap&&(e.aoMap.value=r.aoMap,e.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Zf(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,i,a,o,s){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(e,i):i.isMeshToonMaterial?(r(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(r(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(r(e,i),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,n(t.metalnessMap,e.metalnessMapTransform)),e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,n(t.roughnessMap,e.roughnessMapTransform)),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform))),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate())),t.dispersion>0&&(e.dispersion.value=t.dispersion),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform))),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform))),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform)),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,i,s)):i.isMeshMatcapMaterial?(r(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?r(e,i):i.isMeshDistanceMaterial?(r(e,i),function(e,n){const r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,i)):i.isMeshNormalMaterial?r(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,r,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*i,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i,a,o):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Iw(e,t,n,r){let i={},a={},o=[];const s=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e,t,n,r){const i=e.value,a=t+"_"+n;if(void 0===r[a])return r[a]="number"==typeof i||"boolean"==typeof i?i:i.clone(),!0;{const e=r[a];if("number"==typeof i||"boolean"==typeof i){if(e!==i)return r[a]=i,!0}else if(!1===e.equals(i))return e.copy(i),!0}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const r=o.indexOf(n.__bindingPointIndex);o.splice(r,1),e.deleteBuffer(i[n.id]),delete i[n.id],delete a[n.id]}return{bind:function(e,t){const n=t.program;r.uniformBlockBinding(e,n)},update:function(n,d){let h=i[n.id];void 0===h&&(function(e){const t=e.uniforms;let n=0;for(let i=0,a=t.length;i<a;i++){const e=Array.isArray(t[i])?t[i]:[t[i]];for(let t=0,r=e.length;t<r;t++){const r=e[t],i=Array.isArray(r.value)?r.value:[r.value];for(let e=0,t=i.length;e<t;e++){const t=c(i[e]),a=n%16,o=a%t.boundary,s=a+o;n+=o,0!==s&&16-s<t.storage&&(n+=16-s),r.__data=new Float32Array(t.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,n+=t.storage}}}const r=n%16;r>0&&(n+=16-r),e.__size=n,e.__cache={}}(n),h=function(t){const n=function(){for(let e=0;e<s;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const r=e.createBuffer(),i=t.__size,a=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,i,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),i[n.id]=h,n.addEventListener("dispose",u));const f=d.program;r.updateUBOMapping(n,f);const p=t.render.frame;a[n.id]!==p&&(function(t){const n=i[t.id],r=t.uniforms,a=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let i=0,o=r.length;i<o;i++){const t=Array.isArray(r[i])?r[i]:[r[i]];for(let n=0,r=t.length;n<r;n++){const r=t[n];if(!0===l(r,i,n,a)){const t=r.__offset,n=Array.isArray(r.value)?r.value:[r.value];let i=0;for(let a=0;a<n.length;a++){const o=n[a],s=c(o);"number"==typeof o||"boolean"==typeof o?(r.__data[0]=o,e.bufferSubData(e.UNIFORM_BUFFER,t+i,r.__data)):o.isMatrix3?(r.__data[0]=o.elements[0],r.__data[1]=o.elements[1],r.__data[2]=o.elements[2],r.__data[3]=0,r.__data[4]=o.elements[3],r.__data[5]=o.elements[4],r.__data[6]=o.elements[5],r.__data[7]=0,r.__data[8]=o.elements[6],r.__data[9]=o.elements[7],r.__data[10]=o.elements[8],r.__data[11]=0):(o.toArray(r.__data,i),i+=s.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,r.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),a[n.id]=p)},dispose:function(){for(const t in i)e.deleteBuffer(i[t]);o=[],i={},a={}}}}class Lw{constructor(e={}){const{canvas:t=_d(),context:n=null,depth:r=!0,stencil:i=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:s=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1,reversedDepthBuffer:d=!1}=e;let h;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!=typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");h=n.getContextAttributes().alpha}else h=a;const f=new Uint32Array(4),p=new Int32Array(4);let m=null,g=null;const v=[],y=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=0,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const b=this;let x=!1;this._outputColorSpace=Du;let _=0,w=0,S=null,M=-1,E=null;const T=new Ud,C=new Ud;let A=null;const k=new cf(0);let R=0,N=t.width,P=t.height,I=1,L=null,D=null;const z=new Ud(0,0,N,P),O=new Ud(0,0,N,P);let U=!1;const F=new fm;let B=!1,j=!1;const H=new gh,V=new hd,G=new Ud,W={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let $=!1;function X(){return null===S?I:1}let q,Y,Z,K,J,Q,ee,te,ne,re,ie,ae,oe,se,le,ce,ue,de,he,fe,pe,me,ge,ve,ye=n;function be(e,n){return t.getContext(e,n)}try{const e={alpha:!0,depth:r,stencil:i,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Nl}`),t.addEventListener("webglcontextlost",we,!1),t.addEventListener("webglcontextrestored",Se,!1),t.addEventListener("webglcontextcreationerror",Me,!1),null===ye){const t="webgl2";if(ye=be(t,e),null===ye)throw be(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(He){throw console.error("THREE.WebGLRenderer: "+He.message),He}function xe(){q=new Px(ye),q.init(),me=new Cw(ye,q),Y=new hx(ye,q,e,me),Z=new Ew(ye,q),Y.reversedDepthBuffer&&d&&Z.buffers.depth.setReversed(!0),K=new Dx(ye),J=new hw,Q=new Tw(ye,q,Z,J,Y,me,K),ee=new px(b),te=new Nx(b),ne=new nx(ye),ge=new ux(ye,ne),re=new Ix(ye,ne,K,ge),ie=new Ox(ye,re,ne,K),he=new zx(ye,Y,Q),ce=new fx(J),ae=new dw(b,ee,te,q,Y,ge,ce),oe=new Pw(b,J),se=new gw,le=new ww(q),de=new cx(b,ee,te,Z,ie,h,s),ue=new Sw(b,ie,Y),ve=new Iw(ye,K,Y,Z),fe=new dx(ye,q,K),pe=new Lx(ye,q,K),K.programs=ae.programs,b.capabilities=Y,b.extensions=q,b.properties=J,b.renderLists=se,b.shadowMap=ue,b.state=Z,b.info=K}xe();const _e=new kw(b,ye);function we(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function Se(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const e=K.autoReset,t=ue.enabled,n=ue.autoUpdate,r=ue.needsUpdate,i=ue.type;xe(),K.autoReset=e,ue.enabled=t,ue.autoUpdate=n,ue.needsUpdate=r,ue.type=i}function Me(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ee(e){const t=e.target;t.removeEventListener("dispose",Ee),function(e){(function(e){const t=J.get(e).programs;void 0!==t&&(t.forEach(function(e){ae.releaseProgram(e)}),e.isShaderMaterial&&ae.releaseShaderCache(e))})(e),J.remove(e)}(t)}function Te(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,ze(e,t,n),e.side=0,e.needsUpdate=!0,ze(e,t,n),e.side=2):ze(e,t,n)}this.xr=_e,this.getContext=function(){return ye},this.getContextAttributes=function(){return ye.getContextAttributes()},this.forceContextLoss=function(){const e=q.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=q.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return I},this.setPixelRatio=function(e){void 0!==e&&(I=e,this.setSize(N,P,!1))},this.getSize=function(e){return e.set(N,P)},this.setSize=function(e,n,r=!0){_e.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(N=e,P=n,t.width=Math.floor(e*I),t.height=Math.floor(n*I),!0===r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(N*I,P*I).floor()},this.setDrawingBufferSize=function(e,n,r){N=e,P=n,I=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(T)},this.getViewport=function(e){return e.copy(z)},this.setViewport=function(e,t,n,r){e.isVector4?z.set(e.x,e.y,e.z,e.w):z.set(e,t,n,r),Z.viewport(T.copy(z).multiplyScalar(I).round())},this.getScissor=function(e){return e.copy(O)},this.setScissor=function(e,t,n,r){e.isVector4?O.set(e.x,e.y,e.z,e.w):O.set(e,t,n,r),Z.scissor(C.copy(O).multiplyScalar(I).round())},this.getScissorTest=function(){return U},this.setScissorTest=function(e){Z.setScissorTest(U=e)},this.setOpaqueSort=function(e){L=e},this.setTransparentSort=function(e){D=e},this.getClearColor=function(e){return e.copy(de.getClearColor())},this.setClearColor=function(){de.setClearColor(...arguments)},this.getClearAlpha=function(){return de.getClearAlpha()},this.setClearAlpha=function(){de.setClearAlpha(...arguments)},this.clear=function(e=!0,t=!0,n=!0){let r=0;if(e){let e=!1;if(null!==S){const t=S.texture.format;e=t===qc||t===Xc||t===Wc}if(e){const e=S.texture.type,t=e===Tc||e===Nc||e===kc||e===zc||e===Lc||e===Dc,n=de.getClearColor(),r=de.getClearAlpha(),i=n.r,a=n.g,o=n.b;t?(f[0]=i,f[1]=a,f[2]=o,f[3]=r,ye.clearBufferuiv(ye.COLOR,0,f)):(p[0]=i,p[1]=a,p[2]=o,p[3]=r,ye.clearBufferiv(ye.COLOR,0,p))}else r|=ye.COLOR_BUFFER_BIT}t&&(r|=ye.DEPTH_BUFFER_BIT),n&&(r|=ye.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ye.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",we,!1),t.removeEventListener("webglcontextrestored",Se,!1),t.removeEventListener("webglcontextcreationerror",Me,!1),de.dispose(),se.dispose(),le.dispose(),J.dispose(),ee.dispose(),te.dispose(),ie.dispose(),ge.dispose(),ve.dispose(),ae.dispose(),_e.dispose(),_e.removeEventListener("sessionstart",Ae),_e.removeEventListener("sessionend",ke),Re.stop()},this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=W);const o=i.isMesh&&i.matrixWorld.determinant()<0,s=function(e,t,n,r,i){!0!==t.isScene&&(t=W),Q.resetTextureUnits();const a=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===S?b.outputColorSpace:!0===S.isXRRenderTarget?S.texture.colorSpace:zu,l=(r.isMeshStandardMaterial?te:ee).get(r.envMap||o),c=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),d=!!n.morphAttributes.position,h=!!n.morphAttributes.normal,f=!!n.morphAttributes.color;let p=0;r.toneMapped&&(null!==S&&!0!==S.isXRRenderTarget||(p=b.toneMapping));const m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==m?m.length:0,y=J.get(r),x=g.state.lights;if(!0===B&&(!0===j||e!==E)){const t=e===E&&r.id===M;ce.setState(r,e,t)}let _=!1;r.version===y.__version?y.needsLights&&y.lightsStateVersion!==x.state.version||y.outputColorSpace!==s||i.isBatchedMesh&&!1===y.batching?_=!0:i.isBatchedMesh||!0!==y.batching?i.isBatchedMesh&&!0===y.batchingColor&&null===i.colorTexture||i.isBatchedMesh&&!1===y.batchingColor&&null!==i.colorTexture||i.isInstancedMesh&&!1===y.instancing?_=!0:i.isInstancedMesh||!0!==y.instancing?i.isSkinnedMesh&&!1===y.skinning?_=!0:i.isSkinnedMesh||!0!==y.skinning?i.isInstancedMesh&&!0===y.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===y.instancingColor&&null!==i.instanceColor||i.isInstancedMesh&&!0===y.instancingMorph&&null===i.morphTexture||i.isInstancedMesh&&!1===y.instancingMorph&&null!==i.morphTexture||y.envMap!==l||!0===r.fog&&y.fog!==a?_=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===ce.numPlanes&&y.numIntersection===ce.numIntersection?(y.vertexAlphas!==c||y.vertexTangents!==u||y.morphTargets!==d||y.morphNormals!==h||y.morphColors!==f||y.toneMapping!==p||y.morphTargetsCount!==v)&&(_=!0):_=!0:_=!0:_=!0:_=!0:(_=!0,y.__version=r.version);let w=y.currentProgram;!0===_&&(w=ze(r,t,i));let T=!1,C=!1,A=!1;const k=w.getUniforms(),R=y.uniforms;if(Z.useProgram(w.program)&&(T=!0,C=!0,A=!0),r.id!==M&&(M=r.id,C=!0),T||E!==e){Z.buffers.depth.getReversed()&&!0!==e.reversedDepth&&(e._reversedDepth=!0,e.updateProjectionMatrix()),k.setValue(ye,"projectionMatrix",e.projectionMatrix),k.setValue(ye,"viewMatrix",e.matrixWorldInverse);const t=k.map.cameraPosition;void 0!==t&&t.setValue(ye,V.setFromMatrixPosition(e.matrixWorld)),Y.logarithmicDepthBuffer&&k.setValue(ye,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&k.setValue(ye,"isOrthographic",!0===e.isOrthographicCamera),E!==e&&(E=e,C=!0,A=!0)}if(i.isSkinnedMesh){k.setOptional(ye,i,"bindMatrix"),k.setOptional(ye,i,"bindMatrixInverse");const e=i.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),k.setValue(ye,"boneTexture",e.boneTexture,Q))}i.isBatchedMesh&&(k.setOptional(ye,i,"batchingTexture"),k.setValue(ye,"batchingTexture",i._matricesTexture,Q),k.setOptional(ye,i,"batchingIdTexture"),k.setValue(ye,"batchingIdTexture",i._indirectTexture,Q),k.setOptional(ye,i,"batchingColorTexture"),null!==i._colorsTexture&&k.setValue(ye,"batchingColorTexture",i._colorsTexture,Q));const N=n.morphAttributes;var L,D;if(void 0===N.position&&void 0===N.normal&&void 0===N.color||he.update(i,n,w),(C||y.receiveShadow!==i.receiveShadow)&&(y.receiveShadow=i.receiveShadow,k.setValue(ye,"receiveShadow",i.receiveShadow)),r.isMeshGouraudMaterial&&null!==r.envMap&&(R.envMap.value=l,R.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),r.isMeshStandardMaterial&&null===r.envMap&&null!==t.environment&&(R.envMapIntensity.value=t.environmentIntensity),C&&(k.setValue(ye,"toneMappingExposure",b.toneMappingExposure),y.needsLights&&(D=A,(L=R).ambientLightColor.needsUpdate=D,L.lightProbe.needsUpdate=D,L.directionalLights.needsUpdate=D,L.directionalLightShadows.needsUpdate=D,L.pointLights.needsUpdate=D,L.pointLightShadows.needsUpdate=D,L.spotLights.needsUpdate=D,L.spotLightShadows.needsUpdate=D,L.rectAreaLights.needsUpdate=D,L.hemisphereLights.needsUpdate=D),a&&!0===r.fog&&oe.refreshFogUniforms(R,a),oe.refreshMaterialUniforms(R,r,I,P,g.state.transmissionRenderTarget[e.id]),H_.upload(ye,Oe(y),R,Q)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(H_.upload(ye,Oe(y),R,Q),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&k.setValue(ye,"center",i.center),k.setValue(ye,"modelViewMatrix",i.modelViewMatrix),k.setValue(ye,"normalMatrix",i.normalMatrix),k.setValue(ye,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const e=r.uniformsGroups;for(let t=0,n=e.length;t<n;t++){const n=e[t];ve.update(n,w),ve.bind(n,w)}}return w}(e,t,n,r,i);Z.setMaterial(r,o);let l=n.index,c=1;if(!0===r.wireframe){if(l=re.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,d=n.attributes.position;let h=u.start*c,f=(u.start+u.count)*c;null!==a&&(h=Math.max(h,a.start*c),f=Math.min(f,(a.start+a.count)*c)),null!==l?(h=Math.max(h,0),f=Math.min(f,l.count)):null!=d&&(h=Math.max(h,0),f=Math.min(f,d.count));const p=f-h;if(p<0||p===1/0)return;let m;ge.setup(i,r,s,n,l);let v=fe;if(null!==l&&(m=ne.get(l),v=pe,v.setIndex(m)),i.isMesh)!0===r.wireframe?(Z.setLineWidth(r.wireframeLinewidth*X()),v.setMode(ye.LINES)):v.setMode(ye.TRIANGLES);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),Z.setLineWidth(e*X()),i.isLineSegments?v.setMode(ye.LINES):i.isLineLoop?v.setMode(ye.LINE_LOOP):v.setMode(ye.LINE_STRIP)}else i.isPoints?v.setMode(ye.POINTS):i.isSprite&&v.setMode(ye.TRIANGLES);if(i.isBatchedMesh)if(null!==i._multiDrawInstances)Sd("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),v.renderMultiDrawInstances(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount,i._multiDrawInstances);else if(q.get("WEBGL_multi_draw"))v.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount);else{const e=i._multiDrawStarts,t=i._multiDrawCounts,n=i._multiDrawCount,a=l?ne.get(l).bytesPerElement:1,o=J.get(r).currentProgram.getUniforms();for(let r=0;r<n;r++)o.setValue(ye,"_gl_DrawID",r),v.render(e[r]/a,t[r])}else if(i.isInstancedMesh)v.renderInstances(h,p,i.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);v.renderInstances(h,p,t)}else v.render(h,p)},this.compile=function(e,t,n=null){null===n&&(n=e),g=le.get(n),g.init(t),y.push(g),n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))}),e!==n&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))}),g.setupLights();const r=new Set;return e.traverse(function(e){if(!(e.isMesh||e.isPoints||e.isLine||e.isSprite))return;const t=e.material;if(t)if(Array.isArray(t))for(let i=0;i<t.length;i++){const a=t[i];Te(a,n,e),r.add(a)}else Te(t,n,e),r.add(t)}),g=y.pop(),r},this.compileAsync=function(e,t,n=null){const r=this.compile(e,t,n);return new Promise(t=>{function n(){r.forEach(function(e){J.get(e).currentProgram.isReady()&&r.delete(e)}),0!==r.size?setTimeout(n,10):t(e)}null!==q.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let Ce=null;function Ae(){Re.stop()}function ke(){Re.start()}const Re=new tx;function Ne(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)g.pushLight(e),e.castShadow&&g.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||F.intersectsSprite(e)){r&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(H);const t=ie.update(e),i=e.material;i.visible&&m.push(e,t,i,n,G.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||F.intersectsObject(e))){const t=ie.update(e),i=e.material;if(r&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),G.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),G.copy(t.boundingSphere.center)),G.applyMatrix4(e.matrixWorld).applyMatrix4(H)),Array.isArray(i)){const r=t.groups;for(let a=0,o=r.length;a<o;a++){const o=r[a],s=i[o.materialIndex];s&&s.visible&&m.push(e,t,s,n,G.z,o)}}else i.visible&&m.push(e,t,i,n,G.z,null)}const i=e.children;for(let a=0,o=i.length;a<o;a++)Ne(i[a],t,n,r)}function Pe(e,t,n,r){const i=e.opaque,a=e.transmissive,o=e.transparent;g.setupLightsView(n),!0===B&&ce.setGlobalState(b.clippingPlanes,n),r&&Z.viewport(T.copy(r)),i.length>0&&Le(i,t,n),a.length>0&&Le(a,t,n),o.length>0&&Le(o,t,n),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1)}function Ie(e,t,n,r){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===g.state.transmissionRenderTarget[r.id]&&(g.state.transmissionRenderTarget[r.id]=new Bd(1,1,{generateMipmaps:!0,type:q.has("EXT_color_buffer_half_float")||q.has("EXT_color_buffer_float")?Ic:Tc,minFilter:Ec,samples:4,stencilBuffer:i,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Cd.workingColorSpace}));const a=g.state.transmissionRenderTarget[r.id],o=r.viewport||T;a.setSize(o.z*b.transmissionResolutionScale,o.w*b.transmissionResolutionScale);const s=b.getRenderTarget(),l=b.getActiveCubeFace(),c=b.getActiveMipmapLevel();b.setRenderTarget(a),b.getClearColor(k),R=b.getClearAlpha(),R<1&&b.setClearColor(16777215,.5),b.clear(),$&&de.render(n);const u=b.toneMapping;b.toneMapping=0;const d=r.viewport;if(void 0!==r.viewport&&(r.viewport=void 0),g.setupLightsView(r),!0===B&&ce.setGlobalState(b.clippingPlanes,r),Le(e,n,r),Q.updateMultisampleRenderTarget(a),Q.updateRenderTargetMipmap(a),!1===q.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let i=0,a=t.length;i<a;i++){const a=t[i],o=a.object,s=a.geometry,l=a.material,c=a.group;if(2===l.side&&o.layers.test(r.layers)){const t=l.side;l.side=1,l.needsUpdate=!0,De(o,n,r,s,l,c),l.side=t,l.needsUpdate=!0,e=!0}}!0===e&&(Q.updateMultisampleRenderTarget(a),Q.updateRenderTargetMipmap(a))}b.setRenderTarget(s,l,c),b.setClearColor(k,R),void 0!==d&&(r.viewport=d),b.toneMapping=u}function Le(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,a=e.length;i<a;i++){const a=e[i],o=a.object,s=a.geometry,l=a.group;let c=a.material;!0===c.allowOverride&&null!==r&&(c=r),o.layers.test(n.layers)&&De(o,t,n,s,c,l)}}function De(e,t,n,r,i,a){e.onBeforeRender(b,t,n,r,i,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(b,t,n,r,e,a),!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,i.needsUpdate=!0,b.renderBufferDirect(n,t,r,i,e,a),i.side=0,i.needsUpdate=!0,b.renderBufferDirect(n,t,r,i,e,a),i.side=2):b.renderBufferDirect(n,t,r,i,e,a),e.onAfterRender(b,t,n,r,i,a)}function ze(e,t,n){!0!==t.isScene&&(t=W);const r=J.get(e),i=g.state.lights,a=g.state.shadowsArray,o=i.state.version,s=ae.getParameters(e,i.state,a,t,n),l=ae.getProgramCacheKey(s);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?te:ee).get(e.envMap||r.environment),r.envMapRotation=null!==r.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===c&&(e.addEventListener("dispose",Ee),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===o)return Ue(e,s),u}else s.uniforms=ae.getUniforms(e),e.onBeforeCompile(s,b),u=ae.acquireProgram(s,l),c.set(l,u),r.uniforms=s.uniforms;const d=r.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(d.clippingPlanes=ce.uniform),Ue(e,s),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=o,r.needsLights&&(d.ambientLightColor.value=i.state.ambient,d.lightProbe.value=i.state.probe,d.directionalLights.value=i.state.directional,d.directionalLightShadows.value=i.state.directionalShadow,d.spotLights.value=i.state.spot,d.spotLightShadows.value=i.state.spotShadow,d.rectAreaLights.value=i.state.rectArea,d.ltc_1.value=i.state.rectAreaLTC1,d.ltc_2.value=i.state.rectAreaLTC2,d.pointLights.value=i.state.point,d.pointLightShadows.value=i.state.pointShadow,d.hemisphereLights.value=i.state.hemi,d.directionalShadowMap.value=i.state.directionalShadowMap,d.directionalShadowMatrix.value=i.state.directionalShadowMatrix,d.spotShadowMap.value=i.state.spotShadowMap,d.spotLightMatrix.value=i.state.spotLightMatrix,d.spotLightMap.value=i.state.spotLightMap,d.pointShadowMap.value=i.state.pointShadowMap,d.pointShadowMatrix.value=i.state.pointShadowMatrix),r.currentProgram=u,r.uniformsList=null,u}function Oe(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=H_.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Ue(e,t){const n=J.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Re.setAnimationLoop(function(e){Ce&&Ce(e)}),"undefined"!=typeof self&&Re.setContext(self),this.setAnimationLoop=function(e){Ce=e,_e.setAnimationLoop(e),null===e?Re.stop():Re.start()},_e.addEventListener("sessionstart",Ae),_e.addEventListener("sessionend",ke),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===x)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===_e.enabled&&!0===_e.isPresenting&&(!0===_e.cameraAutoUpdate&&_e.updateCamera(t),t=_e.getCamera()),!0===e.isScene&&e.onBeforeRender(b,e,t,S),g=le.get(e,y.length),g.init(t),y.push(g),H.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),F.setFromProjectionMatrix(H,Zu,t.reversedDepth),j=this.localClippingEnabled,B=ce.init(this.clippingPlanes,j),m=se.get(e,v.length),m.init(),v.push(m),!0===_e.enabled&&!0===_e.isPresenting){const e=b.xr.getDepthSensingMesh();null!==e&&Ne(e,t,-1/0,b.sortObjects)}Ne(e,t,0,b.sortObjects),m.finish(),!0===b.sortObjects&&m.sort(L,D),$=!1===_e.enabled||!1===_e.isPresenting||!1===_e.hasDepthSensing(),$&&de.addToRenderList(m,e),this.info.render.frame++,!0===B&&ce.beginShadows();const n=g.state.shadowsArray;ue.render(n,e,t),!0===B&&ce.endShadows(),!0===this.info.autoReset&&this.info.reset();const r=m.opaque,i=m.transmissive;if(g.setupLights(),t.isArrayCamera){const n=t.cameras;if(i.length>0)for(let t=0,a=n.length;t<a;t++)Ie(r,i,e,n[t]);$&&de.render(e);for(let t=0,r=n.length;t<r;t++){const r=n[t];Pe(m,e,r,r.viewport)}}else i.length>0&&Ie(r,i,e,t),$&&de.render(e),Pe(m,e,t);null!==S&&0===w&&(Q.updateMultisampleRenderTarget(S),Q.updateRenderTargetMipmap(S)),!0===e.isScene&&e.onAfterRender(b,e,t),ge.resetDefaultState(),M=-1,E=null,y.pop(),y.length>0?(g=y[y.length-1],!0===B&&ce.setGlobalState(b.clippingPlanes,g.state.camera)):g=null,v.pop(),m=v.length>0?v[v.length-1]:null},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(e,t,n){const r=J.get(e);r.__autoAllocateDepthBuffer=!1===e.resolveDepthBuffer,!1===r.__autoAllocateDepthBuffer&&(r.__useRenderToTexture=!1),J.get(e.texture).__webglTexture=t,J.get(e.depthTexture).__webglTexture=r.__autoAllocateDepthBuffer?void 0:n,r.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(e,t){const n=J.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t};const Fe=ye.createFramebuffer();this.setRenderTarget=function(e,t=0,n=0){S=e,_=t,w=n;let r=!0,i=null,a=!1,o=!1;if(e){const s=J.get(e);if(void 0!==s.__useDefaultFramebuffer)Z.bindFramebuffer(ye.FRAMEBUFFER,null),r=!1;else if(void 0===s.__webglFramebuffer)Q.setupRenderTarget(e);else if(s.__hasExternalTextures)Q.rebindTextures(e,J.get(e.texture).__webglTexture,J.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){const t=e.depthTexture;if(s.__boundDepthTexture!==t){if(null!==t&&J.has(t)&&(e.width!==t.image.width||e.height!==t.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Q.setupDepthRenderbuffer(e)}}const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(o=!0);const c=J.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=Array.isArray(c[t])?c[t][n]:c[t],a=!0):i=e.samples>0&&!1===Q.useMultisampledRTT(e)?J.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,T.copy(e.viewport),C.copy(e.scissor),A=e.scissorTest}else T.copy(z).multiplyScalar(I).floor(),C.copy(O).multiplyScalar(I).floor(),A=U;if(0!==n&&(i=Fe),Z.bindFramebuffer(ye.FRAMEBUFFER,i)&&r&&Z.drawBuffers(e,i),Z.viewport(T),Z.scissor(C),Z.setScissorTest(A),a){const r=J.get(e.texture);ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(o){const r=t;for(let t=0;t<e.textures.length;t++){const i=J.get(e.textures[t]);ye.framebufferTextureLayer(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0+t,i.__webglTexture,n,r)}}else if(null!==e&&0!==n){const t=J.get(e.texture);ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_2D,t.__webglTexture,n)}M=-1},this.readRenderTargetPixels=function(e,t,n,r,i,a,o,s=0){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=J.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(l=l[o]),l){Z.bindFramebuffer(ye.FRAMEBUFFER,l);try{const o=e.textures[s],l=o.format,c=o.type;if(!Y.textureFormatReadable(l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!Y.textureTypeReadable(c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&(e.textures.length>1&&ye.readBuffer(ye.COLOR_ATTACHMENT0+s),ye.readPixels(t,n,r,i,me.convert(l),me.convert(c),a))}finally{const e=null!==S?J.get(S).__webglFramebuffer:null;Z.bindFramebuffer(ye.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,n,r,i,a,o,s=0){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let l=J.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(l=l[o]),l){if(t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i){Z.bindFramebuffer(ye.FRAMEBUFFER,l);const o=e.textures[s],c=o.format,u=o.type;if(!Y.textureFormatReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Y.textureTypeReadable(u))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const d=ye.createBuffer();ye.bindBuffer(ye.PIXEL_PACK_BUFFER,d),ye.bufferData(ye.PIXEL_PACK_BUFFER,a.byteLength,ye.STREAM_READ),e.textures.length>1&&ye.readBuffer(ye.COLOR_ATTACHMENT0+s),ye.readPixels(t,n,r,i,me.convert(c),me.convert(u),0);const h=null!==S?J.get(S).__webglFramebuffer:null;Z.bindFramebuffer(ye.FRAMEBUFFER,h);const f=ye.fenceSync(ye.SYNC_GPU_COMMANDS_COMPLETE,0);return ye.flush(),await function(e,t){return new Promise(function(n,r){setTimeout(function i(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:r();break;case e.TIMEOUT_EXPIRED:setTimeout(i,4);break;default:n()}},4)})}(ye,f),ye.bindBuffer(ye.PIXEL_PACK_BUFFER,d),ye.getBufferSubData(ye.PIXEL_PACK_BUFFER,0,a),ye.deleteBuffer(d),ye.deleteSync(f),a}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e,t=null,n=0){const r=Math.pow(2,-n),i=Math.floor(e.image.width*r),a=Math.floor(e.image.height*r),o=null!==t?t.x:0,s=null!==t?t.y:0;Q.setTexture2D(e,0),ye.copyTexSubImage2D(ye.TEXTURE_2D,n,0,0,o,s,i,a),Z.unbindTexture()};const Be=ye.createFramebuffer(),je=ye.createFramebuffer();this.copyTextureToTexture=function(e,t,n=null,r=null,i=0,a=null){let o,s,l,c,u,d,h,f,p;null===a&&(0!==i?(Sd("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),a=i,i=0):a=0);const m=e.isCompressedTexture?e.mipmaps[a]:e.image;if(null!==n)o=n.max.x-n.min.x,s=n.max.y-n.min.y,l=n.isBox3?n.max.z-n.min.z:1,c=n.min.x,u=n.min.y,d=n.isBox3?n.min.z:0;else{const t=Math.pow(2,-i);o=Math.floor(m.width*t),s=Math.floor(m.height*t),l=e.isDataArrayTexture?m.depth:e.isData3DTexture?Math.floor(m.depth*t):1,c=0,u=0,d=0}null!==r?(h=r.x,f=r.y,p=r.z):(h=0,f=0,p=0);const g=me.convert(t.format),v=me.convert(t.type);let y;t.isData3DTexture?(Q.setTexture3D(t,0),y=ye.TEXTURE_3D):t.isDataArrayTexture||t.isCompressedArrayTexture?(Q.setTexture2DArray(t,0),y=ye.TEXTURE_2D_ARRAY):(Q.setTexture2D(t,0),y=ye.TEXTURE_2D),ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,t.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,t.unpackAlignment);const b=ye.getParameter(ye.UNPACK_ROW_LENGTH),x=ye.getParameter(ye.UNPACK_IMAGE_HEIGHT),_=ye.getParameter(ye.UNPACK_SKIP_PIXELS),w=ye.getParameter(ye.UNPACK_SKIP_ROWS),S=ye.getParameter(ye.UNPACK_SKIP_IMAGES);ye.pixelStorei(ye.UNPACK_ROW_LENGTH,m.width),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,m.height),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,c),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,u),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,d);const M=e.isDataArrayTexture||e.isData3DTexture,E=t.isDataArrayTexture||t.isData3DTexture;if(e.isDepthTexture){const n=J.get(e),r=J.get(t),m=J.get(n.__renderTarget),g=J.get(r.__renderTarget);Z.bindFramebuffer(ye.READ_FRAMEBUFFER,m.__webglFramebuffer),Z.bindFramebuffer(ye.DRAW_FRAMEBUFFER,g.__webglFramebuffer);for(let v=0;v<l;v++)M&&(ye.framebufferTextureLayer(ye.READ_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,J.get(e).__webglTexture,i,d+v),ye.framebufferTextureLayer(ye.DRAW_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,J.get(t).__webglTexture,a,p+v)),ye.blitFramebuffer(c,u,o,s,h,f,o,s,ye.DEPTH_BUFFER_BIT,ye.NEAREST);Z.bindFramebuffer(ye.READ_FRAMEBUFFER,null),Z.bindFramebuffer(ye.DRAW_FRAMEBUFFER,null)}else if(0!==i||e.isRenderTargetTexture||J.has(e)){const n=J.get(e),r=J.get(t);Z.bindFramebuffer(ye.READ_FRAMEBUFFER,Be),Z.bindFramebuffer(ye.DRAW_FRAMEBUFFER,je);for(let e=0;e<l;e++)M?ye.framebufferTextureLayer(ye.READ_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,n.__webglTexture,i,d+e):ye.framebufferTexture2D(ye.READ_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_2D,n.__webglTexture,i),E?ye.framebufferTextureLayer(ye.DRAW_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,r.__webglTexture,a,p+e):ye.framebufferTexture2D(ye.DRAW_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_2D,r.__webglTexture,a),0!==i?ye.blitFramebuffer(c,u,o,s,h,f,o,s,ye.COLOR_BUFFER_BIT,ye.NEAREST):E?ye.copyTexSubImage3D(y,a,h,f,p+e,c,u,o,s):ye.copyTexSubImage2D(y,a,h,f,c,u,o,s);Z.bindFramebuffer(ye.READ_FRAMEBUFFER,null),Z.bindFramebuffer(ye.DRAW_FRAMEBUFFER,null)}else E?e.isDataTexture||e.isData3DTexture?ye.texSubImage3D(y,a,h,f,p,o,s,l,g,v,m.data):t.isCompressedArrayTexture?ye.compressedTexSubImage3D(y,a,h,f,p,o,s,l,g,m.data):ye.texSubImage3D(y,a,h,f,p,o,s,l,g,v,m):e.isDataTexture?ye.texSubImage2D(ye.TEXTURE_2D,a,h,f,o,s,g,v,m.data):e.isCompressedTexture?ye.compressedTexSubImage2D(ye.TEXTURE_2D,a,h,f,m.width,m.height,g,m.data):ye.texSubImage2D(ye.TEXTURE_2D,a,h,f,o,s,g,v,m);ye.pixelStorei(ye.UNPACK_ROW_LENGTH,b),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,x),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,_),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,w),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,S),0===a&&t.generateMipmaps&&ye.generateMipmap(y),Z.unbindTexture()},this.initRenderTarget=function(e){void 0===J.get(e).__webglFramebuffer&&Q.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?Q.setTextureCube(e,0):e.isData3DTexture?Q.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?Q.setTexture2DArray(e,0):Q.setTexture2D(e,0),Z.unbindTexture()},this.resetState=function(){_=0,w=0,S=null,Z.reset(),ge.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Zu}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=Cd._getDrawingBufferColorSpace(e),t.unpackColorSpace=Cd._getUnpackColorSpace()}}const Dw=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:4,AddEquation:Ol,AddOperation:2,AdditiveAnimationBlendMode:Iu,AdditiveBlending:2,AgXToneMapping:6,AlphaFormat:Fc,AlwaysCompare:519,AlwaysDepth:1,AlwaysStencilFunc:519,AmbientLight:Ly,AnimationAction:vb,AnimationClip:sy,AnimationLoader:class extends hy{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new my(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(n){try{t(i.parse(JSON.parse(n)))}catch(a){r?r(a):console.error(a),i.manager.itemError(e)}},n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=sy.parse(e[n]);t.push(r)}return t}},AnimationMixer:class extends Ju{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName;let c=l[s];void 0===c&&(c={},l[s]=c);for(let u=0;u!==i;++u){const e=r[u],i=e.name;let l=c[i];if(void 0!==l)++l.referenceCount,a[u]=l;else{if(l=a[u],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,s,i));continue}const r=t&&t._propertyBindings[u].binding.parsedPath;l=new cb(gb.create(n,i,r),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,s,i),a[u]=l}o[u].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,i=this._actionsByClip;let a=i[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{const t=a.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,a=this._actionsByClip,o=a[i],s=o.knownActions,l=s[s.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const e=t[n];0===--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let a=r[t];void 0===a&&(a={},r[t]=a),a[n]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,a=this._bindingsByRootAndName,o=a[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[i],0===Object.keys(o).length&&delete a[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Kv(new Float32Array(2),new Float32Array(2),1,yb),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i}clipAction(e,t,n){const r=t||this._root,i=r.uuid;let a="string"==typeof e?sy.findByName(r,e):e;const o=null!==a?a.uuid:e,s=this._actionsByClip[o];let l=null;if(void 0===n&&(n=null!==a?a.blendMode:2500),void 0!==s){const e=s.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;l=s.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;const c=new vb(this,a,t,n);return this._bindAction(c,l),this._addInactiveAction(c,o,i),c}existingAction(e,t){const n=t||this._root,r=n.uuid,i="string"==typeof e?sy.findByName(n,e):e,a=i?i.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1;for(let l=0;l!==n;++l)t[l]._update(r,e,i,a);const o=this._bindings,s=this._nActiveBindings;for(let l=0;l!==s;++l)o[l].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const e=i.knownActions;for(let n=0,r=e.length;n!==r;++n){const r=e[n];this._deactivateAction(r);const i=r._cacheIndex,a=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,a._cacheIndex=i,t[i]=a,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const i in n){const e=n[i].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const i in r){const e=r[i];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}},AnimationObjectGroup:class{constructor(){this.isAnimationObjectGroup=!0,this.uuid=rd(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,r=arguments.length;n!==r;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,a=i.length;let o,s=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],d=u.uuid;let h=t[d];if(void 0===h){h=s++,t[d]=h,e.push(u);for(let e=0,t=a;e!==t;++e)i[e].push(new gb(u,n[e],r[e]))}else if(h<l){o=e[h];const s=--l,c=e[s];t[c.uuid]=h,e[h]=c,t[d]=s,e[s]=u;for(let e=0,t=a;e!==t;++e){const t=i[e],a=t[s];let o=t[h];t[h]=a,void 0===o&&(o=new gb(u,n[e],r[e])),t[s]=o}}else e[h]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a],s=o.uuid,l=t[s];if(void 0!==l&&l>=i){const a=i++,c=e[a];t[c.uuid]=l,e[l]=c,t[s]=a,e[a]=o;for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[a],i=t[l];t[l]=r,t[a]=i}}}this.nCachedObjects_=i}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,a=e.length;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o].uuid,l=t[s];if(void 0!==l)if(delete t[s],l<i){const o=--i,s=e[o],c=--a,u=e[c];t[s.uuid]=l,e[l]=s,t[u.uuid]=o,e[o]=u,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[o],i=t[c];t[l]=r,t[o]=i,t.pop()}}else{const i=--a,o=e[i];i>0&&(t[o.uuid]=l),e[l]=o,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e];t[l]=t[i],t.pop()}}}this.nCachedObjects_=i}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const i=this._bindings;if(void 0!==r)return i[r];const a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[e]=r,a.push(e),o.push(t),i.push(u);for(let d=c,h=s.length;d!==h;++d){const n=s[d];u[d]=new gb(n,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,i=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];t[e[o]]=n,a[n]=s,a.pop(),i[n]=i[o],i.pop(),r[n]=r[o],r.pop()}}},AnimationUtils:class{static convertArray(e,t){return Gv(e,t)}static isTypedArray(e){return Wv(e)}static getKeyframeOrder(e){return $v(e)}static sortedArray(e,t,n){return Xv(e,t,n)}static flattenJSON(e,t,n,r){qv(e,t,n,r)}static subclip(e,t,n,r,i=30){return function(e,t,n,r,i=30){const a=e.clone();a.name=t;const o=[];for(let l=0;l<a.tracks.length;++l){const e=a.tracks[l],t=e.getValueSize(),s=[],c=[];for(let a=0;a<e.times.length;++a){const o=e.times[a]*i;if(!(o<n||o>=r)){s.push(e.times[a]);for(let n=0;n<t;++n)c.push(e.values[a*t+n])}}0!==s.length&&(e.times=Gv(s,e.times.constructor),e.values=Gv(c,e.values.constructor),o.push(e))}a.tracks=o;let s=1/0;for(let l=0;l<a.tracks.length;++l)s>a.tracks[l].times[0]&&(s=a.tracks[l].times[0]);for(let l=0;l<a.tracks.length;++l)a.tracks[l].shift(-1*s);return a.resetDuration(),a}(e,t,n,r,i)}static makeClipAdditive(e,t=0,n=e,r=30){return function(e,t=0,n=e,r=30){r<=0&&(r=30);const i=n.tracks.length,a=t/r;for(let o=0;o<i;++o){const t=n.tracks[o],r=t.ValueTypeName;if("bool"===r||"string"===r)continue;const i=e.tracks.find(function(e){return e.name===t.name&&e.ValueTypeName===r});if(void 0===i)continue;let s=0;const l=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);let c=0;const u=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const d=t.times.length-1;let h;if(a<=t.times[0]){const e=s,n=l-s;h=t.values.slice(e,n)}else if(a>=t.times[d]){const e=d*l+s,n=e+l-s;h=t.values.slice(e,n)}else{const e=t.createInterpolant(),n=s,r=l-s;e.evaluate(a),h=e.resultBuffer.slice(n,r)}"quaternion"===r&&(new dd).fromArray(h).normalize().conjugate().toArray(h);const f=i.times.length;for(let e=0;e<f;++e){const t=e*u+c;if("quaternion"===r)dd.multiplyQuaternionsFlat(i.values,t,h,0,i.values,t);else{const e=u-2*c;for(let n=0;n<e;++n)i.values[t+n]-=h[n]}}}return e.blendMode=Iu,e}(e,t,n,r)}},ArcCurve:xg,ArrayCamera:Ky,ArrowHelper:class extends Vh{constructor(e=new hd(0,0,1),t=new hd(0,0,0),n=1,r=16776960,i=.2*n,a=.2*i){super(),this.type="ArrowHelper",void 0===Jb&&(Jb=new If,Jb.setAttribute("position",new Ef([0,0,0,0,1,0],3)),Qb=new ug(.5,1,5,1),Qb.translate(0,-.5,0)),this.position.copy(t),this.line=new Gm(Jb,new zm({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Wf(Qb,new ff({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Kb.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Kb,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}},AttachedBindMode:cc,Audio:ib,AudioAnalyser:class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}},AudioContext:Xy,AudioListener:class extends Vh{constructor(){super(),this.type="AudioListener",this.context=Xy.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Jy}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Qy,eb,tb),nb.set(0,0,-1).applyQuaternion(eb),rb.set(0,1,0).applyQuaternion(eb),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Qy.x,e),t.positionY.linearRampToValueAtTime(Qy.y,e),t.positionZ.linearRampToValueAtTime(Qy.z,e),t.forwardX.linearRampToValueAtTime(nb.x,e),t.forwardY.linearRampToValueAtTime(nb.y,e),t.forwardZ.linearRampToValueAtTime(nb.z,e),t.upX.linearRampToValueAtTime(rb.x,e),t.upY.linearRampToValueAtTime(rb.y,e),t.upZ.linearRampToValueAtTime(rb.z,e)}else t.setPosition(Qy.x,Qy.y,Qy.z),t.setOrientation(nb.x,nb.y,nb.z,rb.x,rb.y,rb.z)}},AudioLoader:class extends hy{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new my(this.manager);function o(t){r?r(t):console.error(t),i.manager.itemError(e)}a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(e){try{const n=e.slice(0);Xy.getContext().decodeAudioData(n,function(e){t(e)}).catch(o)}catch(n){o(n)}},n,r)}},AxesHelper:class extends qm{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new If;n.setAttribute("position",new Ef(t,3)),n.setAttribute("color",new Ef([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new zm({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const r=new cf,i=this.geometry.attributes.color.array;return r.set(e),r.toArray(i,0),r.toArray(i,3),r.set(t),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},BackSide:1,BasicDepthPacking:3200,BasicShadowMap:0,BatchedMesh:Dm,Bone:$p,BooleanKeyframeTrack:ey,Box2:class{constructor(e=new ud(1/0,1/0),t=new ud(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Ab.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ab).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Box3:Vd,Box3Helper:class extends qm{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new If;r.setIndex(new wf(n,1)),r.setAttribute("position",new Ef([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new zm({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},BoxGeometry:Xf,BoxHelper:class extends qm{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new If;i.setIndex(new wf(n,1)),i.setAttribute("position",new wf(r,3)),super(i,new zm({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(void 0!==this.object&&Zb.setFromObject(this.object),Zb.isEmpty())return;const e=Zb.min,t=Zb.max,n=this.geometry.attributes.position,r=n.array;r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=e.x,r[4]=t.y,r[5]=t.z,r[6]=e.x,r[7]=e.y,r[8]=t.z,r[9]=t.x,r[10]=e.y,r[11]=t.z,r[12]=t.x,r[13]=t.y,r[14]=e.z,r[15]=e.x,r[16]=t.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=t.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}},BufferAttribute:wf,BufferGeometry:If,BufferGeometryLoader:jy,ByteType:Cc,Cache:cy,Camera:Qf,CameraHelper:class extends qm{constructor(e){const t=new If,n=new zm({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],a={};function o(e,t){s(e),s(t)}function s(e){r.push(0,0,0),i.push(0,0,0),void 0===a[e]&&(a[e]=[]),a[e].push(r.length/3-1)}o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4"),t.setAttribute("position",new Ef(r,3)),t.setAttribute("color",new Ef(i,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const l=new cf(16755200),c=new cf(16711680),u=new cf(43775),d=new cf(16777215),h=new cf(3355443);this.setColors(l,c,u,d,h)}setColors(e,t,n,r,i){const a=this.geometry.getAttribute("color");return a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,i.r,i.g,i.b),a.setXYZ(41,i.r,i.g,i.b),a.setXYZ(42,i.r,i.g,i.b),a.setXYZ(43,i.r,i.g,i.b),a.setXYZ(44,i.r,i.g,i.b),a.setXYZ(45,i.r,i.g,i.b),a.setXYZ(46,i.r,i.g,i.b),a.setXYZ(47,i.r,i.g,i.b),a.setXYZ(48,i.r,i.g,i.b),a.setXYZ(49,i.r,i.g,i.b),a.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap;let n,r;if(qb.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),!0===this.camera.reversedDepth)n=1,r=0;else if(this.camera.coordinateSystem===Zu)n=-1,r=1;else{if(this.camera.coordinateSystem!==Ku)throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);n=0,r=1}Yb("c",t,e,qb,0,0,n),Yb("t",t,e,qb,0,0,r),Yb("n1",t,e,qb,-1,-1,n),Yb("n2",t,e,qb,1,-1,n),Yb("n3",t,e,qb,-1,1,n),Yb("n4",t,e,qb,1,1,n),Yb("f1",t,e,qb,-1,-1,r),Yb("f2",t,e,qb,1,-1,r),Yb("f3",t,e,qb,-1,1,r),Yb("f4",t,e,qb,1,1,r),Yb("u1",t,e,qb,.7,1.1,n),Yb("u2",t,e,qb,-.7,1.1,n),Yb("u3",t,e,qb,0,2,n),Yb("cf1",t,e,qb,-1,0,r),Yb("cf2",t,e,qb,1,0,r),Yb("cf3",t,e,qb,0,-1,r),Yb("cf4",t,e,qb,0,1,r),Yb("cn1",t,e,qb,-1,0,n),Yb("cn2",t,e,qb,1,0,n),Yb("cn3",t,e,qb,0,-1,n),Yb("cn4",t,e,qb,0,1,n),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},CanvasTexture:class extends Od{constructor(e,t,n,r,i,a,o,s,l){super(e,t,n,r,i,a,o,s,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},CapsuleGeometry:sg,CatmullRomCurve3:Tg,CineonToneMapping:3,CircleGeometry:lg,ClampToEdgeWrapping:yc,Clock:Jy,Color:cf,ColorKeyframeTrack:ty,ColorManagement:Cd,CompressedArrayTexture:class extends ig{constructor(e,t,n,r,i,a){super(e,t,n,i,a),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=yc,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}},CompressedCubeTexture:class extends ig{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,hc),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}},CompressedTexture:ig,CompressedTextureLoader:class extends hy{constructor(e){super(e)}load(e,t,n,r){const i=this,a=[],o=new ig,s=new my(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials);let l=0;function c(c){s.load(e[c],function(e){const n=i.parse(e,!0);a[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(o.minFilter=Sc),o.image=a,o.format=n.format,o.needsUpdate=!0,t&&t(o))},n,r)}if(Array.isArray(e))for(let u=0,d=e.length;u<d;++u)c(u);else s.load(e,function(e){const n=i.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){a[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)a[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),a[t].format=n.format,a[t].width=n.width,a[t].height=n.height}o.image=a}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=Sc),o.format=n.format,o.needsUpdate=!0,t&&t(o)},n,r);return o}},ConeGeometry:ug,ConstantAlphaFactor:213,ConstantColorFactor:211,Controls:class extends Ju{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){void 0!==e?(null!==this.domElement&&this.disconnect(),this.domElement=e):console.warn("THREE.Controls: connect() now requires an element.")}disconnect(){}dispose(){}update(){}},CubeCamera:ap,CubeReflectionMapping:hc,CubeRefractionMapping:fc,CubeTexture:op,CubeTextureLoader:class extends hy{constructor(e){super(e)}load(e,t,n,r){const i=new op;i.colorSpace=Du;const a=new vy(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function s(n){a.load(e[n],function(e){i.images[n]=e,o++,6===o&&(i.needsUpdate=!0,t&&t(i))},void 0,r)}for(let l=0;l<e.length;++l)s(l);return i}},CubeUVReflectionMapping:gc,CubicBezierCurve:Rg,CubicBezierCurve3:Ng,CubicInterpolant:Zv,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,CullFaceNone:0,Curve:yg,CurvePath:Ug,CustomBlending:5,CustomToneMapping:5,CylinderGeometry:cg,Cylindrical:class{constructor(e=1,t=0,n=0){this.radius=e,this.theta=t,this.y=n}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}},Data3DTexture:Hd,DataArrayTexture:jd,DataTexture:Xp,DataTextureLoader:class extends hy{constructor(e){super(e)}load(e,t,n,r){const i=this,a=new Xp,o=new my(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(i.withCredentials),o.load(e,function(e){let n;try{n=i.parse(e)}catch(o){if(void 0===r)return void console.error(o);r(o)}void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:yc,a.wrapT=void 0!==n.wrapT?n.wrapT:yc,a.magFilter=void 0!==n.magFilter?n.magFilter:Sc,a.minFilter=void 0!==n.minFilter?n.minFilter:Sc,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(a.colorSpace=n.colorSpace),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=Ec),1===n.mipmapCount&&(a.minFilter=Sc),void 0!==n.generateMipmaps&&(a.generateMipmaps=n.generateMipmaps),a.needsUpdate=!0,t&&t(a,n)},n,r),a}},DataUtils:yf,DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DefaultLoadingManager:dy,DepthFormat:Hc,DepthStencilFormat:Vc,DepthTexture:ag,DetachedBindMode:uc,DirectionalLight:Iy,DirectionalLightHelper:class extends Vh{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let r=new If;r.setAttribute("position",new Ef([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const i=new zm({fog:!1,toneMapped:!1});this.lightPlane=new Gm(r,i),this.add(this.lightPlane),r=new If,r.setAttribute("position",new Ef([0,0,0,0,0,1],3)),this.targetLine=new Gm(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Gb.setFromMatrixPosition(this.light.matrixWorld),Wb.setFromMatrixPosition(this.light.target.matrixWorld),$b.subVectors(Wb,Gb),this.lightPlane.lookAt(Wb),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Wb),this.targetLine.scale.z=$b.length()}},DiscreteInterpolant:Jv,DodecahedronGeometry:hg,DoubleSide:2,DstAlphaFactor:206,DstColorFactor:208,DynamicCopyUsage:35050,DynamicDrawUsage:35048,DynamicReadUsage:35049,EdgesGeometry:vg,EllipseCurve:bg,EqualCompare:514,EqualDepth:4,EqualStencilFunc:514,EquirectangularReflectionMapping:pc,EquirectangularRefractionMapping:mc,Euler:Th,EventDispatcher:Ju,ExternalTexture:og,ExtrudeGeometry:gv,FileLoader:my,Float16BufferAttribute:class extends wf{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=vf(this.array[e*this.itemSize]);return this.normalized&&(t=sd(t,this.array)),t}setX(e,t){return this.normalized&&(t=ld(t,this.array)),this.array[e*this.itemSize]=gf(t),this}getY(e){let t=vf(this.array[e*this.itemSize+1]);return this.normalized&&(t=sd(t,this.array)),t}setY(e,t){return this.normalized&&(t=ld(t,this.array)),this.array[e*this.itemSize+1]=gf(t),this}getZ(e){let t=vf(this.array[e*this.itemSize+2]);return this.normalized&&(t=sd(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ld(t,this.array)),this.array[e*this.itemSize+2]=gf(t),this}getW(e){let t=vf(this.array[e*this.itemSize+3]);return this.normalized&&(t=sd(t,this.array)),t}setW(e,t){return this.normalized&&(t=ld(t,this.array)),this.array[e*this.itemSize+3]=gf(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=ld(t,this.array),n=ld(n,this.array)),this.array[e+0]=gf(t),this.array[e+1]=gf(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=ld(t,this.array),n=ld(n,this.array),r=ld(r,this.array)),this.array[e+0]=gf(t),this.array[e+1]=gf(n),this.array[e+2]=gf(r),this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=ld(t,this.array),n=ld(n,this.array),r=ld(r,this.array),i=ld(i,this.array)),this.array[e+0]=gf(t),this.array[e+1]=gf(n),this.array[e+2]=gf(r),this.array[e+3]=gf(i),this}},Float32BufferAttribute:Ef,FloatType:Pc,Fog:hp,FogExp2:dp,FramebufferTexture:class extends Od{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=xc,this.minFilter=xc,this.generateMipmaps=!1,this.needsUpdate=!0}},FrontSide:0,Frustum:fm,FrustumArray:gm,GLBufferAttribute:class{constructor(e,t,n,r,i,a=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.normalized=a,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}},GLSL1:"100",GLSL3:Yu,GreaterCompare:516,GreaterDepth:6,GreaterEqualCompare:518,GreaterEqualDepth:5,GreaterEqualStencilFunc:518,GreaterStencilFunc:516,GridHelper:class extends qm{constructor(e=10,t=10,n=4473924,r=8947848){n=new cf(n),r=new cf(r);const i=t/2,a=e/t,o=e/2,s=[],l=[];for(let u=0,d=0,h=-o;u<=t;u++,h+=a){s.push(-o,0,h,o,0,h),s.push(h,0,-o,h,0,o);const e=u===i?n:r;e.toArray(l,d),d+=3,e.toArray(l,d),d+=3,e.toArray(l,d),d+=3,e.toArray(l,d),d+=3}const c=new If;c.setAttribute("position",new Ef(s,3)),c.setAttribute("color",new Ef(l,3)),super(c,new zm({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},Group:lp,HalfFloatType:Ic,HemisphereLight:by,HemisphereLightHelper:class extends Vh{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const r=new xv(t);r.rotateY(.5*Math.PI),this.material=new ff({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),a=new Float32Array(3*i.count);r.setAttribute("color",new wf(a,3)),this.add(new Wf(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Hb.copy(this.light.color),Vb.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const r=e<n/2?Hb:Vb;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(jb.setFromMatrixPosition(this.light.matrixWorld).negate())}},IcosahedronGeometry:yv,ImageBitmapLoader:class extends hy{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=cy.get(`image-bitmap:${e}`);if(void 0!==a)return i.manager.itemStart(e),a.then?void a.then(n=>{if(!0!==Wy.has(a))return t&&t(n),i.manager.itemEnd(e),n;r&&r(Wy.get(a)),i.manager.itemError(e),i.manager.itemEnd(e)}):(setTimeout(function(){t&&t(a),i.manager.itemEnd(e)},0),a);const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,o.signal="function"==typeof AbortSignal.any?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const s=fetch(e,o).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))}).then(function(n){return cy.add(`image-bitmap:${e}`,n),t&&t(n),i.manager.itemEnd(e),n}).catch(function(t){r&&r(t),Wy.set(s,t),cy.remove(`image-bitmap:${e}`),i.manager.itemError(e),i.manager.itemEnd(e)});cy.add(`image-bitmap:${e}`,s),i.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}},ImageLoader:vy,ImageUtils:Nd,IncrementStencilOp:7682,IncrementWrapStencilOp:34055,InstancedBufferAttribute:Kp,InstancedBufferGeometry:By,InstancedInterleavedBuffer:class extends pp{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}},InstancedMesh:am,Int16BufferAttribute:class extends wf{constructor(e,t,n){super(new Int16Array(e),t,n)}},Int32BufferAttribute:class extends wf{constructor(e,t,n){super(new Int32Array(e),t,n)}},Int8BufferAttribute:class extends wf{constructor(e,t,n){super(new Int8Array(e),t,n)}},IntType:Rc,InterleavedBuffer:pp,InterleavedBufferAttribute:gp,Interpolant:Yv,InterpolateDiscrete:Cu,InterpolateLinear:Au,InterpolateSmooth:ku,InterpolationSamplingMode:{NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"},InterpolationSamplingType:{PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},InvertStencilOp:5386,KeepStencilOp:Fu,KeyframeTrack:Qv,LOD:Dp,LatheGeometry:bv,Layers:Ch,LessCompare:513,LessDepth:2,LessEqualCompare:515,LessEqualDepth:3,LessEqualStencilFunc:515,LessStencilFunc:513,Light:yy,LightProbe:Oy,Line:Gm,Line3:class{constructor(e=new hd,t=new hd){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){kb.subVectors(e,this.start),Rb.subVectors(this.end,this.start);const n=Rb.dot(Rb);let r=Rb.dot(kb)/n;return t&&(r=id(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}distanceSqToLine3(e,t=Lb,n=Db){const r=1e-8*1e-8;let i,a;const o=this.start,s=e.start,l=this.end,c=e.end;Nb.subVectors(l,o),Pb.subVectors(c,s),Ib.subVectors(o,s);const u=Nb.dot(Nb),d=Pb.dot(Pb),h=Pb.dot(Ib);if(u<=r&&d<=r)return t.copy(o),n.copy(s),t.sub(n),t.dot(t);if(u<=r)i=0,a=h/d,a=id(a,0,1);else{const e=Nb.dot(Ib);if(d<=r)a=0,i=id(-e/u,0,1);else{const t=Nb.dot(Pb),n=u*d-t*t;i=0!==n?id((t*h-e*d)/n,0,1):0,a=(t*i+h)/d,a<0?(a=0,i=id(-e/u,0,1)):a>1&&(a=1,i=id((t-e)/u,0,1))}}return t.copy(o).add(Nb.multiplyScalar(i)),n.copy(s).add(Pb.multiplyScalar(a)),t.sub(n),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},LineBasicMaterial:zm,LineCurve:Pg,LineCurve3:Ig,LineDashedMaterial:Vv,LineLoop:Ym,LineSegments:qm,LinearFilter:Sc,LinearInterpolant:Kv,LinearMipMapLinearFilter:1008,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:Ec,LinearMipmapNearestFilter:Mc,LinearSRGBColorSpace:zu,LinearToneMapping:1,LinearTransfer:Ou,Loader:hy,LoaderUtils:Fy,LoadingManager:uy,LoopOnce:2200,LoopPingPong:2202,LoopRepeat:2201,MOUSE:Pl,Material:hf,MaterialLoader:Uy,MathUtils:cd,Matrix2:Cb,Matrix3:md,Matrix4:gh,MaxEquation:104,Mesh:Wf,MeshBasicMaterial:ff,MeshDepthMaterial:Bv,MeshDistanceMaterial:jv,MeshLambertMaterial:Fv,MeshMatcapMaterial:Hv,MeshNormalMaterial:Uv,MeshPhongMaterial:zv,MeshPhysicalMaterial:Dv,MeshStandardMaterial:Lv,MeshToonMaterial:Ov,MinEquation:103,MirroredRepeatWrapping:bc,MixOperation:1,MultiplyBlending:4,MultiplyOperation:0,NearestFilter:xc,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NearestMipmapLinearFilter:wc,NearestMipmapNearestFilter:_c,NeutralToneMapping:7,NeverCompare:512,NeverDepth:0,NeverStencilFunc:512,NoBlending:0,NoColorSpace:Lu,NoToneMapping:0,NormalAnimationBlendMode:2500,NormalBlending:1,NotEqualCompare:517,NotEqualDepth:7,NotEqualStencilFunc:517,NumberKeyframeTrack:ny,Object3D:Vh,ObjectLoader:class extends hy{constructor(e){super(e)}load(e,t,n,r){const i=this,a=""===this.path?Fy.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new my(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(n){let a=null;try{a=JSON.parse(n)}catch(s){return void 0!==r&&r(s),void console.error("THREE:ObjectLoader: Can't parse "+e+".",s.message)}const o=a.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())return void 0!==r&&r(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);i.parse(a,t)},n,r)}async loadAsync(e,t){const n=""===this.path?Fy.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const r=new my(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const i=await r.loadAsync(e,t),a=JSON.parse(i),o=a.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(a)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),a=this.parseImages(e.images,function(){void 0!==t&&t(l)}),o=this.parseTextures(e.textures,a),s=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,i,s,o,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),this.bindLightTargets(l),void 0!==t){let e=!1;for(const t in a)if(a[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),i=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,i),o=this.parseMaterials(e.materials,a),s=this.parseObject(e.object,r,o,a,t),l=this.parseSkeletons(e.skeletons,s);return this.bindSkeletons(s,l),this.bindLightTargets(s),s}parseShapes(e){const t={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){const r=(new Bg).fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse(function(e){e.isBone&&(r[e.uuid]=e)}),void 0!==e)for(let i=0,a=e.length;i<a;i++){const t=(new Zp).fromJSON(e[i],r);n[t.uuid]=t}return n}parseGeometries(e,t){const n={};if(void 0!==e){const r=new jy;for(let i=0,a=e.length;i<a;i++){let a;const o=e[i];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(o);break;default:o.type in Nv?a=Nv[o.type].fromJSON(o,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),void 0!==o.userData&&(a.userData=o.userData),n[o.uuid]=a}}return n}parseMaterials(e,t){const n={},r={};if(void 0!==e){const i=new Uy;i.setTextures(t);for(let t=0,a=e.length;t<a;t++){const a=e[t];void 0===n[a.uuid]&&(n[a.uuid]=i.parse(a)),r[a.uuid]=n[a.uuid]}}return r}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const r=e[n],i=sy.parse(r);t[i.uuid]=i}return t}parseImages(e,t){const n=this,r={};let i;function a(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),i.load(e,function(){n.manager.itemEnd(e)},void 0,function(){n.manager.itemError(e),n.manager.itemEnd(e)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:bd(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new uy(t);i=new vy(n),i.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const n=e[t],i=n.url;if(Array.isArray(i)){const e=[];for(let t=0,n=i.length;t<n;t++){const n=a(i[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new Xp(n.data,n.width,n.height)))}r[n.uuid]=new Id(e)}else{const e=a(n.url);r[n.uuid]=new Id(e)}}}return r}async parseImagesAsync(e){const t=this,n={};let r;async function i(e){if("string"==typeof e){const n=e,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await r.loadAsync(i)}return e.data?{data:bd(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){r=new vy(this.manager),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const r=e[t],a=r.url;if(Array.isArray(a)){const e=[];for(let t=0,n=a.length;t<n;t++){const n=a[t],r=await i(n);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new Xp(r.data,r.width,r.height)))}n[r.uuid]=new Id(e)}else{const e=await i(r.url);n[r.uuid]=new Id(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const r={};if(void 0!==e)for(let i=0,a=e.length;i<a;i++){const a=e[i];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const o=t[a.image],s=o.data;let l;Array.isArray(s)?(l=new op,6===s.length&&(l.needsUpdate=!0)):(l=s&&s.data?new Xp:new Od,s&&(l.needsUpdate=!0)),l.source=o,l.uuid=a.uuid,void 0!==a.name&&(l.name=a.name),void 0!==a.mapping&&(l.mapping=n(a.mapping,Hy)),void 0!==a.channel&&(l.channel=a.channel),void 0!==a.offset&&l.offset.fromArray(a.offset),void 0!==a.repeat&&l.repeat.fromArray(a.repeat),void 0!==a.center&&l.center.fromArray(a.center),void 0!==a.rotation&&(l.rotation=a.rotation),void 0!==a.wrap&&(l.wrapS=n(a.wrap[0],Vy),l.wrapT=n(a.wrap[1],Vy)),void 0!==a.format&&(l.format=a.format),void 0!==a.internalFormat&&(l.internalFormat=a.internalFormat),void 0!==a.type&&(l.type=a.type),void 0!==a.colorSpace&&(l.colorSpace=a.colorSpace),void 0!==a.minFilter&&(l.minFilter=n(a.minFilter,Gy)),void 0!==a.magFilter&&(l.magFilter=n(a.magFilter,Gy)),void 0!==a.anisotropy&&(l.anisotropy=a.anisotropy),void 0!==a.flipY&&(l.flipY=a.flipY),void 0!==a.generateMipmaps&&(l.generateMipmaps=a.generateMipmaps),void 0!==a.premultiplyAlpha&&(l.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(l.unpackAlignment=a.unpackAlignment),void 0!==a.compareFunction&&(l.compareFunction=a.compareFunction),void 0!==a.userData&&(l.userData=a.userData),r[a.uuid]=l}return r}parseObject(e,t,n,r,i){let a,o,s;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(n[i])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function u(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}switch(e.type){case"Scene":a=new fp,void 0!==e.background&&(Number.isInteger(e.background)?a.background=new cf(e.background):a.background=u(e.background)),void 0!==e.environment&&(a.environment=u(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?a.fog=new hp(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(a.fog=new dp(e.fog.color,e.fog.density)),""!==e.fog.name&&(a.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(a.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(a.backgroundIntensity=e.backgroundIntensity),void 0!==e.backgroundRotation&&a.backgroundRotation.fromArray(e.backgroundRotation),void 0!==e.environmentIntensity&&(a.environmentIntensity=e.environmentIntensity),void 0!==e.environmentRotation&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new rp(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(a.focus=e.focus),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.filmGauge&&(a.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(a.filmOffset=e.filmOffset),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new Ny(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new Ly(e.color,e.intensity);break;case"DirectionalLight":a=new Iy(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new Ry(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new Dy(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new Ey(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new by(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=(new Oy).fromJSON(e);break;case"SkinnedMesh":o=l(e.geometry),s=c(e.material),a=new Wp(o,s),void 0!==e.bindMode&&(a.bindMode=e.bindMode),void 0!==e.bindMatrix&&a.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(a.skeleton=e.skeleton);break;case"Mesh":o=l(e.geometry),s=c(e.material),a=new Wf(o,s);break;case"InstancedMesh":o=l(e.geometry),s=c(e.material);const t=e.count,n=e.instanceMatrix,r=e.instanceColor;a=new am(o,s,t),a.instanceMatrix=new Kp(new Float32Array(n.array),16),void 0!==r&&(a.instanceColor=new Kp(new Float32Array(r.array),r.itemSize));break;case"BatchedMesh":o=l(e.geometry),s=c(e.material),a=new Dm(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,s),a.geometry=o,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._geometryInfo=e.geometryInfo.map(e=>{let t=null,n=null;return void 0!==e.boundingBox&&(t=(new Vd).fromJSON(e.boundingBox)),void 0!==e.boundingSphere&&(n=(new sh).fromJSON(e.boundingSphere)),{...e,boundingBox:t,boundingSphere:n}}),a._instanceInfo=e.instanceInfo,a._availableInstanceIds=e._availableInstanceIds,a._availableGeometryIds=e._availableGeometryIds,a._nextIndexStart=e.nextIndexStart,a._nextVertexStart=e.nextVertexStart,a._geometryCount=e.geometryCount,a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._matricesTexture=u(e.matricesTexture.uuid),a._indirectTexture=u(e.indirectTexture.uuid),void 0!==e.colorsTexture&&(a._colorsTexture=u(e.colorsTexture.uuid)),void 0!==e.boundingSphere&&(a.boundingSphere=(new sh).fromJSON(e.boundingSphere)),void 0!==e.boundingBox&&(a.boundingBox=(new Vd).fromJSON(e.boundingBox));break;case"LOD":a=new Dp;break;case"Line":a=new Gm(l(e.geometry),c(e.material));break;case"LineLoop":a=new Ym(l(e.geometry),c(e.material));break;case"LineSegments":a=new qm(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":a=new tg(l(e.geometry),c(e.material));break;case"Sprite":a=new Np(c(e.material));break;case"Group":a=new lp;break;case"Bone":a=new $p;break;default:a=new Vh}if(a.uuid=e.uuid,void 0!==e.name&&(a.name=e.name),void 0!==e.matrix?(a.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==e.position&&a.position.fromArray(e.position),void 0!==e.rotation&&a.rotation.fromArray(e.rotation),void 0!==e.quaternion&&a.quaternion.fromArray(e.quaternion),void 0!==e.scale&&a.scale.fromArray(e.scale)),void 0!==e.up&&a.up.fromArray(e.up),void 0!==e.castShadow&&(a.castShadow=e.castShadow),void 0!==e.receiveShadow&&(a.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.intensity&&(a.shadow.intensity=e.shadow.intensity),void 0!==e.shadow.bias&&(a.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(a.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(a.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&a.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(a.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.frustumCulled&&(a.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(a.renderOrder=e.renderOrder),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.layers&&(a.layers.mask=e.layers),void 0!==e.children){const o=e.children;for(let e=0;e<o.length;e++)a.add(this.parseObject(o[e],t,n,r,i))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];a.animations.push(i[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(a.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],r=a.getObjectByProperty("uuid",n.object);void 0!==r&&a.addLevel(r,n.distance,n.hysteresis)}}return a}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse(function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,r=e.getObjectByProperty("uuid",n);t.target=void 0!==r?r:new Vh}})}},ObjectSpaceNormalMap:1,OctahedronGeometry:xv,OneFactor:201,OneMinusConstantAlphaFactor:214,OneMinusConstantColorFactor:212,OneMinusDstAlphaFactor:207,OneMinusDstColorFactor:209,OneMinusSrcAlphaFactor:Wl,OneMinusSrcColorFactor:203,OrthographicCamera:Ny,PCFShadowMap:1,PCFSoftShadowMap:2,PMREMGenerator:Tx,Path:Fg,PerspectiveCamera:rp,Plane:cm,PlaneGeometry:_v,PlaneHelper:class extends Gm{constructor(e,t=1,n=16776960){const r=n,i=new If;i.setAttribute("position",new Ef([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new zm({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=new If;a.setAttribute("position",new Ef([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),a.computeBoundingSphere(),this.add(new Wf(a,new ff({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}},PointLight:Ry,PointLightHelper:class extends Wf{constructor(e,t,n){super(new Mv(t,4,2),new ff({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Points:tg,PointsMaterial:Zm,PolarGridHelper:class extends qm{constructor(e=10,t=16,n=8,r=64,i=4473924,a=8947848){i=new cf(i),a=new cf(a);const o=[],s=[];if(t>1)for(let c=0;c<t;c++){const n=c/t*(2*Math.PI),r=Math.sin(n)*e,l=Math.cos(n)*e;o.push(0,0,0),o.push(r,0,l);const u=1&c?i:a;s.push(u.r,u.g,u.b),s.push(u.r,u.g,u.b)}for(let c=0;c<n;c++){const t=1&c?i:a,l=e-e/n*c;for(let e=0;e<r;e++){let n=e/r*(2*Math.PI),i=Math.sin(n)*l,a=Math.cos(n)*l;o.push(i,0,a),s.push(t.r,t.g,t.b),n=(e+1)/r*(2*Math.PI),i=Math.sin(n)*l,a=Math.cos(n)*l,o.push(i,0,a),s.push(t.r,t.g,t.b)}}const l=new If;l.setAttribute("position",new Ef(o,3)),l.setAttribute("color",new Ef(s,3)),super(l,new zm({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},PolyhedronGeometry:dg,PositionalAudio:class extends ib{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(ab,ob,sb),lb.set(0,0,1).applyQuaternion(ob);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(ab.x,e),t.positionY.linearRampToValueAtTime(ab.y,e),t.positionZ.linearRampToValueAtTime(ab.z,e),t.orientationX.linearRampToValueAtTime(lb.x,e),t.orientationY.linearRampToValueAtTime(lb.y,e),t.orientationZ.linearRampToValueAtTime(lb.z,e)}else t.setPosition(ab.x,ab.y,ab.z),t.setOrientation(lb.x,lb.y,lb.z)}},PropertyBinding:gb,PropertyMixer:cb,QuadraticBezierCurve:Lg,QuadraticBezierCurve3:Dg,Quaternion:dd,QuaternionKeyframeTrack:iy,QuaternionLinearInterpolant:ry,RED_GREEN_RGTC2_Format:Eu,RED_RGTC1_Format:Su,REVISION:Nl,RGBADepthPacking:3201,RGBAFormat:jc,RGBAIntegerFormat:qc,RGBA_ASTC_10x10_Format:vu,RGBA_ASTC_10x5_Format:pu,RGBA_ASTC_10x6_Format:mu,RGBA_ASTC_10x8_Format:gu,RGBA_ASTC_12x10_Format:yu,RGBA_ASTC_12x12_Format:bu,RGBA_ASTC_4x4_Format:ou,RGBA_ASTC_5x4_Format:su,RGBA_ASTC_5x5_Format:lu,RGBA_ASTC_6x5_Format:cu,RGBA_ASTC_6x6_Format:uu,RGBA_ASTC_8x5_Format:du,RGBA_ASTC_8x6_Format:hu,RGBA_ASTC_8x8_Format:fu,RGBA_BPTC_Format:xu,RGBA_ETC2_EAC_Format:au,RGBA_PVRTC_2BPPV1_Format:nu,RGBA_PVRTC_4BPPV1_Format:tu,RGBA_S3TC_DXT1_Format:Zc,RGBA_S3TC_DXT3_Format:Kc,RGBA_S3TC_DXT5_Format:Jc,RGBDepthPacking:3202,RGBFormat:Bc,RGBIntegerFormat:1032,RGB_BPTC_SIGNED_Format:_u,RGB_BPTC_UNSIGNED_Format:wu,RGB_ETC1_Format:ru,RGB_ETC2_Format:iu,RGB_PVRTC_2BPPV1_Format:eu,RGB_PVRTC_4BPPV1_Format:Qc,RGB_S3TC_DXT1_Format:Yc,RGDepthPacking:3203,RGFormat:$c,RGIntegerFormat:Xc,RawShaderMaterial:Iv,Ray:mh,Raycaster:wb,RectAreaLight:Dy,RedFormat:Gc,RedIntegerFormat:Wc,ReinhardToneMapping:2,RenderTarget:Fd,RenderTarget3D:class extends Fd{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isRenderTarget3D=!0,this.depth=n,this.texture=new Hd(null,e,t,n),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}},RepeatWrapping:vc,ReplaceStencilOp:7681,ReverseSubtractEquation:102,RingGeometry:wv,SIGNED_RED_GREEN_RGTC2_Format:Tu,SIGNED_RED_RGTC1_Format:Mu,SRGBColorSpace:Du,SRGBTransfer:Uu,Scene:fp,ShaderChunk:rx,ShaderLib:ax,ShaderMaterial:Jf,ShadowMaterial:Pv,Shape:Bg,ShapeGeometry:Sv,ShapePath:class{constructor(){this.type="ShapePath",this.color=new cf,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Fg,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,a){return this.currentPath.bezierCurveTo(e,t,n,r,i,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let r=!1;for(let i=n-1,a=0;a<n;i=a++){let n=t[i],o=t[a],s=o.x-n.x,l=o.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[a],s=-s,o=t[i],l=-l),e.y<n.y||e.y>o.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-s*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(o.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=o.x)return!0}}return r}const n=fv.isClockWise,r=this.subPaths;if(0===r.length)return[];let i,a,o;const s=[];if(1===r.length)return a=r[0],o=new Bg,o.curves=a.curves,s.push(o),s;let l=!n(r[0].getPoints());l=e?!l:l;const c=[],u=[];let d,h,f=[],p=0;u[p]=void 0,f[p]=[];for(let m=0,g=r.length;m<g;m++)a=r[m],d=a.getPoints(),i=n(d),i=e?!i:i,i?(!l&&u[p]&&p++,u[p]={s:new Bg,p:d},u[p].s.curves=a.curves,l&&p++,f[p]=[]):f[p].push({h:a,p:d[0]});if(!u[0])return function(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],i=new Bg;i.curves=r.curves,t.push(i)}return t}(r);if(u.length>1){let e=!1,n=0;for(let t=0,r=u.length;t<r;t++)c[t]=[];for(let r=0,i=u.length;r<i;r++){const i=f[r];for(let a=0;a<i.length;a++){const o=i[a];let s=!0;for(let i=0;i<u.length;i++)t(o.p,u[i].p)&&(r!==i&&n++,s?(s=!1,c[i].push(o)):e=!0);s&&c[r].push(o)}}n>0&&!1===e&&(f=c)}for(let m=0,g=u.length;m<g;m++){o=u[m].s,s.push(o),h=f[m];for(let e=0,t=h.length;e<t;e++)o.holes.push(h[e].h)}return s}},ShapeUtils:fv,ShortType:Ac,Skeleton:Zp,SkeletonHelper:class extends qm{constructor(e){const t=Bb(e),n=new If,r=[],i=[];for(let s=0;s<t.length;s++){const e=t[s];e.parent&&e.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(0,0,0),i.push(0,0,0))}n.setAttribute("position",new Ef(r,3)),n.setAttribute("color",new Ef(i,3)),super(n,new zm({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const a=new cf(255),o=new cf(65280);this.setColors(a,o)}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");Fb.copy(this.root.matrixWorld).invert();for(let i=0,a=0;i<t.length;i++){const e=t[i];e.parent&&e.parent.isBone&&(Ub.multiplyMatrices(Fb,e.matrixWorld),Ob.setFromMatrixPosition(Ub),r.setXYZ(a,Ob.x,Ob.y,Ob.z),Ub.multiplyMatrices(Fb,e.parent.matrixWorld),Ob.setFromMatrixPosition(Ub),r.setXYZ(a+1,Ob.x,Ob.y,Ob.z),a+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const n=this.geometry.getAttribute("color");for(let r=0;r<n.count;r+=2)n.setXYZ(r,e.r,e.g,e.b),n.setXYZ(r+1,t.r,t.g,t.b);return n.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},SkinnedMesh:Wp,Source:Id,Sphere:sh,SphereGeometry:Mv,Spherical:Tb,SphericalHarmonics3:zy,SplineCurve:zg,SpotLight:Ey,SpotLightHelper:class extends Vh{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new If,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,s=32;a<s;a++,o++){const e=a/s*Math.PI*2,t=o/s*Math.PI*2;r.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}n.setAttribute("position",new Ef(r,3));const i=new zm({fog:!1,toneMapped:!1});this.cone=new qm(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),zb.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(zb),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Sprite:Np,SpriteMaterial:vp,SrcAlphaFactor:Gl,SrcAlphaSaturateFactor:210,SrcColorFactor:202,StaticCopyUsage:35046,StaticDrawUsage:qu,StaticReadUsage:35045,StereoCamera:class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new rp,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new rp,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Zy.copy(e.projectionMatrix);const n=t.eyeSep/2,r=n*t.near/t.focus,i=t.near*Math.tan(td*t.fov*.5)/t.zoom;let a,o;Yy.elements[12]=-n,qy.elements[12]=n,a=-i*t.aspect+r,o=i*t.aspect+r,Zy.elements[0]=2*t.near/(o-a),Zy.elements[8]=(o+a)/(o-a),this.cameraL.projectionMatrix.copy(Zy),a=-i*t.aspect-r,o=i*t.aspect-r,Zy.elements[0]=2*t.near/(o-a),Zy.elements[8]=(o+a)/(o-a),this.cameraR.projectionMatrix.copy(Zy)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Yy),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(qy)}},StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,StringKeyframeTrack:ay,SubtractEquation:101,SubtractiveBlending:3,TOUCH:Il,TangentSpaceNormalMap:0,TetrahedronGeometry:Ev,Texture:Od,TextureLoader:class extends hy{constructor(e){super(e)}load(e,t,n,r){const i=new Od,a=new vy(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)},n,r),i}},TextureUtils:class{static contain(e,t){return function(e,t){const n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2):(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0),e}(e,t)}static cover(e,t){return function(e,t){const n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0):(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2),e}(e,t)}static fill(e){return function(e){return e.repeat.x=1,e.repeat.y=1,e.offset.x=0,e.offset.y=0,e}(e)}static getByteLength(e,t,n,r){return ex(e,t,n,r)}},Timer:class{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,void 0!==e.hidden&&(this._pageVisibilityHandler=Eb.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){null!==this._pageVisibilityHandler&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return null!==this._pageVisibilityHandler&&!0===this._document.hidden?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(void 0!==e?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}},TimestampQuery:{COMPUTE:"compute",RENDER:"render"},TorusGeometry:Tv,TorusKnotGeometry:Cv,Triangle:rf,TriangleFanDrawMode:2,TriangleStripDrawMode:1,TrianglesDrawMode:0,TubeGeometry:Av,UVMapping:dc,Uint16BufferAttribute:Sf,Uint32BufferAttribute:Mf,Uint8BufferAttribute:class extends wf{constructor(e,t,n){super(new Uint8Array(e),t,n)}},Uint8ClampedBufferAttribute:class extends wf{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}},Uniform:bb,UniformsGroup:class extends Ju{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:xb++}),this.name="",this.usage=qu,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,r=t.length;n<r;n++){const e=Array.isArray(t[n])?t[n]:[t[n]];for(let t=0;t<e.length;t++)this.uniforms.push(e[t].clone())}return this}clone(){return(new this.constructor).copy(this)}},UniformsLib:ix,UniformsUtils:Kf,UnsignedByteType:Tc,UnsignedInt101111Type:Uc,UnsignedInt248Type:zc,UnsignedInt5999Type:Oc,UnsignedIntType:Nc,UnsignedShort4444Type:Lc,UnsignedShort5551Type:Dc,UnsignedShortType:kc,VSMShadowMap:3,Vector2:ud,Vector3:hd,Vector4:Ud,VectorKeyframeTrack:oy,VideoFrameTexture:class extends rg{constructor(e,t,n,r,i,a,o,s){super({},e,t,n,r,i,a,o,s),this.isVideoFrameTexture=!0}update(){}clone(){return(new this.constructor).copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}},VideoTexture:rg,WebGL3DRenderTarget:class extends Bd{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Hd(null,e,t,n),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}},WebGLArrayRenderTarget:class extends Bd{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new jd(null,e,t,n),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}},WebGLCoordinateSystem:Zu,WebGLCubeRenderTarget:sp,WebGLRenderTarget:Bd,WebGLRenderer:Lw,WebGLUtils:Cw,WebGPUCoordinateSystem:Ku,WebXRController:up,WireframeGeometry:kv,WrapAroundEnding:Pu,ZeroCurvatureEnding:Ru,ZeroFactor:200,ZeroSlopeEnding:Nu,ZeroStencilOp:0,createCanvasElement:_d},Symbol.toStringTag,{value:"Module"})),zw=e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:0,g:0,b:0}},Ow="\n  varying vec2 vUv;\n  void main() {\n    vUv = uv;\n    // The default plane geometry has positions in [-0.5, 0.5].\n    // Clip space (gl_Position) is in [-1, 1]. We need to scale\n    // the xy coordinates by 2 to make the plane fill the entire viewport.\n    gl_Position = vec4(position.xy * 2.0, 0.0, 1.0);\n  }\n",Uw=el((e,t)=>({bakedTexture:null,isBaking:!1,isCompiling:!1,bakingProgress:0,lastBakeSettings:{resolution:128,depth:64,supersampling:1},isBaking2D:!1,bakeTexture:async(n,r,i)=>{var a;if(!t().isBaking){e({lastBakeSettings:i}),null==(a=t().bakedTexture)||a.dispose(),e({isBaking:!0,isCompiling:!0,bakingProgress:0,bakedTexture:null});try{const t=await((t,n,r,i,a,o,s)=>new Promise((l,c)=>{setTimeout(async()=>{const u=new Lw({premultipliedAlpha:!1});u.setSize(r,i);const d=new fp,h=new Ny(-.5,.5,.5,-.5,.1,10);h.position.z=1;const f=new _v(1,1),p={u_time:{value:0},u_z_slice:{value:0},u_texture_size:{value:r},u_texture_depth:{value:a}},m=new Map;for(const e of n)for(const t of e.data.params)if("slider"===t.type||"color"===t.type){const n=`u_${e.id.replace(/-/g,"_")}_${t.id}`;m.set(n,t.value)}if(t.uniforms)for(const[e,n]of t.uniforms.entries()){const t=m.has(e)?m.get(e):n.value;let r;if("vec3"===n.type){const{r:e,g:n,b:i}=zw(t);r=new hd(e/255,n/255,i/255)}else r=t;p[e]={value:r}}const g=new Jf({defines:{SUPERSAMPLING_FACTOR:o,MAX_SUPERSAMPLING_ITERATIONS:5},uniforms:p,vertexShader:Ow,fragmentShader:"\n  varying vec2 vUv;\n  uniform float u_time;\n  uniform float u_z_slice;\n  uniform int u_texture_size;\n  uniform int u_texture_depth;\n\n  __PREAMBLE__\n  __NOISE_FUNCTION__\n\n  void main() {\n    // Construct the sampling position in the [-0.5, 0.5] space to match the live viewport.\n    // vUv is [0,1], so vUv-0.5 maps to [-0.5, 0.5].\n    // u_z_slice is also mapped to [0,1] in the baking loop, so we subtract 0.5.\n    vec3 sample_pos = vec3(vUv.x - 0.5, vUv.y - 0.5, u_z_slice - 0.5);\n    \n#if SUPERSAMPLING_FACTOR <= 1\n    // For 1x supersampling, just take a single sample.\n    gl_FragColor = getNoise(sample_pos);\n#else\n    // For higher supersampling, average multiple samples within the voxel.\n    vec4 total_noise = vec4(0.0);\n    float num_samples = 0.0;\n    vec3 voxel_size = vec3(1.0 / float(u_texture_size), 1.0 / float(u_texture_size), 1.0 / float(u_texture_depth));\n\n    // The loop limit (MAX_SUPERSAMPLING_ITERATIONS) and the break condition (SUPERSAMPLING_FACTOR)\n    // are now compile-time constants. This allows the compiler to fully unroll and optimize the loops,\n    // which is significantly faster than branching on a uniform at runtime.\n    for (int sx = 0; sx < MAX_SUPERSAMPLING_ITERATIONS; sx++) {\n        if (sx >= SUPERSAMPLING_FACTOR) break;\n        for (int sy = 0; sy < MAX_SUPERSAMPLING_ITERATIONS; sy++) {\n            if (sy >= SUPERSAMPLING_FACTOR) break;\n            for (int sz = 0; sz < MAX_SUPERSAMPLING_ITERATIONS; sz++) {\n                if (sz >= SUPERSAMPLING_FACTOR) break;\n                \n                // Stratified grid: sample from the center of each sub-voxel.\n                vec3 sub_voxel_offset = ((vec3(float(sx), float(sy), float(sz)) + 0.5) / float(SUPERSAMPLING_FACTOR)) - 0.5;\n                vec3 sample_offset = sub_voxel_offset * voxel_size;\n                \n                total_noise += getNoise(sample_pos + sample_offset);\n                num_samples += 1.0;\n            }\n        }\n    }\n    \n    // Average the noise.\n    vec4 avg_noise = total_noise / num_samples;\n    gl_FragColor = avg_noise;\n#endif\n  }\n".replace("__PREAMBLE__",t.preamble).replace("__NOISE_FUNCTION__",t.noiseFunction)}),v=new Wf(f,g);d.add(v);const y=new Bd(r,i,{format:jc,type:Tc});try{await u.compile(d,h),e({isCompiling:!1});const t=new Uint8Array(r*i*a*4);for(let e=0;e<a;e++){g.uniforms.u_z_slice.value=a>1?e/(a-1):.5,u.setRenderTarget(y),u.render(d,h),u.setRenderTarget(null);const n=new Uint8Array(r*i*4);u.readRenderTargetPixels(y,0,0,r,i,n);const o=e*r*i*4;t.set(n,o),await new Promise(e=>requestAnimationFrame(e)),s((e+1)/a)}const n=new Hd(t,r,i,a);n.format=jc,n.type=Tc,n.minFilter=Sc,n.magFilter=Sc,n.unpackAlignment=1,n.wrapS=vc,n.wrapT=vc,n.wrapR=vc,n.needsUpdate=!0,l(n)}catch(b){console.error("Baking failed:",b),c(b)}finally{u.dispose(),y.dispose(),g.dispose(),f.dispose()}},0)}))(n,r,i.resolution,i.resolution,i.depth,i.supersampling,t=>e({bakingProgress:t}));e({bakedTexture:t})}catch(o){console.error("Failed to bake texture:",o),e({bakedTexture:null})}finally{e({isBaking:!1,isCompiling:!1})}}},quickBake:async(e,n)=>{if(t().isBaking)return;const r=t().lastBakeSettings;r?await t().bakeTexture(e,n,r):console.warn("No last bake settings found to perform a quick bake.")},clearBakedTexture:()=>{var n;null==(n=t().bakedTexture)||n.dispose(),e({bakedTexture:null})},bakeAndDownload2DSlice:async(n,r,i,a,o)=>{if(!t().isBaking2D){e({isBaking2D:!0});try{const e=Rl.getState(),{name:s}=pl.getState(),{bakedTexture:l}=t();await((e,t,n,r,i,a,o,s)=>new Promise((l,c)=>{setTimeout(async()=>{const u=new Lw({premultipliedAlpha:!1});u.setSize(i,a);const d=new fp,h=new Ny(-.5,.5,.5,-.5,.1,10);h.position.z=1;const f=new _v(1,1),p=Boolean(r),m={u_time:{value:0},u_channel_mask:{value:new Ud(n.channelMask.r?1:0,n.channelMask.g?1:0,n.channelMask.b?1:0,n.channelMask.a?1:0)},u_zoom:{value:n.zoom2D},u_offset:{value:new ud(n.offset2D.x,n.offset2D.y)},u_slice_axis:{value:{x:0,y:1,z:2}[n.sliceAxis2D]},u_slice_pos:{value:n.slicePosition2D},u_tiling:{value:n.tiling},u_baked_texture:{value:r},u_use_bicubic:{value:p&&"tricubic"===n.filteringMode},u_texture_res:{value:r?new hd(r.image.width,r.image.height,r.image.depth):new hd(1,1,1)},u_resolution:{value:new ud(i,a)}},g=new Map;for(const e of t)for(const t of e.data.params)if("slider"===t.type||"color"===t.type){const n=`u_${e.id.replace(/-/g,"_")}_${t.id}`;g.set(n,t.value)}if(e.uniforms)for(const[t,n]of e.uniforms.entries()){const e=g.has(t)?g.get(t):n.value;let r;if("vec3"===n.type){const{r:t,g:n,b:i}=zw(e);r=new hd(t/255,n/255,i/255)}else r=e;m[t]={value:r}}const v=new Jf({defines:{SUPERSAMPLING_FACTOR:o,MAX_SUPERSAMPLING_ITERATIONS:5,IS_BAKED:p},uniforms:m,vertexShader:Ow,fragmentShader:nl.replace("__PREAMBLE__",e.preamble).replace("__NOISE_FUNCTION__",p?"":e.noiseFunction)}),y=new Wf(f,v);d.add(y);const b=new Bd(i,a,{format:jc,type:Tc});try{await u.compile(d,h),u.setRenderTarget(b),u.render(d,h),u.setRenderTarget(null);const e=document.createElement("canvas");e.width=i,e.height=a;const t=e.getContext("2d");if(t){const n=new Uint8ClampedArray(i*a*4);u.readRenderTargetPixels(b,0,0,i,a,n);const r=new ImageData(n,i,a);t.putImageData(r,0,0);const o=document.createElement("canvas");o.width=i,o.height=a;const d=o.getContext("2d");d?(d.translate(0,a),d.scale(1,-1),d.drawImage(e,0,0),o.toBlob(e=>{if(!e)return void c(new Error("Failed to create blob for 2D slice"));const t=URL.createObjectURL(e),n=document.createElement("a");n.href=t;const r=s.replace(/[^a-z0-9]/gi,"_").toLowerCase()||"unnamed";n.download=`${r}_slice_${i}x${a}.png`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),l()},"image/png")):c(new Error("Could not get 2D context for final canvas"))}else c(new Error("Could not get 2D context for temporary canvas"))}catch(x){console.error("2D slice baking failed:",x),c(x)}finally{u.dispose(),b.dispose(),v.dispose(),f.dispose()}},0)}))(n,r,e,l,i,a,o,s)}catch(s){console.error("Failed to bake 2D slice:",s),alert(`Failed to bake 2D slice: ${s instanceof Error?s.message:String(s)}`)}finally{e({isBaking2D:!1})}}}}));let Fw=0;const Bw=()=>"dnd-node_"+Fw++,jw=()=>{const{nodes:e,edges:t}=Xw.getState();Xw.setState({generatedShader:hl(e,t)})},Hw=(e,t)=>{const{generatedShader:n,edges:r}=Xw.getState(),i=n.usedNodeIds.has(e),a=r.length,o=r.filter(n=>!(n.source===e&&n.sourceHandle===t||n.target===e&&n.targetHandle===t));if(o.length===r.length)return;Gw.getState().recordState(),Xw.setState({edges:o});const s=Xw.getState().edges.length;i&&s<a&&jw()},Vw=(e,t)=>{const n=(null==t?void 0:t.recompile)??!0,r=(null==t?void 0:t.recordHistory)??!0;if(!e||!Array.isArray(e.nodes)||!Array.isArray(e.edges))return console.error("Invalid graph file format."),void alert("Invalid graph file format.");let i,a;if(r&&Gw.getState().recordState(),2===e.version?(i=e.nodes.map(e=>{const t=ul.get(e.t);if(!t)return null;const n="Comment"===e.t;let r;if(n)r={...t,...e.d,params:[]};else{const n=t.params({}).map(t=>({...t,value:e.p&&e.p.hasOwnProperty(t.id)?e.p[t.id]:t.value})),i={...t,params:n},a=t.params(i).map(t=>e.p&&e.p.hasOwnProperty(t.id)?{...t,value:e.p[t.id]}:t);r={...t,label:e.l||t.label,params:a}}return{id:e.i,type:n?"commentNode":"Output"===e.t?"outputNode":"defaultNode",position:e.pos,data:r,width:e.size?e.size[0]:null,height:e.size?e.size[1]:null,zIndex:e.z}}).filter(e=>null!==e),a=e.edges.map(e=>({id:e.i||`e${e.s}-${e.t}-${e.sh||""}-${e.th||""}`,source:e.s,target:e.t,sourceHandle:e.sh,targetHandle:e.th}))):(i=e.nodes,a=e.edges.map((e,t)=>({...e,id:e.id||`e${e.source}-${e.target}-${e.sourceHandle||""}-${e.targetHandle||""}-${t}`}))),(e=>{const t=e.reduce((e,t)=>{const n=t.id.match(/\d+/g)||[],r=Math.max(0,...n.map(e=>parseInt(e,10)));return Math.max(e,r)},-1);Fw=t+1})(i),e.theme){const{setAccentColor:t,setThemeMode:n,setBrightness:r,setSaturation:i}=xl.getState();e.theme.accentColor&&t(e.theme.accentColor),e.theme.themeMode&&n(e.theme.themeMode),void 0!==e.theme.brightness&&r(e.theme.brightness),void 0!==e.theme.saturation&&i(e.theme.saturation)}e.workspaceName&&pl.getState().setName(e.workspaceName),Xw.setState({nodes:i,edges:a,selectedNodeId:null,graphJustLoaded:!0}),n&&jw()},Gw=el((e,t)=>({past:[],future:[],lastActionForUndo:null,preDragState:null,startDrag:()=>{if(t().preDragState)return;const{nodes:n,edges:r,selectedNodeId:i}=Xw.getState(),{name:a}=pl.getState();e({preDragState:{nodes:n,edges:r,selectedNodeId:i,workspaceName:a}})},endDrag:()=>{const{preDragState:n}=t();n&&e(e=>({past:[...e.past,n],future:[],lastActionForUndo:null,preDragState:null}))},recordState:()=>{const{nodes:t,edges:n,selectedNodeId:r}=Xw.getState(),{name:i}=pl.getState(),a={nodes:t,edges:n,selectedNodeId:r,workspaceName:i};e(e=>({past:[...e.past,a],future:[],lastActionForUndo:null}))},recordContinuousState:n=>{const{lastActionForUndo:r}=t();!((null==r?void 0:r.type)===n.type&&(null==r?void 0:r.nodeId)===n.nodeId&&("updateCommentNodeData"===n.type||(null==r?void 0:r.paramId)===n.paramId))&&t().recordState(),e({lastActionForUndo:n})},undo:()=>{const{past:n}=t();if(0===n.length)return;const r=n[n.length-1],{nodes:i,edges:a,selectedNodeId:o}=Xw.getState(),{name:s}=pl.getState(),l={nodes:i,edges:a,selectedNodeId:o,workspaceName:s},c=!gl(l,r);e(e=>({past:e.past.slice(0,e.past.length-1),future:[l,...e.future],lastActionForUndo:null,preDragState:null})),Vw(r,{recordHistory:!1,recompile:!1}),c&&jw()},redo:()=>{const{future:n}=t();if(0===n.length)return;const r=n[0],{nodes:i,edges:a,selectedNodeId:o}=Xw.getState(),{name:s}=pl.getState(),l={nodes:i,edges:a,selectedNodeId:o,workspaceName:s},c=!gl(l,r);e(e=>({past:[...e.past,l],future:e.future.slice(1),lastActionForUndo:null,preDragState:null})),Vw(r,{recordHistory:!1,recompile:!1}),c&&jw()},clearHistory:()=>e({past:[],future:[],lastActionForUndo:null,preDragState:null})})),Ww=[],$w=[],Xw=el((e,t)=>({nodes:Ww,edges:$w,selectedNodeId:null,generatedShader:hl(Ww,$w),graphJustLoaded:!1,setGraphJustLoaded:t=>e({graphJustLoaded:t}),onNodesChange:n=>{const{usedNodeIds:r}=t().generatedShader,i=n.reduce((e,t)=>("remove"===t.type&&e.push(t.id),e),[]).some(e=>r.has(e));e(e=>{const t=Ja(n,e.nodes),r=t.filter(e=>e.selected),i=1===r.length?r[0].id:null,{startDrag:a,endDrag:o,recordState:s}=Gw.getState(),l=n.some(e=>"position"===e.type&&!0===e.dragging),c=n.some(e=>"position"===e.type&&!1===e.dragging);return(n.some(e=>"remove"===e.type)||n.some(e=>"dimensions"===e.type&&!1===e.resizing))&&s(),l&&a(),c&&o(),{nodes:t,selectedNodeId:i}}),i&&jw()},onEdgesChange:n=>{const{usedNodeIds:r}=t().generatedShader,{edges:i}=t(),a=n.some(e=>"remove"===e.type),o=n.reduce((e,t)=>{if("remove"===t.type){const n=i.find(e=>e.id===t.id);n&&e.push(n)}return e},[]).some(e=>e.target&&r.has(e.target));e(e=>{const t=function(e,t){return Ka(e,t)}(n,e.edges);return a&&Gw.getState().recordState(),{edges:t}}),o&&jw()},onConnect:n=>{const r=t().generatedShader.usedNodeIds;Gw.getState().recordState(),e(e=>{const t=e.edges.filter(e=>!(e.target===n.target&&e.targetHandle===n.targetHandle));return{edges:Di(n,t)}}),n.target&&r.has(n.target)&&jw()}})),qw=(e,t,n)=>{const r=ul.get(e);if(!r)return;Gw.getState().recordState();const i=Xw.getState().nodes.some(e=>"Output"===e.data.type),a=r.params({}),o=a.map(e=>n&&n.hasOwnProperty(e.id)?{...e,value:n[e.id]}:e);let s,l=r.label;if("Math"===e&&n&&n.op){const e=a.find(e=>"op"===e.id),t=null==e?void 0:e.options.find(e=>e.value===n.op);t&&(l=t.label)}const c={...r,params:o,label:l};s="Comment"===e?{id:Bw(),type:"commentNode",position:t,data:{...c,text:"Type your comment here...",fontSize:14,fontWeight:"normal",fontStyle:"normal",backgroundColor:"#374151",textColor:"#F9FAFB",opacity:1,textOpacity:1},style:{width:200,height:100},zIndex:1}:{id:Bw(),type:"Output"===e?"outputNode":"defaultNode",position:t,data:c,zIndex:10},Xw.setState(e=>{const t=e.nodes.map(e=>({...e,selected:!1})),n={...s,selected:!0};return{nodes:[...t,n],selectedNodeId:n.id}}),"Output"!==e||i||jw()},Yw=(e,t,n)=>{const{nodes:r,generatedShader:i}=Xw.getState(),a=r.find(t=>t.id===e);if(!a)return;const{recordState:o,recordContinuousState:s}=Gw.getState(),l=a.data.params.find(e=>e.id===t);let c=!l||"slider"!==l.type&&"color"!==l.type;const u=ul.get(a.data.type);if(!c){const e=a.data.params.map(e=>e.id===t?{...e,value:n}:e),r=u.params({...a.data,params:e});(a.data.params.length!==r.length||a.data.params.some((e,t)=>e.id!==r[t].id))&&(c=!0)}!l||"slider"!==l.type&&"color"!==l.type?o():s({type:"updateNodeParameter",nodeId:e,paramId:t}),Xw.setState(r=>{var i;let o=null;if("Math"===a.data.type&&"op"===t&&"select"===(null==l?void 0:l.type)){const e=ul.get("Math").label,t=null==(i=a.data.params.find(e=>"op"===e.id).options.find(e=>e.value===a.data.params.find(e=>"op"===e.id).value))?void 0:i.label;if(a.data.label===e||a.data.label===t){const e=l.options.find(e=>e.value===n);e&&(o=e.label)}}return{nodes:r.nodes.map(r=>{if(r.id!==e)return r;const i=new Map(r.data.params.map(e=>[e.id,e.value]));i.set(t,n);const a=r.data.params.map(e=>e.id===t?{...e,value:n}:e),s={...r.data,params:a},l=u.params(s).map(e=>i.has(e.id)?{...e,value:i.get(e.id)}:e),c={...r.data,params:l};return o&&(c.label=o),{...r,data:c}})}}),c&&i.usedNodeIds.has(e)&&jw()},Zw=(e,t,n)=>{const{recordState:r,recordContinuousState:i}=Gw.getState();n?i({type:"updateCommentNodeData",nodeId:e,paramId:"comment"}):r(),Xw.setState(n=>({nodes:n.nodes.map(n=>{if(n.id===e&&"Comment"===n.data.type){const e={...n.data,...t};return{...n,data:e}}return n})}))},Kw=({nodeId:e,initialLabel:t})=>{const[n,r]=h.useState(!1),[i,a]=h.useState(t);h.useEffect(()=>{a(t)},[t]);return n?s.jsx("input",{type:"text",value:i,onChange:e=>{a(e.target.value)},onBlur:()=>{r(!1),i.trim()&&i!==t?((e,t)=>{const n=Xw.getState().nodes.find(t=>t.id===e);n&&n.data.label!==t&&(Gw.getState().recordState(),Xw.setState(n=>({nodes:n.nodes.map(n=>n.id===e?{...n,data:{...n.data,label:t}}:n)})))})(e,i):a(t)},onKeyDown:e=>{"Enter"===e.key?e.currentTarget.blur():"Escape"===e.key&&(r(!1),a(t))},className:"font-bold text-accent bg-transparent w-full focus:outline-none ring-2 ring-[var(--color-accent-primary)] rounded px-1 -mx-1",autoFocus:!0,onFocus:e=>e.target.select(),onClick:e=>e.stopPropagation(),onDoubleClick:e=>e.stopPropagation()}):s.jsx("div",{onDoubleClick:e=>{e.stopPropagation(),r(!0)},className:"font-bold text-accent truncate pr-2 cursor-text w-full",title:"Double-click to rename",children:i})},Jw={blue:"#60a5fa",orange:"#fb923c",yellow:"#facc15",purple:"#c084fc",teal:"#2dd4bf",green:"#4ade80",gray:"#9ca3af"},Qw=({nodeId:e,type:t,position:n,handleId:r,label:i,isConnected:a,value:o})=>{const l="target"===t,c=t=>{t.stopPropagation(),Hw(e,r)},u="!w-3 !h-3 transition-colors "+(a?"bg-[var(--color-accent-primary)] !border-[var(--color-accent-text)]":"!bg-[var(--color-bg-600)] !border-[var(--color-border-600)]"),d="pl-5 pr-2 truncate "+(a?"text-[var(--color-accent-text)] font-semibold":"text-[var(--color-text-300)]");return s.jsxs("div",{className:"relative flex items-center justify-between h-6",children:[s.jsxs("div",{className:"flex items-center min-w-0",children:[l&&s.jsx(ta,{type:"target",position:n,id:r,className:u,onDoubleClick:c}),s.jsx("p",{className:d,title:i,children:i})]}),!a&&void 0!==o&&s.jsx("p",{className:"font-mono text-[var(--color-accent-text)] pr-2 flex-shrink-0",children:(h=o,Math.abs(h)<.1&&0!==h||Math.abs(h)<1?h.toFixed(2):h.toFixed(1))}),!l&&s.jsx(ta,{type:"source",position:mi.Right,id:r,className:"!w-3 !h-3 !bg-[var(--color-accent-primary)] !border-[var(--color-border-600)]",onDoubleClick:c})]});var h},eS={gray:"#9ca3af"},tS=({nodeId:e,handleId:t,label:n,isConnected:r})=>{const i="!w-3 !h-3 transition-colors "+(r?"bg-[var(--color-accent-primary)] !border-[var(--color-accent-text)]":"!bg-[var(--color-bg-600)] !border-[var(--color-border-600)]"),a="pl-5 "+(r?"text-[var(--color-accent-text)] font-semibold":"text-[var(--color-text-300)]");return s.jsxs("div",{className:"relative flex items-center h-6",children:[s.jsx(ta,{type:"target",position:mi.Left,id:t,className:i,isConnectable:!0,onDoubleClick:n=>{n.stopPropagation(),Hw(e,t)}}),s.jsx("p",{className:a,children:n})]})},nS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"})}),rS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),iS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",...e,children:s.jsx("path",{fillRule:"evenodd",d:"M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.648c1.295.742 1.295 2.545 0 3.286L7.279 20.99c-1.25.717-2.779-.217-2.779-1.643V5.653z",clipRule:"evenodd"})}),aS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",...e,children:s.jsx("path",{fillRule:"evenodd",d:"M6.75 5.25a.75.75 0 00-.75.75v12a.75.75 0 00.75.75h.75a.75.75 0 00.75-.75V6a.75.75 0 00-.75-.75H6.75zm8.25 0a.75.75 0 00-.75.75v12a.75.75 0 00.75.75h.75a.75.75 0 00.75-.75V6a.75.75 0 00-.75-.75h-.75z",clipRule:"evenodd"})}),oS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 8.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 018.25 20.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6A2.25 2.25 0 0115.75 3.75h2.25A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25A2.25 2.25 0 0113.5 8.25V6zM13.5 15.75A2.25 2.25 0 0115.75 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.025h-2.25a2.25 2.25 0 01-2.25-2.25v-2.25z"})}),sS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"})}),lS=e=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3.75c-3.142 0-6 2.57-6 5.75 0 1.597.64 3.05 1.68 4.12M12 20.25c3.142 0 6-2.57 6-5.75 0-1.597-.64-3.05-1.68-4.12"})]}),cS=e=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18a6 6 0 100-12 6 6 0 000 12z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 100-18 9 9 0 000 18z"})]}),uS=e=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 3h18v18H3V3z",opacity:"0.3"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 10h18"})]}),dS=e=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 4.5v15m6-15v15m-10.5-6h15",opacity:"0.4"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 3.75h16.5v16.5H3.75V3.75z"})]}),hS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})}),fS=e=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75c0-3.314 4.82-6 10.75-6s10.75 2.686 10.75 6c0 1.5-1.2 2.75-2.75 2.75H5c-1.55 0-2.75-1.25-2.75-2.75z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 13.5l2-2 M12 13.5l2-2 M16 13.5l2-2"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9.75c.5-1 1.5-1 2 0 M12 7.75c.5-1 1.5-1 2 0 M15 9.75c.5-1 1.5-1 2 0"})]}),pS=e=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75c0-3.314 4.82-6 10.75-6s10.75 2.686 10.75 6c0 1.5-1.2 2.75-2.75 2.75H5c-1.55 0-2.75-1.25-2.75-2.75z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 13.5l2-2 M12 13.5l2-2 M16 13.5l2-2"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12.75 3.75L9 7.5h3.75L11.25 12l5.25-6.75H12.75V3.75z"})]}),mS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"})}),gS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 15l6-6m0 0l-6-6m6 6H9a6 6 0 000 12h3"})}),vS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"})}),yS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 8.25l-7.5 7.5-7.5-7.5"})}),bS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.664 0l3.181-3.183m-11.664 0l3.181-3.183a8.25 8.25 0 00-11.664 0l-3.181 3.183"})}),xS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"})}),_S=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"})}),wS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z"})}),SS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})}),MS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})}),ES=e=>s.jsx("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",...e,children:s.jsx("path",{d:"M9.954 2.21a9.99 9.99 0 0 1 4.091-.002A3.993 3.993 0 0 0 16 5.07a3.993 3.993 0 0 0 3.457.261A9.99 9.99 0 0 1 21.5 8.876 3.993 3.993 0 0 0 20 12c0 1.264.586 2.391 1.502 3.124a10.043 10.043 0 0 1-2.046 3.543 3.993 3.993 0 0 0-3.456.261 3.993 3.993 0 0 0-1.954 2.86 9.99 9.99 0 0 1-4.091.004A3.993 3.993 0 0 0 8 18.927a3.993 3.993 0 0 0-3.457-.26A9.99 9.99 0 0 1 2.5 15.121 3.993 3.993 0 0 0 4 11.999a3.993 3.993 0 0 0-1.502-3.124 10.043 10.043 0 0 1 2.046-3.543A3.993 3.993 0 0 0 8 5.071a3.993 3.993 0 0 0 1.954-2.86zM12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"})}),TS=e=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.776 48.776 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"})]}),CS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9m11.25-5.25v4.5m0-4.5h-4.5m4.5 0L15 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15m11.25 5.25v-4.5m0 4.5h-4.5m4.5 0L15 15"})}),AS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9V4.5M15 9h4.5M15 9l5.25-5.25M15 15v4.5M15 15h4.5M15 15l5.25 5.25"})}),kS=e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.067-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})}),RS=(e,t)=>{const n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?`rgba(${parseInt(n[1],16)}, ${parseInt(n[2],16)}, ${parseInt(n[3],16)}, ${t})`:`rgba(255, 255, 255, ${t})`},NS={defaultNode:({id:e,data:t,selected:n})=>{const r=h.useContext(LS),i=ul.get(t.type),a=i?i.inputs(t):[],o=i?i.outputs(t):[],l=Jw[t.color]||Jw.gray;return t.params.find(e=>"color"===e.type),s.jsxs("div",{className:`relative rounded-lg shadow-md border-2 ${n?"border-[var(--color-accent-primary)]":"border-[var(--color-border-600)]"} bg-[var(--color-node-bg)] w-52 text-sm`,children:[s.jsxs("div",{className:"bg-[var(--color-bg-900)] px-3 py-2 rounded-t-md flex items-center justify-between",children:[s.jsx(Kw,{nodeId:e,initialLabel:t.label}),s.jsx("div",{style:{backgroundColor:l},className:"w-2.5 h-2.5 rounded-full flex-shrink-0"})]}),s.jsxs("div",{className:"p-2 text-xs space-y-1",children:[a.map(t=>{const n=r.has(`${e}-${t.id}`);return s.jsx(Qw,{nodeId:e,type:"target",position:mi.Left,handleId:t.id,label:t.label,isConnected:n},t.id)}),t.params.map(t=>{if("slider"===t.type){const n=r.has(`${e}-${t.id}`);return s.jsx(Qw,{nodeId:e,type:"target",position:mi.Left,handleId:t.id,label:t.label,isConnected:n,value:t.value},t.id)}return"color"===t.type?s.jsxs("div",{className:"flex items-center justify-between h-6 pl-5 pr-2",children:[s.jsx("p",{className:"text-[var(--color-text-300)] truncate",children:t.label}),s.jsx("div",{className:"w-12 h-4 rounded-sm border border-[var(--color-border-600)]",style:{backgroundColor:t.value}})]},t.id):null}),o.map(t=>s.jsx(Qw,{nodeId:e,type:"source",position:mi.Right,handleId:t.id,label:t.label},t.id))]})]})},outputNode:({id:e,data:t,selected:n})=>{const r=h.useContext(LS),i=eS[t.color]||eS.gray;return s.jsxs("div",{className:`relative rounded-lg shadow-md border-2 ${n?"border-[var(--color-accent-primary)]":"border-[var(--color-border-600)]"} bg-[var(--color-node-bg)] w-52 text-sm`,children:[s.jsxs("div",{className:"bg-[var(--color-bg-900)] px-3 py-2 rounded-t-md flex items-center justify-between",children:[s.jsx("p",{className:"font-bold text-accent truncate pr-2",children:t.label}),s.jsx("div",{style:{backgroundColor:i},className:"w-2.5 h-2.5 rounded-full flex-shrink-0"})]}),s.jsx("div",{className:"p-2 text-xs space-y-1",children:[{id:"in_r",label:"Red (R)"},{id:"in_g",label:"Green (G)"},{id:"in_b",label:"Blue (B)"},{id:"in_a",label:"Alpha (A)"}].map(t=>{const n=r.has(`${e}-${t.id}`);return s.jsx(tS,{nodeId:e,handleId:t.id,label:t.label,isConnected:n},t.id)})})]})},commentNode:({id:e,data:t,selected:n})=>{const[r,i]=h.useState(t.text||"");return h.useEffect(()=>{i(t.text||"")},[t.text]),s.jsxs(s.Fragment,{children:[s.jsx(Ys,{minWidth:100,minHeight:40,isVisible:n}),s.jsxs("div",{className:"relative w-full h-full rounded-lg border-2 transition-colors "+(n?"border-[var(--color-accent-primary)]":"border-transparent"),style:{boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},children:[s.jsx("div",{className:"absolute inset-0 rounded-lg",style:{backgroundColor:t.backgroundColor||"#374151",opacity:t.opacity??1}}),s.jsxs("div",{className:"relative w-full h-full p-3",children:[s.jsx(SS,{className:"absolute top-2 right-2 w-4 h-4 text-[var(--color-text-400)] pointer-events-none",style:{opacity:t.textOpacity??1}}),s.jsx("textarea",{value:r,onChange:e=>{i(e.target.value)},onBlur:()=>{t.text!==r&&Zw(e,{text:r},!1)},className:"w-full h-full bg-transparent resize-none focus:outline-none",style:{fontSize:`${t.fontSize||14}px`,fontWeight:t.fontWeight||"normal",fontStyle:t.fontStyle||"normal",color:RS(t.textColor||"#F9FAFB",t.textOpacity??1)},"aria-label":"Comment text"})]})]})]})}},PS=[32,32],IS={subtle:{float:"#4b5563",vec3:"#9ca3af"},accent:{float:"#4b5563",vec3:"#6366f1"},vibrant:{float:"#6366f1",vec3:"#818cf8"}},LS=h.createContext(new Set),DS=()=>{const{nodes:e,edges:t,onNodesChange:n,onEdgesChange:r,onConnect:i,generatedShader:a,graphJustLoaded:o,setGraphJustLoaded:l}=Xw(),{edgeType:c,edgeColorStyle:u,edgeLineStyle:d,floatStrokeWidth:f,vec3StrokeWidth:p}=Tl(),{quickBake:m}=Uw(),{setDisplayMode:g}=Rl(),{undo:v,redo:y}=Gw(),{accentColor:b,themeMode:x,brightness:_,saturation:w}=xl(),[S,M]=h.useState(IS),E=Fa(),T=h.useRef(null),C=h.useRef({x:0,y:0}),A=h.useRef(new Set),k=h.useMemo(()=>({f:{type:"Constant"},c:{type:"ConstantColor"},a:{type:"Math",params:{op:"add"}},m:{type:"Math",params:{op:"multiply"}},s:{type:"Saturate"},b:{type:"Blend"},t:{type:"Time"},z:{type:"VectorCombine"},x:{type:"VectorSplit"}}),[]);h.useEffect(()=>{o&&(setTimeout(()=>{E.fitView({duration:300})},0),l(!1))},[o,l,E]),h.useEffect(()=>{const e=getComputedStyle(document.documentElement),t=t=>e.getPropertyValue(t).trim();M({subtle:{float:t("--color-border-600"),vec3:t("--color-text-400")},accent:{float:t("--color-border-600"),vec3:t("--color-accent-primary")},vibrant:{float:t("--color-accent-primary"),vec3:t("--color-accent-secondary")}})},[b,x,_,w]);const{screenToFlowPosition:R}=Fa(),[N,P]=h.useState(!1),I=h.useCallback(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",e.dataTransfer.types.includes("Files")&&P(!0)},[]),L=h.useCallback(()=>{P(!1)},[]),D=h.useCallback(e=>{if(e.preventDefault(),P(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];if(t&&"application/json"===t.type){const e=new FileReader;e.onload=e=>{var t;try{const n=JSON.parse(null==(t=e.target)?void 0:t.result);Vw(n)}catch(n){console.error("Error parsing JSON file:",n),alert("Failed to load graph: The file is not a valid JSON format.")}},e.readAsText(t)}else alert("Please drop a valid JSON file to load a graph.");return}const t=e.dataTransfer.getData("application/reactflow");if(void 0===t||!t)return;const n=R({x:e.clientX,y:e.clientY});qw(t,n)},[R]),z=h.useMemo(()=>{const e=a.handleTypes,n=S[u];return t.map(t=>{const r=`${t.source}-${t.sourceHandle}`,i="vec3"===e.get(r),a={...t,type:c,animated:"animated"===d,style:{stroke:i?n.vec3:n.float,strokeWidth:i?p:f,strokeDasharray:"dashed"===d?"8 8":void 0}};return"smoothstep"===c?a.pathOptions={borderRadius:20,offset:30}:"step"===c&&(a.pathOptions={borderRadius:0}),a})},[t,a.handleTypes,c,u,d,f,p,S]),O=h.useMemo(()=>{const e=new Set;return t.forEach(t=>{t.target&&t.targetHandle&&e.add(`${t.target}-${t.targetHandle}`)}),e},[t]);h.useEffect(()=>{const e=e=>{if(e.ctrlKey||e.metaKey||e.altKey)return;if(document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement)return;const t=e.key.toLowerCase();k[t]&&(e.preventDefault(),A.current.add(t))},t=e=>{A.current.delete(e.key.toLowerCase())},n=()=>{A.current.clear()};return document.addEventListener("keydown",e),document.addEventListener("keyup",t),window.addEventListener("blur",n),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",t),window.removeEventListener("blur",n)}},[k]);const U=h.useCallback(e=>{let t=null;for(const n of A.current)if(k[n]){t=k[n];break}if(t){const n=R({x:e.clientX,y:e.clientY});qw(t.type,n,t.params)}},[R,k]),F=h.useCallback(e=>{C.current={x:e.clientX,y:e.clientY}},[]),B=h.useCallback(()=>{const{nodes:e,edges:t}=Xw.getState(),n=e.filter(e=>e.selected);if(0===n.length)return void(T.current=null);const r=new Set(n.map(e=>e.id)),i=t.filter(e=>r.has(e.source)&&r.has(e.target));T.current={nodes:n,edges:i}},[]),j=h.useCallback(()=>{if(!T.current||0===T.current.nodes.length)return;Gw.getState().recordState();const{nodes:e,edges:t}=T.current,n=E.screenToFlowPosition({x:C.current.x,y:C.current.y}),r=Math.min(...e.map(e=>e.position.x)),i=Math.min(...e.map(e=>e.position.y)),{nodes:a,edges:o}=(()=>{const a=new Map;return{nodes:e.map(e=>{const t=Bw();return a.set(e.id,t),{...e,id:t,selected:!0,position:{x:n.x+(e.position.x-r),y:n.y+(e.position.y-i)}}}),edges:t.map(e=>{const{selected:t,...n}=e,r=a.get(e.source),i=a.get(e.target);return r&&i?{...n,id:`e-${r}-${i}-${e.sourceHandle||""}-${e.targetHandle||""}`,source:r,target:i}:null}).filter(e=>null!==e)}})();Xw.setState(e=>({nodes:[...e.nodes.map(e=>({...e,selected:!1})),...a],edges:[...e.edges.map(e=>({...e,selected:!1})),...o],selectedNodeId:1===a.length?a[0].id:null}))},[E]);return h.useEffect(()=>{const e=e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;const t=e.ctrlKey||e.metaKey;if(t&&"z"===e.key.toLowerCase())e.preventDefault(),e.shiftKey?y():v();else if(t&&"y"===e.key.toLowerCase())e.preventDefault(),y();else if(t&&"c"===e.key)e.preventDefault(),B();else if(t&&"v"===e.key)e.preventDefault(),j();else if(t&&"d"===e.key.toLowerCase())e.preventDefault(),(()=>{const{nodes:e}=Xw.getState(),t=e.filter(e=>e.selected);0!==t.length&&(Gw.getState().recordState(),Xw.setState(e=>{const n=new Map,r=t.map(e=>{const t=Bw();return n.set(e.id,t),{...e,id:t,selected:!0,position:{x:e.position.x+32,y:e.position.y+32}}}),i=new Set(t.map(e=>e.id)),a=e.edges.filter(e=>i.has(e.source)&&i.has(e.target)).map(e=>{const t=n.get(e.source),r=n.get(e.target);return t&&r?{...e,id:`e-${t}-${r}-${e.sourceHandle}-${e.targetHandle}`,source:t,target:r}:null}).filter(e=>null!==e);return{nodes:[...e.nodes.map(e=>({...e,selected:!1})),...r],edges:[...e.edges,...a],selectedNodeId:1===r.length?r[0].id:null}}))})();else if(t&&"a"===e.key.toLowerCase())e.preventDefault(),Xw.setState(e=>{var t;if(e.nodes.every(e=>e.selected))return{};const n=e.nodes.map(e=>({...e,selected:!0}));return{nodes:n,selectedNodeId:n.length>1?null:(null==(t=n[0])?void 0:t.id)||null}});else if(t&&"b"===e.key.toLowerCase()){e.preventDefault();const{generatedShader:t,nodes:n}=Xw.getState();m(t,n)}else if(["1","2","3","4"].includes(e.key))switch(e.preventDefault(),e.key){case"1":g("surface");break;case"2":g("volume");break;case"3":g("slice");break;case"4":g("2d")}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[B,j,m,g,v,y]),s.jsxs("div",{className:"w-full h-full bg-[var(--color-bg-800)] relative pb-16 lg:pb-0",children:[s.jsx(LS.Provider,{value:O,children:s.jsxs(ds,{nodes:e,edges:z,onNodesChange:n,onEdgesChange:r,onConnect:i,onDrop:D,onDragOver:I,onDragLeave:L,onPaneMouseMove:F,onPaneClick:U,nodeTypes:NS,snapToGrid:!0,snapGrid:PS,fitView:!0,selectionOnDrag:!0,selectionMode:ci.Partial,multiSelectionKeyCode:"Shift",deleteKeyCode:["Backspace","Delete"],children:[s.jsx(Is,{}),s.jsx(_s,{}),s.jsx(Vs,{variant:Ns.Dots,gap:PS[0],size:4})]})}),N&&s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center pointer-events-none border-4 border-dashed border-[var(--color-accent-primary)] rounded-lg z-10",children:s.jsx("p",{className:"text-[var(--color-text-100)] text-2xl font-bold",children:"Drop JSON file to load graph"})})]})},zS={blue:"#60a5fa",orange:"#fb923c",yellow:"#facc15",purple:"#c084fc",teal:"#2dd4bf",green:"#4ade80",gray:"#9ca3af"},OS=({type:e,label:t,icon:n,onShowTip:r,onHideTip:i})=>{const{screenToFlowPosition:a}=Fa(),o=pl(e=>e.setIsDraggingNode),l=h.useRef(null),[c,u]=h.useState(!1),d=h.useRef(null),f=ul.get(e),p=zS[f.color]||zS.gray,m=h.useCallback(n=>{const r=n.touches[0];let i=!1;const s=e=>{if(i){if(!l.current)return;e.preventDefault();const t=e.touches[0];return l.current.style.left=`${t.clientX}px`,void(l.current.style.top=`${t.clientY}px`)}const n=e.touches[0],a=Math.abs(n.clientX-r.clientX),u=Math.abs(n.clientY-r.clientY);if(a>10&&a>u){i=!0,o(!0),e.preventDefault();const r=document.createElement("div");r.className="w-48 h-12 flex items-center p-2 bg-[var(--color-bg-700)] border-2 rounded-lg text-[var(--color-text-100)] absolute pointer-events-none z-[9999] opacity-90 shadow-lg",r.style.borderColor=getComputedStyle(document.documentElement).getPropertyValue("--color-accent-primary");const a=document.createElement("div");a.className="w-6 h-6 mr-3 rounded flex-shrink-0",a.style.backgroundColor=p;const s=document.createElement("p");s.className="text-sm text-[var(--color-text-100)] truncate",s.textContent=t,r.appendChild(a),r.appendChild(s),r.style.transform="translate(-50%, -50%)",r.style.left=`${n.clientX}px`,r.style.top=`${n.clientY}px`,document.body.appendChild(r),l.current=r}else u>10&&(window.removeEventListener("touchmove",s),window.removeEventListener("touchend",c))},c=t=>{if(window.removeEventListener("touchmove",s),window.removeEventListener("touchend",c),o(!1),l.current&&(document.body.removeChild(l.current),l.current=null),i){const n=t.changedTouches[0],r=document.elementFromPoint(n.clientX,n.clientY);if(null==r?void 0:r.closest(".react-flow__pane")){const t=a({x:n.clientX,y:n.clientY});qw(e,t)}}};window.addEventListener("touchmove",s,{passive:!1}),window.addEventListener("touchend",c)},[e,t,a,p,o]);return s.jsxs("div",{className:"group relative flex items-center p-2 rounded-md cursor-grab bg-[var(--color-bg-800)]/50 hover:bg-[var(--color-bg-700)] border border-transparent hover:border-[var(--color-accent-primary)]",title:t,onDragStart:t=>((e,t)=>{e.dataTransfer.setData("application/reactflow",t),e.dataTransfer.effectAllowed="move",d.current&&(clearTimeout(d.current),d.current=null),i(),o(!0)})(t,e),onDragEnd:()=>{o(!1)},onTouchStart:m,onMouseEnter:e=>{u(!0),d.current&&clearTimeout(d.current);const n=e.currentTarget.getBoundingClientRect();d.current=window.setTimeout(()=>{r({label:t,description:f.description,top:n.top-64})},500)},onMouseLeave:()=>{u(!1),d.current&&(clearTimeout(d.current),d.current=null),i()},draggable:!0,children:[s.jsx(n,{style:c?{color:p}:{},className:"w-6 h-6 mr-3 flex-shrink-0 text-[var(--color-text-300)]"}),s.jsx("p",{className:"text-sm text-[var(--color-text-300)] group-hover:text-[var(--color-text-100)] truncate leading-tight",children:t})]})},US=["Generators","Coordinates","Modifiers","Combiners","Inputs","Utility","Output"],FS={Generators:e=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21c4.97 0 9-4.03 9-9s-4.03-9-9-9-9 4.03-9 9 4.03 9 9 9z",opacity:"0.2"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h3c.75 0 1.5.25 2.125.625m3.75-.625c.625-.375 1.375-.625 2.125-.625h3"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12c0-2.254 1.848-4.088 4.14-4.088 1.488 0 2.808.772 3.593 1.94M15.357 14.146c.785 1.168 2.105 1.94 3.593 1.94C21.152 16.088 23 14.254 23 12",opacity:"0.5"})]}),Coordinates:e=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12h18M12 3v18"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 19.5l15-15",opacity:"0.5"})]}),Modifiers:e=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 15s3-4 6-4 6 4 6 4-3 4-6 4-6-4-6-4z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 8s3-4 6-4",opacity:"0.6"})]}),Combiners:e=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 10.875a4.125 4.125 0 118.25 0 4.125 4.125 0 01-8.25 0z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.875a4.125 4.125 0 11-8.25 0 4.125 4.125 0 018.25 0z",opacity:"0.6"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12c0 4.969 4.031 9 9 9s9-4.031 9-9S16.969 3 12 3 2.25 7.031 2.25 12z",opacity:"0.2"})]}),Inputs:e=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M20.25 20.25v-4.5m0 4.5h-4.5m4.5 0L15 15"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12a8.25 8.25 0 018.25-8.25h.01a8.25 8.25 0 018.249 8.25v.01a8.25 8.25 0 01-8.25 8.25h-.01a8.25 8.25 0 01-8.249-8.25v-.01z",opacity:"0.3"})]}),Utility:e=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193l-3.72 3.72a1.125 1.125 0 01-1.59 0l-3.72-3.72A1.125 1.125 0 016 16.942v-4.286c0-.97.616-1.813 1.5-2.097m6.002 0h-5.25m5.25 0V7.5a2.25 2.25 0 00-2.25-2.25H9.75a2.25 2.25 0 00-2.25 2.25v.011"})}),Output:e=>s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12h15m0 0l-6.75-6.75M19.5 12l-6.75 6.75"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z",opacity:"0.3"})]}),Default:oS},BS=({onSetTip:e})=>{const[t,n]=h.useState(""),r=h.useMemo(()=>{const e={};for(const t of cl)e[t.category]||(e[t.category]=[]),e[t.category].push(t.type);for(const t in e)e[t].sort((e,t)=>{var n,r;const i=(null==(n=ul.get(e))?void 0:n.label)||"",a=(null==(r=ul.get(t))?void 0:r.label)||"";return i.localeCompare(a)});return Object.entries(e).sort(([e],[t])=>{const n=US.indexOf(e),r=US.indexOf(t);return-1===n&&-1===r?e.localeCompare(t):-1===n?1:-1===r?-1:n-r})},[]),[i,a]=h.useState(Object.fromEntries(r.map(([e])=>[e,!0]))),o=h.useCallback(t=>{e(t)},[e]),l=h.useCallback(()=>{e(null)},[e]),c=t.toLowerCase(),u=h.useMemo(()=>c?r.map(([e,t])=>{const n=e.toLowerCase().includes(c),r=t.filter(e=>ul.get(e).label.toLowerCase().includes(c));return n||r.length>0?{groupName:e,nodeTypes:n?t:r,isExpanded:!0}:null}).filter(e=>null!==e):r.map(([e,t])=>({groupName:e,nodeTypes:t,isExpanded:i[e]??!1})),[c,i,r]);return s.jsxs("aside",{className:"bg-[var(--color-bg-900)] border-r border-[var(--color-border-700)] h-full flex flex-col overflow-hidden",children:[s.jsxs("div",{className:"p-4 flex-shrink-0 border-b border-[var(--color-bg-800)]",children:[s.jsx("h2",{className:"text-lg font-semibold mb-4 text-accent",children:"Nodes"}),s.jsxs("div",{className:"relative",children:[s.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:s.jsx(vS,{className:"w-5 h-5 text-[var(--color-text-400)]"})}),s.jsx("input",{type:"text",placeholder:"Search nodes...",value:t,onChange:e=>{n(e.target.value)},className:"w-full bg-[var(--color-bg-800)] border border-[var(--color-border-700)] rounded-md py-2 pl-10 pr-4 text-[var(--color-text-100)] placeholder-[var(--color-text-400)] focus:outline-none focus:ring-2 focus:ring-[var(--color-accent-primary)] focus:border-[var(--color-accent-primary)]","aria-label":"Search for nodes"})]})]}),s.jsx("div",{className:"flex-grow overflow-y-auto",children:s.jsxs("div",{className:"p-4 space-y-2",children:[u.map(({groupName:e,nodeTypes:n,isExpanded:r})=>s.jsxs("div",{children:[s.jsxs("button",{onClick:()=>{return n=e,void(t||a(e=>({...e,[n]:!e[n]})));var n},disabled:!!t,className:"w-full flex items-center justify-between text-left py-1.5 rounded-md hover:bg-[var(--color-bg-800)] focus:outline-none focus:bg-[var(--color-bg-800)] disabled:cursor-default disabled:hover:bg-transparent","aria-expanded":r,children:[s.jsx("h3",{className:"text-sm font-bold uppercase tracking-wider text-accent",children:e}),s.jsx(yS,{className:"w-5 h-5 text-[var(--color-text-400)] transition-transform duration-200 "+(r?"rotate-0":"-rotate-90")})]}),r&&s.jsx("div",{className:"flex flex-col gap-1 pt-2 pb-2",children:n.map(e=>{const t=ul.get(e),n=FS[t.category]||FS.Default;return s.jsx(OS,{type:e,label:t.label,icon:n,onShowTip:o,onHideTip:l},e)})})]},e)),t&&0===u.length&&s.jsx("div",{className:"text-center text-[var(--color-text-400)] pt-10",children:s.jsxs("p",{children:['No results for "',t,'".']})})]})})]})},jS=(e,t,n)=>{t/=100,n/=100;const r=Math.floor(e/60),i=e/60-r,a=n*(1-t),o=n*(1-i*t),s=n*(1-(1-i)*t);let l=0,c=0,u=0;switch(r%6){case 0:l=n,c=s,u=a;break;case 1:l=o,c=n,u=a;break;case 2:l=a,c=n,u=s;break;case 3:l=a,c=o,u=n;break;case 4:l=s,c=a,u=n;break;case 5:l=n,c=a,u=o}return{r:255*l,g:255*c,b:255*u}},HS=e=>{const t=Math.round(e).toString(16);return 1===t.length?"0"+t:t},VS=({value:e,onChange:t})=>{const[n,r]=h.useState({h:0,s:100,v:100}),i=h.useRef(null),a=h.useRef(null);h.useEffect(()=>{const{r:t,g:n,b:i}=(e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:0,g:0,b:0}})(e);r(((e,t,n)=>{e/=255,t/=255,n/=255;const r=Math.max(e,t,n),i=Math.min(e,t,n);let a=0,o=0,s=r;const l=r-i;if(o=0===r?0:l/r,r!==i){switch(r){case e:a=(t-n)/l+(t<n?6:0);break;case t:a=(n-e)/l+2;break;case n:a=(e-t)/l+4}a/=6}return{h:360*a,s:100*o,v:100*s}})(t,n,i))},[e]);const o=h.useCallback(e=>{const{r:n,g:r,b:i}=jS(e.h,e.s,e.v);t(((e,t,n)=>`#${HS(e)}${HS(t)}${HS(n)}`)(n,r,i))},[t]),l=e=>{if(!i.current)return;const t=i.current.getBoundingClientRect(),r="touches"in e?e.touches[0].clientX:e.clientX,a="touches"in e?e.touches[0].clientY:e.clientY,s=Math.max(0,Math.min(t.width,r-t.left)),l=Math.max(0,Math.min(t.height,a-t.top)),c=s/t.width*100,u=100-l/t.height*100;o({...n,s:c,v:u})},c=e=>{if(!a.current)return;const t=a.current.getBoundingClientRect(),r="touches"in e?e.touches[0].clientY:e.clientY,i=Math.max(0,Math.min(t.height,r-t.top))/t.height*360;o({...n,h:i})},u=e=>t=>{t.preventDefault(),e(t);const n="touches"in t,r=t=>{e(t)},i=()=>{n?(window.removeEventListener("touchmove",r),window.removeEventListener("touchend",i)):(window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i))};n?(window.addEventListener("touchmove",r),window.addEventListener("touchend",i)):(window.addEventListener("mousemove",r),window.addEventListener("mouseup",i))},{r:d,g:f,b:p}=jS(n.h,100,100),m=`rgb(${d}, ${f}, ${p})`;return s.jsxs("div",{className:"flex space-x-3",children:[s.jsxs("div",{ref:i,className:"relative w-full h-40 rounded-md cursor-crosshair overflow-hidden",style:{backgroundColor:m},onMouseDown:u(l),onTouchStart:u(l),children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white to-transparent"}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black to-transparent"}),s.jsx("div",{className:"absolute w-4 h-4 rounded-full border-2 border-white shadow-lg pointer-events-none",style:{left:`${n.s}%`,top:100-n.v+"%",transform:"translate(-50%, -50%)",backgroundColor:e}})]}),s.jsx("div",{ref:a,className:"relative w-5 h-40 rounded-full cursor-pointer",style:{background:"linear-gradient(to bottom, #f00, #ff0, #0f0, #0ff, #00f, #f0f, #f00)"},onMouseDown:u(c),onTouchStart:u(c),children:s.jsx("div",{className:"absolute left-1/2 w-5 h-5 -translate-x-1/2 -translate-y-1/2 rounded-full border-2 border-white shadow-lg pointer-events-none",style:{top:n.h/360*100+"%",backgroundColor:m}})})]})},GS=(e,t)=>{h.useEffect(()=>{const n=n=>{const r=null==e?void 0:e.current;r&&!r.contains(n.target)&&t(n)};return document.addEventListener("mousedown",n,!0),document.addEventListener("touchstart",n,!0),()=>{document.removeEventListener("mousedown",n,!0),document.removeEventListener("touchstart",n,!0)}},[e,t])},WS=({nodeId:e,data:t})=>{const[n,r]=h.useState(null),i=h.useRef(null);GS(i,()=>r(null));const{fontSize:a=14,fontWeight:o="normal",fontStyle:l="normal",backgroundColor:c="#374151",textColor:u="#F9FAFB",opacity:d=1,textOpacity:f=1}=t;return s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-semibold text-lg text-accent",children:"Comment Style"}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-[var(--color-text-200)]",children:"Font Size"}),s.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[s.jsx("input",{type:"range",min:"10",max:"48",step:"1",value:a,onChange:t=>Zw(e,{fontSize:Number(t.target.value)},!0),onMouseUp:()=>Zw(e,{fontSize:a},!1),className:"flex-grow h-2 bg-[var(--color-bg-600)] rounded-lg appearance-none cursor-pointer accent-[var(--color-accent-primary)]"}),s.jsxs("span",{className:"font-mono text-sm w-10 text-right",children:[a,"px"]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-[var(--color-text-200)]",children:"Font Weight"}),s.jsxs("div",{className:"flex items-center bg-[var(--color-bg-900)]/70 p-1 rounded-md mt-1",children:[s.jsx("button",{onClick:()=>Zw(e,{fontWeight:"normal"},!1),className:"px-3 py-1 text-sm font-semibold rounded transition-colors w-1/2 "+("normal"===o?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)]":"hover:bg-[var(--color-bg-700)] text-[var(--color-text-300)]"),children:"Regular"}),s.jsx("button",{onClick:()=>Zw(e,{fontWeight:"bold"},!1),className:"px-3 py-1 text-sm font-semibold rounded transition-colors w-1/2 "+("bold"===o?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)]":"hover:bg-[var(--color-bg-700)] text-[var(--color-text-300)]"),children:"Bold"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-[var(--color-text-200)]",children:"Font Style"}),s.jsxs("div",{className:"flex items-center bg-[var(--color-bg-900)]/70 p-1 rounded-md mt-1",children:[s.jsx("button",{onClick:()=>Zw(e,{fontStyle:"normal"},!1),className:"px-3 py-1 text-sm font-semibold rounded transition-colors w-1/2 "+("normal"===l?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)]":"hover:bg-[var(--color-bg-700)] text-[var(--color-text-300)]"),children:"Regular"}),s.jsx("button",{onClick:()=>Zw(e,{fontStyle:"italic"},!1),className:"px-3 py-1 text-sm font-semibold rounded transition-colors w-1/2 "+("italic"===l?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)]":"hover:bg-[var(--color-bg-700)] text-[var(--color-text-300)]"),children:"Italic"})]})]})]}),s.jsxs("div",{className:"relative space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-[var(--color-text-200)]",children:"Background"}),s.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[s.jsx("button",{title:"Background Color",onClick:()=>r("background"),className:"w-8 h-8 rounded-md border border-[var(--color-border-600)]",style:{backgroundColor:c}}),s.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:d,onChange:t=>Zw(e,{opacity:Number(t.target.value)},!0),onMouseUp:()=>Zw(e,{opacity:d},!1),className:"flex-grow h-2 bg-[var(--color-bg-600)] rounded-lg appearance-none cursor-pointer accent-[var(--color-accent-primary)]","aria-label":"Background Opacity"}),s.jsxs("span",{className:"font-mono text-sm w-12 text-right",children:[Math.round(100*d),"%"]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-[var(--color-text-200)]",children:"Text"}),s.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[s.jsx("button",{title:"Text Color",onClick:()=>r("text"),className:"w-8 h-8 rounded-md border border-[var(--color-border-600)] flex items-center justify-center text-lg font-bold bg-white",children:s.jsx("span",{style:{color:u},children:"A"})}),s.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:f,onChange:t=>Zw(e,{textOpacity:Number(t.target.value)},!0),onMouseUp:()=>Zw(e,{textOpacity:f},!1),className:"flex-grow h-2 bg-[var(--color-bg-600)] rounded-lg appearance-none cursor-pointer accent-[var(--color-accent-primary)]","aria-label":"Text Opacity"}),s.jsxs("span",{className:"font-mono text-sm w-12 text-right",children:[Math.round(100*f),"%"]})]})]}),n&&s.jsx("div",{ref:i,className:"absolute right-0 mt-2 z-10 bg-[var(--color-bg-800)] border border-[var(--color-border-700)] rounded-lg shadow-2xl p-4 w-64",children:s.jsx(VS,{value:"background"===n?c:u,onChange:t=>{n&&Zw(e,{["background"===n?"backgroundColor":"textColor"]:t},!0)}})})]})]})},$S=({options:e,value:t,onChange:n,disabled:r=!1,className:i="",selectClassName:a="px-2 py-1.5 text-sm"})=>{const[o,l]=h.useState(!1),c=h.useRef(null);GS(c,()=>l(!1));const u=e.find(e=>e.value===t);return s.jsxs("div",{ref:c,className:`relative ${i}`,children:[s.jsxs("button",{type:"button",onClick:()=>{r||l(!o)},disabled:r,"aria-haspopup":"listbox","aria-expanded":o,className:`w-full flex items-center justify-between bg-[var(--color-bg-700)] border border-[var(--color-border-600)] rounded-md text-[var(--color-text-100)] focus:outline-none focus:ring-2 focus:ring-[var(--color-accent-primary)] disabled:opacity-50 disabled:cursor-not-allowed transition-colors ${a}`,children:[s.jsx("span",{className:"truncate",children:u?u.label:"Select..."}),s.jsx(yS,{className:"w-4 h-4 ml-2 flex-shrink-0 "+(o?"rotate-180":"")})]}),o&&s.jsx("div",{role:"listbox",className:"absolute z-20 mt-1 w-full bg-[var(--color-bg-800)] border border-[var(--color-border-700)] rounded-md shadow-lg max-h-60 overflow-auto",children:s.jsx("div",{className:"p-1",children:e.map(e=>s.jsx("button",{onClick:()=>{return t=e.value,n(t),void l(!1);var t},onMouseDown:e=>e.stopPropagation(),role:"option","aria-selected":t===e.value,className:"w-full text-left text-sm px-3 py-1.5 rounded-md transition-colors "+(t===e.value?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)]":"text-[var(--color-text-200)] hover:bg-[var(--color-bg-700)] hover:text-[var(--color-text-100)]"),children:e.label},e.value))})})]})},XS=e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:0,g:0,b:0}},qS=e=>{const t=Math.round(e).toString(16);return 1===t.length?"0"+t:t},YS=({nodeId:e,param:t})=>{const n=h.useMemo(()=>{try{const e=JSON.parse(t.value);return Array.isArray(e)?e.sort((e,t)=>e.pos-t.pos):[]}catch{return[]}},[t.value]),[r,i]=h.useState(null),a=h.useRef(null),o=h.useRef(null);GS(o,()=>{null!==r&&i(null)});const l=n=>{const r=[...n].sort((e,t)=>e.pos-t.pos);Yw(e,t.id,JSON.stringify(r))},c=h.useMemo(()=>{var e;return n.length<2?(null==(e=n[0])?void 0:e.color)||"#fff":`linear-gradient(to right, ${n.map(e=>`${e.color} ${100*e.pos}%`).join(", ")})`},[n]);return s.jsxs("div",{className:"space-y-3 py-2",children:[s.jsx("label",{className:"text-sm font-medium text-[var(--color-text-200)]",children:t.label}),s.jsxs("div",{className:"relative h-10 -mb-2",children:[s.jsx("div",{ref:a,onClick:e=>{if(!a.current)return;const t=a.current.getBoundingClientRect();(e=>{let t="#ffffff";if(n.length>0){const i=n.findIndex(t=>t.pos>e);let s,l,c;if(0===i)s=l=n[0].color,c=0;else if(-1===i)s=l=n[n.length-1].color,c=1;else{const t=n[i-1],r=n[i];s=t.color,l=r.color,c=(e-t.pos)/(r.pos-t.pos)}const u=XS(s),d=XS(l);r=u.r+(d.r-u.r)*c,a=u.g+(d.g-u.g)*c,o=u.b+(d.b-u.b)*c,t=`#${qS(r)}${qS(a)}${qS(o)}`}var r,a,o;const s=[...n,{pos:e,color:t}].sort((e,t)=>e.pos-t.pos);l(s),i(s.findIndex(t=>t.pos===e))})((e.clientX-t.left)/t.width)},className:"h-6 mt-2 w-full rounded-md border border-[var(--color-border-600)] cursor-pointer",style:{background:c}}),n.map((e,t)=>s.jsx("div",{className:"absolute top-1/2 w-4 h-4 rounded-full border-2 bg-clip-content p-0.5 cursor-pointer",style:{left:100*e.pos+"%",transform:"translate(-50%, -50%)",borderColor:r===t?"var(--color-accent-primary)":"white",backgroundColor:e.color,boxShadow:"0 1px 3px rgba(0,0,0,0.5)"},onMouseDown:e=>((e,t)=>{e.preventDefault(),e.stopPropagation(),i(t);const r=e=>{if(!a.current)return;const r=a.current.getBoundingClientRect(),i=(e.clientX-r.left)/r.width;((e,t)=>{const r=[...n];r[e].pos=Math.max(0,Math.min(1,t)),l(r)})(t,i)},o=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",o)})(e,t),onDoubleClick:()=>(e=>{if(n.length<=2)return;const t=n.filter((t,n)=>n!==e);l(t),i(null)})(t)},t))]}),null!==r&&s.jsx("div",{ref:o,className:"z-10 bg-[var(--color-bg-800)] border border-[var(--color-border-700)] rounded-lg shadow-2xl p-4 w-64 mx-auto",children:s.jsx(VS,{value:n[r].color,onChange:e=>{if(null===r)return;const t=[...n];t[r].color=e,l(t)}})})]})},ZS=({label:e,value:t,onChange:n,onReset:r,min:i,max:a,step:o,isModified:l,disabled:c=!1})=>{const u=h.useMemo(()=>{const e=String(o).split(".");return e.length>1?e[1].length:0},[o]),[d,f]=h.useState(!1),[p,m]=h.useState(t.toFixed(u)),g=h.useRef(null),v=h.useRef({isDragging:!1,startX:0,startValue:0}).current;h.useEffect(()=>{d||m(t.toFixed(u))},[t,d,u]),h.useEffect(()=>{d&&g.current&&g.current.select()},[d]);const y=h.useCallback(e=>{const r=e.clientX-v.startX;if(!v.isDragging&&Math.abs(r)>2&&(v.isDragging=!0),v.isDragging){const e=(a-i)/200;let s=v.startValue+r*e;s=Math.round(s/o)*o;const l=Math.max(i,Math.min(a,s));l!==t&&n(l)}},[i,a,o,n,t,v]),b=h.useCallback(()=>{v.isDragging||f(!0),document.body.style.cursor="",window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",b)},[y,v]),x=h.useCallback(e=>{d||c||(e.preventDefault(),v.isDragging=!1,v.startX=e.clientX,v.startValue=t,document.body.style.cursor="ew-resize",window.addEventListener("mousemove",y),window.addEventListener("mouseup",b))},[d,c,t,y,b,v]),_=()=>{const e=parseFloat(p);isNaN(e)||n(e),f(!1)},w=h.useMemo(()=>{if(a<=i)return t>i?100:0;const e=(t-i)/(a-i)*100;return Math.max(0,Math.min(100,e))},[t,i,a]);return s.jsxs("div",{className:"flex items-center space-x-3 group h-10",children:[s.jsx("div",{className:"w-6 flex-shrink-0 flex items-center justify-center",children:r&&s.jsx("button",{onClick:r,disabled:!l||c,title:"Reset to default",className:`w-6 h-6 flex items-center justify-center transition-opacity text-[var(--color-text-400)] hover:text-[var(--color-text-100)] disabled:text-[var(--color-text-400)] disabled:cursor-not-allowed disabled:hover:text-[var(--color-text-400)] ${l?"opacity-100":"opacity-0"} group-hover:opacity-100 focus:opacity-100`,children:s.jsx(bS,{className:"w-4 h-4"})})}),s.jsx("label",{title:e,className:"text-sm font-medium select-none w-28 flex-shrink-0 truncate "+(c?"text-[var(--color-text-400)]":"text-[var(--color-text-300)]"),children:e}),s.jsx("div",{className:"relative flex-grow h-8",children:d?s.jsx("input",{ref:g,type:"number",step:o,value:p,onChange:e=>m(e.target.value),onBlur:_,onKeyDown:e=>{"Enter"===e.key&&_(),"Escape"===e.key&&(m(t.toFixed(u)),f(!1))},disabled:c,className:"absolute inset-0 w-full h-full bg-transparent text-center font-mono outline-none ring-2 ring-[var(--color-accent-primary)] rounded-md text-[var(--color-text-100)] [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}):s.jsxs("div",{onMouseDown:x,className:"relative w-full h-full flex items-center justify-center bg-[var(--color-bg-700)] border border-transparent rounded-md px-2 py-1.5 text-sm font-mono cursor-ew-resize select-none transition-colors overflow-hidden "+(c?"opacity-50 cursor-not-allowed":"hover:border-[var(--color-border-600)]"),children:[s.jsx("div",{className:"absolute top-0 left-0 h-full bg-[var(--color-accent-primary)] opacity-40",style:{width:`${w}%`}}),s.jsx("span",{className:"relative z-10 text-[var(--color-text-100)]",children:t.toFixed(u)})]})})]})},KS=({nodeId:e,param:t,nodeData:n})=>{const r=Xw(e=>e.edges),[i,a]=h.useState(!1),o=h.useRef(null);GS(o,()=>a(!1));const l=h.useMemo(()=>r.some(n=>n.target===e&&n.targetHandle===t.id),[r,e,t.id]),c=h.useMemo(()=>{const e=ul.get(n.type),r=null==e?void 0:e.params(n).find(e=>e.id===t.id);return r?r.value:null},[n,t.id]),u=null!==c&&t.value!==c,d=h.useCallback(()=>{((e,t)=>{const{nodes:n}=Xw.getState(),r=n.find(t=>t.id===e);if(!r)return;const i=ul.get(r.data.type);if(!i)return;const a=i.params(r.data).find(e=>e.id===t);if(!a)return;const o=a.value,s=r.data.params.find(e=>e.id===t);s&&"value"in s&&s.value===o||(Gw.getState().recordState(),Xw.setState(n=>({nodes:n.nodes.map(n=>{if(n.id===e){const e=n.data.params.map(e=>e.id===t?{...e,value:o}:e);return{...n,data:{...n.data,params:e}}}return n})})),jw())})(e,t.id)},[e,t.id]);return"slider"===t.type?s.jsx(ZS,{label:t.label,value:t.value,onChange:n=>Yw(e,t.id,n),onReset:d,min:t.min,max:t.max,step:t.step,isModified:u,disabled:l}):"select"===t.type?s.jsx("div",{className:"group",children:s.jsxs("div",{className:"flex items-center space-x-3 h-10",children:[s.jsx("div",{className:"w-6 flex-shrink-0",children:s.jsx("button",{onClick:d,disabled:!u,title:"Reset to default",className:`w-6 h-6 flex items-center justify-center rounded-full transition-all text-[var(--color-text-400)] hover:text-[var(--color-text-100)] hover:bg-[var(--color-bg-700)] disabled:text-[var(--color-text-400)] disabled:cursor-not-allowed disabled:hover:text-[var(--color-text-400)] disabled:hover:bg-transparent ${u?"opacity-100":"opacity-0"} group-hover:opacity-100 focus:opacity-100`,children:s.jsx(bS,{className:"w-4 h-4"})})}),s.jsx("label",{className:"text-sm select-none w-28 flex-shrink-0 truncate pr-2 text-[var(--color-text-300)]",title:t.label,children:t.label}),s.jsx($S,{value:t.value,onChange:n=>Yw(e,t.id,String(n)),options:t.options,className:"flex-grow"})]})}):"checkbox"===t.type?s.jsx("div",{className:"group",children:s.jsxs("div",{className:"flex items-center space-x-3 h-10",children:[s.jsx("div",{className:"w-6 flex-shrink-0",children:s.jsx("button",{onClick:d,disabled:!u||l,title:"Reset to default",className:`w-6 h-6 flex items-center justify-center rounded-full transition-all text-[var(--color-text-400)] hover:text-[var(--color-text-100)] hover:bg-[var(--color-bg-700)] disabled:text-[var(--color-text-400)] disabled:cursor-not-allowed disabled:hover:text-[var(--color-text-400)] disabled:hover:bg-transparent ${u?"opacity-100":"opacity-0"} group-hover:opacity-100 focus:opacity-100`,children:s.jsx(bS,{className:"w-4 h-4"})})}),s.jsx("label",{htmlFor:`${e}-${t.id}`,className:"text-sm select-none w-28 flex-shrink-0 truncate pr-2 text-[var(--color-text-300)]",title:t.label,children:t.label}),s.jsx("div",{className:"flex-grow flex items-center h-full",children:s.jsx("input",{id:`${e}-${t.id}`,type:"checkbox",checked:t.value,onChange:n=>Yw(e,t.id,n.target.checked),disabled:l,className:"w-5 h-5 bg-[var(--color-bg-700)] border border-[var(--color-border-600)] rounded text-[var(--color-accent-primary)] focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--color-bg-800)] focus:ring-[var(--color-accent-primary)] disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"})})]})}):"color"===t.type?s.jsxs("div",{className:"group relative",children:[s.jsxs("div",{className:"flex items-center space-x-3 h-10",children:[s.jsx("div",{className:"w-6 flex-shrink-0",children:s.jsx("button",{onClick:d,disabled:!u||l,title:"Reset to default",className:`w-6 h-6 flex items-center justify-center rounded-full transition-all text-[var(--color-text-400)] hover:text-[var(--color-text-100)] hover:bg-[var(--color-bg-700)] disabled:text-[var(--color-text-400)] disabled:cursor-not-allowed disabled:hover:text-[var(--color-text-400)] disabled:hover:bg-transparent ${u?"opacity-100":"opacity-0"} group-hover:opacity-100 focus:opacity-100`,children:s.jsx(bS,{className:"w-4 h-4"})})}),s.jsx("label",{className:"text-sm select-none w-28 flex-shrink-0 truncate pr-2 text-[var(--color-text-300)]",title:t.label,children:t.label}),s.jsx("div",{className:"flex-grow",children:s.jsx("button",{onClick:()=>a(e=>!e),className:"w-full h-8 rounded-md border border-[var(--color-border-600)]",style:{backgroundColor:t.value},"aria-label":`Open color picker for ${t.label}`})})]}),i&&s.jsx("div",{ref:o,className:"absolute left-6 mt-2 z-10 bg-[var(--color-bg-800)] border border-[var(--color-border-700)] rounded-lg shadow-2xl p-4 w-64",children:s.jsx(VS,{value:t.value,onChange:n=>Yw(e,t.id,n)})})]}):"gradient"===t.type?s.jsx(YS,{nodeId:e,param:t}):null},JS=()=>{const e=Xw(e=>e.nodes.find(t=>t.id===e.selectedNodeId));return s.jsxs("div",{className:"p-4 h-full overflow-y-auto bg-[var(--color-bg-800)] text-[var(--color-text-100)]",children:[s.jsx("h3",{className:"text-md font-bold mb-4 border-b border-[var(--color-border-700)] pb-2 text-accent",children:"Properties"}),e?"Comment"===e.data.type?s.jsx(WS,{nodeId:e.id,data:e.data},e.id):s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"font-semibold text-lg text-accent",children:e.data.label}),e.data.params.length>0?e.data.params.map(t=>s.jsx(KS,{nodeId:e.id,param:t,nodeData:e.data},t.id)):s.jsx("p",{className:"text-xs text-[var(--color-text-400)]",children:"No parameters to edit."})]},e.id):s.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-[var(--color-text-400)] p-4",children:[s.jsx(sS,{className:"w-16 h-16 mb-4 text-[var(--color-text-400)]"}),s.jsx("h3",{className:"font-bold text-accent",children:"No Node Selected"}),s.jsx("p",{className:"text-sm mt-1",children:"Select a node in the editor to view and edit its properties."})]})]})};var QS,eM,tM={exports:{}},nM={},rM=(eM||(eM=1,tM.exports=(QS||(QS=1,nM.ConcurrentRoot=1,nM.ContinuousEventPriority=8,nM.DefaultEventPriority=32,nM.DiscreteEventPriority=2,nM.IdleEventPriority=268435456,nM.LegacyRoot=0,nM.NoEventPriority=0),nM)),tM.exports);const{useSyncExternalStoreWithSelector:iM}=O,aM=e=>e,oM=(e,t)=>{const n=Ks(e),r=(e,r=t)=>function(e,t=aM,n){const r=iM(e.subscribe,e.getState,e.getInitialState,t,n);return f.useDebugValue(r),r}(n,e,r);return Object.assign(r,n),r};var sM,lM,cM,uM,dM={exports:{}},hM={exports:{}},fM={exports:{}},pM={};function mM(){return lM||(lM=1,fM.exports=(sM||(sM=1,function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,l=e[s],c=s+1,u=e[c];if(0>i(l,n))c<a&&0>i(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[s]=n,r=s);else{if(!(c<a&&0>i(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(e.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}var l=[],c=[],u=1,d=null,h=3,f=!1,p=!1,m=!1,g="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,y="undefined"!=typeof setImmediate?setImmediate:null;function b(e){for(var i=n(c);null!==i;){if(null===i.callback)r(c);else{if(!(i.startTime<=e))break;r(c),i.sortIndex=i.expirationTime,t(l,i)}i=n(c)}}function x(e){if(m=!1,b(e),!p)if(null!==n(l))p=!0,R();else{var t=n(c);null!==t&&N(x,t.startTime-e)}}var _,w=!1,S=-1,M=5,E=-1;function T(){return!(e.unstable_now()-E<M)}function C(){if(w){var t=e.unstable_now();E=t;var i=!0;try{e:{p=!1,m&&(m=!1,v(S),S=-1),f=!0;var a=h;try{t:{for(b(t),d=n(l);null!==d&&!(d.expirationTime>t&&T());){var o=d.callback;if("function"==typeof o){d.callback=null,h=d.priorityLevel;var s=o(d.expirationTime<=t);if(t=e.unstable_now(),"function"==typeof s){d.callback=s,b(t),i=!0;break t}d===n(l)&&r(l),b(t)}else r(l);d=n(l)}if(null!==d)i=!0;else{var u=n(c);null!==u&&N(x,u.startTime-t),i=!1}}break e}finally{d=null,h=a,f=!1}i=void 0}}finally{i?_():w=!1}}}if("function"==typeof y)_=function(){y(C)};else if("undefined"!=typeof MessageChannel){var A=new MessageChannel,k=A.port2;A.port1.onmessage=C,_=function(){k.postMessage(null)}}else _=function(){g(C,0)};function R(){w||(w=!0,_())}function N(t,n){S=g(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){p||f||(p=!0,R())},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<e?Math.floor(1e3/e):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},e.unstable_scheduleCallback=function(r,i,a){var o=e.unstable_now();switch(a="object"==typeof a&&null!==a&&"number"==typeof(a=a.delay)&&0<a?o+a:o,r){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return r={id:u++,callback:i,priorityLevel:r,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(r.sortIndex=a,t(c,r),null===n(l)&&r===n(c)&&(m?(v(S),S=-1):m=!0,N(x,a-o))):(r.sortIndex=s,t(l,r),p||f||(p=!0,R())),r},e.unstable_shouldYield=T,e.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}}(pM)),pM)),fM.exports}
/**
* @license React
* react-reconciler.production.js
*
* Copyright (c) Meta Platforms, Inc. and affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/const gM=e((uM||(uM=1,dM.exports=(cM||(cM=1,(vM=hM).exports=function(e){function t(e,t,n,r){return new Mi(e,t,n,r)}function n(){}function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=la&&e[la]||e["@@iterator"])?e:null}function a(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===ca?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case Yi:return"Fragment";case qi:return"Portal";case Ki:return"Profiler";case Zi:return"StrictMode";case na:return"Suspense";case ra:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case ea:return(e.displayName||"Context")+".Provider";case Qi:return(e._context.displayName||"Context")+".Consumer";case ta:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case ia:return null!==(t=e.displayName||null)?t:a(e.type)||"Memo";case aa:t=e._payload,e=e._init;try{return a(e(t))}catch(n){}}return null}function o(e){if(void 0===Bi)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Bi=t&&t[1]||"",ji=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Bi+e+ji}function s(e,t){if(!e||da)return"";da=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(i){var r=i}Reflect.construct(e,[],n)}else{try{n.call()}catch(a){r=a}e.call(n.prototype)}}else{try{throw Error()}catch(o){r=o}(n=e())&&"function"==typeof n.catch&&n.catch(function(){})}}catch(s){if(s&&r&&"string"==typeof s.stack)return[s.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var a=r.DetermineComponentFrameRoot(),s=a[0],l=a[1];if(s&&l){var c=s.split("\n"),u=l.split("\n");for(i=r=0;r<c.length&&!c[r].includes("DetermineComponentFrameRoot");)r++;for(;i<u.length&&!u[i].includes("DetermineComponentFrameRoot");)i++;if(r===c.length||i===u.length)for(r=c.length-1,i=u.length-1;1<=r&&0<=i&&c[r]!==u[i];)i--;for(;1<=r&&0<=i;r--,i--)if(c[r]!==u[i]){if(1!==r||1!==i)do{if(r--,0>--i||c[r]!==u[i]){var d="\n"+c[r].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}}while(1<=r&&0<=i);break}}}finally{da=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?o(n):""}function l(e){switch(e.tag){case 26:case 27:case 5:return o(e.type);case 16:return o("Lazy");case 13:return o("Suspense");case 19:return o("SuspenseList");case 0:case 15:return s(e.type,!1);case 11:return s(e.type.render,!1);case 1:return s(e.type,!0);default:return""}}function c(e){try{var t="";do{t+=l(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function u(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function h(e){if(u(e)!==e)throw Error(r(188))}function f(e){var t=e.alternate;if(!t){if(null===(t=u(e)))throw Error(r(188));return t!==e?null:e}for(var n=e,i=t;;){var a=n.return;if(null===a)break;var o=a.alternate;if(null===o){if(null!==(i=a.return)){n=i;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===n)return h(a),e;if(o===i)return h(a),t;o=o.sibling}throw Error(r(188))}if(n.return!==i.return)n=a,i=o;else{for(var s=!1,l=a.child;l;){if(l===n){s=!0,n=a,i=o;break}if(l===i){s=!0,i=a,n=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===n){s=!0,n=o,i=a;break}if(l===i){s=!0,i=o,n=a;break}l=l.sibling}if(!s)throw Error(r(189))}}if(n.alternate!==i)throw Error(r(190))}if(3!==n.tag)throw Error(r(188));return n.stateNode.current===n?e:t}function p(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=p(e)))return t;e=e.sibling}return null}function m(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(4!==e.tag&&null!==(t=m(e)))return t;e=e.sibling}return null}function g(e){return{current:e}}function v(e){0>ys||(e.current=vs[ys],vs[ys]=null,ys--)}function y(e,t){ys++,vs[ys]=e.current,e.current=t}function b(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194176&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function x(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,o=e.warmLanes;e=0!==e.finishedLanes;var s=134217727&n;return 0!==s?0!==(n=s&~i)?r=b(n):0!==(a&=s)?r=b(a):e||0!==(o=s&~o)&&(r=b(o)):0!==(s=n&~i)?r=b(s):0!==a?r=b(a):e||0!==(o=n&~o)&&(r=b(o)),0===r?0:0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(o=t&-t)||32===i&&4194176&o)?t:r}function _(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function w(e,t){switch(e){case 1:case 2:case 4:case 8:return t+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function S(){var e=Ss;return!(4194176&(Ss<<=1))&&(Ss=128),e}function M(){var e=Ms;return!(62914560&(Ms<<=1))&&(Ms=4194304),e}function E(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function T(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function C(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-xs(t);e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|4194218&n}function A(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-xs(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}function k(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function R(e){if("function"==typeof Ls&&Ds(e),Os&&"function"==typeof Os.setStrictMode)try{Os.setStrictMode(zs,e)}catch(t){}}function N(e,t){if("object"==typeof e&&null!==e){var n=Fs.get(e);return void 0!==n?n:(t={value:e,source:t,stack:c(t)},Fs.set(e,t),t)}return{value:e,source:t,stack:c(t)}}function P(e,t){Bs[js++]=Vs,Bs[js++]=Hs,Hs=e,Vs=t}function I(e,t,n){Gs[Ws++]=Xs,Gs[Ws++]=qs,Gs[Ws++]=$s,$s=e;var r=Xs;e=qs;var i=32-xs(r)-1;r&=~(1<<i),n+=1;var a=32-xs(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Xs=1<<32-xs(t)+i|n<<i|r,qs=a+e}else Xs=1<<a|n<<i|r,qs=e}function L(e){null!==e.return&&(P(e,1),I(e,1,0))}function D(e){for(;e===Hs;)Hs=Bs[--js],Bs[js]=null,Vs=Bs[--js],Bs[js]=null;for(;e===$s;)$s=Gs[--Ws],Gs[Ws]=null,qs=Gs[--Ws],Gs[Ws]=null,Xs=Gs[--Ws],Gs[Ws]=null}function z(e,t){y(Ks,t),y(Zs,e),y(Ys,null),e=va(t),v(Ys),y(Ys,e)}function O(){v(Ys),v(Zs),v(Ks)}function U(e){null!==e.memoizedState&&y(Js,e);var t=Ys.current,n=ya(t,e.type);t!==n&&(y(Zs,e),y(Ys,n))}function F(e){Zs.current===e&&(v(Ys),v(Zs)),Js.current===e&&(v(Js),ka?$a._currentValue=Wa:$a._currentValue2=Wa)}function B(e){throw W(N(Error(r(418,"")),e)),il}function j(e,t){if(!Pa)throw Error(r(175));Bo(e.stateNode,e.type,e.memoizedProps,t,e)||B(e)}function H(e){for(Qs=e.return;Qs;)switch(Qs.tag){case 3:case 27:return void(rl=!0);case 5:case 13:return void(rl=!1);default:Qs=Qs.return}}function V(e){if(!Pa||e!==Qs)return!1;if(!tl)return H(e),tl=!0,!1;var t=!1;if(ds?3!==e.tag&&27!==e.tag&&(5!==e.tag||qo(e.type)&&!Ma(e.type,e.memoizedProps))&&(t=!0):3!==e.tag&&(5!==e.tag||qo(e.type)&&!Ma(e.type,e.memoizedProps))&&(t=!0),t&&el&&B(e),H(e),13===e.tag){if(!Pa)throw Error(r(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));el=Vo(e)}else el=Qs?Io(e.stateNode):null;return!0}function G(){Pa&&(el=Qs=null,tl=!1)}function W(e){null===nl?nl=[e]:nl.push(e)}function $(){for(var e=ol,t=sl=ol=0;t<e;){var n=al[t];al[t++]=null;var r=al[t];al[t++]=null;var i=al[t];al[t++]=null;var a=al[t];if(al[t++]=null,null!==r&&null!==i){var o=r.pending;null===o?i.next=i:(i.next=o.next,o.next=i),r.pending=i}0!==a&&Z(n,i,a)}}function X(e,t,n,r){al[ol++]=e,al[ol++]=t,al[ol++]=n,al[ol++]=r,sl|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function q(e,t,n,r){return X(e,t,n,r),K(e)}function Y(e,t){return X(e,null,null,t),K(e)}function Z(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var i=!1,a=e.return;null!==a;)a.childLanes|=n,null!==(r=a.alternate)&&(r.childLanes|=n),22===a.tag&&(null===(e=a.stateNode)||1&e._visibility||(i=!0)),e=a,a=a.return;i&&null!==t&&3===e.tag&&(a=e.stateNode,i=31-xs(n),null===(e=(a=a.hiddenUpdates)[i])?a[i]=[t]:e.push(t),t.lane=536870912|n)}function K(e){if(50<nu)throw nu=0,ru=null,Error(r(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}function J(e){var t;e!==cl&&null===e.next&&(null===cl?ll=cl=e:cl=cl.next=e),dl=!0,ul||(ul=!0,t=ee,qa?Ya(function(){6&Ac?Es(Rs,t):t()}):Es(Rs,t))}function Q(e,t){if(!hl&&dl){hl=!0;do{for(var n=!1,r=ll;null!==r;){if(0!==e){var i=r.pendingLanes;if(0===i)var a=0;else{var o=r.suspendedLanes,s=r.pingedLanes;a=(1<<31-xs(42|e)+1)-1,a=201326677&(a&=i&~(o&~s))?201326677&a|1:a?2|a:0}0!==a&&(n=!0,re(r,a))}else a=Nc,!(3&(a=x(r,r===kc?a:0)))||_(r,a)||(n=!0,re(r,a));r=r.next}}while(n);hl=!1}}function ee(){dl=ul=!1;var e=0;0!==fl&&(Ua()&&(e=fl),fl=0);for(var t=ks(),n=null,r=ll;null!==r;){var i=r.next,a=te(r,t);0===a?(r.next=null,null===n?ll=i:n.next=i,null===i&&(cl=n)):(n=r,(0!==e||3&a)&&(dl=!0)),r=i}Q(e)}function te(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=-62914561&e.pendingLanes;0<a;){var o=31-xs(a),s=1<<o,l=i[o];-1===l?0!==(s&n)&&0===(s&r)||(i[o]=w(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}if(n=Nc,n=x(e,e===(t=kc)?n:0),r=e.callbackNode,0===n||e===t&&2===Pc||null!==e.cancelPendingCommit)return null!==r&&null!==r&&Ts(r),e.callbackNode=null,e.callbackPriority=0;if(!(3&n)||_(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&Ts(r),k(n)){case 2:case 8:n=Ns;break;case 32:default:n=Ps;break;case 268435456:n=Is}return r=ne.bind(null,e),n=Es(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&Ts(r),e.callbackPriority=2,e.callbackNode=null,2}function ne(e,t){var n=e.callbackNode;if(gi()&&e.callbackNode!==n)return null;var r=Nc;return 0===(r=x(e,e===kc?r:0))?null:(Xr(e,r,t),te(e,ks()),null!=e.callbackNode&&e.callbackNode===n?ne.bind(null,e):null)}function re(e,t){if(gi())return null;Xr(e,t,!0)}function ie(){return 0===fl&&(fl=S()),fl}function ae(){if(0===--ml&&null!==pl){null!==vl&&(vl.status="fulfilled");var e=pl;pl=null,gl=0,vl=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function oe(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function se(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function le(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function ce(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&Ac){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,t=K(e),Z(e,null,n),t}return X(e,r,t,n),K(e)}function ue(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194176&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,A(e,n)}}function de(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===a?i=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function he(){if(bl&&null!==vl)throw vl}function fe(e,t,n,r){bl=!1;var i=e.updateQueue;yl=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var l=s,c=l.next;l.next=null,null===o?a=c:o.next=c,o=l;var u=e.alternate;null!==u&&(s=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l)}if(null!==a){var d=i.baseState;for(o=0,u=c=l=null,s=a;;){var h=-536870913&s.lane,f=h!==s.lane;if(f?(Nc&h)===h:(r&h)===h){0!==h&&h===gl&&(bl=!0),null!==u&&(u=u.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null});e:{var p=e,m=s;h=t;var g=n;switch(m.tag){case 1:if("function"==typeof(p=m.payload)){d=p.call(g,d,h);break e}d=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null==(h="function"==typeof(p=m.payload)?p.call(g,d,h):p))break e;d=Wi({},d,h);break e;case 2:yl=!0}}null!==(h=s.callback)&&(e.flags|=64,f&&(e.flags|=8192),null===(f=i.callbacks)?i.callbacks=[h]:f.push(h))}else f={lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=f,l=d):u=u.next=f,o|=h;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(f=s).next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null===a&&(i.shared.lanes=0),Fc|=o,e.lanes=o,e.memoizedState=d}}function pe(e,t){if("function"!=typeof e)throw Error(r(191,e));e.call(t)}function me(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)pe(n[e],t)}function ge(e,t){if(Us(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!xl.call(t,i)||!Us(e[i],t[i]))return!1}return!0}function ve(e){return"fulfilled"===(e=e.status)||"rejected"===e}function ye(){}function be(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(ye,ye),t=n),t.status){case"fulfilled":return t.value;case"rejected":if((e=t.reason)===_l)throw Error(r(483));throw e;default:if("string"==typeof t.status)t.then(ye,ye);else{if(null!==(e=kc)&&100<e.shellSuspendCounter)throw Error(r(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":if((e=t.reason)===_l)throw Error(r(483));throw e}throw Ml=t,_l}}function xe(){if(null===Ml)throw Error(r(459));var e=Ml;return Ml=null,e}function _e(e){var t=Tl;return Tl+=1,null===El&&(El=[]),be(El,e,t)}function we(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function Se(e,t){if(t.$$typeof===$i)throw Error(r(525));throw e=Object.prototype.toString.call(t),Error(r(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Me(e){return(0,e._init)(e._payload)}function Ee(e){function n(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function a(t,r){if(!e)return null;for(;null!==r;)n(t,r),r=r.sibling;return null}function o(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function s(e,t){return(e=Ti(e,t)).index=0,e.sibling=null,e}function l(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=33554434,n):r:(t.flags|=33554434,n):(t.flags|=1048576,n)}function c(t){return e&&null===t.alternate&&(t.flags|=33554434),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Ni(n,e.mode,r)).return=e,t):((t=s(t,n)).return=e,t)}function d(e,t,n,r){var i=n.type;return i===Yi?f(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"==typeof i&&null!==i&&i.$$typeof===aa&&Me(i)===t.type)?(we(t=s(t,n.props),n),t.return=e,t):(we(t=Ai(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function h(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Pi(n,e.mode,r)).return=e,t):((t=s(t,n.children||[])).return=e,t)}function f(e,t,n,r,i){return null===t||7!==t.tag?((t=ki(n,e.mode,r,i)).return=e,t):((t=s(t,n)).return=e,t)}function p(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=Ni(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case Xi:return we(n=Ai(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case qi:return(t=Pi(t,e.mode,n)).return=e,t;case aa:return p(e,t=(0,t._init)(t._payload),n)}if(ha(t)||i(t))return(t=ki(t,e.mode,n,null)).return=e,t;if("function"==typeof t.then)return p(e,_e(t),n);if(t.$$typeof===ea)return p(e,In(e,t),n);Se(e,t)}return null}function m(e,t,n,r){var a=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return null!==a?null:u(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case Xi:return n.key===a?d(e,t,n,r):null;case qi:return n.key===a?h(e,t,n,r):null;case aa:return m(e,t,n=(a=n._init)(n._payload),r)}if(ha(n)||i(n))return null!==a?null:f(e,t,n,r,null);if("function"==typeof n.then)return m(e,t,_e(n),r);if(n.$$typeof===ea)return m(e,t,In(e,n),r);Se(e,n)}return null}function g(e,t,n,r,a){if("string"==typeof r&&""!==r||"number"==typeof r||"bigint"==typeof r)return u(t,e=e.get(n)||null,""+r,a);if("object"==typeof r&&null!==r){switch(r.$$typeof){case Xi:return d(t,e=e.get(null===r.key?n:r.key)||null,r,a);case qi:return h(t,e=e.get(null===r.key?n:r.key)||null,r,a);case aa:return g(e,t,n,r=(0,r._init)(r._payload),a)}if(ha(r)||i(r))return f(t,e=e.get(n)||null,r,a,null);if("function"==typeof r.then)return g(e,t,n,_e(r),a);if(r.$$typeof===ea)return g(e,t,n,In(t,r),a);Se(t,r)}return null}function v(t,u,d,h){if("object"==typeof d&&null!==d&&d.type===Yi&&null===d.key&&(d=d.props.children),"object"==typeof d&&null!==d){switch(d.$$typeof){case Xi:e:{for(var f=d.key;null!==u;){if(u.key===f){if((f=d.type)===Yi){if(7===u.tag){a(t,u.sibling),(h=s(u,d.props.children)).return=t,t=h;break e}}else if(u.elementType===f||"object"==typeof f&&null!==f&&f.$$typeof===aa&&Me(f)===u.type){a(t,u.sibling),we(h=s(u,d.props),d),h.return=t,t=h;break e}a(t,u);break}n(t,u),u=u.sibling}d.type===Yi?((h=ki(d.props.children,t.mode,h,d.key)).return=t,t=h):(we(h=Ai(d.type,d.key,d.props,null,t.mode,h),d),h.return=t,t=h)}return c(t);case qi:e:{for(f=d.key;null!==u;){if(u.key===f){if(4===u.tag&&u.stateNode.containerInfo===d.containerInfo&&u.stateNode.implementation===d.implementation){a(t,u.sibling),(h=s(u,d.children||[])).return=t,t=h;break e}a(t,u);break}n(t,u),u=u.sibling}(h=Pi(d,t.mode,h)).return=t,t=h}return c(t);case aa:return v(t,u,d=(f=d._init)(d._payload),h)}if(ha(d))return function(t,r,i,s){for(var c=null,u=null,d=r,h=r=0,f=null;null!==d&&h<i.length;h++){d.index>h?(f=d,d=null):f=d.sibling;var v=m(t,d,i[h],s);if(null===v){null===d&&(d=f);break}e&&d&&null===v.alternate&&n(t,d),r=l(v,r,h),null===u?c=v:u.sibling=v,u=v,d=f}if(h===i.length)return a(t,d),tl&&P(t,h),c;if(null===d){for(;h<i.length;h++)null!==(d=p(t,i[h],s))&&(r=l(d,r,h),null===u?c=d:u.sibling=d,u=d);return tl&&P(t,h),c}for(d=o(d);h<i.length;h++)null!==(f=g(d,t,h,i[h],s))&&(e&&null!==f.alternate&&d.delete(null===f.key?h:f.key),r=l(f,r,h),null===u?c=f:u.sibling=f,u=f);return e&&d.forEach(function(e){return n(t,e)}),tl&&P(t,h),c}(t,u,d,h);if(i(d)){if("function"!=typeof(f=i(d)))throw Error(r(150));return function(t,i,s,c){if(null==s)throw Error(r(151));for(var u=null,d=null,h=i,f=i=0,v=null,y=s.next();null!==h&&!y.done;f++,y=s.next()){h.index>f?(v=h,h=null):v=h.sibling;var b=m(t,h,y.value,c);if(null===b){null===h&&(h=v);break}e&&h&&null===b.alternate&&n(t,h),i=l(b,i,f),null===d?u=b:d.sibling=b,d=b,h=v}if(y.done)return a(t,h),tl&&P(t,f),u;if(null===h){for(;!y.done;f++,y=s.next())null!==(y=p(t,y.value,c))&&(i=l(y,i,f),null===d?u=y:d.sibling=y,d=y);return tl&&P(t,f),u}for(h=o(h);!y.done;f++,y=s.next())null!==(y=g(h,t,f,y.value,c))&&(e&&null!==y.alternate&&h.delete(null===y.key?f:y.key),i=l(y,i,f),null===d?u=y:d.sibling=y,d=y);return e&&h.forEach(function(e){return n(t,e)}),tl&&P(t,f),u}(t,u,d=f.call(d),h)}if("function"==typeof d.then)return v(t,u,_e(d),h);if(d.$$typeof===ea)return v(t,u,In(t,d),h);Se(t,d)}return"string"==typeof d&&""!==d||"number"==typeof d||"bigint"==typeof d?(d=""+d,null!==u&&6===u.tag?(a(t,u.sibling),(h=s(u,d)).return=t,t=h):(a(t,u),(h=Ni(d,t.mode,h)).return=t,t=h),c(t)):a(t,u)}return function(e,n,r,i){try{Tl=0;var a=v(e,n,r,i);return El=null,a}catch(s){if(s===_l)throw s;var o=t(29,s,null,e.mode);return o.lanes=i,o.return=e,o}}}function Te(e,t){y(Rl,e=Oc),y(kl,t),Oc=e|t.baseLanes}function Ce(){y(Rl,Oc),y(kl,kl.current)}function Ae(){Oc=Rl.current,v(kl),v(Rl)}function ke(e){var t=e.alternate;y(Il,1&Il.current),y(Nl,e),null===Pl&&(null===t||null!==kl.current||null!==t.memoizedState)&&(Pl=e)}function Re(e){if(22===e.tag){if(y(Il,Il.current),y(Nl,e),null===Pl){var t=e.alternate;null!==t&&null!==t.memoizedState&&(Pl=e)}}else Ne()}function Ne(){y(Il,Il.current),y(Nl,Nl.current)}function Pe(e){v(Nl),Pl===e&&(Pl=null),v(Il)}function Ie(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Co(n)||Ao(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function Le(){throw Error(r(321))}function De(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Us(e[n],t[n]))return!1;return!0}function ze(e,t,n,r,i,a){return Ll=a,Dl=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ua.H=null===e||null===e.memoizedState?Xl:ql,Bl=!1,a=n(r,i),Bl=!1,Fl&&(a=Ue(t,n,r,i)),Oe(e),a}function Oe(e){ua.H=$l;var t=null!==zl&&null!==zl.next;if(Ll=0,Ol=zl=Dl=null,Ul=!1,Hl=0,Vl=null,t)throw Error(r(300));null===e||Ql||null!==(e=e.dependencies)&&Rn(e)&&(Ql=!0)}function Ue(e,t,n,i){Dl=e;var a=0;do{if(Fl&&(Vl=null),Hl=0,Fl=!1,25<=a)throw Error(r(301));if(a+=1,Ol=zl=null,null!=e.updateQueue){var o=e.updateQueue;o.lastEffect=null,o.events=null,o.stores=null,null!=o.memoCache&&(o.memoCache.index=0)}ua.H=Yl,o=t(n,i)}while(Fl);return o}function Fe(){var e=ua.H,t=e.useState()[0];return t="function"==typeof t.then?We(t):t,e=e.useState()[0],(null!==zl?zl.memoizedState:null)!==e&&(Dl.flags|=1024),t}function Be(){var e=0!==jl;return jl=0,e}function je(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function He(e){if(Ul){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Ul=!1}Ll=0,Ol=zl=Dl=null,Fl=!1,Hl=jl=0,Vl=null}function Ve(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Ol?Dl.memoizedState=Ol=e:Ol=Ol.next=e,Ol}function Ge(){if(null===zl){var e=Dl.alternate;e=null!==e?e.memoizedState:null}else e=zl.next;var t=null===Ol?Dl.memoizedState:Ol.next;if(null!==t)Ol=t,zl=e;else{if(null===e){if(null===Dl.alternate)throw Error(r(467));throw Error(r(310))}e={memoizedState:(zl=e).memoizedState,baseState:zl.baseState,baseQueue:zl.baseQueue,queue:zl.queue,next:null},null===Ol?Dl.memoizedState=Ol=e:Ol=Ol.next=e}return Ol}function We(e){var t=Hl;return Hl+=1,null===Vl&&(Vl=[]),e=be(Vl,e,t),t=Dl,null===(null===Ol?t.memoizedState:Ol.next)&&(t=t.alternate,ua.H=null===t||null===t.memoizedState?Xl:ql),e}function $e(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return We(e);if(e.$$typeof===ea)return Pn(e)}throw Error(r(438,String(e)))}function Xe(e){var t=null,n=Dl.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=Dl.alternate;null!==r&&null!==(r=r.updateQueue)&&null!=(r=r.memoCache)&&(t={data:r.data.map(function(e){return e.slice()}),index:0})}if(null==t&&(t={data:[],index:0}),null===n&&(n=Wl(),Dl.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=sa;return t.index++,n}function qe(e,t){return"function"==typeof t?t(e):t}function Ye(e){return Ze(Ge(),zl,e)}function Ze(e,t,n){var i=e.queue;if(null===i)throw Error(r(311));i.lastRenderedReducer=n;var a=e.baseQueue,o=i.pending;if(null!==o){if(null!==a){var s=a.next;a.next=o.next,o.next=s}t.baseQueue=a=o,i.pending=null}if(o=e.baseState,null===a)e.memoizedState=o;else{var l=s=null,c=null,u=t=a.next,d=!1;do{var h=-536870913&u.lane;if(h!==u.lane?(Nc&h)===h:(Ll&h)===h){var f=u.revertLane;if(0===f)null!==c&&(c=c.next={lane:0,revertLane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),h===gl&&(d=!0);else{if((Ll&f)===f){u=u.next,f===gl&&(d=!0);continue}h={lane:0,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=h,s=o):c=c.next=h,Dl.lanes|=f,Fc|=f}h=u.action,Bl&&n(o,h),o=u.hasEagerState?u.eagerState:n(o,h)}else f={lane:h,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=f,s=o):c=c.next=f,Dl.lanes|=h,Fc|=h;u=u.next}while(null!==u&&u!==t);if(null===c?s=o:c.next=l,!Us(o,e.memoizedState)&&(Ql=!0,d&&null!==(n=vl)))throw n;e.memoizedState=o,e.baseState=s,e.baseQueue=c,i.lastRenderedState=o}return null===a&&(i.lanes=0),[e.memoizedState,i.dispatch]}function Ke(e){var t=Ge(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var i=n.dispatch,a=n.pending,o=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{o=e(o,s.action),s=s.next}while(s!==a);Us(o,t.memoizedState)||(Ql=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function Je(e,t,n){var i=Dl,a=Ge(),o=tl;if(o){if(void 0===n)throw Error(r(407));n=n()}else n=t();var s=!Us((zl||a).memoizedState,n);if(s&&(a.memoizedState=n,Ql=!0),a=a.queue,St(tt.bind(null,i,a,e),[e]),a.getSnapshot!==t||s||null!==Ol&&1&Ol.memoizedState.tag){if(i.flags|=2048,yt(9,et.bind(null,i,a,n,t),{destroy:void 0},null),null===kc)throw Error(r(349));o||60&Ll||Qe(i,t,n)}return n}function Qe(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Dl.updateQueue)?(t=Wl(),Dl.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function et(e,t,n,r){t.value=n,t.getSnapshot=r,nt(t)&&rt(e)}function tt(e,t,n){return n(function(){nt(t)&&rt(e)})}function nt(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Us(e,n)}catch(r){return!0}}function rt(e){var t=Y(e,2);null!==t&&$r(t,0,2)}function it(e){var t=Ve();if("function"==typeof e){var n=e;if(e=n(),Bl){R(!0);try{n()}finally{R(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:qe,lastRenderedState:e},t}function at(e,t,n,r){return e.baseState=n,Ze(e,zl,"function"==typeof r?r:qe)}function ot(e,t,n,i,a){if(Vt(e))throw Error(r(485));if(null!==(e=t.action)){var o={payload:a,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}};null!==ua.T?n(!0):o.isTransition=!1,i(o),null===(n=t.pending)?(o.next=t.pending=o,st(t,o)):(o.next=n.next,t.pending=n.next=o)}}function st(e,t){var n=t.action,r=t.payload,i=e.state;if(t.isTransition){var a=ua.T,o={};ua.T=o;try{var s=n(i,r),l=ua.S;null!==l&&l(o,s),lt(e,t,s)}catch(c){ut(e,t,c)}finally{ua.T=a}}else try{lt(e,t,a=n(i,r))}catch(u){ut(e,t,u)}}function lt(e,t,n){null!==n&&"object"==typeof n&&"function"==typeof n.then?n.then(function(n){ct(e,t,n)},function(n){return ut(e,t,n)}):ct(e,t,n)}function ct(e,t,n){t.status="fulfilled",t.value=n,dt(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,st(e,n)))}function ut(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do{t.status="rejected",t.reason=n,dt(t),t=t.next}while(t!==r)}e.action=null}function dt(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function ht(e,t){return t}function ft(e,t){if(tl){var n=kc.formState;if(null!==n){e:{var r=Dl;if(tl){if(el){var i=No(el,rl);if(i){el=Io(i),r=Po(i);break e}}B(r)}r=!1}r&&(t=n[0])}}(n=Ve()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ht,lastRenderedState:t},n.queue=r,n=Bt.bind(null,Dl,r),r.dispatch=n,r=it(!1);var a=Ht.bind(null,Dl,!1,r.queue);return i={state:t,dispatch:null,action:e,pending:null},(r=Ve()).queue=i,n=ot.bind(null,Dl,i,a,n),i.dispatch=n,r.memoizedState=e,[t,n,!1]}function pt(e){return mt(Ge(),zl,e)}function mt(e,t,n){t=Ze(e,t,ht)[0],e=Ye(qe)[0],t="object"==typeof t&&null!==t&&"function"==typeof t.then?We(t):t;var r=Ge(),i=r.queue,a=i.dispatch;return n!==r.memoizedState&&(Dl.flags|=2048,yt(9,gt.bind(null,i,n),{destroy:void 0},null)),[t,a,e]}function gt(e,t){e.action=t}function vt(e){var t=Ge(),n=zl;if(null!==n)return mt(t,n,e);Ge(),t=t.memoizedState;var r=(n=Ge()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function yt(e,t,n,r){return e={tag:e,create:t,inst:n,deps:r,next:null},null===(t=Dl.updateQueue)&&(t=Wl(),Dl.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function bt(){return Ge().memoizedState}function xt(e,t,n,r){var i=Ve();Dl.flags|=e,i.memoizedState=yt(1|t,n,{destroy:void 0},void 0===r?null:r)}function _t(e,t,n,r){var i=Ge();r=void 0===r?null:r;var a=i.memoizedState.inst;null!==zl&&null!==r&&De(r,zl.memoizedState.deps)?i.memoizedState=yt(t,n,a,r):(Dl.flags|=e,i.memoizedState=yt(1|t,n,a,r))}function wt(e,t){xt(8390656,8,e,t)}function St(e,t){_t(2048,8,e,t)}function Mt(e,t){return _t(4,2,e,t)}function Et(e,t){return _t(4,4,e,t)}function Tt(e,t){if("function"==typeof t){e=e();var n=t(e);return function(){"function"==typeof n?n():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function Ct(e,t,n){n=null!=n?n.concat([e]):null,_t(4,4,Tt.bind(null,t,e),n)}function At(){}function kt(e,t){var n=Ge();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&De(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Rt(e,t){var n=Ge();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&De(t,r[1]))return r[0];if(r=e(),Bl){R(!0);try{e()}finally{R(!1)}}return n.memoizedState=[r,t],r}function Nt(e,t,n){return void 0===n||1073741824&Ll?e.memoizedState=t:(e.memoizedState=n,e=Wr(),Dl.lanes|=e,Fc|=e,n)}function Pt(e,t,n,r){return Us(n,t)?n:null!==kl.current?(e=Nt(e,n,r),Us(e,t)||(Ql=!0),e):42&Ll?(e=Wr(),Dl.lanes|=e,Fc|=e,t):(Ql=!0,e.memoizedState=n)}function It(e,t,n,r,i){var a=za();Da(0!==a&&8>a?a:8);var o,s,l,c=ua.T,u={};ua.T=u,Ht(e,!1,t,n);try{var d=i(),h=ua.S;null!==h&&h(u,d),null!==d&&"object"==typeof d&&"function"==typeof d.then?jt(e,t,(o=r,s=[],l={status:"pending",value:null,reason:null,then:function(e){s.push(e)}},d.then(function(){l.status="fulfilled",l.value=o;for(var e=0;e<s.length;e++)(0,s[e])(o)},function(e){for(l.status="rejected",l.reason=e,e=0;e<s.length;e++)(0,s[e])(void 0)}),l),Gr()):jt(e,t,r,Gr())}catch(f){jt(e,t,{then:function(){},status:"rejected",reason:f},Gr())}finally{Da(a),ua.T=c}}function Lt(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:Wa,baseState:Wa,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qe,lastRenderedState:Wa},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qe,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Dt(){return Pn($a)}function zt(){return Ge().memoizedState}function Ot(){return Ge().memoizedState}function Ut(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Gr(),r=ce(t,e=le(n),n);return null!==r&&($r(r,0,n),ue(r,t,n)),t={cache:Dn()},void(e.payload=t)}t=t.return}}function Ft(e,t,n){var r=Gr();n={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},Vt(e)?Gt(t,n):null!==(n=q(e,t,n,r))&&($r(n,0,r),Wt(n,t,r))}function Bt(e,t,n){jt(e,t,n,Gr())}function jt(e,t,n,r){var i={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(Vt(e))Gt(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,Us(s,o))return X(e,t,i,0),null===kc&&$(),!1}catch(l){}if(null!==(n=q(e,t,i,r)))return $r(n,0,r),Wt(n,t,r),!0}return!1}function Ht(e,t,n,i){if(i={lane:2,revertLane:ie(),action:i,hasEagerState:!1,eagerState:null,next:null},Vt(e)){if(t)throw Error(r(479))}else null!==(t=q(e,n,i,2))&&$r(t,0,2)}function Vt(e){var t=e.alternate;return e===Dl||null!==t&&t===Dl}function Gt(e,t){Fl=Ul=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Wt(e,t,n){if(4194176&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,A(e,n)}}function $t(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:Wi({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}function Xt(e,t,n,r,i,a,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!(t.prototype&&t.prototype.isPureReactComponent&&ge(n,r)&&ge(i,a))}function qt(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Zl.enqueueReplaceState(t,t.state,null)}function Yt(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var i in n===t&&(n=Wi({},n)),e)void 0===n[i]&&(n[i]=e[i]);return n}function Zt(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Kt(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function Jt(e,t,n){return(n=le(n)).tag=3,n.payload={element:null},n.callback=function(){Zt(e,t)},n}function Qt(e){return(e=le(e)).tag=3,e}function en(e,t,n,r){var i=n.type.getDerivedStateFromError;if("function"==typeof i){var a=r.value;e.payload=function(){return i(a)},e.callback=function(){Kt(t,n,r)}}var o=n.stateNode;null!==o&&"function"==typeof o.componentDidCatch&&(e.callback=function(){Kt(t,n,r),"function"!=typeof i&&(null===Zc?Zc=new Set([this]):Zc.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}function tn(e,t,n,r){t.child=null===e?Al(t,null,n,r):Cl(t,e.child,n,r)}function nn(e,t,n,r,i){n=n.render;var a=t.ref;if("ref"in r){var o={};for(var s in r)"ref"!==s&&(o[s]=r[s])}else o=r;return Nn(t),r=ze(e,t,n,o,a,i),s=Be(),null===e||Ql?(tl&&s&&L(t),t.flags|=1,tn(e,t,r,i),t.child):(je(e,t,i),wn(e,t,i))}function rn(e,t,n,r,i){if(null===e){var a=n.type;return"function"!=typeof a||Ei(a)||void 0!==a.defaultProps||null!==n.compare?((e=Ai(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,an(e,t,a,r,i))}if(a=e.child,!Sn(e,i)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:ge)(o,r)&&e.ref===t.ref)return wn(e,t,i)}return t.flags|=1,(e=Ti(a,r)).ref=t.ref,e.return=t,t.child=e}function an(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(ge(a,r)&&e.ref===t.ref){if(Ql=!1,t.pendingProps=r=a,!Sn(e,i))return t.lanes=e.lanes,wn(e,t,i);131072&e.flags&&(Ql=!0)}}return cn(e,t,n,r,i)}function on(e,t,n){var r=t.pendingProps,i=r.children,a=!!(2&t.stateNode._pendingVisibility),o=null!==e?e.memoizedState:null;if(ln(e,t),"hidden"===r.mode||a){if(128&t.flags){if(r=null!==o?o.baseLanes|n:n,null!==e){for(i=t.child=e.child,a=0;null!==i;)a=a|i.lanes|i.childLanes,i=i.sibling;t.childLanes=a&~r}else t.childLanes=0,t.child=null;return sn(e,t,r,n)}if(!(536870912&n))return t.lanes=t.childLanes=536870912,sn(e,t,null!==o?o.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Un(0,null!==o?o.cachePool:null),null!==o?Te(t,o):Ce(),Re(t)}else null!==o?(Un(0,o.cachePool),Te(t,o),Ne(),t.memoizedState=null):(null!==e&&Un(0,null),Ce(),Ne());return tn(e,t,i,n),t.child}function sn(e,t,n,r){var i=On();return i=null===i?null:{parent:ka?sc._currentValue:sc._currentValue2,pool:i},t.memoizedState={baseLanes:n,cachePool:i},null!==e&&Un(0,null),Ce(),Re(t),null!==e&&kn(e,t,r,!0),null}function ln(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=2097664);else{if("function"!=typeof n&&"object"!=typeof n)throw Error(r(284));null!==e&&e.ref===n||(t.flags|=2097664)}}function cn(e,t,n,r,i){return Nn(t),n=ze(e,t,n,r,void 0,i),r=Be(),null===e||Ql?(tl&&r&&L(t),t.flags|=1,tn(e,t,n,i),t.child):(je(e,t,i),wn(e,t,i))}function un(e,t,n,r,i,a){return Nn(t),t.updateQueue=null,n=Ue(t,r,n,i),Oe(e),r=Be(),null===e||Ql?(tl&&r&&L(t),t.flags|=1,tn(e,t,n,a),t.child):(je(e,t,a),wn(e,t,a))}function dn(e,t,n,r,i){if(Nn(t),null===t.stateNode){var a=bs,o=n.contextType;"object"==typeof o&&null!==o&&(a=Pn(o)),a=new n(r,a),t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,a.updater=Zl,t.stateNode=a,a._reactInternals=t,(a=t.stateNode).props=r,a.state=t.memoizedState,a.refs={},oe(t),o=n.contextType,a.context="object"==typeof o&&null!==o?Pn(o):bs,a.state=t.memoizedState,"function"==typeof(o=n.getDerivedStateFromProps)&&($t(t,n,o,r),a.state=t.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof a.getSnapshotBeforeUpdate||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||(o=a.state,"function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),o!==a.state&&Zl.enqueueReplaceState(a,a.state,null),fe(t,r,a,i),he(),a.state=t.memoizedState),"function"==typeof a.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){a=t.stateNode;var s=t.memoizedProps,l=Yt(n,s);a.props=l;var c=a.context,u=n.contextType;o=bs,"object"==typeof u&&null!==u&&(o=Pn(u));var d=n.getDerivedStateFromProps;u="function"==typeof d||"function"==typeof a.getSnapshotBeforeUpdate,s=t.pendingProps!==s,u||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s||c!==o)&&qt(t,a,r,o),yl=!1;var h=t.memoizedState;a.state=h,fe(t,r,a,i),he(),c=t.memoizedState,s||h!==c||yl?("function"==typeof d&&($t(t,n,d,r),c=t.memoizedState),(l=yl||Xt(t,n,l,r,h,c,o))?(u||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4194308)):("function"==typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),a.props=r,a.state=c,a.context=o,r=l):("function"==typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,se(e,t),u=Yt(n,o=t.memoizedProps),a.props=u,d=t.pendingProps,h=a.context,c=n.contextType,l=bs,"object"==typeof c&&null!==c&&(l=Pn(c)),(c="function"==typeof(s=n.getDerivedStateFromProps)||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o!==d||h!==l)&&qt(t,a,r,l),yl=!1,h=t.memoizedState,a.state=h,fe(t,r,a,i),he();var f=t.memoizedState;o!==d||h!==f||yl||null!==e&&null!==e.dependencies&&Rn(e.dependencies)?("function"==typeof s&&($t(t,n,s,r),f=t.memoizedState),(u=yl||Xt(t,n,u,r,h,f,l)||null!==e&&null!==e.dependencies&&Rn(e.dependencies))?(c||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(r,f,l),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,f,l)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),a.props=r,a.state=f,a.context=l,r=u):("function"!=typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return a=r,ln(e,t),r=!!(128&t.flags),a||r?(a=t.stateNode,n=r&&"function"!=typeof n.getDerivedStateFromError?null:a.render(),t.flags|=1,null!==e&&r?(t.child=Cl(t,e.child,null,i),t.child=Cl(t,null,n,i)):tn(e,t,n,i),t.memoizedState=a.state,e=t.child):e=wn(e,t,i),e}function hn(e,t,n,r){return G(),t.flags|=256,tn(e,t,n,r),t.child}function fn(e){return{baseLanes:e,cachePool:Fn()}}function pn(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=Hc),e}function mn(e,n,i){var a,o=n.pendingProps,s=!1,l=!!(128&n.flags);if((a=l)||(a=(null===e||null!==e.memoizedState)&&!!(2&Il.current)),a&&(s=!0,n.flags&=-129),a=!!(32&n.flags),n.flags&=-33,null===e){if(tl){if(s?ke(n):Ne(),tl){var c,u=el;(c=u)&&(null!==(u=Fo(u,rl))?(n.memoizedState={dehydrated:u,treeContext:null!==$s?{id:Xs,overflow:qs}:null,retryLane:536870912},(c=t(18,null,null,0)).stateNode=u,c.return=n,n.child=c,Qs=n,el=null,c=!0):c=!1),c||B(n)}if(null!==(u=n.memoizedState)&&null!==(u=u.dehydrated))return Ao(u)?n.lanes=16:n.lanes=536870912,null;Pe(n)}return u=o.children,o=o.fallback,s?(Ne(),u=vn({mode:"hidden",children:u},s=n.mode),o=ki(o,s,i,null),u.return=n,o.return=n,u.sibling=o,n.child=u,(s=n.child).memoizedState=fn(i),s.childLanes=pn(e,a,i),n.memoizedState=ec,o):(ke(n),gn(n,u))}if(null!==(c=e.memoizedState)&&null!==(u=c.dehydrated)){if(l)256&n.flags?(ke(n),n.flags&=-257,n=yn(e,n,i)):null!==n.memoizedState?(Ne(),n.child=e.child,n.flags|=128,n=null):(Ne(),s=o.fallback,u=n.mode,o=vn({mode:"visible",children:o.children},u),(s=ki(s,u,i,null)).flags|=2,o.return=n,s.return=n,o.sibling=s,n.child=o,Cl(n,e.child,null,i),(o=n.child).memoizedState=fn(i),o.childLanes=pn(e,a,i),n.memoizedState=ec,n=s);else if(ke(n),Ao(u))a=ko(u).digest,(o=Error(r(419))).stack="",o.digest=a,W({value:o,source:null,stack:null}),n=yn(e,n,i);else if(Ql||kn(e,n,i,!1),a=0!==(i&e.childLanes),Ql||a){if(null!==(a=kc)){if(42&(o=i&-i))o=1;else switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=64;break;case 268435456:o=134217728;break;default:o=0}if(0!==(o=0!==(o&(a.suspendedLanes|i))?0:o)&&o!==c.retryLane)throw c.retryLane=o,Y(e,o),$r(a,0,o),Jl}Co(u)||ai(),n=yn(e,n,i)}else Co(u)?(n.flags|=128,n.child=e.child,n=wi.bind(null,e),Ro(u,n),n=null):(e=c.treeContext,Pa&&(el=zo(u),Qs=n,tl=!0,nl=null,rl=!1,null!==e&&(Gs[Ws++]=Xs,Gs[Ws++]=qs,Gs[Ws++]=$s,Xs=e.id,qs=e.overflow,$s=n)),(n=gn(n,o.children)).flags|=4096);return n}return s?(Ne(),s=o.fallback,u=n.mode,l=(c=e.child).sibling,(o=Ti(c,{mode:"hidden",children:o.children})).subtreeFlags=31457280&c.subtreeFlags,null!==l?s=Ti(l,s):(s=ki(s,u,i,null)).flags|=2,s.return=n,o.return=n,o.sibling=s,n.child=o,o=s,s=n.child,null===(u=e.child.memoizedState)?u=fn(i):(null!==(c=u.cachePool)?(l=ka?sc._currentValue:sc._currentValue2,c=c.parent!==l?{parent:l,pool:l}:c):c=Fn(),u={baseLanes:u.baseLanes|i,cachePool:c}),s.memoizedState=u,s.childLanes=pn(e,a,i),n.memoizedState=ec,o):(ke(n),e=(i=e.child).sibling,(i=Ti(i,{mode:"visible",children:o.children})).return=n,i.sibling=null,null!==e&&(null===(a=n.deletions)?(n.deletions=[e],n.flags|=16):a.push(e)),n.child=i,n.memoizedState=null,i)}function gn(e,t){return(t=vn({mode:"visible",children:t},e.mode)).return=e,e.child=t}function vn(e,t){return Ri(e,t,0,null)}function yn(e,t,n){return Cl(t,e.child,null,n),(e=gn(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function bn(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Cn(e.return,t,n)}function xn(e,t,n,r,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function _n(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(tn(e,t,r.children,n),2&(r=Il.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&bn(e,n,t);else if(19===e.tag)bn(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}switch(y(Il,r),i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Ie(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),xn(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Ie(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}xn(t,!0,n,null,a);break;case"together":xn(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function wn(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Fc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(kn(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(r(153));if(null!==t.child){for(n=Ti(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ti(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Sn(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Rn(e))}function Mn(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Ql=!0;else{if(!(Sn(e,n)||128&t.flags))return Ql=!1,function(e,t,n){switch(t.tag){case 3:z(t,t.stateNode.containerInfo),En(0,sc,e.memoizedState.cache),G();break;case 27:case 5:U(t);break;case 4:z(t,t.stateNode.containerInfo);break;case 10:En(0,t.type,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(ke(t),t.flags|=128,null):0!==(n&t.child.childLanes)?mn(e,t,n):(ke(t),null!==(e=wn(e,t,n))?e.sibling:null);ke(t);break;case 19:var i=!!(128&e.flags);if((r=0!==(n&t.childLanes))||(kn(e,t,n,!1),r=0!==(n&t.childLanes)),i){if(r)return _n(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),y(Il,Il.current),r)break;return null;case 22:case 23:return t.lanes=0,on(e,t,n);case 24:En(0,sc,e.memoizedState.cache)}return wn(e,t,n)}(e,t,n);Ql=!!(131072&e.flags)}else Ql=!1,tl&&1048576&t.flags&&I(t,Vs,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var i=t.elementType,o=i._init;if(i=o(i._payload),t.type=i,"function"!=typeof i){if(null!=i){if((o=i.$$typeof)===ta){t.tag=11,t=nn(null,t,i,e,n);break e}if(o===ia){t.tag=14,t=rn(null,t,i,e,n);break e}}throw t=a(i)||i,Error(r(306,t,""))}Ei(i)?(e=Yt(i,e),t.tag=1,t=dn(null,t,i,e,n)):(t.tag=0,t=cn(null,t,i,e,n))}return t;case 0:return cn(e,t,t.type,t.pendingProps,n);case 1:return dn(e,t,i=t.type,o=Yt(i,t.pendingProps),n);case 3:e:{if(z(t,t.stateNode.containerInfo),null===e)throw Error(r(387));var s=t.pendingProps;i=(o=t.memoizedState).element,se(e,t),fe(t,s,null,n);var l=t.memoizedState;if(s=l.cache,En(0,sc,s),s!==o.cache&&An(t,[sc],n,!0),he(),s=l.element,Pa&&o.isDehydrated){if(o={element:s,isDehydrated:!1,cache:l.cache},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=hn(e,t,s,n);break e}if(s!==i){W(i=N(Error(r(424)),t)),t=hn(e,t,s,n);break e}for(Pa&&(el=Do(t.stateNode.containerInfo),Qs=t,tl=!0,nl=null,rl=!0),n=Al(t,null,s,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(G(),s===i){t=wn(e,t,n);break e}tn(e,t,s,n)}t=t.child}return t;case 26:if(Ko)return ln(e,t),null===e?(n=es(t.type,null,t.pendingProps,null))?t.memoizedState=n:tl||(t.stateNode=os(t.type,t.pendingProps,Ks.current,t)):t.memoizedState=es(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:if(ds)return U(t),null===e&&ds&&tl&&(i=t.stateNode=hs(t.type,t.pendingProps,Ks.current,Ys.current,!1),Qs=t,rl=!0,el=Lo(i)),i=t.pendingProps.children,null!==e||tl?tn(e,t,i,n):t.child=Cl(t,null,i,n),ln(e,t),t.child;case 5:return null===e&&tl&&(Yo(t.type,t.pendingProps,Ys.current),(o=i=el)&&(null!==(i=Oo(i,t.type,t.pendingProps,rl))?(t.stateNode=i,Qs=t,el=Lo(i),rl=!1,o=!0):o=!1),o||B(t)),U(t),o=t.type,s=t.pendingProps,l=null!==e?e.memoizedProps:null,i=s.children,Ma(o,s)?i=null:null!==l&&Ma(o,l)&&(t.flags|=32),null!==t.memoizedState&&(o=ze(e,t,Fe,null,null,n),ka?$a._currentValue=o:$a._currentValue2=o),ln(e,t),tn(e,t,i,n),t.child;case 6:return null===e&&tl&&(Zo(t.pendingProps,Ys.current),(e=n=el)&&(null!==(n=Uo(n,t.pendingProps,rl))?(t.stateNode=n,Qs=t,el=null,e=!0):e=!1),e||B(t)),null;case 13:return mn(e,t,n);case 4:return z(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Cl(t,null,i,n):tn(e,t,i,n),t.child;case 11:return nn(e,t,t.type,t.pendingProps,n);case 7:return tn(e,t,t.pendingProps,n),t.child;case 8:case 12:return tn(e,t,t.pendingProps.children,n),t.child;case 10:return i=t.pendingProps,En(0,t.type,i.value),tn(e,t,i.children,n),t.child;case 9:return o=t.type._context,i=t.pendingProps.children,Nn(t),i=i(o=Pn(o)),t.flags|=1,tn(e,t,i,n),t.child;case 14:return rn(e,t,t.type,t.pendingProps,n);case 15:return an(e,t,t.type,t.pendingProps,n);case 19:return _n(e,t,n);case 22:return on(e,t,n);case 24:return Nn(t),i=Pn(sc),null===e?(null===(o=On())&&(o=kc,s=Dn(),o.pooledCache=s,s.refCount++,null!==s&&(o.pooledCacheLanes|=n),o=s),t.memoizedState={parent:i,cache:o},oe(t),En(0,sc,o)):(0!==(e.lanes&n)&&(se(e,t),fe(t,null,null,n),he()),o=e.memoizedState,s=t.memoizedState,o.parent!==i?(o={parent:i,cache:i},t.memoizedState=o,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=o),En(0,sc,i)):(i=s.cache,En(0,sc,i),i!==o.cache&&An(t,[sc],n,!0))),tn(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(r(156,t.tag))}function En(e,t,n){ka?(y(tc,t._currentValue),t._currentValue=n):(y(tc,t._currentValue2),t._currentValue2=n)}function Tn(e){var t=tc.current;ka?e._currentValue=t:e._currentValue2=t,v(tc)}function Cn(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function An(e,t,n,i){var a=e.child;for(null!==a&&(a.return=e);null!==a;){var o=a.dependencies;if(null!==o){var s=a.child;o=o.firstContext;e:for(;null!==o;){var l=o;o=a;for(var c=0;c<t.length;c++)if(l.context===t[c]){o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Cn(o.return,n,e),i||(s=null);break e}o=l.next}}else if(18===a.tag){if(null===(s=a.return))throw Error(r(341));s.lanes|=n,null!==(o=s.alternate)&&(o.lanes|=n),Cn(s,n,e),s=null}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===e){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}}function kn(e,t,n,i){e=null;for(var a=t,o=!1;null!==a;){if(!o)if(524288&a.flags)o=!0;else if(262144&a.flags)break;if(10===a.tag){var s=a.alternate;if(null===s)throw Error(r(387));if(null!==(s=s.memoizedProps)){var l=a.type;Us(a.pendingProps.value,s.value)||(null!==e?e.push(l):e=[l])}}else if(a===Js.current){if(null===(s=a.alternate))throw Error(r(387));s.memoizedState.memoizedState!==a.memoizedState.memoizedState&&(null!==e?e.push($a):e=[$a])}a=a.return}null!==e&&An(t,e,n,i),t.flags|=262144}function Rn(e){for(e=e.firstContext;null!==e;){var t=e.context;if(!Us(ka?t._currentValue:t._currentValue2,e.memoizedValue))return!0;e=e.next}return!1}function Nn(e){nc=e,rc=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Pn(e){return Ln(nc,e)}function In(e,t){return null===nc&&Nn(e),Ln(e,t)}function Ln(e,t){var n=ka?t._currentValue:t._currentValue2;if(t={context:t,memoizedValue:n,next:null},null===rc){if(null===e)throw Error(r(308));rc=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else rc=rc.next=t;return n}function Dn(){return{controller:new ic,data:new Map,refCount:0}}function zn(e){e.refCount--,0===e.refCount&&ac(oc,function(){e.controller.abort()})}function On(){var e=cc.current;return null!==e?e:kc.pooledCache}function Un(e,t){y(cc,null===t?cc.current:t.pool)}function Fn(){var e=On();return null===e?null:{parent:ka?sc._currentValue:sc._currentValue2,pool:e}}function Bn(e){e.flags|=4}function jn(e,t){if(null!==e&&e.child===t.child)return!1;if(16&t.flags)return!0;for(e=t.child;null!==e;){if(13878&e.flags||13878&e.subtreeFlags)return!0;e=e.sibling}return!1}function Hn(e,t,n,r){if(Ra)for(n=t.child;null!==n;){if(5===n.tag||6===n.tag)wa(e,n.stateNode);else if(!(4===n.tag||ds&&27===n.tag)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}else if(Na)for(var i=t.child;null!==i;){if(5===i.tag){var a=i.stateNode;n&&r&&(a=Eo(a,i.type,i.memoizedProps)),wa(e,a)}else if(6===i.tag)a=i.stateNode,n&&r&&(a=To(a,i.memoizedProps)),wa(e,a);else if(4!==i.tag)if(22===i.tag&&null!==i.memoizedState)null!==(a=i.child)&&(a.return=i),Hn(e,i,!0,!0);else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}}function Vn(e,t,n,r){if(Na)for(var i=t.child;null!==i;){if(5===i.tag){var a=i.stateNode;n&&r&&(a=Eo(a,i.type,i.memoizedProps)),wo(e,a)}else if(6===i.tag)a=i.stateNode,n&&r&&(a=To(a,i.memoizedProps)),wo(e,a);else if(4!==i.tag)if(22===i.tag&&null!==i.memoizedState)null!==(a=i.child)&&(a.return=i),Vn(e,i,!(null!==i.memoizedProps&&"manual"===i.memoizedProps.mode),!0);else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}}function Gn(e,t){if(Na&&jn(e,t)){var n=(e=t.stateNode).containerInfo,r=_o();Vn(r,t,!1,!1),e.pendingChildren=r,Bn(t),So(n,r)}}function Wn(e,t,n,r){if(Ra)e.memoizedProps!==r&&Bn(t);else if(Na){var i=e.stateNode,a=e.memoizedProps;if((e=jn(e,t))||a!==r){var o=Ys.current;(a=xo(i,n,a,r,!e,null))===i?t.stateNode=i:(Sa(a,n,r,o)&&Bn(t),t.stateNode=a,e?Hn(a,t,!1,!1):Bn(t))}else t.stateNode=i}}function $n(e,t,n){if(Ba(t,n)){if(e.flags|=16777216,!ja(t,n)){if(!ni())throw Ml=Sl,wl;e.flags|=8192}}else e.flags&=-16777217}function Xn(e,t){if(ls(t)){if(e.flags|=16777216,!cs(t)){if(!ni())throw Ml=Sl,wl;e.flags|=8192}}else e.flags&=-16777217}function qn(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?M():536870912,e.lanes|=t,Vc|=t)}function Yn(e,t){if(!tl)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Zn(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=31457280&i.subtreeFlags,r|=31457280&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Kn(e,t,n){var i=t.pendingProps;switch(D(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return Zn(t),null;case 3:return n=t.stateNode,i=null,null!==e&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),Tn(sc),O(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(V(t)?Bn(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==nl&&(qr(nl),nl=null))),Gn(e,t),Zn(t),null;case 26:if(Ko){n=t.type;var a=t.memoizedState;return null===e?(Bn(t),null!==a?(Zn(t),Xn(t,a)):(Zn(t),$n(t,n,i))):a?a!==e.memoizedState?(Bn(t),Zn(t),Xn(t,a)):(Zn(t),t.flags&=-16777217):(Ra?e.memoizedProps!==i&&Bn(t):Wn(e,t,n,i),Zn(t),$n(t,n,i)),null}case 27:if(ds){if(F(t),n=Ks.current,a=t.type,null!==e&&null!=t.stateNode)Ra?e.memoizedProps!==i&&Bn(t):Wn(e,t,a,i);else{if(!i){if(null===t.stateNode)throw Error(r(166));return Zn(t),null}e=Ys.current,V(t)?j(t,e):(e=hs(a,i,n,e,!0),t.stateNode=e,Bn(t))}return Zn(t),null}case 5:if(F(t),n=t.type,null!==e&&null!=t.stateNode)Wn(e,t,n,i);else{if(!i){if(null===t.stateNode)throw Error(r(166));return Zn(t),null}e=Ys.current,V(t)?j(t,e):(Hn(a=_a(n,i,Ks.current,e,t),t,!1,!1),t.stateNode=a,Sa(a,n,i,e)&&Bn(t))}return Zn(t),$n(t,t.type,t.pendingProps),null;case 6:if(e&&null!=t.stateNode)n=e.memoizedProps,Ra?n!==i&&Bn(t):Na&&(n!==i?(t.stateNode=Ea(i,Ks.current,Ys.current,t),Bn(t)):t.stateNode=e.stateNode);else{if("string"!=typeof i&&null===t.stateNode)throw Error(r(166));if(e=Ks.current,n=Ys.current,V(t)){if(!Pa)throw Error(r(176));if(e=t.stateNode,n=t.memoizedProps,i=null,null!==(a=Qs))switch(a.tag){case 27:case 5:i=a.memoizedProps}jo(e,n,t,i)||B(t)}else t.stateNode=Ea(i,e,n,t)}return Zn(t),null;case 13:if(i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(a=V(t),null!==i&&null!==i.dehydrated){if(null===e){if(!a)throw Error(r(318));if(!Pa)throw Error(r(344));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(r(317));Ho(a,t)}else G(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Zn(t),a=!1}else null!==nl&&(qr(nl),nl=null),a=!0;if(!a)return 256&t.flags?(Pe(t),t):(Pe(t),null)}if(Pe(t),128&t.flags)return t.lanes=n,t;if(n=null!==i,e=null!==e&&null!==e.memoizedState,n){a=null,null!==(i=t.child).alternate&&null!==i.alternate.memoizedState&&null!==i.alternate.memoizedState.cachePool&&(a=i.alternate.memoizedState.cachePool.pool);var o=null;null!==i.memoizedState&&null!==i.memoizedState.cachePool&&(o=i.memoizedState.cachePool.pool),o!==a&&(i.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),qn(t,t.updateQueue),Zn(t),null;case 4:return O(),Gn(e,t),null===e&&La(t.stateNode.containerInfo),Zn(t),null;case 10:return Tn(t.type),Zn(t),null;case 19:if(v(Il),null===(a=t.memoizedState))return Zn(t),null;if(i=!!(128&t.flags),null===(o=a.rendering))if(i)Yn(a,!1);else{if(0!==Uc||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(o=Ie(e))){for(t.flags|=128,Yn(a,!1),e=o.updateQueue,t.updateQueue=e,qn(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Ci(n,e),n=n.sibling;return y(Il,1&Il.current|2),t.child}e=e.sibling}null!==a.tail&&ks()>qc&&(t.flags|=128,i=!0,Yn(a,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=Ie(o))){if(t.flags|=128,i=!0,e=e.updateQueue,t.updateQueue=e,qn(t,e),Yn(a,!0),null===a.tail&&"hidden"===a.tailMode&&!o.alternate&&!tl)return Zn(t),null}else 2*ks()-a.renderingStartTime>qc&&536870912!==n&&(t.flags|=128,i=!0,Yn(a,!1),t.lanes=4194304);a.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=a.last)?e.sibling=o:t.child=o,a.last=o)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=ks(),t.sibling=null,e=Il.current,y(Il,i?1&e|2:1&e),t):(Zn(t),null);case 22:case 23:return Pe(t),Ae(),i=null!==t.memoizedState,null!==e?null!==e.memoizedState!==i&&(t.flags|=8192):i&&(t.flags|=8192),i?!!(536870912&n)&&!(128&t.flags)&&(Zn(t),6&t.subtreeFlags&&(t.flags|=8192)):Zn(t),null!==(n=t.updateQueue)&&qn(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),i=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(i=t.memoizedState.cachePool.pool),i!==n&&(t.flags|=2048),null!==e&&v(cc),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),Tn(sc),Zn(t),null;case 25:return null}throw Error(r(156,t.tag))}function Jn(e,t){switch(D(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Tn(sc),O(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return F(t),null;case 13:if(Pe(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(r(340));G()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return v(Il),null;case 4:return O(),null;case 10:return Tn(t.type),null;case 22:case 23:return Pe(t),Ae(),null!==e&&v(cc),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return Tn(sc),null;default:return null}}function Qn(e,t){switch(D(t),t.tag){case 3:Tn(sc),O();break;case 26:case 27:case 5:F(t);break;case 4:O();break;case 13:Pe(t);break;case 19:v(Il);break;case 10:Tn(t.type);break;case 22:case 23:Pe(t),Ae(),null!==e&&v(cc);break;case 24:Tn(sc)}}function er(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var i=r.next;n=i;do{if((n.tag&e)===e){r=void 0;var a=n.create,o=n.inst;r=a(),o.destroy=r}n=n.next}while(n!==i)}}catch(s){yi(t,t.return,s)}}function tr(e,t,n){try{var r=t.updateQueue,i=null!==r?r.lastEffect:null;if(null!==i){var a=i.next;r=a;do{if((r.tag&e)===e){var o=r.inst,s=o.destroy;if(void 0!==s){o.destroy=void 0,i=t;var l=n;try{s()}catch(c){yi(i,l,c)}}}r=r.next}while(r!==a)}}catch(c){yi(t,t.return,c)}}function nr(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{me(t,n)}catch(r){yi(e,e.return,r)}}}function rr(e,t,n){n.props=Yt(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(r){yi(e,t,r)}}function ir(e,t){try{var n=e.ref;if(null!==n){var r=e.stateNode;switch(e.tag){case 26:case 27:case 5:var i=ga(r);break;default:i=r}"function"==typeof n?e.refCleanup=n(i):n.current=i}}catch(a){yi(e,t,a)}}function ar(e,t){var n=e.ref,r=e.refCleanup;if(null!==n)if("function"==typeof r)try{r()}catch(i){yi(e,t,i)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof n)try{n(null)}catch(a){yi(e,t,a)}else n.current=null}function or(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{so(r,t,n,e)}catch(i){yi(e,e.return,i)}}function sr(e,t,n){try{lo(e.stateNode,e.type,n,t,e)}catch(r){yi(e,e.return,r)}}function lr(e){return 5===e.tag||3===e.tag||!!Ko&&26===e.tag||!!ds&&27===e.tag||4===e.tag}function cr(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||lr(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&(!ds||27!==e.tag)&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ur(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?uo(n,e,t):ao(n,e);else if(!(4===r||ds&&27===r)&&null!==(e=e.child))for(ur(e,t,n),e=e.sibling;null!==e;)ur(e,t,n),e=e.sibling}function dr(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?co(n,e,t):io(n,e);else if(!(4===r||ds&&27===r)&&null!==(e=e.child))for(dr(e,t,n),e=e.sibling;null!==e;)dr(e,t,n),e=e.sibling}function hr(e,t,n){e=e.containerInfo;try{Mo(e,n)}catch(r){yi(t,t.return,r)}}function fr(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:Sr(e,n),4&r&&er(5,n);break;case 1:if(Sr(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(s){yi(n,n.return,s)}else{var i=Yt(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(i,t,e.__reactInternalSnapshotBeforeUpdate)}catch(l){yi(n,n.return,l)}}64&r&&nr(n),512&r&&ir(n,n.return);break;case 3:if(Sr(e,n),64&r&&null!==(r=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 27:case 5:e=ga(n.child.stateNode);break;case 1:e=n.child.stateNode}try{me(r,e)}catch(s){yi(n,n.return,s)}}break;case 26:if(Ko){Sr(e,n),512&r&&ir(n,n.return);break}case 27:case 5:Sr(e,n),null===t&&4&r&&or(n),512&r&&ir(n,n.return);break;case 12:Sr(e,n);break;case 13:Sr(e,n),4&r&&vr(e,n);break;case 22:if(!(i=null!==n.memoizedState||uc)){t=null!==t&&null!==t.memoizedState||dc;var a=uc,o=dc;uc=i,(dc=t)&&!o?Er(e,n,!!(8772&n.subtreeFlags)):Sr(e,n),uc=a,dc=o}512&r&&("manual"===n.memoizedProps.mode?ir(n,n.return):ar(n,n.return));break;default:Sr(e,n)}}function pr(e){var t=e.alternate;null!==t&&(e.alternate=null,pr(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&Fa(t),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function mr(e,t,n){for(n=n.child;null!==n;)gr(e,t,n),n=n.sibling}function gr(e,t,n){if(Os&&"function"==typeof Os.onCommitFiberUnmount)try{Os.onCommitFiberUnmount(zs,n)}catch(a){}switch(n.tag){case 26:if(Ko){dc||ar(n,t),mr(e,t,n),n.memoizedState?ns(n.memoizedState):n.stateNode&&as(n.stateNode);break}case 27:if(ds){dc||ar(n,t);var r=gc,i=vc;gc=n.stateNode,mr(e,t,n),ms(n.stateNode),gc=r,vc=i;break}case 5:dc||ar(n,t);case 6:if(Ra){if(r=gc,i=vc,gc=null,mr(e,t,n),vc=i,null!==(gc=r))if(vc)try{fo(gc,n.stateNode)}catch(o){yi(n,t,o)}else try{ho(gc,n.stateNode)}catch(o){yi(n,t,o)}}else mr(e,t,n);break;case 18:Ra&&null!==gc&&(vc?Xo(gc,n.stateNode):$o(gc,n.stateNode));break;case 4:Ra?(r=gc,i=vc,gc=n.stateNode.containerInfo,vc=!0,mr(e,t,n),gc=r,vc=i):(Na&&hr(n.stateNode,n,_o()),mr(e,t,n));break;case 0:case 11:case 14:case 15:dc||tr(2,n,t),dc||tr(4,n,t),mr(e,t,n);break;case 1:dc||(ar(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount&&rr(n,t,r)),mr(e,t,n);break;case 21:mr(e,t,n);break;case 22:dc||ar(n,t),dc=(r=dc)||null!==n.memoizedState,mr(e,t,n),dc=r;break;default:mr(e,t,n)}}function vr(e,t){if(Pa&&null===t.memoizedState&&null!==(e=t.alternate)&&null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))try{Wo(e)}catch(n){yi(t,t.return,n)}}function yr(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new fc),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new fc),t;default:throw Error(r(435,e.tag))}}(e);t.forEach(function(t){var r=Si.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}function br(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var a=n[i],o=e,s=t;if(Ra){var l=s;e:for(;null!==l;){switch(l.tag){case 27:case 5:gc=l.stateNode,vc=!1;break e;case 3:case 4:gc=l.stateNode.containerInfo,vc=!0;break e}l=l.return}if(null===gc)throw Error(r(160));gr(o,s,a),gc=null,vc=!1}else gr(o,s,a);null!==(o=a.alternate)&&(o.return=null),a.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)xr(t,e),t=t.sibling}function xr(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:br(t,e),_r(e),4&i&&(tr(3,e,e.return),er(3,e),tr(5,e,e.return));break;case 1:br(t,e),_r(e),512&i&&(dc||null===n||ar(n,n.return)),64&i&&uc&&null!==(e=e.updateQueue)&&null!==(i=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?i:n.concat(i));break;case 26:if(Ko){var a=yc;br(t,e),_r(e),512&i&&(dc||null===n||ar(n,n.return)),4&i&&(i=null!==n?n.memoizedState:null,t=e.memoizedState,null===n?null===t?null===e.stateNode?e.stateNode=rs(a,e.type,e.memoizedProps,e):is(a,e.type,e.stateNode):e.stateNode=ts(a,t,e.memoizedProps):i!==t?(null===i?null!==n.stateNode&&as(n.stateNode):ns(i),null===t?is(a,e.type,e.stateNode):ts(a,t,e.memoizedProps)):null===t&&null!==e.stateNode&&sr(e,e.memoizedProps,n.memoizedProps));break}case 27:if(ds&&4&i&&null===e.alternate){a=e.stateNode;var o=e.memoizedProps;try{fs(a),ps(e.type,o,a,e)}catch(d){yi(e,e.return,d)}}case 5:if(br(t,e),_r(e),512&i&&(dc||null===n||ar(n,n.return)),Ra){if(32&e.flags){t=e.stateNode;try{po(t)}catch(d){yi(e,e.return,d)}}4&i&&null!=e.stateNode&&sr(e,t=e.memoizedProps,null!==n?n.memoizedProps:t),1024&i&&(hc=!0)}break;case 6:if(br(t,e),_r(e),4&i&&Ra){if(null===e.stateNode)throw Error(r(162));i=e.memoizedProps,n=null!==n?n.memoizedProps:i,t=e.stateNode;try{oo(t,n,i)}catch(d){yi(e,e.return,d)}}break;case 3:if(Ko?(ss(),a=yc,yc=Qo(t.containerInfo),br(t,e),yc=a):br(t,e),_r(e),4&i){if(Ra&&Pa&&null!==n&&n.memoizedState.isDehydrated)try{Go(t.containerInfo)}catch(d){yi(e,e.return,d)}if(Na){i=t.containerInfo,n=t.pendingChildren;try{Mo(i,n)}catch(d){yi(e,e.return,d)}}}hc&&(hc=!1,wr(e));break;case 4:Ko?(n=yc,yc=Qo(e.stateNode.containerInfo),br(t,e),_r(e),yc=n):(br(t,e),_r(e)),4&i&&Na&&hr(e.stateNode,e,e.stateNode.pendingChildren);break;case 12:br(t,e),_r(e);break;case 13:br(t,e),_r(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==n&&null!==n.memoizedState)&&(Xc=ks()),4&i&&null!==(i=e.updateQueue)&&(e.updateQueue=null,yr(e,i));break;case 22:512&i&&(dc||null===n||ar(n,n.return)),a=null!==e.memoizedState;var s=null!==n&&null!==n.memoizedState,l=uc,c=dc;if(uc=l||a,dc=c||s,br(t,e),dc=c,uc=l,_r(e),(t=e.stateNode)._current=e,t._visibility&=-3,t._visibility|=2&t._pendingVisibility,8192&i&&(t._visibility=a?-2&t._visibility:1|t._visibility,a&&(t=uc||dc,null===n||s||t||Mr(e)),Ra&&(null===e.memoizedProps||"manual"!==e.memoizedProps.mode)))e:if(n=null,Ra)for(t=e;;){if(5===t.tag||Ko&&26===t.tag||ds&&27===t.tag){if(null===n){s=n=t;try{o=s.stateNode,a?mo(o):vo(s.stateNode,s.memoizedProps)}catch(d){yi(s,s.return,d)}}}else if(6===t.tag){if(null===n){s=t;try{var u=s.stateNode;a?go(u):yo(u,s.memoizedProps)}catch(d){yi(s,s.return,d)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&i&&null!==(i=e.updateQueue)&&null!==(n=i.retryQueue)&&(i.retryQueue=null,yr(e,n));break;case 19:br(t,e),_r(e),4&i&&null!==(i=e.updateQueue)&&(e.updateQueue=null,yr(e,i));break;case 21:break;default:br(t,e),_r(e)}}function _r(e){var t=e.flags;if(2&t){try{if(Ra&&(!ds||27!==e.tag)){e:{for(var n=e.return;null!==n;){if(lr(n)){var i=n;break e}n=n.return}throw Error(r(160))}switch(i.tag){case 27:if(ds){var a=i.stateNode;dr(e,cr(e),a);break}case 5:var o=i.stateNode;32&i.flags&&(po(o),i.flags&=-33),dr(e,cr(e),o);break;case 3:case 4:var s=i.stateNode.containerInfo;ur(e,cr(e),s);break;default:throw Error(r(161))}}}catch(l){yi(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function wr(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;wr(t),5===t.tag&&1024&t.flags&&Xa(t.stateNode),e=e.sibling}}function Sr(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)fr(e,t.alternate,t),t=t.sibling}function Mr(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:tr(4,t,t.return),Mr(t);break;case 1:ar(t,t.return);var n=t.stateNode;"function"==typeof n.componentWillUnmount&&rr(t,t.return,n),Mr(t);break;case 26:case 27:case 5:ar(t,t.return),Mr(t);break;case 22:ar(t,t.return),null===t.memoizedState&&Mr(t);break;default:Mr(t)}e=e.sibling}}function Er(e,t,n){for(n=n&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,i=e,a=t,o=a.flags;switch(a.tag){case 0:case 11:case 15:Er(i,a,n),er(4,a);break;case 1:if(Er(i,a,n),"function"==typeof(i=(r=a).stateNode).componentDidMount)try{i.componentDidMount()}catch(c){yi(r,r.return,c)}if(null!==(i=(r=a).updateQueue)){var s=r.stateNode;try{var l=i.shared.hiddenCallbacks;if(null!==l)for(i.shared.hiddenCallbacks=null,i=0;i<l.length;i++)pe(l[i],s)}catch(c){yi(r,r.return,c)}}n&&64&o&&nr(a),ir(a,a.return);break;case 26:case 27:case 5:Er(i,a,n),n&&null===r&&4&o&&or(a),ir(a,a.return);break;case 12:default:Er(i,a,n);break;case 13:Er(i,a,n),n&&4&o&&vr(i,a);break;case 22:null===a.memoizedState&&Er(i,a,n),ir(a,a.return)}t=t.sibling}}function Tr(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&zn(n))}function Cr(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&zn(e))}function Ar(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)kr(e,t,n,r),t=t.sibling}function kr(e,t,n,r){var i=t.flags;switch(t.tag){case 0:case 11:case 15:Ar(e,t,n,r),2048&i&&er(9,t);break;case 3:Ar(e,t,n,r),2048&i&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&zn(e)));break;case 12:if(2048&i){Ar(e,t,n,r),e=t.stateNode;try{var a=t.memoizedProps,o=a.id,s=a.onPostCommit;"function"==typeof s&&s(o,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){yi(t,t.return,l)}}else Ar(e,t,n,r);break;case 23:break;case 22:a=t.stateNode,null!==t.memoizedState?4&a._visibility?Ar(e,t,n,r):Nr(e,t):4&a._visibility?Ar(e,t,n,r):(a._visibility|=4,Rr(e,t,n,r,!!(10256&t.subtreeFlags))),2048&i&&Tr(t.alternate,t);break;case 24:Ar(e,t,n,r),2048&i&&Cr(t.alternate,t);break;default:Ar(e,t,n,r)}}function Rr(e,t,n,r,i){for(i=i&&!!(10256&t.subtreeFlags),t=t.child;null!==t;){var a=e,o=t,s=n,l=r,c=o.flags;switch(o.tag){case 0:case 11:case 15:Rr(a,o,s,l,i),er(8,o);break;case 23:break;case 22:var u=o.stateNode;null!==o.memoizedState?4&u._visibility?Rr(a,o,s,l,i):Nr(a,o):(u._visibility|=4,Rr(a,o,s,l,i)),i&&2048&c&&Tr(o.alternate,o);break;case 24:Rr(a,o,s,l,i),i&&2048&c&&Cr(o.alternate,o);break;default:Rr(a,o,s,l,i)}t=t.sibling}}function Nr(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,i=r.flags;switch(r.tag){case 22:Nr(n,r),2048&i&&Tr(r.alternate,r);break;case 24:Nr(n,r),2048&i&&Cr(r.alternate,r);break;default:Nr(n,r)}t=t.sibling}}function Pr(e){if(e.subtreeFlags&bc)for(e=e.child;null!==e;)Ir(e),e=e.sibling}function Ir(e){switch(e.tag){case 26:Pr(e),e.flags&bc&&(null!==e.memoizedState?us(yc,e.memoizedState,e.memoizedProps):Va(e.type,e.memoizedProps));break;case 5:Pr(e),e.flags&bc&&Va(e.type,e.memoizedProps);break;case 3:case 4:if(Ko){var t=yc;yc=Qo(e.stateNode.containerInfo),Pr(e),yc=t}else Pr(e);break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=bc,bc=16777216,Pr(e),bc=t):Pr(e));break;default:Pr(e)}}function Lr(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Dr(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];pc=r,Ur(r,e)}Lr(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)zr(e),e=e.sibling}function zr(e){switch(e.tag){case 0:case 11:case 15:Dr(e),2048&e.flags&&tr(9,e,e.return);break;case 3:case 12:default:Dr(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&4&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-5,Or(e)):Dr(e)}}function Or(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];pc=r,Ur(r,e)}Lr(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:tr(8,t,t.return),Or(t);break;case 22:4&(n=t.stateNode)._visibility&&(n._visibility&=-5,Or(t));break;default:Or(t)}e=e.sibling}}function Ur(e,t){for(;null!==pc;){var n=pc;switch(n.tag){case 0:case 11:case 15:tr(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:zn(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,pc=r;else e:for(n=e;null!==pc;){var i=(r=pc).sibling,a=r.return;if(pr(r),r===n){pc=null;break e}if(null!==i){i.return=a,pc=i;break e}pc=a}}}function Fr(e){var t=Ia(e);if(null!=t){if("string"!=typeof t.memoizedProps["data-testname"])throw Error(r(364));return t}if(null===(e=Ka(e)))throw Error(r(362));return e.stateNode.current}function Br(e,t){var n=e.tag;switch(t.$$typeof){case _c:if(e.type===t.value)return!0;break;case wc:e:{for(t=t.value,e=[e,0],n=0;n<e.length;){var i=e[n++],a=i.tag,o=e[n++],s=t[o];if(5!==a&&26!==a&&27!==a||!eo(i)){for(;null!=s&&Br(i,s);)s=t[++o];if(o===t.length){t=!0;break e}for(i=i.child;null!==i;)e.push(i,o),i=i.sibling}}t=!1}return t;case Sc:if((5===n||26===n||27===n)&&to(e.stateNode,t.value))return!0;break;case Ec:if((5===n||6===n||26===n||27===n)&&null!==(e=Qa(e))&&0<=e.indexOf(t.value))return!0;break;case Mc:if((5===n||26===n||27===n)&&"string"==typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase())return!0;break;default:throw Error(r(365))}return!1}function jr(e){switch(e.$$typeof){case _c:return"<"+(a(e.value)||"Unknown")+">";case wc:return":has("+(jr(e)||"")+")";case Sc:return'[role="'+e.value+'"]';case Ec:return'"'+e.value+'"';case Mc:return'[data-testname="'+e.value+'"]';default:throw Error(r(365))}}function Hr(e,t){var n=[];e=[e,0];for(var r=0;r<e.length;){var i=e[r++],a=i.tag,o=e[r++],s=t[o];if(5!==a&&26!==a&&27!==a||!eo(i)){for(;null!=s&&Br(i,s);)s=t[++o];if(o===t.length)n.push(i);else for(i=i.child;null!==i;)e.push(i,o),i=i.sibling}}return n}function Vr(e,t){if(!Za)throw Error(r(363));e=Hr(e=Fr(e),t),t=[],e=Array.from(e);for(var n=0;n<e.length;){var i=e[n++],a=i.tag;if(5===a||26===a||27===a)eo(i)||t.push(i.stateNode);else for(i=i.child;null!==i;)e.push(i),i=i.sibling}return t}function Gr(){return 2&Ac&&0!==Nc?Nc&-Nc:null!==ua.T?0!==gl?gl:ie():Oa()}function Wr(){0===Hc&&(Hc=536870912&Nc&&!tl?536870912:S());var e=Nl.current;return null!==e&&(e.flags|=32),Hc}function $r(e,t,n){(e===kc&&2===Pc||null!==e.cancelPendingCommit)&&(ei(e,0),Kr(e,Nc,Hc,!1)),T(e,n),2&Ac&&e===kc||(e===kc&&(!(2&Ac)&&(Bc|=n),4===Uc&&Kr(e,Nc,Hc,!1)),J(e))}function Xr(e,t,n){if(6&Ac)throw Error(r(327));for(var i=!n&&!(60&t)&&0===(t&e.expiredLanes)||_(e,t),a=i?function(e,t){var n=Ac;Ac|=2;var i=ri(),a=ii();kc!==e||Nc!==t?(Yc=null,qc=ks()+500,ei(e,t)):Dc=_(e,t);e:for(;;)try{if(0!==Pc&&null!==Rc){t=Rc;var o=Ic;t:switch(Pc){case 1:Pc=0,Ic=null,di(e,t,o,1);break;case 2:if(ve(o)){Pc=0,Ic=null,ui(t);break}t=function(){2===Pc&&kc===e&&(Pc=7),J(e)},o.then(t,t);break e;case 3:Pc=7;break e;case 4:Pc=5;break e;case 7:ve(o)?(Pc=0,Ic=null,ui(t)):(Pc=0,Ic=null,di(e,t,o,7));break;case 5:var s=null;switch(Rc.tag){case 26:s=Rc.memoizedState;case 5:case 27:var l=Rc,c=l.type,u=l.pendingProps;if(s?cs(s):ja(c,u)){Pc=0,Ic=null;var d=l.sibling;if(null!==d)Rc=d;else{var h=l.return;null!==h?(Rc=h,hi(h)):Rc=null}break t}}Pc=0,Ic=null,di(e,t,o,5);break;case 6:Pc=0,Ic=null,di(e,t,o,6);break;case 8:Qr(),Uc=6;break e;default:throw Error(r(462))}}li();break}catch(f){ti(e,f)}return rc=nc=null,ua.H=i,ua.A=a,Ac=n,null!==Rc?0:(kc=null,Nc=0,$(),Uc)}(e,t):oi(e,t,!0),o=i;;){if(0===a){Dc&&!i&&Kr(e,t,0,!1);break}if(6===a)Kr(e,t,0,!Lc);else{if(n=e.current.alternate,o&&!Zr(n)){a=oi(e,t,!1),o=!1;continue}if(2===a){if(o=t,e.errorRecoveryDisabledLanes&o)var s=0;else s=0!=(s=-536870913&e.pendingLanes)?s:536870912&s?536870912:0;if(0!==s){t=s;e:{var l=e;a=Gc;var c=Pa&&l.current.memoizedState.isDehydrated;if(c&&(ei(l,s).flags|=256),2!==(s=oi(l,s,!1))){if(zc&&!c){l.errorRecoveryDisabledLanes|=o,Bc|=o,a=4;break e}o=Wc,Wc=a,null!==o&&qr(o)}a=s}if(o=!1,2!==a)continue}}if(1===a){ei(e,0),Kr(e,t,0,!0);break}e:{switch(i=e,a){case 0:case 1:throw Error(r(345));case 4:if((4194176&t)===t){Kr(i,t,Hc,!Lc);break e}break;case 2:Wc=null;break;case 3:case 5:break;default:throw Error(r(329))}if(i.finishedWork=n,i.finishedLanes=t,(62914560&t)===t&&10<(o=Xc+300-ks())){if(Kr(i,t,Hc,!Lc),0!==x(i,0))break e;i.timeoutHandle=Ta(Yr.bind(null,i,n,Wc,Yc,$c,t,Hc,Bc,Vc,Lc,2,-0,0),o)}else Yr(i,n,Wc,Yc,$c,t,Hc,Bc,Vc,Lc,0,-0,0)}}break}J(e)}function qr(e){null===Wc?Wc=e:Wc.push.apply(Wc,e)}function Yr(e,t,n,r,i,a,o,s,l,c,u,d,h){var f=t.subtreeFlags;if((8192&f||!(16785408&~f))&&(Ha(),Ir(t),null!==(t=Ga())))return e.cancelPendingCommit=t(pi.bind(null,e,n,r,i,o,s,l,1,d,h)),void Kr(e,a,o,!c);pi(e,n,r,i,o,s,l)}function Zr(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&null!==(n=t.updateQueue)&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!Us(a(),i))return!1}catch(o){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Kr(e,t,n,r){t&=~jc,t&=~Bc,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var i=t;0<i;){var a=31-xs(i),o=1<<a;r[a]=-1,i&=~o}0!==n&&C(e,n,t)}function Jr(){return!!(6&Ac)||(Q(0),!1)}function Qr(){if(null!==Rc){if(0===Pc)var e=Rc.return;else rc=nc=null,He(e=Rc),El=null,Tl=0,e=Rc;for(;null!==e;)Qn(e.alternate,e),e=e.return;Rc=null}}function ei(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;n!==Aa&&(e.timeoutHandle=Aa,Ca(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Qr(),kc=e,Rc=n=Ti(e.current,null),Nc=t,Pc=0,Ic=null,Lc=!1,Dc=_(e,t),zc=!1,Vc=Hc=jc=Bc=Fc=Uc=0,Wc=Gc=null,$c=!1,8&t&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var i=31-xs(r),a=1<<i;t|=e[i],r&=~a}return Oc=t,$(),n}function ti(e,t){Dl=null,ua.H=$l,t===_l?(t=xe(),Pc=3):t===wl?(t=xe(),Pc=4):Pc=t===Jl?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,Ic=t,null===Rc&&(Uc=1,Zt(e,N(t,e.current)))}function ni(){var e=Nl.current;return null===e||((4194176&Nc)===Nc?null===Pl:!!((62914560&Nc)===Nc||536870912&Nc)&&e===Pl)}function ri(){var e=ua.H;return ua.H=$l,null===e?$l:e}function ii(){var e=ua.A;return ua.A=xc,e}function ai(){Uc=4,Lc||(4194176&Nc)!==Nc&&null!==Nl.current||(Dc=!0),!(134217727&Fc)&&!(134217727&Bc)||null===kc||Kr(kc,Nc,Hc,!1)}function oi(e,t,n){var r=Ac;Ac|=2;var i=ri(),a=ii();kc===e&&Nc===t||(Yc=null,ei(e,t)),t=!1;var o=Uc;e:for(;;)try{if(0!==Pc&&null!==Rc){var s=Rc,l=Ic;switch(Pc){case 8:Qr(),o=6;break e;case 3:case 2:case 6:null===Nl.current&&(t=!0);var c=Pc;if(Pc=0,Ic=null,di(e,s,l,c),n&&Dc){o=0;break e}break;default:c=Pc,Pc=0,Ic=null,di(e,s,l,c)}}si(),o=Uc;break}catch(u){ti(e,u)}return t&&e.shellSuspendCounter++,rc=nc=null,Ac=r,ua.H=i,ua.A=a,null===Rc&&(kc=null,Nc=0,$()),o}function si(){for(;null!==Rc;)ci(Rc)}function li(){for(;null!==Rc&&!Cs();)ci(Rc)}function ci(e){var t=Mn(e.alternate,e,Oc);e.memoizedProps=e.pendingProps,null===t?hi(e):Rc=t}function ui(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=un(n,t,t.pendingProps,t.type,void 0,Nc);break;case 11:t=un(n,t,t.pendingProps,t.type.render,t.ref,Nc);break;case 5:He(t);default:Qn(n,t),t=Mn(n,t=Rc=Ci(t,Oc),Oc)}e.memoizedProps=e.pendingProps,null===t?hi(e):Rc=t}function di(e,t,n,i){rc=nc=null,He(t),El=null,Tl=0;var a=t.return;try{if(function(e,t,n,i,a){if(n.flags|=32768,null!==i&&"object"==typeof i&&"function"==typeof i.then){if(null!==(t=n.alternate)&&kn(t,n,a,!0),null!==(n=Nl.current)){switch(n.tag){case 13:return null===Pl?ai():null===n.alternate&&0===Uc&&(Uc=3),n.flags&=-257,n.flags|=65536,n.lanes=a,i===Sl?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([i]):t.add(i),bi(e,i,a)),!1;case 22:return n.flags|=65536,i===Sl?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([i])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([i]):n.add(i),bi(e,i,a)),!1}throw Error(r(435,n.tag))}return bi(e,i,a),ai(),!1}if(tl)return null!==(t=Nl.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=a,i!==il&&W(N(e=Error(r(422),{cause:i}),n))):(i!==il&&W(N(t=Error(r(423),{cause:i}),n)),(e=e.current.alternate).flags|=65536,a&=-a,e.lanes|=a,i=N(i,n),de(e,a=Jt(e.stateNode,i,a)),4!==Uc&&(Uc=2)),!1;var o=Error(r(520),{cause:i});if(o=N(o,n),null===Gc?Gc=[o]:Gc.push(o),4!==Uc&&(Uc=2),null===t)return!0;i=N(i,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=a&-a,n.lanes|=e,de(n,e=Jt(n.stateNode,i,e)),!1;case 1:if(t=n.type,o=n.stateNode,!(128&n.flags||"function"!=typeof t.getDerivedStateFromError&&(null===o||"function"!=typeof o.componentDidCatch||null!==Zc&&Zc.has(o))))return n.flags|=65536,a&=-a,n.lanes|=a,en(a=Qt(a),e,n,i),de(n,a),!1}n=n.return}while(null!==n);return!1}(e,a,t,n,Nc))return Uc=1,Zt(e,N(n,e.current)),void(Rc=null)}catch(o){if(null!==a)throw Rc=a,o;return Uc=1,Zt(e,N(n,e.current)),void(Rc=null)}32768&t.flags?(tl||1===i?e=!0:Dc||536870912&Nc?e=!1:(Lc=e=!0,(2===i||3===i||6===i)&&null!==(i=Nl.current)&&13===i.tag&&(i.flags|=16384)),fi(t,e)):hi(t)}function hi(e){var t=e;do{if(32768&t.flags)return void fi(t,Lc);e=t.return;var n=Kn(t.alternate,t,Oc);if(null!==n)return void(Rc=n);if(null!==(t=t.sibling))return void(Rc=t);Rc=t=e}while(null!==t);0===Uc&&(Uc=5)}function fi(e,t){do{var n=Jn(e.alternate,e);if(null!==n)return n.flags&=32767,void(Rc=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(Rc=e);Rc=e=n}while(null!==e);Uc=6,Rc=null}function pi(e,t,n,i,a,o,s,l,c,u){var d=ua.T,h=za();try{Da(2),ua.T=null,function(e,t,n,i,a,o,s,l){do{gi()}while(null!==Jc);if(6&Ac)throw Error(r(327));var c=e.finishedWork;if(i=e.finishedLanes,null===c)return null;if(e.finishedWork=null,e.finishedLanes=0,c===e.current)throw Error(r(177));e.callbackNode=null,e.callbackPriority=0,e.cancelPendingCommit=null;var u=c.lanes|c.childLanes;if(function(e,t,n,r,i,a){var o=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var s=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=o&~n;0<n;){var u=31-xs(n),d=1<<u;s[u]=0,l[u]=-1;var h=c[u];if(null!==h)for(c[u]=null,u=0;u<h.length;u++){var f=h[u];null!==f&&(f.lane&=-536870913)}n&=~d}0!==r&&C(e,r,0),0!==a&&0===i&&0!==e.tag&&(e.suspendedLanes|=a&~(o&~t))}(e,i,u|=sl,o,s,l),e===kc&&(Rc=kc=null,Nc=0),!(10256&c.subtreeFlags)&&!(10256&c.flags)||Kc||(Kc=!0,eu=u,tu=n,Es(Ps,function(){return gi(),null})),n=!!(15990&c.flags),15990&c.subtreeFlags||n?(n=ua.T,ua.T=null,o=za(),Da(2),s=Ac,Ac|=4,function(e,t){for(ba(e.containerInfo),pc=t;null!==pc;)if(t=(e=pc).child,1028&e.subtreeFlags&&null!==t)t.return=e,pc=t;else for(;null!==pc;){var n=(e=pc).alternate;switch(t=e.flags,e.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(1024&t&&null!==n){t=void 0;var i=e,a=n.memoizedProps;n=n.memoizedState;var o=i.stateNode;try{var s=Yt(i.type,a,(i.elementType,i.type));t=o.getSnapshotBeforeUpdate(s,n),o.__reactInternalSnapshotBeforeUpdate=t}catch(l){yi(i,i.return,l)}}break;case 3:1024&t&&Ra&&bo(e.stateNode.containerInfo);break;default:if(1024&t)throw Error(r(163))}if(null!==(t=e.sibling)){t.return=e.return,pc=t;break}pc=e.return}s=mc,mc=!1}(e,c),xr(c,e),xa(e.containerInfo),e.current=c,fr(e,c.alternate,c),As(),Ac=s,Da(o),ua.T=n):e.current=c,Kc?(Kc=!1,Jc=e,Qc=i):mi(e,u),0===(u=e.pendingLanes)&&(Zc=null),function(e){if(Os&&"function"==typeof Os.onCommitFiberRoot)try{Os.onCommitFiberRoot(zs,e,void 0,!(128&~e.current.flags))}catch(t){}}(c.stateNode),J(e),null!==t)for(a=e.onRecoverableError,c=0;c<t.length;c++)a((u=t[c]).value,{componentStack:u.stack});!!(3&Qc)&&gi(),u=e.pendingLanes,4194218&i&&42&u?e===ru?nu++:(nu=0,ru=e):nu=0,Q(0)}(e,t,n,i,h,a,o,s)}finally{ua.T=d,Da(h)}}function mi(e,t){0===(e.pooledCacheLanes&=t)&&null!=(t=e.pooledCache)&&(e.pooledCache=null,zn(t))}function gi(){if(null!==Jc){var e=Jc,t=eu;eu=0;var n=k(Qc),i=32>n?32:n;n=ua.T;var a=za();try{if(Da(i),ua.T=null,null===Jc)var o=!1;else{i=tu,tu=null;var s=Jc,l=Qc;if(Jc=null,Qc=0,6&Ac)throw Error(r(331));var c=Ac;if(Ac|=4,zr(s.current),kr(s,s.current,l,i),Ac=c,Q(0),Os&&"function"==typeof Os.onPostCommitFiberRoot)try{Os.onPostCommitFiberRoot(zs,s)}catch(u){}o=!0}return o}finally{Da(a),ua.T=n,mi(e,t)}}return!1}function vi(e,t,n){t=N(n,t),null!==(e=ce(e,t=Jt(e.stateNode,t,2),2))&&(T(e,2),J(e))}function yi(e,t,n){if(3===e.tag)vi(e,e,n);else for(;null!==t;){if(3===t.tag){vi(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===Zc||!Zc.has(r))){e=N(n,e),null!==(r=ce(t,n=Qt(2),2))&&(en(n,r,t,e),T(r,2),J(r));break}}t=t.return}}function bi(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new Cc;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(zc=!0,i.add(n),e=xi.bind(null,e,t,n),t.then(e,e))}function xi(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,kc===e&&(Nc&n)===n&&(4===Uc||3===Uc&&(62914560&Nc)===Nc&&300>ks()-Xc?!(2&Ac)&&ei(e,0):jc|=n,Vc===Nc&&(Vc=0)),J(e)}function _i(e,t){0===t&&(t=M()),null!==(e=Y(e,t))&&(T(e,t),J(e))}function wi(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),_i(e,n)}function Si(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:i=e.stateNode;break;case 22:i=e.stateNode._retryCache;break;default:throw Error(r(314))}null!==i&&i.delete(t),_i(e,n)}function Mi(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ei(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ti(e,n){var r=e.alternate;return null===r?((r=t(e.tag,n,e.key,e.mode)).elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=n,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=31457280&e.flags,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,n=e.dependencies,r.dependencies=null===n?null:{lanes:n.lanes,firstContext:n.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r.refCleanup=e.refCleanup,r}function Ci(e,t){e.flags&=31457282;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Ai(e,n,i,a,o,s){var l=0;if(a=e,"function"==typeof e)Ei(e)&&(l=1);else if("string"==typeof e)l=Ko&&ds?Jo(e,i,Ys.current)?26:gs(e)?27:5:Ko?Jo(e,i,Ys.current)?26:5:ds&&gs(e)?27:5;else e:switch(e){case Yi:return ki(i.children,o,s,n);case Zi:l=8,o|=24;break;case Ki:return(e=t(12,i,n,2|o)).elementType=Ki,e.lanes=s,e;case na:return(e=t(13,i,n,o)).elementType=na,e.lanes=s,e;case ra:return(e=t(19,i,n,o)).elementType=ra,e.lanes=s,e;case oa:return Ri(i,o,s,n);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case Ji:case ea:l=10;break e;case Qi:l=9;break e;case ta:l=11;break e;case ia:l=14;break e;case aa:l=16,a=null;break e}l=29,i=Error(r(130,null===e?"null":typeof e,"")),a=null}return(n=t(l,i,n,o)).elementType=e,n.type=a,n.lanes=s,n}function ki(e,n,r,i){return(e=t(7,e,i,n)).lanes=r,e}function Ri(e,n,i,a){(e=t(22,e,a,n)).elementType=oa,e.lanes=i;var o={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var e=o._current;if(null===e)throw Error(r(456));if(!(2&o._pendingVisibility)){var t=Y(e,2);null!==t&&(o._pendingVisibility|=2,$r(t,0,2))}},attach:function(){var e=o._current;if(null===e)throw Error(r(456));if(2&o._pendingVisibility){var t=Y(e,2);null!==t&&(o._pendingVisibility&=-3,$r(t,0,2))}}};return e.stateNode=o,e}function Ni(e,n,r){return(e=t(6,e,null,n)).lanes=r,e}function Pi(e,n,r){return(n=t(4,null!==e.children?e.children:[],e.key,n)).lanes=r,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}function Ii(e,t,n,r,i,a,o,s){this.tag=1,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Aa,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=E(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=E(0),this.hiddenUpdates=E(null),this.identifierPrefix=r,this.onUncaughtError=i,this.onCaughtError=a,this.onRecoverableError=o,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=s,this.incompleteTransitions=new Map}function Li(e,n,r,i,a,o,s,l,c,u,d,h){return e=new Ii(e,n,r,s,l,c,u,h),n=1,!0===o&&(n|=24),o=t(3,null,null,n),e.current=o,o.stateNode=e,(n=Dn()).refCount++,e.pooledCache=n,n.refCount++,o.memoizedState={element:i,isDehydrated:r,cache:n},oe(o),e}function Di(e){return e?e=bs:bs}function zi(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(r(188));throw e=Object.keys(e).join(","),Error(r(268,e))}return null===(e=null!==(e=f(t))?p(e):null)?null:ga(e.stateNode)}function Oi(e,t,n,r,i,a){i=Di(i),null===r.context?r.context=i:r.pendingContext=i,(r=le(t)).payload={element:n},null!==(a=void 0===a?null:a)&&(r.callback=a),null!==(n=ce(e,r,t))&&($r(n,0,t),ue(n,e,t))}function Ui(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Fi(e,t){Ui(e,t),(e=e.alternate)&&Ui(e,t)}var Bi,ji,Hi={},Vi=d(),Gi=mM(),Wi=Object.assign,$i=Symbol.for("react.element"),Xi=Symbol.for("react.transitional.element"),qi=Symbol.for("react.portal"),Yi=Symbol.for("react.fragment"),Zi=Symbol.for("react.strict_mode"),Ki=Symbol.for("react.profiler"),Ji=Symbol.for("react.provider"),Qi=Symbol.for("react.consumer"),ea=Symbol.for("react.context"),ta=Symbol.for("react.forward_ref"),na=Symbol.for("react.suspense"),ra=Symbol.for("react.suspense_list"),ia=Symbol.for("react.memo"),aa=Symbol.for("react.lazy"),oa=Symbol.for("react.offscreen"),sa=Symbol.for("react.memo_cache_sentinel"),la=Symbol.iterator,ca=Symbol.for("react.client.reference"),ua=Vi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,da=!1,ha=Array.isArray,fa=e.rendererVersion,pa=e.rendererPackageName,ma=e.extraDevToolsConfig,ga=e.getPublicInstance,va=e.getRootHostContext,ya=e.getChildHostContext,ba=e.prepareForCommit,xa=e.resetAfterCommit,_a=e.createInstance,wa=e.appendInitialChild,Sa=e.finalizeInitialChildren,Ma=e.shouldSetTextContent,Ea=e.createTextInstance,Ta=e.scheduleTimeout,Ca=e.cancelTimeout,Aa=e.noTimeout,ka=e.isPrimaryRenderer;e.warnsIfNotActing;var Ra=e.supportsMutation,Na=e.supportsPersistence,Pa=e.supportsHydration,Ia=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var La=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var Da=e.setCurrentUpdatePriority,za=e.getCurrentUpdatePriority,Oa=e.resolveUpdatePriority;e.resolveEventType,e.resolveEventTimeStamp;var Ua=e.shouldAttemptEagerTransition,Fa=e.detachDeletedInstance;e.requestPostPaintCallback;var Ba=e.maySuspendCommit,ja=e.preloadInstance,Ha=e.startSuspendingCommit,Va=e.suspendInstance,Ga=e.waitForCommitToBeReady,Wa=e.NotPendingTransition,$a=e.HostTransitionContext,Xa=e.resetFormInstance;e.bindToConsole;var qa=e.supportsMicrotasks,Ya=e.scheduleMicrotask,Za=e.supportsTestSelectors,Ka=e.findFiberRoot,Ja=e.getBoundingRect,Qa=e.getTextContent,eo=e.isHiddenSubtree,to=e.matchAccessibilityRole,no=e.setFocusIfFocusable,ro=e.setupIntersectionObserver,io=e.appendChild,ao=e.appendChildToContainer,oo=e.commitTextUpdate,so=e.commitMount,lo=e.commitUpdate,co=e.insertBefore,uo=e.insertInContainerBefore,ho=e.removeChild,fo=e.removeChildFromContainer,po=e.resetTextContent,mo=e.hideInstance,go=e.hideTextInstance,vo=e.unhideInstance,yo=e.unhideTextInstance,bo=e.clearContainer,xo=e.cloneInstance,_o=e.createContainerChildSet,wo=e.appendChildToContainerChildSet,So=e.finalizeContainerChildren,Mo=e.replaceContainerChildren,Eo=e.cloneHiddenInstance,To=e.cloneHiddenTextInstance,Co=e.isSuspenseInstancePending,Ao=e.isSuspenseInstanceFallback,ko=e.getSuspenseInstanceFallbackErrorDetails,Ro=e.registerSuspenseInstanceRetry,No=e.canHydrateFormStateMarker,Po=e.isFormStateMarkerMatching,Io=e.getNextHydratableSibling,Lo=e.getFirstHydratableChild,Do=e.getFirstHydratableChildWithinContainer,zo=e.getFirstHydratableChildWithinSuspenseInstance,Oo=e.canHydrateInstance,Uo=e.canHydrateTextInstance,Fo=e.canHydrateSuspenseInstance,Bo=e.hydrateInstance,jo=e.hydrateTextInstance,Ho=e.hydrateSuspenseInstance,Vo=e.getNextHydratableInstanceAfterSuspenseInstance,Go=e.commitHydratedContainer,Wo=e.commitHydratedSuspenseInstance,$o=e.clearSuspenseBoundary,Xo=e.clearSuspenseBoundaryFromContainer,qo=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var Yo=e.validateHydratableInstance,Zo=e.validateHydratableTextInstance,Ko=e.supportsResources,Jo=e.isHostHoistableType,Qo=e.getHoistableRoot,es=e.getResource,ts=e.acquireResource,ns=e.releaseResource,rs=e.hydrateHoistable,is=e.mountHoistable,as=e.unmountHoistable,os=e.createHoistableInstance,ss=e.prepareToCommitHoistables,ls=e.mayResourceSuspendCommit,cs=e.preloadResource,us=e.suspendResource,ds=e.supportsSingletons,hs=e.resolveSingletonInstance,fs=e.clearSingleton,ps=e.acquireSingletonInstance,ms=e.releaseSingletonInstance,gs=e.isHostSingletonType,vs=[],ys=-1,bs={},xs=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(_s(e)/ws|0)|0},_s=Math.log,ws=Math.LN2,Ss=128,Ms=4194304,Es=Gi.unstable_scheduleCallback,Ts=Gi.unstable_cancelCallback,Cs=Gi.unstable_shouldYield,As=Gi.unstable_requestPaint,ks=Gi.unstable_now,Rs=Gi.unstable_ImmediatePriority,Ns=Gi.unstable_UserBlockingPriority,Ps=Gi.unstable_NormalPriority,Is=Gi.unstable_IdlePriority,Ls=Gi.log,Ds=Gi.unstable_setDisableYieldValue,zs=null,Os=null,Us="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},Fs=new WeakMap,Bs=[],js=0,Hs=null,Vs=0,Gs=[],Ws=0,$s=null,Xs=1,qs="",Ys=g(null),Zs=g(null),Ks=g(null),Js=g(null),Qs=null,el=null,tl=!1,nl=null,rl=!1,il=Error(r(519)),al=[],ol=0,sl=0,ll=null,cl=null,ul=!1,dl=!1,hl=!1,fl=0,pl=null,ml=0,gl=0,vl=null,yl=!1,bl=!1,xl=Object.prototype.hasOwnProperty,_l=Error(r(460)),wl=Error(r(474)),Sl={then:function(){}},Ml=null,El=null,Tl=0,Cl=Ee(!0),Al=Ee(!1),kl=g(null),Rl=g(0),Nl=g(null),Pl=null,Il=g(0),Ll=0,Dl=null,zl=null,Ol=null,Ul=!1,Fl=!1,Bl=!1,jl=0,Hl=0,Vl=null,Gl=0,Wl=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},$l={readContext:Pn,use:$e,useCallback:Le,useContext:Le,useEffect:Le,useImperativeHandle:Le,useLayoutEffect:Le,useInsertionEffect:Le,useMemo:Le,useReducer:Le,useRef:Le,useState:Le,useDebugValue:Le,useDeferredValue:Le,useTransition:Le,useSyncExternalStore:Le,useId:Le};$l.useCacheRefresh=Le,$l.useMemoCache=Le,$l.useHostTransitionStatus=Le,$l.useFormState=Le,$l.useActionState=Le,$l.useOptimistic=Le;var Xl={readContext:Pn,use:$e,useCallback:function(e,t){return Ve().memoizedState=[e,void 0===t?null:t],e},useContext:Pn,useEffect:wt,useImperativeHandle:function(e,t,n){n=null!=n?n.concat([e]):null,xt(4194308,4,Tt.bind(null,t,e),n)},useLayoutEffect:function(e,t){return xt(4194308,4,e,t)},useInsertionEffect:function(e,t){xt(4,2,e,t)},useMemo:function(e,t){var n=Ve();t=void 0===t?null:t;var r=e();if(Bl){R(!0);try{e()}finally{R(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=Ve();if(void 0!==n){var i=n(t);if(Bl){R(!0);try{n(t)}finally{R(!1)}}}else i=t;return r.memoizedState=r.baseState=i,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},r.queue=e,e=e.dispatch=Ft.bind(null,Dl,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ve().memoizedState=e},useState:function(e){var t=(e=it(e)).queue,n=Bt.bind(null,Dl,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:At,useDeferredValue:function(e,t){return Nt(Ve(),e,t)},useTransition:function(){var e=it(!1);return e=It.bind(null,Dl,e.queue,!0,!1),Ve().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var i=Dl,a=Ve();if(tl){if(void 0===n)throw Error(r(407));n=n()}else{if(n=t(),null===kc)throw Error(r(349));60&Nc||Qe(i,t,n)}a.memoizedState=n;var o={value:n,getSnapshot:t};return a.queue=o,wt(tt.bind(null,i,o,e),[e]),i.flags|=2048,yt(9,et.bind(null,i,o,n,t),{destroy:void 0},null),n},useId:function(){var e=Ve(),t=kc.identifierPrefix;if(tl){var n=qs;t=":"+t+"R"+(n=(Xs&~(1<<32-xs(Xs)-1)).toString(32)+n),0<(n=jl++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Gl++).toString(32)+":";return e.memoizedState=t},useCacheRefresh:function(){return Ve().memoizedState=Ut.bind(null,Dl)}};Xl.useMemoCache=Xe,Xl.useHostTransitionStatus=Dt,Xl.useFormState=ft,Xl.useActionState=ft,Xl.useOptimistic=function(e){var t=Ve();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Ht.bind(null,Dl,!0,n),n.dispatch=t,[e,t]};var ql={readContext:Pn,use:$e,useCallback:kt,useContext:Pn,useEffect:St,useImperativeHandle:Ct,useInsertionEffect:Mt,useLayoutEffect:Et,useMemo:Rt,useReducer:Ye,useRef:bt,useState:function(){return Ye(qe)},useDebugValue:At,useDeferredValue:function(e,t){return Pt(Ge(),zl.memoizedState,e,t)},useTransition:function(){var e=Ye(qe)[0],t=Ge().memoizedState;return["boolean"==typeof e?e:We(e),t]},useSyncExternalStore:Je,useId:zt};ql.useCacheRefresh=Ot,ql.useMemoCache=Xe,ql.useHostTransitionStatus=Dt,ql.useFormState=pt,ql.useActionState=pt,ql.useOptimistic=function(e,t){return at(Ge(),0,e,t)};var Yl={readContext:Pn,use:$e,useCallback:kt,useContext:Pn,useEffect:St,useImperativeHandle:Ct,useInsertionEffect:Mt,useLayoutEffect:Et,useMemo:Rt,useReducer:Ke,useRef:bt,useState:function(){return Ke(qe)},useDebugValue:At,useDeferredValue:function(e,t){var n=Ge();return null===zl?Nt(n,e,t):Pt(n,zl.memoizedState,e,t)},useTransition:function(){var e=Ke(qe)[0],t=Ge().memoizedState;return["boolean"==typeof e?e:We(e),t]},useSyncExternalStore:Je,useId:zt};Yl.useCacheRefresh=Ot,Yl.useMemoCache=Xe,Yl.useHostTransitionStatus=Dt,Yl.useFormState=vt,Yl.useActionState=vt,Yl.useOptimistic=function(e,t){var n=Ge();return null!==zl?at(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])};var Zl={isMounted:function(e){return!!(e=e._reactInternals)&&u(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Gr(),i=le(r);i.payload=t,null!=n&&(i.callback=n),null!==(t=ce(e,i,r))&&($r(t,0,r),ue(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Gr(),i=le(r);i.tag=1,i.payload=t,null!=n&&(i.callback=n),null!==(t=ce(e,i,r))&&($r(t,0,r),ue(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Gr(),r=le(n);r.tag=2,null!=t&&(r.callback=t),null!==(t=ce(e,r,n))&&($r(t,0,n),ue(t,e,n))}},Kl="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},Jl=Error(r(461)),Ql=!1,ec={dehydrated:null,treeContext:null,retryLane:0},tc=g(null),nc=null,rc=null,ic="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},ac=Gi.unstable_scheduleCallback,oc=Gi.unstable_NormalPriority,sc={$$typeof:ea,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},lc=ua.S;ua.S=function(e,t){"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===pl){var n=pl=[];ml=0,gl=ie(),vl={status:"pending",value:void 0,then:function(e){n.push(e)}}}ml++,t.then(ae,ae)}(0,t),null!==lc&&lc(e,t)};var cc=g(null),uc=!1,dc=!1,hc=!1,fc="function"==typeof WeakSet?WeakSet:Set,pc=null,mc=!1,gc=null,vc=!1,yc=null,bc=8192,xc={getCacheForType:function(e){var t=Pn(sc),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},_c=0,wc=1,Sc=2,Mc=3,Ec=4;if("function"==typeof Symbol&&Symbol.for){var Tc=Symbol.for;_c=Tc("selector.component"),wc=Tc("selector.has_pseudo_class"),Sc=Tc("selector.role"),Mc=Tc("selector.test_id"),Ec=Tc("selector.text")}var Cc="function"==typeof WeakMap?WeakMap:Map,Ac=0,kc=null,Rc=null,Nc=0,Pc=0,Ic=null,Lc=!1,Dc=!1,zc=!1,Oc=0,Uc=0,Fc=0,Bc=0,jc=0,Hc=0,Vc=0,Gc=null,Wc=null,$c=!1,Xc=0,qc=1/0,Yc=null,Zc=null,Kc=!1,Jc=null,Qc=0,eu=0,tu=null,nu=0,ru=null;return Hi.attemptContinuousHydration=function(e){if(13===e.tag){var t=Y(e,67108864);null!==t&&$r(t,0,67108864),Fi(e,67108864)}},Hi.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=Gr(),n=Y(e,t);null!==n&&$r(n,0,t),Fi(e,t)}},Hi.attemptSynchronousHydration=function(e){switch(e.tag){case 3:if((e=e.stateNode).current.memoizedState.isDehydrated){var t=b(e.pendingLanes);if(0!==t){for(e.pendingLanes|=2,e.entangledLanes|=2;t;){var n=1<<31-xs(t);e.entanglements[1]|=n,t&=~n}J(e),!(6&Ac)&&(qc=ks()+500,Q(0))}}break;case 13:null!==(t=Y(e,2))&&$r(t,0,2),Jr(),Fi(e,2)}},Hi.batchedUpdates=function(e,t){return e(t)},Hi.createComponentSelector=function(e){return{$$typeof:_c,value:e}},Hi.createContainer=function(e,t,n,r,i,a,o,s,l,c){return Li(e,t,!1,null,0,r,a,o,s,l,0,null)},Hi.createHasPseudoClassSelector=function(e){return{$$typeof:wc,value:e}},Hi.createHydrationContainer=function(e,t,n,r,i,a,o,s,l,c,u,d,h){return(e=Li(n,r,!0,e,0,a,s,l,c,u,0,h)).context=Di(null),n=e.current,(i=le(r=Gr())).callback=null!=t?t:null,ce(n,i,r),e.current.lanes=r,T(e,r),J(e),e},Hi.createPortal=function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:qi,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}},Hi.createRoleSelector=function(e){return{$$typeof:Sc,value:e}},Hi.createTestNameSelector=function(e){return{$$typeof:Mc,value:e}},Hi.createTextSelector=function(e){return{$$typeof:Ec,value:e}},Hi.defaultOnCaughtError=function(e){console.error(e)},Hi.defaultOnRecoverableError=function(e){Kl(e)},Hi.defaultOnUncaughtError=function(e){Kl(e)},Hi.deferredUpdates=function(e){var t=ua.T,n=za();try{return Da(32),ua.T=null,e()}finally{Da(n),ua.T=t}},Hi.discreteUpdates=function(e,t,n,r,i){var a=ua.T,o=za();try{return Da(2),ua.T=null,e(t,n,r,i)}finally{Da(o),ua.T=a,0===Ac&&(qc=ks()+500)}},Hi.findAllNodes=Vr,Hi.findBoundingRects=function(e,t){if(!Za)throw Error(r(363));t=Vr(e,t),e=[];for(var n=0;n<t.length;n++)e.push(Ja(t[n]));for(t=e.length-1;0<t;t--)for(var i=(n=e[t]).x,a=i+n.width,o=n.y,s=o+n.height,l=t-1;0<=l;l--)if(t!==l){var c=e[l],u=c.x,d=u+c.width,h=c.y,f=h+c.height;if(i>=u&&o>=h&&a<=d&&s<=f){e.splice(t,1);break}if(!(i!==u||n.width!==c.width||f<o||h>s)){h>o&&(c.height+=h-o,c.y=o),f<s&&(c.height=s-h),e.splice(t,1);break}if(!(o!==h||n.height!==c.height||d<i||u>a)){u>i&&(c.width+=u-i,c.x=i),d<a&&(c.width=a-u),e.splice(t,1);break}}return e},Hi.findHostInstance=zi,Hi.findHostInstanceWithNoPortals=function(e){return null===(e=null!==(e=f(e))?m(e):null)?null:ga(e.stateNode)},Hi.findHostInstanceWithWarning=function(e){return zi(e)},Hi.flushPassiveEffects=gi,Hi.flushSyncFromReconciler=function(e){var t=Ac;Ac|=1;var n=ua.T,r=za();try{if(Da(2),ua.T=null,e)return e()}finally{Da(r),ua.T=n,!(6&(Ac=t))&&Q(0)}},Hi.flushSyncWork=Jr,Hi.focusWithin=function(e,t){if(!Za)throw Error(r(363));for(t=Hr(e=Fr(e),t),t=Array.from(t),e=0;e<t.length;){var n=t[e++],i=n.tag;if(!eo(n)){if((5===i||26===i||27===i)&&no(n.stateNode))return!0;for(n=n.child;null!==n;)t.push(n),n=n.sibling}}return!1},Hi.getFindAllNodesFailureDescription=function(e,t){if(!Za)throw Error(r(363));var n=0,i=[];e=[Fr(e),0];for(var a=0;a<e.length;){var o=e[a++],s=o.tag,l=e[a++],c=t[l];if((5!==s&&26!==s&&27!==s||!eo(o))&&(Br(o,c)&&(i.push(jr(c)),++l>n&&(n=l)),l<t.length))for(o=o.child;null!==o;)e.push(o,l),o=o.sibling}if(n<t.length){for(e=[];n<t.length;n++)e.push(jr(t[n]));return"findAllNodes was able to match part of the selector:\n  "+i.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},Hi.getPublicRootInstance=function(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 27:case 5:return ga(e.child.stateNode);default:return e.child.stateNode}},Hi.injectIntoDevTools=function(){var e={bundleType:0,version:fa,rendererPackageName:pa,currentDispatcherRef:ua,findFiberByHostInstance:Ia,reconcilerVersion:"19.0.0"};if(null!==ma&&(e.rendererConfig=ma),"undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)e=!0;else{try{zs=t.inject(e),Os=t}catch(n){}e=!!t.checkDCE}}return e},Hi.isAlreadyRendering=function(){return!1},Hi.observeVisibleRects=function(e,t,n,i){if(!Za)throw Error(r(363));e=Vr(e,t);var a=ro(e,n,i).disconnect;return{disconnect:function(){a()}}},Hi.shouldError=function(){return null},Hi.shouldSuspend=function(){return!1},Hi.startHostTransition=function(e,t,i,a){if(5!==e.tag)throw Error(r(476));var o=Lt(e).queue;It(e,o,t,Wa,null===i?n:function(){var t=Lt(e).next.queue;return jt(e,t,{},Gr()),i(a)})},Hi.updateContainer=function(e,t,n,r){var i=t.current,a=Gr();return Oi(i,a,e,t,n,r),a},Hi.updateContainerSync=function(e,t,n,r){return 0===t.tag&&gi(),Oi(t.current,2,e,t,n,r),2},Hi},vM.exports.default=vM.exports,Object.defineProperty(vM.exports,"__esModule",{value:!0})),hM.exports)),dM.exports));var vM,yM=mM();function bM(e,t,n){if(!e)return;if(!0===n(e))return e;let r=t?e.return:e.child;for(;r;){const e=bM(r,t,n);if(e)return e;r=t?null:r.sibling}}function xM(e){try{return Object.defineProperties(e,{_currentRenderer:{get:()=>null,set(){}},_currentRenderer2:{get:()=>null,set(){}}})}catch(t){return e}}const _M=xM(h.createContext(null));class wM extends h.Component{render(){return h.createElement(_M.Provider,{value:this._reactInternals},this.props.children)}}function SM(){const e=h.useContext(_M);if(null===e)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=h.useId();return h.useMemo(()=>{for(const n of[e,null==e?void 0:e.alternate]){if(!n)continue;const e=bM(n,!1,e=>{let n=e.memoizedState;for(;n;){if(n.memoizedState===t)return!0;n=n.next}});if(e)return e}},[e,t])}const MM=Symbol.for("react.context"),EM=e=>null!==e&&"object"==typeof e&&"$$typeof"in e&&e.$$typeof===MM;function TM(e){let t=e.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const CM=e=>e&&e.isOrthographicCamera,AM=e=>null!=e&&("string"==typeof e||"number"==typeof e||e.isColor),kM=((e,t)=>"undefined"!=typeof window&&((null==(e=window.document)?void 0:e.createElement)||"ReactNative"===(null==(t=window.navigator)?void 0:t.product)))()?h.useLayoutEffect:h.useEffect;function RM(e){const t=h.useRef(e);return kM(()=>{t.current=e},[e]),t}function NM({set:e}){return kM(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}const PM=(e=>((e=class extends h.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}).getDerivedStateFromError=()=>({error:!0}),e))();function IM(e){var t;const n="undefined"!=typeof window?null!=(t=window.devicePixelRatio)?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}function LM(e){var t;return null==(t=e.__r3f)?void 0:t.root.getState()}const DM={obj:e=>e===Object(e)&&!DM.arr(e)&&"function"!=typeof e,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,boo:e=>"boolean"==typeof e,und:e=>void 0===e,nul:e=>null===e,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:r="reference",strict:i=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(DM.str(e)||DM.num(e)||DM.boo(e))return e===t;const a=DM.obj(e);if(a&&"reference"===r)return e===t;const o=DM.arr(e);if(o&&"reference"===n)return e===t;if((o||a)&&e===t)return!0;let s;for(s in e)if(!(s in t))return!1;if(a&&"shallow"===n&&"shallow"===r){for(s in i?t:e)if(!DM.equ(e[s],t[s],{strict:i,objects:"reference"}))return!1}else for(s in i?t:e)if(e[s]!==t[s])return!1;if(DM.und(s)){if(o&&0===e.length&&0===t.length)return!0;if(a&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}},zM=["children","key","ref"];function OM(e){const t={};for(const n in e)zM.includes(n)||(t[n]=e[n]);return t}function UM(e,t,n,r){const i=e;let a=null==i?void 0:i.__r3f;return a||(a={root:t,type:n,parent:null,children:[],props:OM(r),object:i,eventCount:0,handlers:{},isHidden:!1},i&&(i.__r3f=a)),a}function FM(e,t){if(!t.includes("-"))return{root:e,key:t,target:e[t]};if(t in e)return{root:e,key:t,target:e[t]};let n=e;const r=t.split("-");for(const i of r){if("object"!=typeof n||null===n)return void 0!==n?{root:n,key:r.slice(r.indexOf(i)).join("-"),target:void 0}:{root:e,key:t,target:void 0};e=n,n=n[t=i]}return{root:e,key:t,target:n}}const BM=/-\d+$/;function jM(e,t){if(DM.str(t.props.attach)){if(BM.test(t.props.attach)){const n=t.props.attach.replace(BM,""),{root:r,key:i}=FM(e.object,n);Array.isArray(r[i])||(r[i]=[])}const{root:n,key:r}=FM(e.object,t.props.attach);t.previousAttach=n[r],n[r]=t.object}else DM.fun(t.props.attach)&&(t.previousAttach=t.props.attach(e.object,t.object))}function HM(e,t){if(DM.str(t.props.attach)){const{root:n,key:r}=FM(e.object,t.props.attach),i=t.previousAttach;void 0===i?delete n[r]:n[r]=i}else null==t.previousAttach||t.previousAttach(e.object,t.object);delete t.previousAttach}const VM=[...zM,"args","dispose","attach","object","onUpdate","dispose"],GM=new Map;function WM(e){let t=GM.get(e.constructor);try{t||(t=new e.constructor,GM.set(e.constructor,t))}catch(n){}return t}const $M=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],XM=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function qM(e,t){var n;const r=e.__r3f,i=r&&TM(r).getState(),a=null==r?void 0:r.eventCount;for(const s in t){let n=t[s];if(VM.includes(s))continue;if(r&&XM.test(s)){"function"==typeof n?r.handlers[s]=n:delete r.handlers[s],r.eventCount=Object.keys(r.handlers).length;continue}if(void 0===n)continue;let{root:a,key:l,target:c}=FM(e,s);if(void 0===c&&("object"!=typeof a||null===a))throw Error(`R3F: Cannot set "${s}". Ensure it is an object before setting "${l}".`);if(c instanceof Ch&&n instanceof Ch)c.mask=n.mask;else if(c instanceof cf&&AM(n))c.set(n);else if(null!==c&&"object"==typeof c&&"function"==typeof c.set&&"function"==typeof c.copy&&null!=n&&n.constructor&&c.constructor===n.constructor)c.copy(n);else if(null!==c&&"object"==typeof c&&"function"==typeof c.set&&Array.isArray(n))"function"==typeof c.fromArray?c.fromArray(n):c.set(...n);else if(null!==c&&"object"==typeof c&&"function"==typeof c.set&&"number"==typeof n)"function"==typeof c.setScalar?c.setScalar(n):c.set(n);else{var o;a[l]=n,i&&!i.linear&&$M.includes(l)&&null!=(o=a[l])&&o.isTexture&&a[l].format===jc&&a[l].type===Tc&&(a[l].colorSpace=Du)}}if(null!=r&&r.parent&&null!=i&&i.internal&&null!=(n=r.object)&&n.isObject3D&&a!==r.eventCount){const e=r.object,t=i.internal.interaction.indexOf(e);t>-1&&i.internal.interaction.splice(t,1),r.eventCount&&null!==e.raycast&&i.internal.interaction.push(e)}return r&&void 0===r.props.attach&&(r.object.isBufferGeometry?r.props.attach="geometry":r.object.isMaterial&&(r.props.attach="material")),r&&YM(r),e}function YM(e){var t;if(!e.parent)return;null==e.props.onUpdate||e.props.onUpdate(e.object);const n=null==(t=e.root)||null==t.getState?void 0:t.getState();n&&0===n.internal.frames&&n.invalidate()}const ZM=e=>null==e?void 0:e.isObject3D;function KM(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function JM(e,t,n,r){const i=n.get(t);i&&(n.delete(t),0===n.size&&(e.delete(r),i.target.releasePointerCapture(r)))}const QM=e=>!(null==e||!e.render),eE=h.createContext(null);function tE(){const e=h.useContext(eE);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function nE(e=e=>e,t){return tE()(e,t)}function rE(e,t=0){const n=tE(),r=n.getState().internal.subscribe,i=RM(e);return kM(()=>r(i,t,n),[t,r,n]),null}function iE(e){const t=gM(e);return t.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:h.version}),t}const aE={},oE=/^three(?=[A-Z])/,sE=e=>`${e[0].toUpperCase()}${e.slice(1)}`;let lE=0;function cE(e,t){const n=sE(e),r=aE[n];if("primitive"!==e&&!r)throw new Error(`R3F: ${n} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if("primitive"===e&&!t.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(void 0!==t.args&&!Array.isArray(t.args))throw new Error("R3F: The args prop must be an array!")}function uE(e){var t;e.isHidden&&(e.props.attach&&null!=(t=e.parent)&&t.object?jM(e.parent,e):ZM(e.object)&&!1!==e.props.visible&&(e.object.visible=!0),e.isHidden=!1,YM(e))}function dE(e,t,n){const r=t.root.getState();if(e.parent||e.object===r.scene){if(!t.object){var i,a;const e=aE[sE(t.type)];t.object=null!=(i=t.props.object)?i:new e(...null!=(a=t.props.args)?a:[]),t.object.__r3f=t}if(qM(t.object,t.props),t.props.attach)jM(e,t);else if(ZM(t.object)&&ZM(e.object)){const r=e.object.children.indexOf(null==n?void 0:n.object);if(n&&-1!==r){const n=e.object.children.indexOf(t.object);if(-1!==n){e.object.children.splice(n,1);const i=n<r?r-1:r;e.object.children.splice(i,0,t.object)}else t.object.parent=e.object,e.object.children.splice(r,0,t.object),t.object.dispatchEvent({type:"added"}),e.object.dispatchEvent({type:"childadded",child:t.object})}else e.object.add(t.object)}for(const e of t.children)dE(t,e);YM(t)}}function hE(e,t){t&&(t.parent=e,e.children.push(t),dE(e,t))}function fE(e,t,n){if(!t||!n)return;t.parent=e;const r=e.children.indexOf(n);-1!==r?e.children.splice(r,0,t):e.children.push(t),dE(e,t,n)}function pE(e){if("function"==typeof e.dispose){const t=()=>{try{e.dispose()}catch{}};"undefined"!=typeof IS_REACT_ACT_ENVIRONMENT?t():yM.unstable_scheduleCallback(yM.unstable_IdlePriority,t)}}function mE(e,t,n){if(!t)return;t.parent=null;const r=e.children.indexOf(t);-1!==r&&e.children.splice(r,1),t.props.attach?HM(e,t):ZM(t.object)&&ZM(e.object)&&(e.object.remove(t.object),function(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(e=>e!==t),n.initialHits=n.initialHits.filter(e=>e!==t),n.hovered.forEach((e,r)=>{e.eventObject!==t&&e.object!==t||n.hovered.delete(r)}),n.capturedMap.forEach((e,r)=>{JM(n.capturedMap,t,e,r)})}(TM(t),t.object));const i=null!==t.props.dispose&&!1!==n;for(let a=t.children.length-1;a>=0;a--)mE(t,t.children[a],i);t.children.length=0,delete t.object.__r3f,i&&"primitive"!==t.type&&"Scene"!==t.object.type&&pE(t.object),void 0===n&&YM(t)}function gE(e,t){for(const n of[e,e.alternate])if(null!==n)if("function"==typeof n.ref){null==n.refCleanup||n.refCleanup();const e=n.ref(t);"function"==typeof e&&(n.refCleanup=e)}else n.ref&&(n.ref.current=t)}const vE=[],yE=()=>{},bE={};let xE=0;const _E=iE({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:function(e,t,n){var r;return cE(e=sE(e)in aE?e:e.replace(oE,""),t),"primitive"===e&&null!=(r=t.object)&&r.__r3f&&delete t.object.__r3f,UM(t.object,n,e,t)},removeChild:mE,appendChild:hE,appendInitialChild:hE,insertBefore:fE,appendChildToContainer(e,t){const n=e.getState().scene.__r3f;t&&n&&hE(n,t)},removeChildFromContainer(e,t){const n=e.getState().scene.__r3f;t&&n&&mE(n,t)},insertInContainerBefore(e,t,n){const r=e.getState().scene.__r3f;t&&n&&r&&fE(r,t,n)},getRootHostContext:()=>bE,getChildHostContext:()=>bE,commitUpdate(e,t,n,r,i){var a,o,s;cE(t,r);let l=!1;if(("primitive"===e.type&&n.object!==r.object||(null==(a=r.args)?void 0:a.length)!==(null==(o=n.args)?void 0:o.length)||null!=(s=r.args)&&s.some((e,t)=>{var r;return e!==(null==(r=n.args)?void 0:r[t])}))&&(l=!0),l)vE.push([e,{...r},i]);else{const t=function(e,t){const n={};for(const r in t)if(!VM.includes(r)&&!DM.equ(t[r],e.props[r])){n[r]=t[r];for(const e in t)e.startsWith(`${r}-`)&&(n[e]=t[e])}for(const r in e.props){if(VM.includes(r)||t.hasOwnProperty(r))continue;const{root:i,key:a}=FM(e.object,r);if(i.constructor&&0===i.constructor.length){const e=WM(i);DM.und(e)||(n[a]=e[a])}else n[a]=0}return n}(e,r);Object.keys(t).length&&(Object.assign(e.props,t),qM(e.object,t))}(null===i.sibling||!(4&i.flags))&&function(){for(const[n]of vE){const e=n.parent;if(e){n.props.attach?HM(e,n):ZM(n.object)&&ZM(e.object)&&e.object.remove(n.object);for(const e of n.children)e.props.attach?HM(n,e):ZM(e.object)&&ZM(n.object)&&n.object.remove(e.object)}n.isHidden&&uE(n),n.object.__r3f&&delete n.object.__r3f,"primitive"!==n.type&&pE(n.object)}for(const[n,r,i]of vE){n.props=r;const a=n.parent;if(a){var e,t;const r=aE[sE(n.type)];n.object=null!=(e=n.props.object)?e:new r(...null!=(t=n.props.args)?t:[]),n.object.__r3f=n,gE(i,n.object),qM(n.object,n.props),n.props.attach?jM(a,n):ZM(n.object)&&ZM(a.object)&&a.object.add(n.object);for(const e of n.children)e.props.attach?jM(n,e):ZM(e.object)&&ZM(n.object)&&n.object.add(e.object);YM(n)}}vE.length=0}()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:e=>null==e?void 0:e.object,prepareForCommit:()=>null,preparePortalMount:e=>UM(e.getState().scene,e,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:function(e){var t;e.isHidden||(e.props.attach&&null!=(t=e.parent)&&t.object?HM(e.parent,e):ZM(e.object)&&(e.object.visible=!1),e.isHidden=!0,YM(e))},unhideInstance:uE,createTextInstance:yE,hideTextInstance:yE,unhideTextInstance:yE,scheduleTimeout:"function"==typeof setTimeout?setTimeout:void 0,cancelTimeout:"function"==typeof clearTimeout?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:h.createContext(null),setCurrentUpdatePriority(e){xE=e},getCurrentUpdatePriority:()=>xE,resolveUpdatePriority(){var e;if(0!==xE)return xE;switch("undefined"!=typeof window&&(null==(e=window.event)?void 0:e.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return rM.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return rM.ContinuousEventPriority;default:return rM.DefaultEventPriority}},resetFormInstance(){}}),wE=new Map,SE={objects:"shallow",strict:!1};function ME(e){const t=wE.get(e),n=null==t?void 0:t.fiber,r=null==t?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const i="function"==typeof reportError?reportError:console.error,a=r||((e,t)=>{const n=(r=(n,r)=>{const i=new hd,a=new hd,o=new hd;function s(e=r().camera,t=a,n=r().size){const{width:s,height:l,top:c,left:u}=n,d=s/l;t.isVector3?o.copy(t):o.set(...t);const h=e.getWorldPosition(i).distanceTo(o);if(CM(e))return{width:s/e.zoom,height:l/e.zoom,top:c,left:u,factor:1,distance:h,aspect:d};{const t=e.fov*Math.PI/180,n=2*Math.tan(t/2)*h,r=n*(s/l);return{width:r,height:n,top:c,left:u,factor:s/r,distance:h,aspect:d}}}let l;const c=e=>n(t=>({performance:{...t.performance,current:e}})),u=new ud;return{set:n,get:r,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(t=1)=>e(r(),t),advance:(e,n)=>t(e,n,r()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Jy,pointer:u,mouse:u,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const e=r();l&&clearTimeout(l),e.performance.current!==e.performance.min&&c(e.performance.min),l=setTimeout(()=>c(r().performance.max),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:s},setEvents:e=>n(t=>({...t,events:{...t.events,...e}})),setSize:(e,t,i=0,o=0)=>{const l=r().camera,c={width:e,height:t,top:i,left:o};n(e=>({size:c,viewport:{...e.viewport,...s(l,a,c)}}))},setDpr:e=>n(t=>{const n=IM(e);return{viewport:{...t.viewport,dpr:n,initialDpr:t.viewport.initialDpr||n}}}),setFrameloop:(e="always")=>{const t=r().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),n(()=>({frameloop:e}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:h.createRef(),active:!1,frames:0,priority:0,subscribe:(e,t,n)=>{const i=r().internal;return i.priority=i.priority+(t>0?1:0),i.subscribers.push({ref:e,priority:t,store:n}),i.subscribers=i.subscribers.sort((e,t)=>e.priority-t.priority),()=>{const n=r().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter(t=>t.ref!==e))}}}}})?oM(r,void 0):oM;var r;const i=n.getState();let a=i.size,o=i.viewport.dpr,s=i.camera;return n.subscribe(()=>{const{camera:e,size:t,viewport:r,gl:i,set:l}=n.getState();if(t.width!==a.width||t.height!==a.height||r.dpr!==o){a=t,o=r.dpr,function(e,t){e.manual||(CM(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix())}(e,t),r.dpr>0&&i.setPixelRatio(r.dpr);const n="undefined"!=typeof HTMLCanvasElement&&i.domElement instanceof HTMLCanvasElement;i.setSize(t.width,t.height,n)}e!==s&&(s=e,l(t=>({viewport:{...t.viewport,...t.viewport.getCurrentViewport(e)}})))}),n.subscribe(t=>e(t)),n})(jE,HE),o=n||_E.createContainer(a,rM.ConcurrentRoot,null,!1,null,"",i,i,i,null);let l,c;t||wE.set(e,{fiber:o,store:a});let u=!1,d=null;return{async configure(t={}){let n;d=new Promise(e=>n=e);let{gl:r,size:i,scene:o,events:s,onCreated:h,shadows:f=!1,linear:p=!1,flat:m=!1,legacy:g=!1,orthographic:v=!1,frameloop:y="always",dpr:b=[1,2],performance:x,raycaster:_,camera:w,onPointerMissed:S}=t,M=a.getState(),E=M.gl;if(!M.gl){const t={canvas:e,powerPreference:"high-performance",antialias:!0,alpha:!0},n="function"==typeof r?await r(t):r;E=QM(n)?n:new Lw({...t,...r}),M.set({gl:E})}let T=M.raycaster;T||M.set({raycaster:T=new wb});const{params:C,...A}=_||{};if(DM.equ(A,T,SE)||qM(T,{...A}),DM.equ(C,T.params,SE)||qM(T,{params:{...T.params,...C}}),!M.camera||M.camera===c&&!DM.equ(c,w,SE)){c=w;const e=null==w?void 0:w.isCamera,t=e?w:v?new Ny(0,0,0,0,.1,1e3):new rp(75,0,.1,1e3);e||(t.position.z=5,w&&(qM(t,w),t.manual||("aspect"in w||"left"in w||"right"in w||"bottom"in w||"top"in w)&&(t.manual=!0,t.updateProjectionMatrix())),M.camera||null!=w&&w.rotation||t.lookAt(0,0,0)),M.set({camera:t}),T.camera=t}if(!M.scene){let e;null!=o&&o.isScene?(e=o,UM(e,a,"",{})):(e=new fp,UM(e,a,"",{}),o&&qM(e,o)),M.set({scene:e})}s&&!M.events.handlers&&M.set({events:s(a)});const k=function(e,t){if(!t&&"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:t,height:n,top:r,left:i}=e.parentElement.getBoundingClientRect();return{width:t,height:n,top:r,left:i}}return!t&&"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?{width:e.width,height:e.height,top:0,left:0}:{width:0,height:0,top:0,left:0,...t}}(e,i);if(DM.equ(k,M.size,SE)||M.setSize(k.width,k.height,k.top,k.left),b&&M.viewport.dpr!==IM(b)&&M.setDpr(b),M.frameloop!==y&&M.setFrameloop(y),M.onPointerMissed||M.set({onPointerMissed:S}),x&&!DM.equ(x,M.performance,SE)&&M.set(e=>({performance:{...e.performance,...x}})),!M.xr){var R;const e=(e,t)=>{const n=a.getState();"never"!==n.frameloop&&HE(e,!0,n,t)},t=()=>{const t=a.getState();t.gl.xr.enabled=t.gl.xr.isPresenting,t.gl.xr.setAnimationLoop(t.gl.xr.isPresenting?e:null),t.gl.xr.isPresenting||jE(t)},n={connect(){const e=a.getState().gl;e.xr.addEventListener("sessionstart",t),e.xr.addEventListener("sessionend",t)},disconnect(){const e=a.getState().gl;e.xr.removeEventListener("sessionstart",t),e.xr.removeEventListener("sessionend",t)}};"function"==typeof(null==(R=E.xr)?void 0:R.addEventListener)&&n.connect(),M.set({xr:n})}if(E.shadowMap){const e=E.shadowMap.enabled,t=E.shadowMap.type;if(E.shadowMap.enabled=!!f,DM.boo(f))E.shadowMap.type=2;else if(DM.str(f)){var N;const e={basic:0,percentage:1,soft:2,variance:3};E.shadowMap.type=null!=(N=e[f])?N:2}else DM.obj(f)&&Object.assign(E.shadowMap,f);e===E.shadowMap.enabled&&t===E.shadowMap.type||(E.shadowMap.needsUpdate=!0)}return Cd.enabled=!g,u||(E.outputColorSpace=p?zu:Du,E.toneMapping=m?0:4),M.legacy!==g&&M.set(()=>({legacy:g})),M.linear!==p&&M.set(()=>({linear:p})),M.flat!==m&&M.set(()=>({flat:m})),!r||DM.fun(r)||QM(r)||DM.equ(r,E,SE)||qM(E,r),l=h,u=!0,n(),this},render(t){return u||d||this.configure(),d.then(()=>{_E.updateContainer(s.jsx(EE,{store:a,children:t,onCreated:l,rootElement:e}),o,null,()=>{})}),a},unmount(){TE(e)}}}function EE({store:e,children:t,onCreated:n,rootElement:r}){return kM(()=>{const t=e.getState();t.set(e=>({internal:{...e.internal,active:!0}})),n&&n(t),e.getState().events.connected||null==t.events.connect||t.events.connect(r)},[]),s.jsx(eE.Provider,{value:e,children:t})}function TE(e,t){const n=wE.get(e),r=null==n?void 0:n.fiber;if(r){const t=null==n?void 0:n.store.getState();t&&(t.internal.active=!1),_E.updateContainer(null,r,null,()=>{t&&setTimeout(()=>{try{var n,r,i,a;null==t.events.disconnect||t.events.disconnect(),null==(n=t.gl)||null==(r=n.renderLists)||null==r.dispose||r.dispose(),null==(i=t.gl)||null==i.forceContextLoss||i.forceContextLoss(),null!=(a=t.gl)&&a.xr&&t.xr.disconnect(),function(e){"Scene"!==e.type&&(null==e.dispose||e.dispose());for(const t in e){const n=e[t];"Scene"!==(null==n?void 0:n.type)&&(null==n||null==n.dispose||n.dispose())}}(t.scene),wE.delete(e)}catch(o){}},500)})}}const CE=new Set,AE=new Set,kE=new Set;function RE(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function NE(e,t){switch(e){case"before":return RE(CE,t);case"after":return RE(AE,t);case"tail":return RE(kE,t)}}let PE,IE;function LE(e,t,n){let r=t.clock.getDelta();"never"===t.frameloop&&"number"==typeof e&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),PE=t.internal.subscribers;for(let i=0;i<PE.length;i++)IE=PE[i],IE.ref.current(IE.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}let DE,zE,OE,UE=!1,FE=!1;function BE(e){zE=requestAnimationFrame(BE),UE=!0,DE=0,NE("before",e),FE=!0;for(const n of wE.values()){var t;OE=n.store.getState(),!OE.internal.active||!("always"===OE.frameloop||OE.internal.frames>0)||null!=(t=OE.gl.xr)&&t.isPresenting||(DE+=LE(e,OE))}if(FE=!1,NE("after",e),0===DE)return NE("tail",e),UE=!1,cancelAnimationFrame(zE)}function jE(e,t=1){var n;if(!e)return wE.forEach(e=>jE(e.store.getState(),t));null!=(n=e.gl.xr)&&n.isPresenting||!e.internal.active||"never"===e.frameloop||(e.internal.frames=t>1?Math.min(60,e.internal.frames+t):FE?2:1,UE||(UE=!0,requestAnimationFrame(BE)))}function HE(e,t=!0,n,r){if(t&&NE("before",e),n)LE(e,n,r);else for(const i of wE.values())LE(e,i.store.getState());t&&NE("after",e)}const VE={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function GE(e){const{handlePointer:t}=function(e){function t(e){return e.filter(e=>["Move","Over","Enter","Out","Leave"].some(t=>{var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))}function n(t){const{internal:n}=e.getState();for(const e of n.hovered.values())if(!t.length||!t.find(t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId)){const r=e.eventObject.__r3f;if(n.hovered.delete(KM(e)),null!=r&&r.eventCount){const n=r.handlers,i={...e,intersections:t};null==n.onPointerOut||n.onPointerOut(i),null==n.onPointerLeave||n.onPointerLeave(i)}}}function r(e,t){for(let n=0;n<t.length;n++){const r=t[n].__r3f;null==r||null==r.handlers.onPointerMissed||r.handlers.onPointerMissed(e)}}return{handlePointer:function(i){switch(i){case"onPointerLeave":case"onPointerCancel":return()=>n([]);case"onLostPointerCapture":return t=>{const{internal:r}=e.getState();"pointerId"in t&&r.capturedMap.has(t.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(t.pointerId)&&(r.capturedMap.delete(t.pointerId),n([]))})}}return function(a){const{onPointerMissed:o,internal:s}=e.getState();s.lastEvent.current=a;const l="onPointerMove"===i,c="onClick"===i||"onContextMenu"===i||"onDoubleClick"===i,u=function(t,n){const r=e.getState(),i=new Set,a=[],o=n?n(r.internal.interaction):r.internal.interaction;for(let e=0;e<o.length;e++){const t=LM(o[e]);t&&(t.raycaster.camera=void 0)}r.previousRoot||null==r.events.compute||r.events.compute(t,r);let s=o.flatMap(function(e){const n=LM(e);return n&&n.events.enabled&&null!==n.raycaster.camera?(void 0===n.raycaster.camera&&(null==n.events.compute||n.events.compute(t,n,null==(r=n.previousRoot)?void 0:r.getState()),void 0===n.raycaster.camera&&(n.raycaster.camera=null)),n.raycaster.camera?n.raycaster.intersectObject(e,!0):[]):[];var r}).sort((e,t)=>{const n=LM(e.object),r=LM(t.object);return n&&r&&r.events.priority-n.events.priority||e.distance-t.distance}).filter(e=>{const t=KM(e);return!i.has(t)&&(i.add(t),!0)});r.events.filter&&(s=r.events.filter(s,r));for(const e of s){let t=e.object;for(;t;){var l;null!=(l=t.__r3f)&&l.eventCount&&a.push({...e,eventObject:t}),t=t.parent}}if("pointerId"in t&&r.internal.capturedMap.has(t.pointerId))for(let e of r.internal.capturedMap.get(t.pointerId).values())i.has(KM(e.intersection))||a.push(e.intersection);return a}(a,l?t:void 0),d=c?function(t){const{internal:n}=e.getState(),r=t.offsetX-n.initialClick[0],i=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(r*r+i*i))}(a):0;"onPointerDown"===i&&(s.initialClick=[a.offsetX,a.offsetY],s.initialHits=u.map(e=>e.eventObject)),c&&!u.length&&d<=2&&(r(a,s.interaction),o&&o(a)),l&&n(u),function(e,t,r,i){if(e.length){const a={stopped:!1};for(const o of e){let s=LM(o.object);if(s||o.object.traverseAncestors(e=>{const t=LM(e);if(t)return s=t,!1}),s){const{raycaster:l,pointer:c,camera:u,internal:d}=s,h=new hd(c.x,c.y,0).unproject(u),f=e=>{var t,n;return null!=(t=null==(n=d.capturedMap.get(e))?void 0:n.has(o.eventObject))&&t},p=e=>{const n={intersection:o,target:t.target};d.capturedMap.has(e)?d.capturedMap.get(e).set(o.eventObject,n):d.capturedMap.set(e,new Map([[o.eventObject,n]])),t.target.setPointerCapture(e)},m=e=>{const t=d.capturedMap.get(e);t&&JM(d.capturedMap,o.eventObject,t,e)};let g={};for(let e in t){let n=t[e];"function"!=typeof n&&(g[e]=n)}let v={...o,...g,pointer:c,intersections:e,stopped:a.stopped,delta:r,unprojectedPoint:h,ray:l.ray,camera:u,stopPropagation(){const r="pointerId"in t&&d.capturedMap.get(t.pointerId);(!r||r.has(o.eventObject))&&(v.stopped=a.stopped=!0,d.hovered.size&&Array.from(d.hovered.values()).find(e=>e.eventObject===o.eventObject))&&n([...e.slice(0,e.indexOf(o)),o])},target:{hasPointerCapture:f,setPointerCapture:p,releasePointerCapture:m},currentTarget:{hasPointerCapture:f,setPointerCapture:p,releasePointerCapture:m},nativeEvent:t};if(i(v),!0===a.stopped)break}}}}(u,a,d,function(e){const t=e.eventObject,n=t.__r3f;if(null==n||!n.eventCount)return;const o=n.handlers;if(l){if(o.onPointerOver||o.onPointerEnter||o.onPointerOut||o.onPointerLeave){const t=KM(e),n=s.hovered.get(t);n?n.stopped&&e.stopPropagation():(s.hovered.set(t,e),null==o.onPointerOver||o.onPointerOver(e),null==o.onPointerEnter||o.onPointerEnter(e))}null==o.onPointerMove||o.onPointerMove(e)}else{const n=o[i];n?c&&!s.initialHits.includes(t)||(r(a,s.interaction.filter(e=>!s.initialHits.includes(e))),n(e)):c&&s.initialHits.includes(t)&&r(a,s.interaction.filter(e=>!s.initialHits.includes(e)))}})}}}}(e);return{priority:1,enabled:!0,compute(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(VE).reduce((e,n)=>({...e,[n]:t(n)}),{}),update:()=>{var t;const{events:n,internal:r}=e.getState();null!=(t=r.lastEvent)&&t.current&&n.handlers&&n.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{const{set:n,events:r}=e.getState();if(null==r.disconnect||r.disconnect(),n(e=>({events:{...e.events,connected:t}})),r.handlers)for(const e in r.handlers){const n=r.handlers[e],[i,a]=VE[e];t.addEventListener(i,n,{passive:a})}},disconnect:()=>{const{set:t,events:n}=e.getState();if(n.connected){if(n.handlers)for(const e in n.handlers){const t=n.handlers[e],[r]=VE[e];n.connected.removeEventListener(r,t)}t(e=>({events:{...e.events,connected:void 0}}))}}}}function WE(e,t){let n;return(...r)=>{window.clearTimeout(n),n=window.setTimeout(()=>e(...r),t)}}function $E({debounce:e,scroll:t,polyfill:n,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const i=n||("undefined"==typeof window?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[a,o]=h.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),s=h.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:a,orientationHandler:null}),l=e?"number"==typeof e?e:e.scroll:null,c=e?"number"==typeof e?e:e.resize:null,u=h.useRef(!1);h.useEffect(()=>(u.current=!0,()=>{u.current=!1}));const[d,f,p]=h.useMemo(()=>{const e=()=>{if(!s.current.element)return;const{left:e,top:t,width:n,height:i,bottom:a,right:l,x:c,y:d}=s.current.element.getBoundingClientRect(),h={left:e,top:t,width:n,height:i,bottom:a,right:l,x:c,y:d};s.current.element instanceof HTMLElement&&r&&(h.height=s.current.element.offsetHeight,h.width=s.current.element.offsetWidth),Object.freeze(h),u.current&&!YE(s.current.lastBounds,h)&&o(s.current.lastBounds=h)};return[e,c?WE(e,c):e,l?WE(e,l):e]},[o,r,l,c]);function m(){s.current.scrollContainers&&(s.current.scrollContainers.forEach(e=>e.removeEventListener("scroll",p,!0)),s.current.scrollContainers=null),s.current.resizeObserver&&(s.current.resizeObserver.disconnect(),s.current.resizeObserver=null),s.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",s.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",s.current.orientationHandler))}function g(){s.current.element&&(s.current.resizeObserver=new i(p),s.current.resizeObserver.observe(s.current.element),t&&s.current.scrollContainers&&s.current.scrollContainers.forEach(e=>e.addEventListener("scroll",p,{capture:!0,passive:!0})),s.current.orientationHandler=()=>{p()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",s.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",s.current.orientationHandler))}return function(e,t){h.useEffect(()=>{if(t){const t=e;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",t,!0)}}},[e,t])}(p,!!t),function(e){h.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[e])}(f),h.useEffect(()=>{m(),g()},[t,p,f]),h.useEffect(()=>m,[]),[e=>{!e||e===s.current.element||(m(),s.current.element=e,s.current.scrollContainers=XE(e),g())},a,d]}function XE(e){const t=[];if(!e||e===document.body)return t;const{overflow:n,overflowX:r,overflowY:i}=window.getComputedStyle(e);return[n,r,i].some(e=>"auto"===e||"scroll"===e)&&t.push(e),[...t,...XE(e.parentElement)]}const qE=["x","y","top","bottom","left","right","width","height"],YE=(e,t)=>qE.every(n=>e[n]===t[n]);function ZE({ref:e,children:t,fallback:n,resize:r,style:i,gl:a,events:o=GE,eventSource:l,eventPrefix:c,shadows:u,linear:d,flat:f,legacy:p,orthographic:m,frameloop:g,dpr:v,performance:y,raycaster:b,camera:x,scene:_,onPointerMissed:w,onCreated:S,...M}){h.useMemo(()=>function(e){if("function"==typeof e){const t=""+lE++;return aE[t]=e,t}Object.assign(aE,e)}(Dw),[]);const E=function(){const e=SM(),t=function(){const e=function(){const e=SM(),[t]=h.useState(()=>new Map);t.clear();let n=e;for(;n;){const e=n.type;EM(e)&&e!==_M&&!t.has(e)&&t.set(e,h.use(xM(e))),n=n.return}return t}();return h.useMemo(()=>Array.from(e.keys()).reduce((t,n)=>r=>h.createElement(t,null,h.createElement(n.Provider,{...r,value:e.get(n)})),e=>h.createElement(wM,{...e})),[e])}();return h.useMemo(()=>({children:n})=>{const r=bM(e,!0,e=>e.type===h.StrictMode)?h.StrictMode:h.Fragment;return s.jsx(r,{children:s.jsx(t,{children:n})})},[e,t])}(),[T,C]=$E({scroll:!0,debounce:{scroll:50,resize:0},...r}),A=h.useRef(null),k=h.useRef(null);h.useImperativeHandle(e,()=>A.current);const R=RM(w),[N,P]=h.useState(!1),[I,L]=h.useState(!1);if(N)throw N;if(I)throw I;const D=h.useRef(null);kM(()=>{const e=A.current;if(C.width>0&&C.height>0&&e){async function n(){await D.current.configure({gl:a,scene:_,events:o,shadows:u,linear:d,flat:f,legacy:p,orthographic:m,frameloop:g,dpr:v,performance:y,raycaster:b,camera:x,size:C,onPointerMissed:(...e)=>null==R.current?void 0:R.current(...e),onCreated:e=>{var t;null==e.events.connect||e.events.connect(l?(t=l)&&t.hasOwnProperty("current")?l.current:l:k.current),c&&e.setEvents({compute:(e,t)=>{const n=e[c+"X"],r=e[c+"Y"];t.pointer.set(n/t.size.width*2-1,-r/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),null==S||S(e)}}),D.current.render(s.jsx(E,{children:s.jsx(PM,{set:L,children:s.jsx(h.Suspense,{fallback:s.jsx(NM,{set:P}),children:null!=t?t:null})})}))}D.current||(D.current=ME(e)),n()}}),h.useEffect(()=>{const e=A.current;if(e)return()=>TE(e)},[]);const z=l?"none":"auto";return s.jsx("div",{ref:k,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:z,...i},...M,children:s.jsx("div",{ref:T,style:{width:"100%",height:"100%"},children:s.jsx("canvas",{ref:A,style:{display:"block"},children:n})})})}function KE(e){return s.jsx(wM,{children:s.jsx(ZE,{...e})})}function JE(){return JE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},JE.apply(null,arguments)}var QE=Object.defineProperty;class eT{constructor(){var e;((e,t,n)=>{t in e?QE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(this,"_listeners"+"",e)}addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}var tT=Object.defineProperty,nT=(e,t,n)=>(((e,t,n)=>{t in e?tT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const rT=new mh,iT=new cm,aT=Math.cos(Math.PI/180*70),oT=(e,t)=>(e%t+t)%t;let sT=class extends eT{constructor(e,t){super(),nT(this,"object"),nT(this,"domElement"),nT(this,"enabled",!0),nT(this,"target",new hd),nT(this,"minDistance",0),nT(this,"maxDistance",1/0),nT(this,"minZoom",0),nT(this,"maxZoom",1/0),nT(this,"minPolarAngle",0),nT(this,"maxPolarAngle",Math.PI),nT(this,"minAzimuthAngle",-1/0),nT(this,"maxAzimuthAngle",1/0),nT(this,"enableDamping",!1),nT(this,"dampingFactor",.05),nT(this,"enableZoom",!0),nT(this,"zoomSpeed",1),nT(this,"enableRotate",!0),nT(this,"rotateSpeed",1),nT(this,"enablePan",!0),nT(this,"panSpeed",1),nT(this,"screenSpacePanning",!0),nT(this,"keyPanSpeed",7),nT(this,"zoomToCursor",!1),nT(this,"autoRotate",!1),nT(this,"autoRotateSpeed",2),nT(this,"reverseOrbit",!1),nT(this,"reverseHorizontalOrbit",!1),nT(this,"reverseVerticalOrbit",!1),nT(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),nT(this,"mouseButtons",{LEFT:Pl.ROTATE,MIDDLE:Pl.DOLLY,RIGHT:Pl.PAN}),nT(this,"touches",{ONE:Il.ROTATE,TWO:Il.DOLLY_PAN}),nT(this,"target0"),nT(this,"position0"),nT(this,"zoom0"),nT(this,"_domElementKeyEvents",null),nT(this,"getPolarAngle"),nT(this,"getAzimuthalAngle"),nT(this,"setPolarAngle"),nT(this,"setAzimuthalAngle"),nT(this,"getDistance"),nT(this,"getZoomScale"),nT(this,"listenToKeyEvents"),nT(this,"stopListenToKeyEvents"),nT(this,"saveState"),nT(this,"reset"),nT(this,"update"),nT(this,"connect"),nT(this,"dispose"),nT(this,"dollyIn"),nT(this,"dollyOut"),nT(this,"getScale"),nT(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=e=>{let t=oT(e,2*Math.PI),r=c.phi;r<0&&(r+=2*Math.PI),t<0&&(t+=2*Math.PI);let i=Math.abs(t-r);2*Math.PI-i<i&&(t<r?t+=2*Math.PI:r+=2*Math.PI),u.phi=t-r,n.update()},this.setAzimuthalAngle=e=>{let t=oT(e,2*Math.PI),r=c.theta;r<0&&(r+=2*Math.PI),t<0&&(t+=2*Math.PI);let i=Math.abs(t-r);2*Math.PI-i<i&&(t<r?t+=2*Math.PI:r+=2*Math.PI),u.theta=t-r,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=e=>{e.addEventListener("keydown",Z),this._domElementKeyEvents=e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Z),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),s=o.NONE},this.update=(()=>{const t=new hd,i=new hd(0,1,0),a=(new dd).setFromUnitVectors(e.up,i),f=a.clone().invert(),p=new hd,m=new dd,g=2*Math.PI;return function(){const v=n.object.position;a.setFromUnitVectors(e.up,i),f.copy(a).invert(),t.copy(v).sub(n.target),t.applyQuaternion(a),c.setFromVector3(t),n.autoRotate&&s===o.NONE&&A(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(c.theta+=u.theta*n.dampingFactor,c.phi+=u.phi*n.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);let y=n.minAzimuthAngle,b=n.maxAzimuthAngle;isFinite(y)&&isFinite(b)&&(y<-Math.PI?y+=g:y>Math.PI&&(y-=g),b<-Math.PI?b+=g:b>Math.PI&&(b-=g),c.theta=y<=b?Math.max(y,Math.min(b,c.theta)):c.theta>(y+b)/2?Math.max(y,c.theta):Math.min(b,c.theta)),c.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,c.phi)),c.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(h,n.dampingFactor):n.target.add(h),n.zoomToCursor&&M||n.object.isOrthographicCamera?c.radius=O(c.radius):c.radius=O(c.radius*d),t.setFromSpherical(c),t.applyQuaternion(f),v.copy(n.target).add(t),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),!0===n.enableDamping?(u.theta*=1-n.dampingFactor,u.phi*=1-n.dampingFactor,h.multiplyScalar(1-n.dampingFactor)):(u.set(0,0,0),h.set(0,0,0));let x=!1;if(n.zoomToCursor&&M){let r=null;if(n.object instanceof rp&&n.object.isPerspectiveCamera){const e=t.length();r=O(e*d);const i=e-r;n.object.position.addScaledVector(w,i),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const e=new hd(S.x,S.y,0);e.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/d)),n.object.updateProjectionMatrix(),x=!0;const i=new hd(S.x,S.y,0);i.unproject(n.object),n.object.position.sub(i).add(e),n.object.updateMatrixWorld(),r=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;null!==r&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(r).add(n.object.position):(rT.origin.copy(n.object.position),rT.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(rT.direction))<aT?e.lookAt(n.target):(iT.setFromNormalAndCoplanarPoint(n.object.up,n.target),rT.intersectPlane(iT,n.target))))}else n.object instanceof Ny&&n.object.isOrthographicCamera&&(x=1!==d,x&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/d)),n.object.updateProjectionMatrix()));return d=1,M=!1,!!(x||p.distanceToSquared(n.object.position)>l||8*(1-m.dot(n.object.quaternion))>l)&&(n.dispatchEvent(r),p.copy(n.object.position),m.copy(n.object.quaternion),x=!1,!0)}})(),this.connect=e=>{n.domElement=e,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",K),n.domElement.addEventListener("pointerdown",$),n.domElement.addEventListener("pointercancel",q),n.domElement.addEventListener("wheel",Y)},this.dispose=()=>{var e,t,r,i,a,o;n.domElement&&(n.domElement.style.touchAction="auto"),null==(e=n.domElement)||e.removeEventListener("contextmenu",K),null==(t=n.domElement)||t.removeEventListener("pointerdown",$),null==(r=n.domElement)||r.removeEventListener("pointercancel",q),null==(i=n.domElement)||i.removeEventListener("wheel",Y),null==(a=n.domElement)||a.ownerDocument.removeEventListener("pointermove",X),null==(o=n.domElement)||o.ownerDocument.removeEventListener("pointerup",q),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",Z)};const n=this,r={type:"change"},i={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=o.NONE;const l=1e-6,c=new Tb,u=new Tb;let d=1;const h=new hd,f=new ud,p=new ud,m=new ud,g=new ud,v=new ud,y=new ud,b=new ud,x=new ud,_=new ud,w=new hd,S=new ud;let M=!1;const E=[],T={};function C(){return Math.pow(.95,n.zoomSpeed)}function A(e){n.reverseOrbit||n.reverseHorizontalOrbit?u.theta+=e:u.theta-=e}function k(e){n.reverseOrbit||n.reverseVerticalOrbit?u.phi+=e:u.phi-=e}const R=(()=>{const e=new hd;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),h.add(e)}})(),N=(()=>{const e=new hd;return function(t,r){!0===n.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),h.add(e)}})(),P=(()=>{const e=new hd;return function(t,r){const i=n.domElement;if(i&&n.object instanceof rp&&n.object.isPerspectiveCamera){const a=n.object.position;e.copy(a).sub(n.target);let o=e.length();o*=Math.tan(n.object.fov/2*Math.PI/180),R(2*t*o/i.clientHeight,n.object.matrix),N(2*r*o/i.clientHeight,n.object.matrix)}else i&&n.object instanceof Ny&&n.object.isOrthographicCamera?(R(t*(n.object.right-n.object.left)/n.object.zoom/i.clientWidth,n.object.matrix),N(r*(n.object.top-n.object.bottom)/n.object.zoom/i.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function I(e){n.object instanceof rp&&n.object.isPerspectiveCamera||n.object instanceof Ny&&n.object.isOrthographicCamera?d=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function L(e){I(d/e)}function D(e){I(d*e)}function z(e){if(!n.zoomToCursor||!n.domElement)return;M=!0;const t=n.domElement.getBoundingClientRect(),r=e.clientX-t.left,i=e.clientY-t.top,a=t.width,o=t.height;S.x=r/a*2-1,S.y=-i/o*2+1,w.set(S.x,S.y,1).unproject(n.object).sub(n.object.position).normalize()}function O(e){return Math.max(n.minDistance,Math.min(n.maxDistance,e))}function U(e){f.set(e.clientX,e.clientY)}function F(e){g.set(e.clientX,e.clientY)}function B(){if(1==E.length)f.set(E[0].pageX,E[0].pageY);else{const e=.5*(E[0].pageX+E[1].pageX),t=.5*(E[0].pageY+E[1].pageY);f.set(e,t)}}function j(){if(1==E.length)g.set(E[0].pageX,E[0].pageY);else{const e=.5*(E[0].pageX+E[1].pageX),t=.5*(E[0].pageY+E[1].pageY);g.set(e,t)}}function H(){const e=E[0].pageX-E[1].pageX,t=E[0].pageY-E[1].pageY,n=Math.sqrt(e*e+t*t);b.set(0,n)}function V(e){if(1==E.length)p.set(e.pageX,e.pageY);else{const t=Q(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);p.set(n,r)}m.subVectors(p,f).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(A(2*Math.PI*m.x/t.clientHeight),k(2*Math.PI*m.y/t.clientHeight)),f.copy(p)}function G(e){if(1==E.length)v.set(e.pageX,e.pageY);else{const t=Q(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);v.set(n,r)}y.subVectors(v,g).multiplyScalar(n.panSpeed),P(y.x,y.y),g.copy(v)}function W(e){const t=Q(e),r=e.pageX-t.x,i=e.pageY-t.y,a=Math.sqrt(r*r+i*i);x.set(0,a),_.set(0,Math.pow(x.y/b.y,n.zoomSpeed)),L(_.y),b.copy(x)}function $(e){var t,r;!1!==n.enabled&&(0===E.length&&(null==(t=n.domElement)||t.ownerDocument.addEventListener("pointermove",X),null==(r=n.domElement)||r.ownerDocument.addEventListener("pointerup",q)),function(e){E.push(e)}(e),"touch"===e.pointerType?function(e){switch(J(e),E.length){case 1:switch(n.touches.ONE){case Il.ROTATE:if(!1===n.enableRotate)return;B(),s=o.TOUCH_ROTATE;break;case Il.PAN:if(!1===n.enablePan)return;j(),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(n.touches.TWO){case Il.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&H(),n.enablePan&&j(),s=o.TOUCH_DOLLY_PAN;break;case Il.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&H(),n.enableRotate&&B(),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&n.dispatchEvent(i)}(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Pl.DOLLY:if(!1===n.enableZoom)return;!function(e){z(e),b.set(e.clientX,e.clientY)}(e),s=o.DOLLY;break;case Pl.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;F(e),s=o.PAN}else{if(!1===n.enableRotate)return;U(e),s=o.ROTATE}break;case Pl.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;U(e),s=o.ROTATE}else{if(!1===n.enablePan)return;F(e),s=o.PAN}break;default:s=o.NONE}s!==o.NONE&&n.dispatchEvent(i)}(e))}function X(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(J(e),s){case o.TOUCH_ROTATE:if(!1===n.enableRotate)return;V(e),n.update();break;case o.TOUCH_PAN:if(!1===n.enablePan)return;G(e),n.update();break;case o.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&W(e),n.enablePan&&G(e)}(e),n.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&W(e),n.enableRotate&&V(e)}(e),n.update();break;default:s=o.NONE}}(e):function(e){if(!1!==n.enabled)switch(s){case o.ROTATE:if(!1===n.enableRotate)return;!function(e){p.set(e.clientX,e.clientY),m.subVectors(p,f).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(A(2*Math.PI*m.x/t.clientHeight),k(2*Math.PI*m.y/t.clientHeight)),f.copy(p),n.update()}(e);break;case o.DOLLY:if(!1===n.enableZoom)return;!function(e){x.set(e.clientX,e.clientY),_.subVectors(x,b),_.y>0?L(C()):_.y<0&&D(C()),b.copy(x),n.update()}(e);break;case o.PAN:if(!1===n.enablePan)return;!function(e){v.set(e.clientX,e.clientY),y.subVectors(v,g).multiplyScalar(n.panSpeed),P(y.x,y.y),g.copy(v),n.update()}(e)}}(e))}function q(e){var t,r,i;!function(e){delete T[e.pointerId];for(let t=0;t<E.length;t++)if(E[t].pointerId==e.pointerId)return void E.splice(t,1)}(e),0===E.length&&(null==(t=n.domElement)||t.releasePointerCapture(e.pointerId),null==(r=n.domElement)||r.ownerDocument.removeEventListener("pointermove",X),null==(i=n.domElement)||i.ownerDocument.removeEventListener("pointerup",q)),n.dispatchEvent(a),s=o.NONE}function Y(e){!1===n.enabled||!1===n.enableZoom||s!==o.NONE&&s!==o.ROTATE||(e.preventDefault(),n.dispatchEvent(i),function(e){z(e),e.deltaY<0?D(C()):e.deltaY>0&&L(C()),n.update()}(e),n.dispatchEvent(a))}function Z(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:P(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:P(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:P(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:P(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function K(e){!1!==n.enabled&&e.preventDefault()}function J(e){let t=T[e.pointerId];void 0===t&&(t=new ud,T[e.pointerId]=t),t.set(e.pageX,e.pageY)}function Q(e){const t=e.pointerId===E[0].pointerId?E[1]:E[0];return T[t.pointerId]}this.dollyIn=(e=C())=>{D(e),n.update()},this.dollyOut=(e=C())=>{L(e),n.update()},this.getScale=()=>d,this.setScale=e=>{I(e),n.update()},this.getZoomScale=()=>C(),void 0!==t&&this.connect(t),this.update()}};const lT=h.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:r,enableDamping:i=!0,keyEvents:a=!1,onChange:o,onStart:s,onEnd:l,...c},u)=>{const d=nE(e=>e.invalidate),f=nE(e=>e.camera),p=nE(e=>e.gl),m=nE(e=>e.events),g=nE(e=>e.setEvents),v=nE(e=>e.set),y=nE(e=>e.get),b=nE(e=>e.performance),x=t||f,_=r||m.connected||p.domElement,w=h.useMemo(()=>new sT(x),[x]);return rE(()=>{w.enabled&&w.update()},-1),h.useEffect(()=>(a&&w.connect(!0===a?_:a),w.connect(_),()=>{w.dispose()}),[a,_,n,w,d]),h.useEffect(()=>{const e=e=>{d(),n&&b.regress(),o&&o(e)},t=e=>{s&&s(e)},r=e=>{l&&l(e)};return w.addEventListener("change",e),w.addEventListener("start",t),w.addEventListener("end",r),()=>{w.removeEventListener("start",t),w.removeEventListener("end",r),w.removeEventListener("change",e)}},[o,s,l,w,d,g]),h.useEffect(()=>{if(e){const e=y().controls;return v({controls:w}),()=>v({controls:e})}},[e,w]),h.createElement("primitive",JE({ref:u,object:w,enableDamping:i},c))});function cT(e,t){const n=e+"Geometry";return h.forwardRef(({args:e,children:r,...i},a)=>{const o=h.useRef(null);return h.useImperativeHandle(a,()=>o.current),h.useLayoutEffect(()=>{null==t||t(o.current)}),h.createElement("mesh",JE({ref:o},i),h.createElement(n,{attach:"geometry",args:e}),r)})}const uT=cT("plane"),dT=e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:0,g:0,b:0}};function hT(e,t){h.useEffect(()=>{if(null==e?void 0:e.uniforms)for(const n of t)for(const t of n.data.params)if("slider"===t.type||"color"===t.type){const r=`u_${n.id.replace(/-/g,"_")}_${t.id}`;if(e.uniforms[r]){const n=e.uniforms[r];if("color"===t.type){const{r:e,g:r,b:i}=dT(t.value);n.value.set(e/255,r/255,i/255)}else n.value=t.value}}},[t,e])}const fT=()=>{const{invalidate:e}=nE(),t=Rl(e=>e.filteringMode),n=Uw(e=>e.bakedTexture);return h.useEffect(()=>{if(!n)return;const r="nearest"===t?xc:Sc;n.minFilter===r&&n.magFilter===r||(n.minFilter=r,n.magFilter=r,n.needsUpdate=!0,e())},[n,t,e]),null};function pT({isBaked:e,bakedTexture:t,tiling:n,generatedShader:r,channelMask:i,filteringMode:a,volume:o=!1,density:s=1,raymarchSteps:l=100}){const c={vertexShader:"\n  varying vec3 v_world_pos;\n  void main() {\n    v_world_pos = (modelMatrix * vec4(position, 1.0)).xyz;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }\n",transparent:o},u=new Ud(i.r?1:0,i.g?1:0,i.b?1:0,i.a?1:0),d={};if(r.uniforms)for(const[f,p]of r.uniforms.entries()){let e;if("vec3"===p.type){const{r:t,g:n,b:r}=dT(p.value);e=new hd(t/255,n/255,r/255)}else e=p.value;d[f]={value:e}}if(e&&t){const e=o?tl:"",i=o?"\n  varying vec3 v_world_pos; uniform float u_time; uniform float u_density; uniform vec3 u_camera_pos;\n  uniform sampler3D u_baked_texture; uniform float u_tiling; uniform vec4 u_channel_mask; uniform vec3 u_texture_res; uniform bool u_use_bicubic;\n  __PREAMBLE__\n  vec4 getNoise(vec3 p) { \n      vec3 uvw = fract((p + 0.5) * u_tiling);\n      if (u_use_bicubic) {\n          return textureBicubic(u_baked_texture, uvw, u_texture_res);\n      }\n      return texture(u_baked_texture, uvw);\n  }\n  __RAYMARCHING_CODE__\n  void main() { vec3 dir = normalize(v_world_pos - u_camera_pos); gl_FragColor = raymarch(u_camera_pos, dir); }\n":"\n  uniform sampler3D u_baked_texture; uniform float u_tiling; uniform vec4 u_channel_mask; varying vec3 v_world_pos; uniform vec3 u_texture_res; uniform bool u_use_bicubic;\n  __PREAMBLE__\n  void main() {\n    vec3 uvw = fract((v_world_pos + 0.5) * u_tiling);\n    vec4 noise;\n    if (u_use_bicubic) {\n        noise = textureBicubic(u_baked_texture, uvw, u_texture_res);\n    } else {\n        noise = texture(u_baked_texture, uvw);\n    }\n    gl_FragColor = vec4(getPreviewColor(noise, u_channel_mask), 1.0);\n  }\n";c.fragmentShader=i.replace("__PREAMBLE__",(null==r?void 0:r.preamble)??"").replace("__RAYMARCHING_CODE__",e),c.uniforms={...d,u_baked_texture:{value:t},u_tiling:{value:n},u_channel_mask:{value:u},u_texture_res:{value:new hd(t.image.width,t.image.height,t.image.depth)},u_use_bicubic:{value:"tricubic"===a},...o?{u_density:{value:s},u_camera_pos:{value:new hd},u_raymarch_steps:{value:Math.round(l)}}:{}}}else{const e=o?tl:"",t=o?"\n  varying vec3 v_world_pos; uniform float u_time; uniform float u_density; uniform vec3 u_camera_pos; uniform vec4 u_channel_mask;\n  __PREAMBLE__\n  __NOISE_FUNCTION__\n  __RAYMARCHING_CODE__\n  void main() { vec3 dir = normalize(v_world_pos - u_camera_pos); gl_FragColor = raymarch(u_camera_pos, dir); }\n":"\n  varying vec3 v_world_pos; uniform float u_time; uniform vec4 u_channel_mask;\n  __PREAMBLE__\n  __NOISE_FUNCTION__\n  void main() { gl_FragColor = vec4(getPreviewColor(getNoise(v_world_pos), u_channel_mask), 1.0); }\n";c.fragmentShader=t.replace("__PREAMBLE__",(null==r?void 0:r.preamble)??"").replace("__NOISE_FUNCTION__",(null==r?void 0:r.noiseFunction)??"").replace("__RAYMARCHING_CODE__",e),c.uniforms={...d,u_time:{value:0},u_channel_mask:{value:u},...o?{u_density:{value:s},u_camera_pos:{value:new hd},u_raymarch_steps:{value:Math.round(l)}}:{}}}o||(c.side=2);const h=new Jf(c);return h.depthWrite=!o,h.depthTest=!o,h}const mT=({visible:e})=>{const t=Xw(e=>e.nodes),{shape:n,tiling:r,channelMask:i,filteringMode:a}=Rl(),o=Xw(e=>e.generatedShader),{bakedTexture:l}=Uw(),{invalidate:c}=nE(),u=h.useMemo(()=>{switch(n){case"sphere":return new Mv(.5,64,64);case"torus":return new Tv(.4,.1,32,100);default:return new Xf(1,1,1)}},[n]);h.useEffect(()=>()=>u.dispose(),[u]);const d=h.useMemo(()=>pT({isBaked:Boolean(l),bakedTexture:l??null,tiling:r,generatedShader:o,channelMask:i,volume:!1,filteringMode:a}),[l,r,o,i,a]);return hT(d,t),h.useEffect(()=>(c(),()=>d.dispose()),[d,c]),rE(({clock:e})=>{(null==d?void 0:d.uniforms)&&(l?d.uniforms.u_tiling.value=r:d.uniforms.u_time.value=e.getElapsedTime(),d.uniforms.u_channel_mask.value.set(i.r?1:0,i.g?1:0,i.b?1:0,i.a?1:0))}),s.jsx("mesh",{visible:e,geometry:u,material:d})},gT=({visible:e})=>{const t=Xw(e=>e.nodes),{density:n,tiling:r,raymarchSteps:i,channelMask:a,filteringMode:o}=Rl(),l=Xw(e=>e.generatedShader),{bakedTexture:c}=Uw(),{invalidate:u}=nE(),d=h.useMemo(()=>pT({isBaked:Boolean(c),bakedTexture:c??null,tiling:r,generatedShader:l,channelMask:a,volume:!0,density:n,raymarchSteps:i,filteringMode:o}),[c,r,l,a,o]);hT(d,t),h.useEffect(()=>(u(),()=>d.dispose()),[d,u]),rE(({camera:e,clock:t})=>{(null==d?void 0:d.uniforms)&&(d.uniforms.u_camera_pos.value.copy(e.position),d.uniforms.u_density.value=n,d.uniforms.u_raymarch_steps.value=Math.round(i),c?d.uniforms.u_tiling.value=r:d.uniforms.u_time.value=t.getElapsedTime(),d.uniforms.u_channel_mask.value.set(a.r?1:0,a.g?1:0,a.b?1:0,a.a?1:0))});const f=h.useMemo(()=>new Xf(1,1,1),[]);return h.useEffect(()=>()=>f.dispose(),[f]),s.jsx("mesh",{visible:e,geometry:f,material:d})},vT=({visible:e})=>{const t=Xw(e=>e.nodes),{slice:n,tiling:r,channelMask:i,filteringMode:a}=Rl(),o=Xw(e=>e.generatedShader),{bakedTexture:l}=Uw(),{invalidate:c}=nE(),u=h.useMemo(()=>pT({isBaked:Boolean(l),bakedTexture:l??null,tiling:r,generatedShader:o,channelMask:i,volume:!1,filteringMode:a}),[l,r,o,i,a]);return hT(u,t),h.useEffect(()=>(c(),()=>u.dispose()),[u,c]),rE(({clock:e})=>{(null==u?void 0:u.uniforms)&&(l?u.uniforms.u_tiling.value=r:u.uniforms.u_time.value=e.getElapsedTime(),u.uniforms.u_channel_mask.value.set(i.r?1:0,i.g?1:0,i.b?1:0,i.a?1:0))}),s.jsxs("group",{visible:e,children:[s.jsx(uT,{args:[1,1],position:[n.x-.5,0,0],rotation:[0,Math.PI/2,0],material:u}),s.jsx(uT,{args:[1,1],position:[0,n.y-.5,0],rotation:[-Math.PI/2,0,0],material:u}),s.jsx(uT,{args:[1,1],position:[0,0,n.z-.5],material:u})]})},yT=()=>{const e=nE(e=>e.invalidate),t=h.useCallback(()=>{e()},[e]);return s.jsx(lT,{makeDefault:!0,onChange:t})},bT=()=>{const{displayMode:e}=Rl(),t="surface"===e,n="volume"===e,r="slice"===e;return s.jsxs(s.Fragment,{children:[s.jsx("ambientLight",{intensity:.8}),s.jsx("pointLight",{position:[10,10,10],intensity:.5}),s.jsxs("group",{children:[s.jsx(mT,{visible:t}),s.jsx(gT,{visible:n}),s.jsx(vT,{visible:r})]}),s.jsx(yT,{})]})},xT=()=>{const{sliceAxis2D:e,slicePosition2D:t,zoom2D:n,offset2D:r,channelMask:i,tiling:a,filteringMode:o}=Rl(),l=Xw(e=>e.generatedShader),c=Xw(e=>e.nodes),{bakedTexture:u}=Uw(),d=Boolean(u),f={x:0,y:1,z:2},{size:p}=nE(),m=h.useMemo(()=>{const s={u_time:{value:0},u_channel_mask:{value:new Ud(i.r?1:0,i.g?1:0,i.b?1:0,i.a?1:0)},u_zoom:{value:n},u_offset:{value:new ud(r.x,r.y)},u_slice_axis:{value:f[e]},u_slice_pos:{value:t},u_tiling:{value:a},u_baked_texture:{value:u},u_use_bicubic:{value:d&&"tricubic"===o},u_texture_res:{value:u?new hd(u.image.width,u.image.height,u.image.depth):new hd(1,1,1)},u_resolution:{value:new ud(p.width,p.height)}};if(l.uniforms)for(const[e,t]of l.uniforms.entries()){let n;if("vec3"===t.type){const{r:e,g:r,b:i}=dT(t.value);n=new hd(e/255,r/255,i/255)}else n=t.value;s[e]={value:n}}return new Jf({defines:{SUPERSAMPLING_FACTOR:1,IS_BAKED:d},vertexShader:"\nvarying vec2 vUv;void main(){vUv=uv;gl_Position=vec4(position,1.);}",fragmentShader:nl.replace("__PREAMBLE__",l.preamble).replace("__NOISE_FUNCTION__",d?"":l.noiseFunction),uniforms:s})},[l,u,d,o]);return hT(m,c),h.useEffect(()=>()=>m.dispose(),[m]),rE(({clock:o,size:s})=>{m.uniforms.u_resolution.value.set(s.width,s.height),m.uniforms.u_zoom.value=n,m.uniforms.u_offset.value.set(r.x,r.y),m.uniforms.u_slice_axis.value=f[e],m.uniforms.u_slice_pos.value=t,m.uniforms.u_channel_mask.value.set(i.r?1:0,i.g?1:0,i.b?1:0,i.a?1:0),d?m.uniforms.u_tiling.value=a:m.uniforms.u_time.value=o.getElapsedTime()}),s.jsx(uT,{args:[2,2],children:s.jsx("primitive",{object:m,attach:"material"})})},_T=()=>{const{invalidate:e}=nE(),{isPlaying:t,fpsLimit:n,hasInitiallyRendered:r,setHasInitiallyRendered:i}=Rl(),a=h.useRef(null);return h.useEffect(()=>{if(!t)return;let r=performance.now();const i=t=>{if(a.current=requestAnimationFrame(i),Number.isFinite(n)){const i=1e3/Math.max(1,n),a=t-r;a>=i&&(r=t-a%i,e())}else e()};return a.current=requestAnimationFrame(i),()=>{a.current&&(cancelAnimationFrame(a.current),a.current=null)}},[t,n,e]),h.useEffect(()=>{if(t)return;const n=()=>{e()};let a={shader:Xw.getState().generatedShader,nodes:Xw.getState().nodes};const o=Xw.subscribe(e=>{const t={shader:e.generatedShader,nodes:e.nodes},r=a,i=t;let o=!0;if(r.shader!==i.shader||r.nodes.length!==i.nodes.length)o=!1;else for(let n=0;n<i.nodes.length;n++)if(r.nodes[n].data.params!==i.nodes[n].data.params){o=!1;break}o||n(),a=t}),s=Uw.subscribe(n),l=Rl.subscribe(n);return r||(e(),i(!0)),()=>{o(),s(),l()}},[t,e,r,i]),null},wT=()=>{const{isBaking:e,bakingProgress:t,isCompiling:n}=Uw();return e?s.jsxs("div",{className:"absolute inset-0 bg-[var(--color-bg-900)] bg-opacity-75 flex flex-col items-center justify-center z-10",children:[s.jsx("h3",{className:"text-xl font-bold mb-4 text-[var(--color-text-100)]",children:n?"Compiling Shaders...":"Baking Texture..."}),!n&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-1/2 bg-[var(--color-bg-700)] rounded-full h-2.5",children:s.jsx("div",{className:"bg-[var(--color-accent-primary)] h-2.5 rounded-full transition-all duration-150",style:{width:100*t+"%"}})}),s.jsxs("p",{className:"mt-2 text-sm text-[var(--color-text-300)]",children:[(100*t).toFixed(0),"%"]})]})]}):null},ST=({onClick:e,label:t,isActive:n})=>s.jsx("button",{onClick:e,"aria-label":`Toggle ${t} channel`,className:"w-8 h-8 rounded text-sm font-bold transition-all duration-150 border flex items-center justify-center shadow-md "+(n?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)] border-transparent":"bg-[var(--color-bg-700)] hover:bg-[var(--color-bg-600)] text-[var(--color-text-300)] border-[var(--color-border-700)]"),children:t}),MT=()=>{const{channelMask:e,setChannelMask:t}=Rl();return s.jsxs("div",{className:"absolute top-4 left-4 z-10 flex items-center space-x-2",children:[s.jsx(ST,{onClick:()=>t("r"),label:"R",isActive:e.r}),s.jsx(ST,{onClick:()=>t("g"),label:"G",isActive:e.g}),s.jsx(ST,{onClick:()=>t("b"),label:"B",isActive:e.b}),s.jsx(ST,{onClick:()=>t("a"),label:"A",isActive:e.a})]})},ET=()=>{const{fpsLimit:e,setFpsLimit:t}=Rl(),n=h.useCallback(()=>{t(e<=15?60:e<=60?1/0:15)},[e,t]),r=Number.isFinite(e)?e<=15?"15":"60":"Max";return s.jsxs("button",{onClick:n,className:"absolute top-4 right-4 z-10 px-3 py-1.5 rounded-md text-sm font-bold shadow-md bg-[var(--color-bg-700)] hover:bg-[var(--color-bg-600)] text-[var(--color-text-300)] transition-colors",title:`Toggle FPS (current: ${r})`,"aria-live":"polite",children:[r," ",s.jsx("span",{className:"ml-1 text-xs",children:"FPS"})]})},TT=()=>{const{filteringMode:e,setFilteringMode:t}=Rl(),{bakedTexture:n}=Uw(),r=!n,i=h.useMemo(()=>[{value:"nearest",label:"Nearest"},{value:"trilinear",label:"Trilinear"},{value:"tricubic",label:"Tricubic"}],[]);return s.jsx("div",{className:"absolute bottom-4 right-4 z-10",children:s.jsx($S,{value:e,onChange:e=>t(e),disabled:r,options:i,className:"w-28",selectClassName:"px-2 py-1.5 text-xs"})})},CT=()=>{const{setZoom2D:e,setOffset2D:t}=Rl(),n=h.useRef(!1),r=h.useRef({x:0,y:0}),i=nE(e=>e.gl),a=h.useCallback(e=>{n.current=!0,r.current={x:e.clientX,y:e.clientY},e.target.setPointerCapture(e.pointerId)},[]),o=h.useCallback(e=>{if(!n.current)return;const{clientX:a,clientY:o}=e,s=a-r.current.x,l=o-r.current.y;r.current={x:a,y:o},t(e=>{const t=Rl.getState().zoom2D,{height:n}=i.domElement.getBoundingClientRect(),r=2/n;return{x:e.x+s*r*t,y:e.y-l*r*t}})},[t,i]),s=h.useCallback(e=>{n.current=!1,e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)},[]),l=h.useCallback(t=>{t.preventDefault(),e(e=>Math.max(.01,e*(1+.001*t.deltaY)))},[e]);return h.useEffect(()=>{const e=i.domElement;return e.addEventListener("wheel",l),e.addEventListener("pointerdown",a),e.addEventListener("pointermove",o),e.addEventListener("pointerup",s),e.addEventListener("pointerleave",s),()=>{e.removeEventListener("wheel",l),e.removeEventListener("pointerdown",a),e.removeEventListener("pointermove",o),e.removeEventListener("pointerup",s),e.removeEventListener("pointerleave",s)}},[i,l,a,o,s]),null},AT=()=>{const e=h.useMemo(()=>({position:[0,0,2],fov:50}),[]);return s.jsxs(KE,{frameloop:"demand",camera:e,children:[s.jsx(_T,{}),s.jsx(fT,{}),s.jsx(bT,{})]})},kT=()=>{const e=h.useMemo(()=>({zoom:1,position:[0,0,1]}),[]);return s.jsxs(KE,{frameloop:"demand",orthographic:!0,camera:e,children:[s.jsx(_T,{}),s.jsx(fT,{}),s.jsx(xT,{}),s.jsx(CT,{})]})},RT=f.memo(()=>{const e=Rl(e=>e.displayMode),t=h.useRef(null),[n,r]=h.useState(!1);h.useEffect(()=>{const e=()=>{r(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>{document.removeEventListener("fullscreenchange",e)}},[]);const i=h.useCallback(()=>{t.current&&(n?document.exitFullscreen():t.current.requestFullscreen())},[n]);return s.jsxs("div",{ref:t,className:"relative w-full h-full bg-[var(--color-bg-900)] cursor-grab active:cursor-grabbing",children:[s.jsx(wT,{}),s.jsx(MT,{}),s.jsx(ET,{}),s.jsx(TT,{}),s.jsx("button",{onClick:i,className:"absolute bottom-4 left-4 z-10 w-8 h-8 flex items-center justify-center rounded bg-[var(--color-bg-700)] hover:bg-[var(--color-bg-600)] text-[var(--color-text-300)] border border-[var(--color-border-700)] transition-colors shadow-md",title:n?"Exit Fullscreen":"Enter Fullscreen","aria-label":n?"Exit Fullscreen":"Enter Fullscreen",children:n?s.jsx(AS,{className:"w-5 h-5"}):s.jsx(CS,{className:"w-5 h-5"})}),"2d"===e?s.jsx(kT,{}):s.jsx(AT,{})]})}),NT=({displayAs:e="icon-button"})=>{const{accentColor:t,setAccentColor:n,themeMode:r,setThemeMode:i,brightness:a,setBrightness:o,saturation:l,setSaturation:c}=xl(),[u,d]=h.useState(!1),f=h.useRef(null),[p,m]=h.useState(t);h.useEffect(()=>{m(t)},[t]),GS(f,()=>d(!1));const g=()=>{let e=p.startsWith("#")?p:`#${p}`;/^#[0-9A-F]{6}$/i.test(e)?n(e):m(t)};return s.jsxs("div",{className:"relative",ref:f,children:["menu-item"===e?s.jsxs("button",{onClick:()=>d(e=>!e),className:"flex items-center justify-between w-full px-3 py-2 text-left text-sm rounded-md text-[var(--color-text-200)] hover:bg-[var(--color-bg-700)] hover:text-[var(--color-text-100)] transition-colors",title:"Change theme","aria-label":"Open theme customizer",children:[s.jsx("span",{children:"Customize Theme"}),s.jsx("div",{className:"w-5 h-5 ml-3 rounded-full border-2 border-[var(--color-text-400)]",style:{backgroundColor:t}})]}):s.jsx("button",{onClick:()=>d(e=>!e),className:"flex items-center justify-center w-10 h-10 rounded-md cursor-pointer bg-[var(--color-bg-700)] hover:bg-[var(--color-bg-600)] transition-colors",title:"Change theme","aria-label":"Open theme customizer",children:s.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-[var(--color-text-400)]",style:{backgroundColor:t}})}),u&&s.jsx("div",{className:"absolute top-12 right-0 bg-[var(--color-bg-800)] border border-[var(--color-border-700)] rounded-lg shadow-2xl p-4 z-[51] w-64",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx(VS,{value:t,onChange:n}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{htmlFor:"hex-color-input",className:"text-sm font-medium text-[var(--color-text-200)]",children:"Hex"}),s.jsx("input",{id:"hex-color-input",type:"text",value:p,onChange:e=>m(e.target.value),onBlur:g,onKeyDown:e=>{"Enter"===e.key?(g(),e.currentTarget.blur()):"Escape"===e.key&&(m(t),e.currentTarget.blur())},className:"w-24 bg-[var(--color-bg-700)] border border-[var(--color-border-600)] rounded-md px-2 py-1 font-mono text-sm text-[var(--color-text-100)] focus:outline-none focus:ring-2 focus:ring-[var(--color-accent-primary)]"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"brightness-slider",className:"text-sm font-medium text-[var(--color-text-200)]",children:"Brightness"}),s.jsx("input",{id:"brightness-slider",type:"range",min:"0",max:"100",value:a,onChange:e=>o(Number(e.target.value)),className:"w-full h-2 bg-[var(--color-bg-600)] rounded-lg appearance-none cursor-pointer accent-[var(--color-accent-primary)]"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"saturation-slider",className:"text-sm font-medium text-[var(--color-text-200)]",children:"Saturation"}),s.jsx("input",{id:"saturation-slider",type:"range",min:"0",max:"100",value:l,onChange:e=>c(Number(e.target.value)),className:"w-full h-2 bg-[var(--color-bg-600)] rounded-lg appearance-none cursor-pointer accent-[var(--color-accent-primary)]"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm font-medium text-[var(--color-text-200)]",children:"Mode"}),s.jsx("button",{onClick:()=>{i("dark"===r?"light":"dark")},className:"flex items-center justify-center w-10 h-8 rounded-md bg-[var(--color-bg-700)] hover:bg-[var(--color-bg-600)] text-[var(--color-text-200)] transition-colors",title:`Switch to ${"dark"===r?"light":"dark"} mode`,"aria-label":`Switch to ${"dark"===r?"light":"dark"} mode`,children:"dark"===r?s.jsx(xS,{className:"w-5 h-5"}):s.jsx(_S,{className:"w-5 h-5"})})]})]})})]})},PT=({isMobile:e})=>{const{name:t,setName:n}=pl(),[r,i]=h.useState(!1),a=h.useRef(null);h.useEffect(()=>{r&&a.current&&(a.current.focus(),a.current.select())},[r]);const o="unnamed"===t,l=o?"Unnamed":t,c=r&&o?"":t;return s.jsx("div",{className:"relative flex items-center",children:r?s.jsx("input",{ref:a,type:"text",value:c,placeholder:l,onChange:e=>n(e.target.value),onBlur:()=>{""===t.trim()&&n("unnamed"),i(!1)},onKeyDown:e=>{var t;"Enter"===e.key?e.currentTarget.blur():"Escape"===e.key&&(n((null==(t=a.current)?void 0:t.placeholder)||"unnamed"),i(!1))},className:"bg-[var(--color-bg-700)] text-left text-[var(--color-text-200)] font-semibold rounded-md ring-2 ring-[var(--color-accent-primary)] outline-none "+(e?"text-base px-2 py-1 w-full":"text-lg px-3 py-1"),"aria-label":"Workspace Name"}):s.jsxs("button",{onClick:()=>i(!0),className:"flex items-center bg-transparent text-left text-[var(--color-text-200)] font-semibold rounded-md hover:bg-[var(--color-bg-800)] focus:bg-[var(--color-bg-800)] focus:ring-2 focus:ring-[var(--color-accent-primary)] focus:outline-none transition-colors "+(e?"text-base px-2 py-1 w-full":"text-lg px-3 py-1 min-w-[120px]"),"aria-label":"Edit Workspace Name",children:[s.jsx("span",{className:"truncate",children:l}),o&&s.jsx("span",{className:"ml-1 font-normal text-[var(--color-accent-text)] animate-blink",children:"|"})]})})},IT=[64,128,256,512,1024,2048],LT=[16,32,64,128,256],DT=[{value:1,label:"1x (None)"},{value:2,label:"2x (Fast AA)"},{value:3,label:"3x (Good Quality)"},{value:4,label:"4x (High Quality)"},{value:5,label:"5x (Ultra Quality)"}],zT=({isMobile:e})=>{const[t,n]=h.useState(!1),r=h.useRef(null);GS(r,()=>n(!1));const{isBaking:i,isCompiling:a,bakingProgress:o,bakeTexture:l,lastBakeSettings:c}=Uw(),{generatedShader:u,nodes:d}=Xw(),[f,p]=h.useState(c.resolution),[m,g]=h.useState(c.depth),[v,y]=h.useState(c.supersampling),b=a?"Compiling...":i?`Baking... (${(100*o).toFixed(0)}%)`:"Bake",x=e?"p-2 rounded-full text-[var(--color-text-300)] hover:bg-[var(--color-bg-700)]":"w-10 h-10 flex items-center justify-center rounded-md bg-[var(--color-bg-700)] hover:bg-[var(--color-accent-primary)] text-[var(--color-text-300)] transition-colors";return s.jsxs("div",{ref:r,className:"relative",children:[s.jsx("button",{onClick:()=>n(e=>!e),className:x,title:"Bake Menu","aria-label":"Open bake menu",children:s.jsx(wS,{className:"w-6 h-6 lg:w-5 lg:h-5"})}),t&&s.jsxs(s.Fragment,{children:[s.jsx("div",{onClick:()=>n(!1),className:"fixed inset-0 bg-black/70 lg:hidden z-[49]","aria-hidden":"true"}),s.jsx("div",{className:"absolute top-12 right-0 bg-[var(--color-bg-800)] border border-[var(--color-border-700)] rounded-lg shadow-2xl z-50 w-80",children:s.jsxs("div",{className:"p-4 space-y-3",children:[s.jsx("h4",{className:"font-semibold text-accent",children:"Bake Texture"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-[var(--color-text-300)] mb-1",children:"Resolution"}),s.jsx($S,{value:f,onChange:e=>p(Number(e)),disabled:i,options:IT.map(e=>({value:e,label:`${e}x${e}`}))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-[var(--color-text-300)] mb-1",children:"Depth"}),s.jsx($S,{value:m,onChange:e=>g(Number(e)),disabled:i,options:LT.map(e=>({value:e,label:`${e} slices`}))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-[var(--color-text-300)] mb-1",children:"Quality"}),s.jsx($S,{value:v,onChange:e=>y(Number(e)),disabled:i,options:DT})]})]}),s.jsxs("button",{onClick:()=>{n(!1),l(u,d,{resolution:f,depth:m,supersampling:v})},disabled:i,className:"w-full flex items-center justify-center px-4 py-2 bg-[var(--color-accent-primary)] hover:bg-[var(--color-accent-secondary)] rounded-md text-[var(--color-text-100)] font-semibold transition-colors duration-200 disabled:bg-[var(--color-bg-600)] disabled:cursor-not-allowed",children:[s.jsx(fS,{className:"w-5 h-5 mr-2"}),b]})]})})]})]})},OT=({isMobile:e})=>{const[t,n]=h.useState(!1),r=h.useRef(null);GS(r,()=>n(!1));const{nodes:i,edges:a}=Xw(),{name:o}=pl(),l=h.useRef(null),{edgeType:c,setEdgeType:u,edgeColorStyle:d,setEdgeColorStyle:f,edgeLineStyle:p,setEdgeLineStyle:m,floatStrokeWidth:g,setFloatStrokeWidth:v,vec3StrokeWidth:y,setVec3StrokeWidth:b}=Tl(),{saveLayout:x,setSaveLayout:_}=Tl(),w=h.useCallback(()=>{const{accentColor:e,themeMode:t,brightness:r,saturation:s}=xl.getState(),l=i.map(({id:e,position:t,data:n,width:r,height:i,zIndex:a})=>{const o="Comment"===n.type,s={i:e,t:n.type,pos:t,z:a};return r&&i&&(s.size=[r,i]),o?s.d={text:n.text,fontSize:n.fontSize,fontWeight:n.fontWeight,fontStyle:n.fontStyle,backgroundColor:n.backgroundColor,textColor:n.textColor,opacity:n.opacity,textOpacity:n.textOpacity}:(s.l=n.label,n.params&&n.params.length>0&&(s.p=n.params.reduce((e,t)=>(void 0!==t.value&&(e[t.id]=t.value),e),{}))),s}),c=a.map(({id:e,source:t,target:n,sourceHandle:r,targetHandle:i})=>({i:e,s:t,t:n,sh:r,th:i})),u={version:2,workspaceName:o,nodes:l,edges:c,theme:{accentColor:e,themeMode:t,brightness:r,saturation:s}},d=`data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(u))}`,h=document.createElement("a");h.href=d;const f=o.replace(/[^a-z0-9]/gi,"_").toLowerCase()||"unnamed";h.download=`${f}.json`,h.click(),n(!1)},[i,a,o]),S=h.useCallback(()=>{var e;null==(e=l.current)||e.click(),n(!1)},[]),M=h.useCallback(e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];if(n){if("application/json"===n.type){const e=new FileReader;e.onload=e=>{var t;try{const n=JSON.parse(null==(t=e.target)?void 0:t.result);Vw(n,{recordHistory:!0})}catch(n){console.error("Error parsing JSON file:",n),alert("Failed to load graph: The file is not a valid JSON format.")}},e.readAsText(n)}else alert("Please select a valid JSON file to load a graph.");e.target&&(e.target.value="")}},[]),E=h.useCallback(()=>{(()=>{pl.getState().resetAppLayout();const e=JSON.parse(JSON.stringify(_l));Uw.getState().clearBakedTexture(),Tl.getState().reset(),Gw.getState().recordState(),Vw(e,{recordHistory:!1}),Rl.getState().reset()})(),n(!1)},[]),T=e?"p-2 rounded-full text-[var(--color-text-300)] hover:bg-[var(--color-bg-700)]":"w-10 h-10 flex items-center justify-center rounded-md bg-[var(--color-bg-700)] hover:bg-[var(--color-accent-primary)] text-[var(--color-text-300)] transition-colors";return s.jsxs("div",{ref:r,className:"relative",children:[s.jsx("input",{type:"file",ref:l,onChange:M,accept:".json",className:"hidden"}),s.jsx("button",{onClick:()=>n(e=>!e),className:T,title:"Settings","aria-label":"Open settings menu",children:s.jsx(ES,{className:"w-6 h-6 lg:w-5 lg:h-5"})}),t&&s.jsxs(s.Fragment,{children:[s.jsx("div",{onClick:()=>n(!1),className:"fixed inset-0 bg-black/70 lg:hidden z-[49]","aria-hidden":"true"}),s.jsxs("div",{className:"absolute top-12 right-0 bg-[var(--color-bg-800)] border border-[var(--color-border-700)] rounded-lg shadow-2xl z-50 w-80 p-4",children:[s.jsx("h4",{className:"font-semibold text-accent mb-3 text-lg",children:"Settings"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-[var(--color-text-200)] mb-1",children:"Edge Curve Style"}),s.jsx($S,{value:c,onChange:e=>u(e),options:[{value:"default",label:"Bezier"},{value:"smoothstep",label:"Smooth"},{value:"step",label:"Step"},{value:"straight",label:"Straight"}]})]}),s.jsx("hr",{className:"border-[var(--color-border-700)]"}),s.jsx("h5",{className:"font-semibold text-accent mb-2",children:"Edge Appearance"}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-[var(--color-text-300)]",children:"Color Theme"}),s.jsxs("div",{className:"flex items-center bg-[var(--color-bg-900)]/70 p-1 rounded-md mt-1",children:[s.jsx("button",{onClick:()=>f("subtle"),className:"px-3 py-1 text-sm font-semibold rounded transition-colors w-1/3 "+("subtle"===d?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)]":"hover:bg-[var(--color-bg-700)] text-[var(--color-text-300)]"),children:"Subtle"}),s.jsx("button",{onClick:()=>f("accent"),className:"px-3 py-1 text-sm font-semibold rounded transition-colors w-1/3 "+("accent"===d?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)]":"hover:bg-[var(--color-bg-700)] text-[var(--color-text-300)]"),children:"Accent"}),s.jsx("button",{onClick:()=>f("vibrant"),className:"px-3 py-1 text-sm font-semibold rounded transition-colors w-1/3 "+("vibrant"===d?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)]":"hover:bg-[var(--color-bg-700)] text-[var(--color-text-300)]"),children:"Vibrant"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-[var(--color-text-300)]",children:"Line Style"}),s.jsxs("div",{className:"flex items-center bg-[var(--color-bg-900)]/70 p-1 rounded-md mt-1",children:[s.jsx("button",{onClick:()=>m("solid"),className:"px-3 py-1 text-sm font-semibold rounded transition-colors w-1/3 "+("solid"===p?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)]":"hover:bg-[var(--color-bg-700)] text-[var(--color-text-300)]"),children:"Solid"}),s.jsx("button",{onClick:()=>m("dashed"),className:"px-3 py-1 text-sm font-semibold rounded transition-colors w-1/3 "+("dashed"===p?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)]":"hover:bg-[var(--color-bg-700)] text-[var(--color-text-300)]"),children:"Dashed"}),s.jsx("button",{onClick:()=>m("animated"),className:"px-3 py-1 text-sm font-semibold rounded transition-colors w-1/3 "+("animated"===p?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)]":"hover:bg-[var(--color-bg-700)] text-[var(--color-text-300)]"),children:"Animated"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-[var(--color-text-300)]",children:"Float (Value) Width"}),s.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[s.jsx("input",{type:"range",min:"1",max:"5",step:"0.1",value:g,onChange:e=>v(parseFloat(e.target.value)),className:"flex-grow h-2 bg-[var(--color-bg-600)] rounded-lg appearance-none cursor-pointer accent-[var(--color-accent-primary)]"}),s.jsxs("span",{className:"font-mono text-xs w-10 text-right",children:[g.toFixed(1),"px"]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-[var(--color-text-300)]",children:"Vector (Color) Width"}),s.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[s.jsx("input",{type:"range",min:"1",max:"5",step:"0.1",value:y,onChange:e=>b(parseFloat(e.target.value)),className:"flex-grow h-2 bg-[var(--color-bg-600)] rounded-lg appearance-none cursor-pointer accent-[var(--color-accent-primary)]"}),s.jsxs("span",{className:"font-mono text-xs w-10 text-right",children:[y.toFixed(1),"px"]})]})]})]}),s.jsx("hr",{className:"border-[var(--color-border-700)]"}),s.jsx("h5",{className:"font-semibold text-accent mb-2",children:"Layout"}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{htmlFor:"save-layout-toggle",className:"text-sm text-[var(--color-text-200)] cursor-pointer",children:"Save layout between sessions"}),s.jsx("input",{id:"save-layout-toggle",type:"checkbox",checked:x,onChange:e=>_(e.target.checked),className:"w-5 h-5 bg-[var(--color-bg-700)] border border-[var(--color-border-600)] rounded text-[var(--color-accent-primary)] focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--color-bg-800)] focus:ring-[var(--color-accent-primary)] cursor-pointer"})]}),s.jsx("hr",{className:"border-[var(--color-border-700)]"}),s.jsx("div",{className:"lg:hidden",children:s.jsx(NT,{displayAs:"menu-item"})}),s.jsx("div",{className:"lg:hidden",children:s.jsx("hr",{className:"border-[var(--color-border-700)]"})}),s.jsxs("div",{className:"space-y-1",children:[s.jsxs("button",{onClick:S,className:"w-full flex items-center px-3 py-2 text-left text-sm rounded-md text-[var(--color-text-200)] hover:bg-[var(--color-bg-700)] hover:text-[var(--color-text-100)] transition-colors",children:[s.jsx(rS,{className:"w-5 h-5 mr-3"}),"Import Graph..."]}),s.jsxs("button",{onClick:w,className:"w-full flex items-center px-3 py-2 text-left text-sm rounded-md text-[var(--color-text-200)] hover:bg-[var(--color-bg-700)] hover:text-[var(--color-text-100)] transition-colors",children:[s.jsx(nS,{className:"w-5 h-5 mr-3"}),"Export Graph..."]}),s.jsxs("button",{onClick:E,className:"w-full flex items-center px-3 py-2 text-left text-sm rounded-md text-[var(--color-text-200)] hover:bg-[var(--color-bg-700)] hover:text-[var(--color-text-100)] transition-colors",children:[s.jsx(bS,{className:"w-5 h-5 mr-3"}),"Reset Layout"]})]})]})]})]})]})},UT=({onToggleSidebar:e,onToggleRightPanel:t,isSidebarOpen:n,isRightPanelOpen:r})=>{const{isBaking:i,quickBake:a,bakingProgress:o}=Uw(),{generatedShader:l,nodes:c}=Xw(),{undo:u,redo:d,past:h,future:f}=Gw();return s.jsxs(s.Fragment,{children:[s.jsxs("header",{className:"relative flex-shrink-0 h-16 bg-[var(--color-bg-900)] border-b border-[var(--color-border-700)] flex items-center justify-between px-4 lg:px-6 z-50",children:[s.jsxs("div",{className:"flex lg:hidden items-center justify-between w-full",children:[s.jsx("div",{className:"w-1/3 flex items-center",children:s.jsx(PT,{isMobile:!0})}),s.jsx("div",{className:"w-1/3 text-center",children:s.jsx("h1",{className:"font-logo text-4xl text-accent inline-block whitespace-nowrap",children:"Noisette 3D"})}),s.jsxs("div",{className:"w-1/3 flex justify-end space-x-1",children:[s.jsx(OT,{isMobile:!0}),s.jsx(zT,{isMobile:!0})]})]}),s.jsxs("div",{className:"hidden lg:flex items-center space-x-4 w-1/3",children:[s.jsx("button",{onClick:e,className:"w-10 h-10 flex items-center justify-center rounded-md transition-colors "+(n?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)]":"bg-[var(--color-bg-700)] hover:bg-[var(--color-accent-primary)] text-[var(--color-text-300)]"),"aria-label":n?"Collapse Nodes Panel":"Expand Nodes Panel",title:n?"Collapse Nodes Panel":"Expand Nodes Panel",children:s.jsx(oS,{className:"w-5 h-5"})}),s.jsx(PT,{isMobile:!1})]}),s.jsx("div",{className:"hidden lg:flex w-1/3 justify-center items-center",children:s.jsx("h1",{className:"font-logo text-5xl text-accent",children:"Noisette 3D"})}),s.jsxs("div",{className:"hidden lg:flex items-center justify-end space-x-3 w-1/3",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:u,disabled:0===h.length,className:"w-10 h-10 flex items-center justify-center rounded-md bg-[var(--color-bg-700)] hover:bg-[var(--color-accent-primary)] text-[var(--color-text-300)] disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Undo",title:"Undo",children:s.jsx(mS,{className:"w-5 h-5"})}),s.jsx("button",{onClick:d,disabled:0===f.length,className:"w-10 h-10 flex items-center justify-center rounded-md bg-[var(--color-bg-700)] hover:bg-[var(--color-accent-primary)] text-[var(--color-text-300)] disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Redo",title:"Redo",children:s.jsx(gS,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"h-8 w-px bg-[var(--color-border-700)]"}),s.jsx(NT,{}),s.jsx(OT,{}),s.jsx("div",{className:"h-8 w-px bg-[var(--color-border-700)]"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:t,className:"w-10 h-10 flex items-center justify-center rounded-md transition-colors "+(r?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)]":"bg-[var(--color-bg-700)] hover:bg-[var(--color-accent-primary)] text-[var(--color-text-300)]"),"aria-label":r?"Collapse Viewport Panel":"Expand Viewport Panel",title:r?"Collapse Viewport Panel":"Expand Viewport Panel",children:s.jsx(sS,{className:"w-5 h-5"})}),s.jsx("button",{onClick:()=>{a(l,c)},disabled:i,className:"w-10 h-10 flex items-center justify-center rounded-md bg-[var(--color-bg-700)] hover:bg-[var(--color-accent-primary)] text-[var(--color-text-300)] disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Quick Bake",title:"Quick Bake (uses last settings)",children:s.jsx(pS,{className:"w-5 h-5"})}),s.jsx(zT,{})]})]})]}),i&&s.jsx("div",{className:"lg:hidden fixed top-16 left-0 right-0 z-10",children:s.jsx("div",{className:"w-full h-1 bg-[var(--color-bg-700)]",children:s.jsx("div",{className:"bg-[var(--color-accent-primary)] h-1 transition-all duration-150",style:{width:100*o+"%"}})})})]})};var FT,BT={exports:{}},jT={};function HT(){return FT||(FT=1,function(e){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var i in r)n(r,i)&&(e[i]=r[i])}}return e},e.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){var t,n,r,i,a,o;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)a=e[t],o.set(a,i),i+=a.length;return o}},i={arraySet:function(e,t,n,r,i){for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,r)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,i))},e.setTyped(t)}(jT)),jT}var VT,GT,WT,$T,XT,qT,YT,ZT,KT={},JT={},QT={};function eC(){return WT?GT:(WT=1,GT=function(e,t,n,r){for(var i=65535&e,a=e>>>16&65535,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16})}function tC(){if(XT)return $T;XT=1;var e=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();return $T=function(t,n,r,i){var a=e,o=i+r;t^=-1;for(var s=i;s<o;s++)t=t>>>8^a[255&(t^n[s])];return-1^t}}function nC(){return YT?qT:(YT=1,qT={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"})}function rC(){if(ZT)return JT;ZT=1;var e,t=HT(),n=function(){if(VT)return QT;VT=1;var e=HT();function t(e){for(var t=e.length;--t>=0;)e[t]=0}var n=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],r=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],a=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],o=new Array(576);t(o);var s=new Array(60);t(s);var l=new Array(512);t(l);var c=new Array(256);t(c);var u=new Array(29);t(u);var d,h,f,p=new Array(30);function m(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function g(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function v(e){return e<256?l[e]:l[256+(e>>>7)]}function y(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function b(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,y(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function x(e,t,n){b(e,n[2*t],n[2*t+1])}function _(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function w(e,t,n){var r,i,a=new Array(16),o=0;for(r=1;r<=15;r++)a[r]=o=o+n[r-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=_(a[s]++,s))}}function S(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function M(e){e.bi_valid>8?y(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function E(e,t,n,r){var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]}function T(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&E(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!E(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function C(e,t,i){var a,o,s,l,d=0;if(0!==e.last_lit)do{a=e.pending_buf[e.d_buf+2*d]<<8|e.pending_buf[e.d_buf+2*d+1],o=e.pending_buf[e.l_buf+d],d++,0===a?x(e,o,t):(x(e,(s=c[o])+256+1,t),0!==(l=n[s])&&b(e,o-=u[s],l),x(e,s=v(--a),i),0!==(l=r[s])&&b(e,a-=p[s],l))}while(d<e.last_lit);x(e,256,t)}function A(e,t){var n,r,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==a[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)T(e,a,n);i=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],T(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,T(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,a,o,s,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(a=0;a<=15;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(a=l[2*l[2*(r=e.heap[n])+1]+1]+1)>p&&(a=p,m++),l[2*r+1]=a,r>c||(e.bl_count[a]++,o=0,r>=f&&(o=h[r-f]),s=l[2*r],e.opt_len+=s*(a+o),d&&(e.static_len+=s*(u[2*r+1]+o)));if(0!==m){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(a=p;0!==a;a--)for(r=e.bl_count[a];0!==r;)(i=e.heap[--n])>c||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),r--)}}(e,t),w(a,c,e.bl_count)}function k(e,t,n){var r,i,a=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++s<l&&i===o||(s<c?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(l=138,c=3):i===o?(l=6,c=3):(l=7,c=4))}function R(e,t,n){var r,i,a=-1,o=t[1],s=0,l=7,c=4;for(0===o&&(l=138,c=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++s<l&&i===o)){if(s<c)do{x(e,i,e.bl_tree)}while(0!==--s);else 0!==i?(i!==a&&(x(e,i,e.bl_tree),s--),x(e,16,e.bl_tree),b(e,s-3,2)):s<=10?(x(e,17,e.bl_tree),b(e,s-3,3)):(x(e,18,e.bl_tree),b(e,s-11,7));s=0,a=i,0===o?(l=138,c=3):i===o?(l=6,c=3):(l=7,c=4)}}t(p);var N=!1;function P(t,n,r,i){b(t,0+(i?1:0),3),function(t,n,r){M(t),y(t,r),y(t,~r),e.arraySet(t.pending_buf,t.window,n,r,t.pending),t.pending+=r}(t,n,r)}return QT._tr_init=function(e){N||(function(){var e,t,a,g,v,y=new Array(16);for(a=0,g=0;g<28;g++)for(u[g]=a,e=0;e<1<<n[g];e++)c[a++]=g;for(c[a-1]=g,v=0,g=0;g<16;g++)for(p[g]=v,e=0;e<1<<r[g];e++)l[v++]=g;for(v>>=7;g<30;g++)for(p[g]=v<<7,e=0;e<1<<r[g]-7;e++)l[256+v++]=g;for(t=0;t<=15;t++)y[t]=0;for(e=0;e<=143;)o[2*e+1]=8,e++,y[8]++;for(;e<=255;)o[2*e+1]=9,e++,y[9]++;for(;e<=279;)o[2*e+1]=7,e++,y[7]++;for(;e<=287;)o[2*e+1]=8,e++,y[8]++;for(w(o,287,y),e=0;e<30;e++)s[2*e+1]=5,s[2*e]=_(e,5);d=new m(o,n,257,286,15),h=new m(s,r,0,30,15),f=new m(new Array(0),i,0,19,7)}(),N=!0),e.l_desc=new g(e.dyn_ltree,d),e.d_desc=new g(e.dyn_dtree,h),e.bl_desc=new g(e.bl_tree,f),e.bi_buf=0,e.bi_valid=0,S(e)},QT._tr_stored_block=P,QT._tr_flush_block=function(e,t,n,r){var i,l,c=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),A(e,e.l_desc),A(e,e.d_desc),c=function(e){var t;for(k(e,e.dyn_ltree,e.l_desc.max_code),k(e,e.dyn_dtree,e.d_desc.max_code),A(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*a[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(l=e.static_len+3+7>>>3)<=i&&(i=l)):i=l=n+5,n+4<=i&&-1!==t?P(e,t,n,r):4===e.strategy||l===i?(b(e,2+(r?1:0),3),C(e,o,s)):(b(e,4+(r?1:0),3),function(e,t,n,r){var i;for(b(e,t-257,5),b(e,n-1,5),b(e,r-4,4),i=0;i<r;i++)b(e,e.bl_tree[2*a[i]+1],3);R(e,e.dyn_ltree,t-1),R(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,c+1),C(e,e.dyn_ltree,e.dyn_dtree)),S(e),r&&M(e)},QT._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(c[n]+256+1)]++,e.dyn_dtree[2*v(t)]++),e.last_lit===e.lit_bufsize-1},QT._tr_align=function(e){b(e,2,3),x(e,256,o),function(e){16===e.bi_valid?(y(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)},QT}(),r=eC(),i=tC(),a=nC(),o=-2,s=258,l=262,c=103,u=113,d=666;function h(e,t){return e.msg=a[t],t}function f(e){return(e<<1)-(e>4?9:0)}function p(e){for(var t=e.length;--t>=0;)e[t]=0}function m(e){var n=e.state,r=n.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(t.arraySet(e.output,n.pending_buf,n.pending_out,r,e.next_out),e.next_out+=r,n.pending_out+=r,e.total_out+=r,e.avail_out-=r,n.pending-=r,0===n.pending&&(n.pending_out=0))}function g(e,t){n._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,m(e.strm)}function v(e,t){e.pending_buf[e.pending++]=t}function y(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function b(e,n,a,o){var s=e.avail_in;return s>o&&(s=o),0===s?0:(e.avail_in-=s,t.arraySet(n,e.input,e.next_in,s,a),1===e.state.wrap?e.adler=r(e.adler,n,s,a):2===e.state.wrap&&(e.adler=i(e.adler,n,s,a)),e.next_in+=s,e.total_in+=s,s)}function x(e,t){var n,r,i=e.max_chain_length,a=e.strstart,o=e.prev_length,c=e.nice_match,u=e.strstart>e.w_size-l?e.strstart-(e.w_size-l):0,d=e.window,h=e.w_mask,f=e.prev,p=e.strstart+s,m=d[a+o-1],g=d[a+o];e.prev_length>=e.good_match&&(i>>=2),c>e.lookahead&&(c=e.lookahead);do{if(d[(n=t)+o]===g&&d[n+o-1]===m&&d[n]===d[a]&&d[++n]===d[a+1]){a+=2,n++;do{}while(d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&a<p);if(r=s-(p-a),a=p-s,r>o){if(e.match_start=t,o=r,r>=c)break;m=d[a+o-1],g=d[a+o]}}}while((t=f[t&h])>u&&0!==--i);return o<=e.lookahead?o:e.lookahead}function _(e){var n,r,i,a,o,s=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-l)){t.arraySet(e.window,e.window,s,s,0),e.match_start-=s,e.strstart-=s,e.block_start-=s,n=r=e.hash_size;do{i=e.head[--n],e.head[n]=i>=s?i-s:0}while(--r);n=r=s;do{i=e.prev[--n],e.prev[n]=i>=s?i-s:0}while(--r);a+=s}if(0===e.strm.avail_in)break;if(r=b(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=r,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+3-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<l&&0!==e.strm.avail_in)}function w(e,t){for(var r,i;;){if(e.lookahead<l){if(_(e),e.lookahead<l&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-l&&(e.match_length=x(e,r)),e.match_length>=3)if(i=n._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(g(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(g(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(g(e,!1),0===e.strm.avail_out)?1:2}function S(e,t){for(var r,i,a;;){if(e.lookahead<l){if(_(e),e.lookahead<l&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-l&&(e.match_length=x(e,r),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,i=n._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(g(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((i=n._tr_tally(e,0,e.window[e.strstart-1]))&&g(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=n._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(g(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(g(e,!1),0===e.strm.avail_out)?1:2}function M(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function E(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new t.Buf16(1146),this.dyn_dtree=new t.Buf16(122),this.bl_tree=new t.Buf16(78),p(this.dyn_ltree),p(this.dyn_dtree),p(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new t.Buf16(16),this.heap=new t.Buf16(573),p(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new t.Buf16(573),p(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function T(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:u,e.adler=2===t.wrap?0:1,t.last_flush=0,n._tr_init(t),0):h(e,o)}function C(t){var n,r=T(t);return 0===r&&((n=t.state).window_size=2*n.w_size,p(n.head),n.max_lazy_match=e[n.level].max_lazy,n.good_match=e[n.level].good_length,n.nice_match=e[n.level].nice_length,n.max_chain_length=e[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),r}function A(e,n,r,i,a,s){if(!e)return o;var l=1;if(-1===n&&(n=6),i<0?(l=0,i=-i):i>15&&(l=2,i-=16),a<1||a>9||8!==r||i<8||i>15||n<0||n>9||s<0||s>4)return h(e,o);8===i&&(i=9);var c=new E;return e.state=c,c.strm=e,c.wrap=l,c.gzhead=null,c.w_bits=i,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=a+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new t.Buf8(2*c.w_size),c.head=new t.Buf16(c.hash_size),c.prev=new t.Buf16(c.w_size),c.lit_bufsize=1<<a+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new t.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=n,c.strategy=s,c.method=r,C(e)}return e=[new M(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(_(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,g(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-l&&(g(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(g(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(g(e,!1),e.strm.avail_out),1)}),new M(4,4,8,4,w),new M(4,5,16,8,w),new M(4,6,32,32,w),new M(4,4,16,16,S),new M(8,16,32,32,S),new M(8,16,128,128,S),new M(8,32,128,256,S),new M(32,128,258,1024,S),new M(32,258,258,4096,S)],JT.deflateInit=function(e,t){return A(e,t,8,15,8,0)},JT.deflateInit2=A,JT.deflateReset=C,JT.deflateResetKeep=T,JT.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?o:(e.state.gzhead=t,0):o},JT.deflate=function(t,r){var a,l,b,x;if(!t||!t.state||r>5||r<0)return t?h(t,o):o;if(l=t.state,!t.output||!t.input&&0!==t.avail_in||l.status===d&&4!==r)return h(t,0===t.avail_out?-5:o);if(l.strm=t,a=l.last_flush,l.last_flush=r,42===l.status)if(2===l.wrap)t.adler=0,v(l,31),v(l,139),v(l,8),l.gzhead?(v(l,(l.gzhead.text?1:0)+(l.gzhead.hcrc?2:0)+(l.gzhead.extra?4:0)+(l.gzhead.name?8:0)+(l.gzhead.comment?16:0)),v(l,255&l.gzhead.time),v(l,l.gzhead.time>>8&255),v(l,l.gzhead.time>>16&255),v(l,l.gzhead.time>>24&255),v(l,9===l.level?2:l.strategy>=2||l.level<2?4:0),v(l,255&l.gzhead.os),l.gzhead.extra&&l.gzhead.extra.length&&(v(l,255&l.gzhead.extra.length),v(l,l.gzhead.extra.length>>8&255)),l.gzhead.hcrc&&(t.adler=i(t.adler,l.pending_buf,l.pending,0)),l.gzindex=0,l.status=69):(v(l,0),v(l,0),v(l,0),v(l,0),v(l,0),v(l,9===l.level?2:l.strategy>=2||l.level<2?4:0),v(l,3),l.status=u);else{var w=8+(l.w_bits-8<<4)<<8;w|=(l.strategy>=2||l.level<2?0:l.level<6?1:6===l.level?2:3)<<6,0!==l.strstart&&(w|=32),w+=31-w%31,l.status=u,y(l,w),0!==l.strstart&&(y(l,t.adler>>>16),y(l,65535&t.adler)),t.adler=1}if(69===l.status)if(l.gzhead.extra){for(b=l.pending;l.gzindex<(65535&l.gzhead.extra.length)&&(l.pending!==l.pending_buf_size||(l.gzhead.hcrc&&l.pending>b&&(t.adler=i(t.adler,l.pending_buf,l.pending-b,b)),m(t),b=l.pending,l.pending!==l.pending_buf_size));)v(l,255&l.gzhead.extra[l.gzindex]),l.gzindex++;l.gzhead.hcrc&&l.pending>b&&(t.adler=i(t.adler,l.pending_buf,l.pending-b,b)),l.gzindex===l.gzhead.extra.length&&(l.gzindex=0,l.status=73)}else l.status=73;if(73===l.status)if(l.gzhead.name){b=l.pending;do{if(l.pending===l.pending_buf_size&&(l.gzhead.hcrc&&l.pending>b&&(t.adler=i(t.adler,l.pending_buf,l.pending-b,b)),m(t),b=l.pending,l.pending===l.pending_buf_size)){x=1;break}x=l.gzindex<l.gzhead.name.length?255&l.gzhead.name.charCodeAt(l.gzindex++):0,v(l,x)}while(0!==x);l.gzhead.hcrc&&l.pending>b&&(t.adler=i(t.adler,l.pending_buf,l.pending-b,b)),0===x&&(l.gzindex=0,l.status=91)}else l.status=91;if(91===l.status)if(l.gzhead.comment){b=l.pending;do{if(l.pending===l.pending_buf_size&&(l.gzhead.hcrc&&l.pending>b&&(t.adler=i(t.adler,l.pending_buf,l.pending-b,b)),m(t),b=l.pending,l.pending===l.pending_buf_size)){x=1;break}x=l.gzindex<l.gzhead.comment.length?255&l.gzhead.comment.charCodeAt(l.gzindex++):0,v(l,x)}while(0!==x);l.gzhead.hcrc&&l.pending>b&&(t.adler=i(t.adler,l.pending_buf,l.pending-b,b)),0===x&&(l.status=c)}else l.status=c;if(l.status===c&&(l.gzhead.hcrc?(l.pending+2>l.pending_buf_size&&m(t),l.pending+2<=l.pending_buf_size&&(v(l,255&t.adler),v(l,t.adler>>8&255),t.adler=0,l.status=u)):l.status=u),0!==l.pending){if(m(t),0===t.avail_out)return l.last_flush=-1,0}else if(0===t.avail_in&&f(r)<=f(a)&&4!==r)return h(t,-5);if(l.status===d&&0!==t.avail_in)return h(t,-5);if(0!==t.avail_in||0!==l.lookahead||0!==r&&l.status!==d){var S=2===l.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(_(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,r=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(g(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(g(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(g(e,!1),0===e.strm.avail_out)?1:2}(l,r):3===l.strategy?function(e,t){for(var r,i,a,o,l=e.window;;){if(e.lookahead<=s){if(_(e),e.lookahead<=s&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=l[a=e.strstart-1])===l[++a]&&i===l[++a]&&i===l[++a]){o=e.strstart+s;do{}while(i===l[++a]&&i===l[++a]&&i===l[++a]&&i===l[++a]&&i===l[++a]&&i===l[++a]&&i===l[++a]&&i===l[++a]&&a<o);e.match_length=s-(o-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=n._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(g(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(g(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(g(e,!1),0===e.strm.avail_out)?1:2}(l,r):e[l.level].func(l,r);if(3!==S&&4!==S||(l.status=d),1===S||3===S)return 0===t.avail_out&&(l.last_flush=-1),0;if(2===S&&(1===r?n._tr_align(l):5!==r&&(n._tr_stored_block(l,0,0,!1),3===r&&(p(l.head),0===l.lookahead&&(l.strstart=0,l.block_start=0,l.insert=0))),m(t),0===t.avail_out))return l.last_flush=-1,0}return 4!==r?0:l.wrap<=0?1:(2===l.wrap?(v(l,255&t.adler),v(l,t.adler>>8&255),v(l,t.adler>>16&255),v(l,t.adler>>24&255),v(l,255&t.total_in),v(l,t.total_in>>8&255),v(l,t.total_in>>16&255),v(l,t.total_in>>24&255)):(y(l,t.adler>>>16),y(l,65535&t.adler)),m(t),l.wrap>0&&(l.wrap=-l.wrap),0!==l.pending?0:1)},JT.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==c&&t!==u&&t!==d?h(e,o):(e.state=null,t===u?h(e,-3):0):o},JT.deflateSetDictionary=function(e,n){var i,a,s,l,c,u,d,h,f=n.length;if(!e||!e.state)return o;if(2===(l=(i=e.state).wrap)||1===l&&42!==i.status||i.lookahead)return o;for(1===l&&(e.adler=r(e.adler,n,f,0)),i.wrap=0,f>=i.w_size&&(0===l&&(p(i.head),i.strstart=0,i.block_start=0,i.insert=0),h=new t.Buf8(i.w_size),t.arraySet(h,n,f-i.w_size,i.w_size,0),n=h,f=i.w_size),c=e.avail_in,u=e.next_in,d=e.input,e.avail_in=f,e.next_in=0,e.input=n,_(i);i.lookahead>=3;){a=i.strstart,s=i.lookahead-2;do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[a+3-1])&i.hash_mask,i.prev[a&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=a,a++}while(--s);i.strstart=a,i.lookahead=2,_(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=u,e.input=d,e.avail_in=c,i.wrap=l,0},JT.deflateInfo="pako deflate (from Nodeca project)",JT}var iC,aC,oC,sC,lC={};function cC(){if(iC)return lC;iC=1;var e=HT(),t=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch(o){t=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(o){n=!1}for(var r=new e.Buf8(256),i=0;i<256;i++)r[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;function a(r,i){if(i<65534&&(r.subarray&&n||!r.subarray&&t))return String.fromCharCode.apply(null,e.shrinkBuf(r,i));for(var a="",o=0;o<i;o++)a+=String.fromCharCode(r[o]);return a}return r[254]=r[254]=1,lC.string2buf=function(t){var n,r,i,a,o,s=t.length,l=0;for(a=0;a<s;a++)55296==(64512&(r=t.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=t.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),l+=r<128?1:r<2048?2:r<65536?3:4;for(n=new e.Buf8(l),o=0,a=0;o<l;a++)55296==(64512&(r=t.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=t.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),r<128?n[o++]=r:r<2048?(n[o++]=192|r>>>6,n[o++]=128|63&r):r<65536?(n[o++]=224|r>>>12,n[o++]=128|r>>>6&63,n[o++]=128|63&r):(n[o++]=240|r>>>18,n[o++]=128|r>>>12&63,n[o++]=128|r>>>6&63,n[o++]=128|63&r);return n},lC.buf2binstring=function(e){return a(e,e.length)},lC.binstring2buf=function(t){for(var n=new e.Buf8(t.length),r=0,i=n.length;r<i;r++)n[r]=t.charCodeAt(r);return n},lC.buf2string=function(e,t){var n,i,o,s,l=t||e.length,c=new Array(2*l);for(i=0,n=0;n<l;)if((o=e[n++])<128)c[i++]=o;else if((s=r[o])>4)c[i++]=65533,n+=s-1;else{for(o&=2===s?31:3===s?15:7;s>1&&n<l;)o=o<<6|63&e[n++],s--;s>1?c[i++]=65533:o<65536?c[i++]=o:(o-=65536,c[i++]=55296|o>>10&1023,c[i++]=56320|1023&o)}return a(c,i)},lC.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+r[e[n]]>t?n:t},lC}function uC(){return oC?aC:(oC=1,aC=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0})}var dC,hC,fC,pC,mC,gC,vC,yC,bC,xC,_C,wC,SC,MC,EC,TC,CC,AC={},kC={};function RC(){return vC?gC:(vC=1,gC={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8})}function NC(){if(xC)return AC;xC=1;var e=function(){if(mC)return kC;mC=1;var e=HT(),t=eC(),n=tC(),r=hC?dC:(hC=1,dC=function(e,t){var n,r,i,a,o,s,l,c,u,d,h,f,p,m,g,v,y,b,x,_,w,S,M,E,T;n=e.state,r=e.next_in,E=e.input,i=r+(e.avail_in-5),a=e.next_out,T=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=n.dmax,c=n.wsize,u=n.whave,d=n.wnext,h=n.window,f=n.hold,p=n.bits,m=n.lencode,g=n.distcode,v=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{p<15&&(f+=E[r++]<<p,p+=8,f+=E[r++]<<p,p+=8),b=m[f&v];t:for(;;){if(f>>>=x=b>>>24,p-=x,0==(x=b>>>16&255))T[a++]=65535&b;else{if(!(16&x)){if(64&x){if(32&x){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}b=m[(65535&b)+(f&(1<<x)-1)];continue t}for(_=65535&b,(x&=15)&&(p<x&&(f+=E[r++]<<p,p+=8),_+=f&(1<<x)-1,f>>>=x,p-=x),p<15&&(f+=E[r++]<<p,p+=8,f+=E[r++]<<p,p+=8),b=g[f&y];;){if(f>>>=x=b>>>24,p-=x,16&(x=b>>>16&255)){if(w=65535&b,p<(x&=15)&&(f+=E[r++]<<p,(p+=8)<x&&(f+=E[r++]<<p,p+=8)),(w+=f&(1<<x)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=x,p-=x,w>(x=a-o)){if((x=w-x)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(S=0,M=h,0===d){if(S+=c-x,x<_){_-=x;do{T[a++]=h[S++]}while(--x);S=a-w,M=T}}else if(d<x){if(S+=c+d-x,(x-=d)<_){_-=x;do{T[a++]=h[S++]}while(--x);if(S=0,d<_){_-=x=d;do{T[a++]=h[S++]}while(--x);S=a-w,M=T}}}else if(S+=d-x,x<_){_-=x;do{T[a++]=h[S++]}while(--x);S=a-w,M=T}for(;_>2;)T[a++]=M[S++],T[a++]=M[S++],T[a++]=M[S++],_-=3;_&&(T[a++]=M[S++],_>1&&(T[a++]=M[S++]))}else{S=a-w;do{T[a++]=T[S++],T[a++]=T[S++],T[a++]=T[S++],_-=3}while(_>2);_&&(T[a++]=T[S++],_>1&&(T[a++]=T[S++]))}break}if(64&x){e.msg="invalid distance code",n.mode=30;break e}b=g[(65535&b)+(f&(1<<x)-1)]}}break}}while(r<i&&a<s);r-=_=p>>3,f&=(1<<(p-=_<<3))-1,e.next_in=r,e.next_out=a,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=a<s?s-a+257:257-(a-s),n.hold=f,n.bits=p}),i=function(){if(pC)return fC;pC=1;var e=HT(),t=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],r=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],i=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return fC=function(a,o,s,l,c,u,d,h){var f,p,m,g,v,y,b,x,_,w=h.bits,S=0,M=0,E=0,T=0,C=0,A=0,k=0,R=0,N=0,P=0,I=null,L=0,D=new e.Buf16(16),z=new e.Buf16(16),O=null,U=0;for(S=0;S<=15;S++)D[S]=0;for(M=0;M<l;M++)D[o[s+M]]++;for(C=w,T=15;T>=1&&0===D[T];T--);if(C>T&&(C=T),0===T)return c[u++]=20971520,c[u++]=20971520,h.bits=1,0;for(E=1;E<T&&0===D[E];E++);for(C<E&&(C=E),R=1,S=1;S<=15;S++)if(R<<=1,(R-=D[S])<0)return-1;if(R>0&&(0===a||1!==T))return-1;for(z[1]=0,S=1;S<15;S++)z[S+1]=z[S]+D[S];for(M=0;M<l;M++)0!==o[s+M]&&(d[z[o[s+M]]++]=M);if(0===a?(I=O=d,y=19):1===a?(I=t,L-=257,O=n,U-=257,y=256):(I=r,O=i,y=-1),P=0,M=0,S=E,v=u,A=C,k=0,m=-1,g=(N=1<<C)-1,1===a&&N>852||2===a&&N>592)return 1;for(;;){b=S-k,d[M]<y?(x=0,_=d[M]):d[M]>y?(x=O[U+d[M]],_=I[L+d[M]]):(x=96,_=0),f=1<<S-k,E=p=1<<A;do{c[v+(P>>k)+(p-=f)]=b<<24|x<<16|_}while(0!==p);for(f=1<<S-1;P&f;)f>>=1;if(0!==f?(P&=f-1,P+=f):P=0,M++,0===--D[S]){if(S===T)break;S=o[s+d[M]]}if(S>C&&(P&g)!==m){for(0===k&&(k=C),v+=E,R=1<<(A=S-k);A+k<T&&!((R-=D[A+k])<=0);)A++,R<<=1;if(N+=1<<A,1===a&&N>852||2===a&&N>592)return 1;c[m=P&g]=C<<24|A<<16|v-u}}return 0!==P&&(c[v+P]=S-k<<24|64<<16),h.bits=C,0}}(),a=-2,o=12,s=30;function l(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function c(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new e.Buf16(320),this.work=new e.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function u(t){var n;return t&&t.state?(n=t.state,t.total_in=t.total_out=n.total=0,t.msg="",n.wrap&&(t.adler=1&n.wrap),n.mode=1,n.last=0,n.havedict=0,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new e.Buf32(852),n.distcode=n.distdyn=new e.Buf32(592),n.sane=1,n.back=-1,0):a}function d(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,u(e)):a}function h(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?a:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,d(e))):a}function f(e,t){var n,r;return e?(r=new c,e.state=r,r.window=null,0!==(n=h(e,t))&&(e.state=null),n):a}var p,m,g=!0;function v(t){if(g){var n;for(p=new e.Buf32(512),m=new e.Buf32(32),n=0;n<144;)t.lens[n++]=8;for(;n<256;)t.lens[n++]=9;for(;n<280;)t.lens[n++]=7;for(;n<288;)t.lens[n++]=8;for(i(1,t.lens,0,288,p,0,t.work,{bits:9}),n=0;n<32;)t.lens[n++]=5;i(2,t.lens,0,32,m,0,t.work,{bits:5}),g=!1}t.lencode=p,t.lenbits=9,t.distcode=m,t.distbits=5}function y(t,n,r,i){var a,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new e.Buf8(o.wsize)),i>=o.wsize?(e.arraySet(o.window,n,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>i&&(a=i),e.arraySet(o.window,n,r-i,a,o.wnext),(i-=a)?(e.arraySet(o.window,n,r-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}return kC.inflateReset=d,kC.inflateReset2=h,kC.inflateResetKeep=u,kC.inflateInit=function(e){return f(e,15)},kC.inflateInit2=f,kC.inflate=function(c,u){var d,h,f,p,m,g,b,x,_,w,S,M,E,T,C,A,k,R,N,P,I,L,D,z,O=0,U=new e.Buf8(4),F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!c||!c.state||!c.output||!c.input&&0!==c.avail_in)return a;(d=c.state).mode===o&&(d.mode=13),m=c.next_out,f=c.output,b=c.avail_out,p=c.next_in,h=c.input,g=c.avail_in,x=d.hold,_=d.bits,w=g,S=b,L=0;e:for(;;)switch(d.mode){case 1:if(0===d.wrap){d.mode=13;break}for(;_<16;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}if(2&d.wrap&&35615===x){d.check=0,U[0]=255&x,U[1]=x>>>8&255,d.check=n(d.check,U,2,0),x=0,_=0,d.mode=2;break}if(d.flags=0,d.head&&(d.head.done=!1),!(1&d.wrap)||(((255&x)<<8)+(x>>8))%31){c.msg="incorrect header check",d.mode=s;break}if(8!=(15&x)){c.msg="unknown compression method",d.mode=s;break}if(_-=4,I=8+(15&(x>>>=4)),0===d.wbits)d.wbits=I;else if(I>d.wbits){c.msg="invalid window size",d.mode=s;break}d.dmax=1<<I,c.adler=d.check=1,d.mode=512&x?10:o,x=0,_=0;break;case 2:for(;_<16;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}if(d.flags=x,8!=(255&d.flags)){c.msg="unknown compression method",d.mode=s;break}if(57344&d.flags){c.msg="unknown header flags set",d.mode=s;break}d.head&&(d.head.text=x>>8&1),512&d.flags&&(U[0]=255&x,U[1]=x>>>8&255,d.check=n(d.check,U,2,0)),x=0,_=0,d.mode=3;case 3:for(;_<32;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}d.head&&(d.head.time=x),512&d.flags&&(U[0]=255&x,U[1]=x>>>8&255,U[2]=x>>>16&255,U[3]=x>>>24&255,d.check=n(d.check,U,4,0)),x=0,_=0,d.mode=4;case 4:for(;_<16;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}d.head&&(d.head.xflags=255&x,d.head.os=x>>8),512&d.flags&&(U[0]=255&x,U[1]=x>>>8&255,d.check=n(d.check,U,2,0)),x=0,_=0,d.mode=5;case 5:if(1024&d.flags){for(;_<16;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}d.length=x,d.head&&(d.head.extra_len=x),512&d.flags&&(U[0]=255&x,U[1]=x>>>8&255,d.check=n(d.check,U,2,0)),x=0,_=0}else d.head&&(d.head.extra=null);d.mode=6;case 6:if(1024&d.flags&&((M=d.length)>g&&(M=g),M&&(d.head&&(I=d.head.extra_len-d.length,d.head.extra||(d.head.extra=new Array(d.head.extra_len)),e.arraySet(d.head.extra,h,p,M,I)),512&d.flags&&(d.check=n(d.check,h,M,p)),g-=M,p+=M,d.length-=M),d.length))break e;d.length=0,d.mode=7;case 7:if(2048&d.flags){if(0===g)break e;M=0;do{I=h[p+M++],d.head&&I&&d.length<65536&&(d.head.name+=String.fromCharCode(I))}while(I&&M<g);if(512&d.flags&&(d.check=n(d.check,h,M,p)),g-=M,p+=M,I)break e}else d.head&&(d.head.name=null);d.length=0,d.mode=8;case 8:if(4096&d.flags){if(0===g)break e;M=0;do{I=h[p+M++],d.head&&I&&d.length<65536&&(d.head.comment+=String.fromCharCode(I))}while(I&&M<g);if(512&d.flags&&(d.check=n(d.check,h,M,p)),g-=M,p+=M,I)break e}else d.head&&(d.head.comment=null);d.mode=9;case 9:if(512&d.flags){for(;_<16;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}if(x!==(65535&d.check)){c.msg="header crc mismatch",d.mode=s;break}x=0,_=0}d.head&&(d.head.hcrc=d.flags>>9&1,d.head.done=!0),c.adler=d.check=0,d.mode=o;break;case 10:for(;_<32;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}c.adler=d.check=l(x),x=0,_=0,d.mode=11;case 11:if(0===d.havedict)return c.next_out=m,c.avail_out=b,c.next_in=p,c.avail_in=g,d.hold=x,d.bits=_,2;c.adler=d.check=1,d.mode=o;case o:if(5===u||6===u)break e;case 13:if(d.last){x>>>=7&_,_-=7&_,d.mode=27;break}for(;_<3;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}switch(d.last=1&x,_-=1,3&(x>>>=1)){case 0:d.mode=14;break;case 1:if(v(d),d.mode=20,6===u){x>>>=2,_-=2;break e}break;case 2:d.mode=17;break;case 3:c.msg="invalid block type",d.mode=s}x>>>=2,_-=2;break;case 14:for(x>>>=7&_,_-=7&_;_<32;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}if((65535&x)!=(x>>>16^65535)){c.msg="invalid stored block lengths",d.mode=s;break}if(d.length=65535&x,x=0,_=0,d.mode=15,6===u)break e;case 15:d.mode=16;case 16:if(M=d.length){if(M>g&&(M=g),M>b&&(M=b),0===M)break e;e.arraySet(f,h,p,M,m),g-=M,p+=M,b-=M,m+=M,d.length-=M;break}d.mode=o;break;case 17:for(;_<14;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}if(d.nlen=257+(31&x),x>>>=5,_-=5,d.ndist=1+(31&x),x>>>=5,_-=5,d.ncode=4+(15&x),x>>>=4,_-=4,d.nlen>286||d.ndist>30){c.msg="too many length or distance symbols",d.mode=s;break}d.have=0,d.mode=18;case 18:for(;d.have<d.ncode;){for(;_<3;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}d.lens[F[d.have++]]=7&x,x>>>=3,_-=3}for(;d.have<19;)d.lens[F[d.have++]]=0;if(d.lencode=d.lendyn,d.lenbits=7,D={bits:d.lenbits},L=i(0,d.lens,0,19,d.lencode,0,d.work,D),d.lenbits=D.bits,L){c.msg="invalid code lengths set",d.mode=s;break}d.have=0,d.mode=19;case 19:for(;d.have<d.nlen+d.ndist;){for(;A=(O=d.lencode[x&(1<<d.lenbits)-1])>>>16&255,k=65535&O,!((C=O>>>24)<=_);){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}if(k<16)x>>>=C,_-=C,d.lens[d.have++]=k;else{if(16===k){for(z=C+2;_<z;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}if(x>>>=C,_-=C,0===d.have){c.msg="invalid bit length repeat",d.mode=s;break}I=d.lens[d.have-1],M=3+(3&x),x>>>=2,_-=2}else if(17===k){for(z=C+3;_<z;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}_-=C,I=0,M=3+(7&(x>>>=C)),x>>>=3,_-=3}else{for(z=C+7;_<z;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}_-=C,I=0,M=11+(127&(x>>>=C)),x>>>=7,_-=7}if(d.have+M>d.nlen+d.ndist){c.msg="invalid bit length repeat",d.mode=s;break}for(;M--;)d.lens[d.have++]=I}}if(d.mode===s)break;if(0===d.lens[256]){c.msg="invalid code -- missing end-of-block",d.mode=s;break}if(d.lenbits=9,D={bits:d.lenbits},L=i(1,d.lens,0,d.nlen,d.lencode,0,d.work,D),d.lenbits=D.bits,L){c.msg="invalid literal/lengths set",d.mode=s;break}if(d.distbits=6,d.distcode=d.distdyn,D={bits:d.distbits},L=i(2,d.lens,d.nlen,d.ndist,d.distcode,0,d.work,D),d.distbits=D.bits,L){c.msg="invalid distances set",d.mode=s;break}if(d.mode=20,6===u)break e;case 20:d.mode=21;case 21:if(g>=6&&b>=258){c.next_out=m,c.avail_out=b,c.next_in=p,c.avail_in=g,d.hold=x,d.bits=_,r(c,S),m=c.next_out,f=c.output,b=c.avail_out,p=c.next_in,h=c.input,g=c.avail_in,x=d.hold,_=d.bits,d.mode===o&&(d.back=-1);break}for(d.back=0;A=(O=d.lencode[x&(1<<d.lenbits)-1])>>>16&255,k=65535&O,!((C=O>>>24)<=_);){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}if(A&&!(240&A)){for(R=C,N=A,P=k;A=(O=d.lencode[P+((x&(1<<R+N)-1)>>R)])>>>16&255,k=65535&O,!(R+(C=O>>>24)<=_);){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}x>>>=R,_-=R,d.back+=R}if(x>>>=C,_-=C,d.back+=C,d.length=k,0===A){d.mode=26;break}if(32&A){d.back=-1,d.mode=o;break}if(64&A){c.msg="invalid literal/length code",d.mode=s;break}d.extra=15&A,d.mode=22;case 22:if(d.extra){for(z=d.extra;_<z;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}d.length+=x&(1<<d.extra)-1,x>>>=d.extra,_-=d.extra,d.back+=d.extra}d.was=d.length,d.mode=23;case 23:for(;A=(O=d.distcode[x&(1<<d.distbits)-1])>>>16&255,k=65535&O,!((C=O>>>24)<=_);){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}if(!(240&A)){for(R=C,N=A,P=k;A=(O=d.distcode[P+((x&(1<<R+N)-1)>>R)])>>>16&255,k=65535&O,!(R+(C=O>>>24)<=_);){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}x>>>=R,_-=R,d.back+=R}if(x>>>=C,_-=C,d.back+=C,64&A){c.msg="invalid distance code",d.mode=s;break}d.offset=k,d.extra=15&A,d.mode=24;case 24:if(d.extra){for(z=d.extra;_<z;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}d.offset+=x&(1<<d.extra)-1,x>>>=d.extra,_-=d.extra,d.back+=d.extra}if(d.offset>d.dmax){c.msg="invalid distance too far back",d.mode=s;break}d.mode=25;case 25:if(0===b)break e;if(M=S-b,d.offset>M){if((M=d.offset-M)>d.whave&&d.sane){c.msg="invalid distance too far back",d.mode=s;break}M>d.wnext?(M-=d.wnext,E=d.wsize-M):E=d.wnext-M,M>d.length&&(M=d.length),T=d.window}else T=f,E=m-d.offset,M=d.length;M>b&&(M=b),b-=M,d.length-=M;do{f[m++]=T[E++]}while(--M);0===d.length&&(d.mode=21);break;case 26:if(0===b)break e;f[m++]=d.length,b--,d.mode=21;break;case 27:if(d.wrap){for(;_<32;){if(0===g)break e;g--,x|=h[p++]<<_,_+=8}if(S-=b,c.total_out+=S,d.total+=S,S&&(c.adler=d.check=d.flags?n(d.check,f,S,m-S):t(d.check,f,S,m-S)),S=b,(d.flags?x:l(x))!==d.check){c.msg="incorrect data check",d.mode=s;break}x=0,_=0}d.mode=28;case 28:if(d.wrap&&d.flags){for(;_<32;){if(0===g)break e;g--,x+=h[p++]<<_,_+=8}if(x!==(4294967295&d.total)){c.msg="incorrect length check",d.mode=s;break}x=0,_=0}d.mode=29;case 29:L=1;break e;case s:L=-3;break e;case 31:return-4;default:return a}return c.next_out=m,c.avail_out=b,c.next_in=p,c.avail_in=g,d.hold=x,d.bits=_,(d.wsize||S!==c.avail_out&&d.mode<s&&(d.mode<27||4!==u))&&y(c,c.output,c.next_out,S-c.avail_out),w-=c.avail_in,S-=c.avail_out,c.total_in+=w,c.total_out+=S,d.total+=S,d.wrap&&S&&(c.adler=d.check=d.flags?n(d.check,f,S,c.next_out-S):t(d.check,f,S,c.next_out-S)),c.data_type=d.bits+(d.last?64:0)+(d.mode===o?128:0)+(20===d.mode||15===d.mode?256:0),(0===w&&0===S||4===u)&&0===L&&(L=-5),L},kC.inflateEnd=function(e){if(!e||!e.state)return a;var t=e.state;return t.window&&(t.window=null),e.state=null,0},kC.inflateGetHeader=function(e,t){var n;return e&&e.state&&2&(n=e.state).wrap?(n.head=t,t.done=!1,0):a},kC.inflateSetDictionary=function(e,n){var r,i=n.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?a:11===r.mode&&t(1,n,i,0)!==r.check?-3:y(e,n,i,i)?(r.mode=31,-4):(r.havedict=1,0):a},kC.inflateInfo="pako inflate (from Nodeca project)",kC}(),t=HT(),n=cC(),r=RC(),i=nC(),a=uC(),o=bC?yC:(bC=1,yC=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}),s=Object.prototype.toString;function l(c){if(!(this instanceof l))return new l(c);this.options=t.assign({chunkSize:16384,windowBits:0,to:""},c||{});var u=this.options;u.raw&&u.windowBits>=0&&u.windowBits<16&&(u.windowBits=-u.windowBits,0===u.windowBits&&(u.windowBits=-15)),!(u.windowBits>=0&&u.windowBits<16)||c&&c.windowBits||(u.windowBits+=32),u.windowBits>15&&u.windowBits<48&&(15&u.windowBits||(u.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var d=e.inflateInit2(this.strm,u.windowBits);if(d!==r.Z_OK)throw new Error(i[d]);if(this.header=new o,e.inflateGetHeader(this.strm,this.header),u.dictionary&&("string"==typeof u.dictionary?u.dictionary=n.string2buf(u.dictionary):"[object ArrayBuffer]"===s.call(u.dictionary)&&(u.dictionary=new Uint8Array(u.dictionary)),u.raw&&(d=e.inflateSetDictionary(this.strm,u.dictionary))!==r.Z_OK))throw new Error(i[d])}function c(e,t){var n=new l(t);if(n.push(e,!0),n.err)throw n.msg||i[n.err];return n.result}return l.prototype.push=function(i,a){var o,l,c,u,d,h=this.strm,f=this.options.chunkSize,p=this.options.dictionary,m=!1;if(this.ended)return!1;l=a===~~a?a:!0===a?r.Z_FINISH:r.Z_NO_FLUSH,"string"==typeof i?h.input=n.binstring2buf(i):"[object ArrayBuffer]"===s.call(i)?h.input=new Uint8Array(i):h.input=i,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new t.Buf8(f),h.next_out=0,h.avail_out=f),(o=e.inflate(h,r.Z_NO_FLUSH))===r.Z_NEED_DICT&&p&&(o=e.inflateSetDictionary(this.strm,p)),o===r.Z_BUF_ERROR&&!0===m&&(o=r.Z_OK,m=!1),o!==r.Z_STREAM_END&&o!==r.Z_OK)return this.onEnd(o),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&o!==r.Z_STREAM_END&&(0!==h.avail_in||l!==r.Z_FINISH&&l!==r.Z_SYNC_FLUSH)||("string"===this.options.to?(c=n.utf8border(h.output,h.next_out),u=h.next_out-c,d=n.buf2string(h.output,c),h.next_out=u,h.avail_out=f-u,u&&t.arraySet(h.output,h.output,c,u,0),this.onData(d)):this.onData(t.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(m=!0)}while((h.avail_in>0||0===h.avail_out)&&o!==r.Z_STREAM_END);return o===r.Z_STREAM_END&&(l=r.Z_FINISH),l===r.Z_FINISH?(o=e.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===r.Z_OK):l!==r.Z_SYNC_FLUSH||(this.onEnd(r.Z_OK),h.avail_out=0,!0)},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){e===r.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},AC.Inflate=l,AC.inflate=c,AC.inflateRaw=function(e,t){return(t=t||{}).raw=!0,c(e,t)},AC.ungzip=c,AC}const PC=e((SC||(SC=1,BT.exports=CC={},MC=function(){if(wC)return _C;wC=1;var e={};return(0,HT().assign)(e,function(){if(sC)return KT;sC=1;var e=rC(),t=HT(),n=cC(),r=nC(),i=uC(),a=Object.prototype.toString;function o(s){if(!(this instanceof o))return new o(s);this.options=t.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},s||{});var l=this.options;l.raw&&l.windowBits>0?l.windowBits=-l.windowBits:l.gzip&&l.windowBits>0&&l.windowBits<16&&(l.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;var c=e.deflateInit2(this.strm,l.level,l.method,l.windowBits,l.memLevel,l.strategy);if(0!==c)throw new Error(r[c]);if(l.header&&e.deflateSetHeader(this.strm,l.header),l.dictionary){var u;if(u="string"==typeof l.dictionary?n.string2buf(l.dictionary):"[object ArrayBuffer]"===a.call(l.dictionary)?new Uint8Array(l.dictionary):l.dictionary,0!==(c=e.deflateSetDictionary(this.strm,u)))throw new Error(r[c]);this._dict_set=!0}}function s(e,t){var n=new o(t);if(n.push(e,!0),n.err)throw n.msg||r[n.err];return n.result}return o.prototype.push=function(r,i){var o,s,l=this.strm,c=this.options.chunkSize;if(this.ended)return!1;s=i===~~i?i:!0===i?4:0,"string"==typeof r?l.input=n.string2buf(r):"[object ArrayBuffer]"===a.call(r)?l.input=new Uint8Array(r):l.input=r,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new t.Buf8(c),l.next_out=0,l.avail_out=c),1!==(o=e.deflate(l,s))&&0!==o)return this.onEnd(o),this.ended=!0,!1;0!==l.avail_out&&(0!==l.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(n.buf2binstring(t.shrinkBuf(l.output,l.next_out))):this.onData(t.shrinkBuf(l.output,l.next_out)))}while((l.avail_in>0||0===l.avail_out)&&1!==o);return 4===s?(o=e.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,0===o):2!==s||(this.onEnd(0),l.avail_out=0,!0)},o.prototype.onData=function(e){this.chunks.push(e)},o.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},KT.Deflate=o,KT.deflate=s,KT.deflateRaw=function(e,t){return(t=t||{}).raw=!0,s(e,t)},KT.gzip=function(e,t){return(t=t||{}).gzip=!0,s(e,t)},KT}(),NC(),RC()),_C=e}(),TC=MC,(EC=CC).toRGBA8=function(e){var t=e.width,n=e.height;if(null==e.tabs.acTL)return[EC.toRGBA8.decodeImage(e.data,t,n,e).buffer];var r=[];null==e.frames[0].data&&(e.frames[0].data=e.data);for(var i,a=new Uint8Array(t*n*4),o=0;o<e.frames.length;o++){var s=e.frames[o],l=s.rect.x,c=s.rect.y,u=s.rect.width,d=s.rect.height,h=EC.toRGBA8.decodeImage(s.data,u,d,e);if(0==o?i=h:0==s.blend?EC._copyTile(h,u,d,i,t,n,l,c,0):1==s.blend&&EC._copyTile(h,u,d,i,t,n,l,c,1),r.push(i.buffer),i=i.slice(0),0==s.dispose);else if(1==s.dispose)EC._copyTile(a,u,d,i,t,n,l,c,0);else if(2==s.dispose){for(var f=o-1;2==e.frames[f].dispose;)f--;i=new Uint8Array(r[f]).slice(0)}}return r},EC.toRGBA8.decodeImage=function(e,t,n,r){var i=t*n,a=EC.decode._getBPP(r),o=Math.ceil(t*a/8),s=new Uint8Array(4*i),l=new Uint32Array(s.buffer),c=r.ctype,u=r.depth,d=EC._bin.readUshort;if(6==c){var h=i<<2;if(8==u)for(var f=0;f<h;f++)s[f]=e[f];if(16==u)for(f=0;f<h;f++)s[f]=e[f<<1]}else if(2==c){var p=r.tabs.tRNS,m=-1,g=-1,v=-1;if(p&&(m=p[0],g=p[1],v=p[2]),8==u)for(f=0;f<i;f++){var y=3*f;s[E=f<<2]=e[y],s[E+1]=e[y+1],s[E+2]=e[y+2],s[E+3]=255,-1!=m&&e[y]==m&&e[y+1]==g&&e[y+2]==v&&(s[E+3]=0)}if(16==u)for(f=0;f<i;f++)y=6*f,s[E=f<<2]=e[y],s[E+1]=e[y+2],s[E+2]=e[y+4],s[E+3]=255,-1!=m&&d(e,y)==m&&d(e,y+2)==g&&d(e,y+4)==v&&(s[E+3]=0)}else if(3==c){var b=r.tabs.PLTE,x=r.tabs.tRNS,_=x?x.length:0;if(1==u)for(var w=0;w<n;w++){var S=w*o,M=w*t;for(f=0;f<t;f++){var E=M+f<<2,T=3*(C=e[S+(f>>3)]>>7-(7&f)&1);s[E]=b[T],s[E+1]=b[T+1],s[E+2]=b[T+2],s[E+3]=C<_?x[C]:255}}if(2==u)for(w=0;w<n;w++)for(S=w*o,M=w*t,f=0;f<t;f++)E=M+f<<2,T=3*(C=e[S+(f>>2)]>>6-((3&f)<<1)&3),s[E]=b[T],s[E+1]=b[T+1],s[E+2]=b[T+2],s[E+3]=C<_?x[C]:255;if(4==u)for(w=0;w<n;w++)for(S=w*o,M=w*t,f=0;f<t;f++)E=M+f<<2,T=3*(C=e[S+(f>>1)]>>4-((1&f)<<2)&15),s[E]=b[T],s[E+1]=b[T+1],s[E+2]=b[T+2],s[E+3]=C<_?x[C]:255;if(8==u)for(f=0;f<i;f++){var C;E=f<<2,T=3*(C=e[f]),s[E]=b[T],s[E+1]=b[T+1],s[E+2]=b[T+2],s[E+3]=C<_?x[C]:255}}else if(4==c){if(8==u)for(f=0;f<i;f++){E=f<<2;var A=e[k=f<<1];s[E]=A,s[E+1]=A,s[E+2]=A,s[E+3]=e[k+1]}if(16==u)for(f=0;f<i;f++){var k;E=f<<2,A=e[k=f<<2],s[E]=A,s[E+1]=A,s[E+2]=A,s[E+3]=e[k+2]}}else if(0==c){if(m=r.tabs.tRNS?r.tabs.tRNS:-1,1==u)for(f=0;f<i;f++){var R=(A=255*(e[f>>3]>>7-(7&f)&1))==255*m?0:255;l[f]=R<<24|A<<16|A<<8|A}if(2==u)for(f=0;f<i;f++)R=(A=85*(e[f>>2]>>6-((3&f)<<1)&3))==85*m?0:255,l[f]=R<<24|A<<16|A<<8|A;if(4==u)for(f=0;f<i;f++)R=(A=17*(e[f>>1]>>4-((1&f)<<2)&15))==17*m?0:255,l[f]=R<<24|A<<16|A<<8|A;if(8==u)for(f=0;f<i;f++)R=(A=e[f])==m?0:255,l[f]=R<<24|A<<16|A<<8|A;if(16==u)for(f=0;f<i;f++)A=e[f<<1],R=d(e,f<<1)==m?0:255,l[f]=R<<24|A<<16|A<<8|A}return s},EC.decode=function(e){for(var t,n=new Uint8Array(e),r=8,i=EC._bin,a=i.readUshort,o=i.readUint,s={tabs:{},frames:[]},l=new Uint8Array(n.length),c=0,u=0,d=[137,80,78,71,13,10,26,10],h=0;h<8;h++)if(n[h]!=d[h])throw"The input is not a PNG file!";for(;r<n.length;){var f=i.readUint(n,r);r+=4;var p=i.readASCII(n,r,4);if(r+=4,"IHDR"==p)EC.decode._IHDR(n,r,s);else if("IDAT"==p){for(h=0;h<f;h++)l[c+h]=n[r+h];c+=f}else if("acTL"==p)s.tabs[p]={num_frames:o(n,r),num_plays:o(n,r+4)},t=new Uint8Array(n.length);else if("fcTL"==p){0!=u&&((S=s.frames[s.frames.length-1]).data=EC.decode._decompress(s,t.slice(0,u),S.rect.width,S.rect.height),u=0);var m={x:o(n,r+12),y:o(n,r+16),width:o(n,r+4),height:o(n,r+8)},g=a(n,r+22);g=a(n,r+20)/(0==g?100:g);var v={rect:m,delay:Math.round(1e3*g),dispose:n[r+24],blend:n[r+25]};s.frames.push(v)}else if("fdAT"==p){for(h=0;h<f-4;h++)t[u+h]=n[r+h+4];u+=f-4}else if("pHYs"==p)s.tabs[p]=[i.readUint(n,r),i.readUint(n,r+4),n[r+8]];else if("cHRM"==p)for(s.tabs[p]=[],h=0;h<8;h++)s.tabs[p].push(i.readUint(n,r+4*h));else if("tEXt"==p){null==s.tabs[p]&&(s.tabs[p]={});var y=i.nextZero(n,r),b=i.readASCII(n,r,y-r),x=i.readASCII(n,y+1,r+f-y-1);s.tabs[p][b]=x}else if("iTXt"==p){null==s.tabs[p]&&(s.tabs[p]={}),y=0;var _=r;y=i.nextZero(n,_),b=i.readASCII(n,_,y-_),n[_=y+1],n[_+1],_+=2,y=i.nextZero(n,_),i.readASCII(n,_,y-_),_=y+1,y=i.nextZero(n,_),i.readUTF8(n,_,y-_),_=y+1,x=i.readUTF8(n,_,f-(_-r)),s.tabs[p][b]=x}else if("PLTE"==p)s.tabs[p]=i.readBytes(n,r,f);else if("hIST"==p){var w=s.tabs.PLTE.length/3;for(s.tabs[p]=[],h=0;h<w;h++)s.tabs[p].push(a(n,r+2*h))}else if("tRNS"==p)3==s.ctype?s.tabs[p]=i.readBytes(n,r,f):0==s.ctype?s.tabs[p]=a(n,r):2==s.ctype&&(s.tabs[p]=[a(n,r),a(n,r+2),a(n,r+4)]);else if("gAMA"==p)s.tabs[p]=i.readUint(n,r)/1e5;else if("sRGB"==p)s.tabs[p]=n[r];else if("bKGD"==p)0==s.ctype||4==s.ctype?s.tabs[p]=[a(n,r)]:2==s.ctype||6==s.ctype?s.tabs[p]=[a(n,r),a(n,r+2),a(n,r+4)]:3==s.ctype&&(s.tabs[p]=n[r]);else if("IEND"==p){var S;0!=u&&((S=s.frames[s.frames.length-1]).data=EC.decode._decompress(s,t.slice(0,u),S.rect.width,S.rect.height),u=0),s.data=EC.decode._decompress(s,l,s.width,s.height);break}r+=f,i.readUint(n,r),r+=4}return delete s.compress,delete s.interlace,delete s.filter,s},EC.decode._decompress=function(e,t,n,r){return 0==e.compress&&(t=EC.decode._inflate(t)),0==e.interlace?t=EC.decode._filterZero(t,e,0,n,r):1==e.interlace&&(t=EC.decode._readInterlace(t,e)),t},EC.decode._inflate=function(e){return TC.inflate(e)},EC.decode._readInterlace=function(e,t){for(var n=t.width,r=t.height,i=EC.decode._getBPP(t),a=i>>3,o=Math.ceil(n*i/8),s=new Uint8Array(r*o),l=0,c=[0,0,4,0,2,0,1],u=[0,4,0,2,0,1,0],d=[8,8,8,4,4,2,2],h=[8,8,4,4,2,2,1],f=0;f<7;){for(var p=d[f],m=h[f],g=0,v=0,y=c[f];y<r;)y+=p,v++;for(var b=u[f];b<n;)b+=m,g++;var x=Math.ceil(g*i/8);EC.decode._filterZero(e,t,l,g,v);for(var _=0,w=c[f];w<r;){for(var S=u[f],M=l+_*x<<3;S<n;){var E;if(1==i&&(E=(E=e[M>>3])>>7-(7&M)&1,s[w*o+(S>>3)]|=E<<7-(3&S)),2==i&&(E=(E=e[M>>3])>>6-(7&M)&3,s[w*o+(S>>2)]|=E<<6-((3&S)<<1)),4==i&&(E=(E=e[M>>3])>>4-(7&M)&15,s[w*o+(S>>1)]|=E<<4-((1&S)<<2)),i>=8)for(var T=w*o+S*a,C=0;C<a;C++)s[T+C]=e[(M>>3)+C];M+=i,S+=m}_++,w+=p}g*v!=0&&(l+=v*(1+x)),f+=1}return s},EC.decode._getBPP=function(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth},EC.decode._filterZero=function(e,t,n,r,i){var a=EC.decode._getBPP(t),o=Math.ceil(r*a/8),s=EC.decode._paeth;a=Math.ceil(a/8);for(var l=0;l<i;l++){var c=n+l*o,u=c+l+1,d=e[u-1];if(0==d)for(var h=0;h<o;h++)e[c+h]=e[u+h];else if(1==d){for(h=0;h<a;h++)e[c+h]=e[u+h];for(h=a;h<o;h++)e[c+h]=e[u+h]+e[c+h-a]&255}else if(0==l){for(h=0;h<a;h++)e[c+h]=e[u+h];if(2==d)for(h=a;h<o;h++)e[c+h]=255&e[u+h];if(3==d)for(h=a;h<o;h++)e[c+h]=e[u+h]+(e[c+h-a]>>1)&255;if(4==d)for(h=a;h<o;h++)e[c+h]=e[u+h]+s(e[c+h-a],0,0)&255}else{if(2==d)for(h=0;h<o;h++)e[c+h]=e[u+h]+e[c+h-o]&255;if(3==d){for(h=0;h<a;h++)e[c+h]=e[u+h]+(e[c+h-o]>>1)&255;for(h=a;h<o;h++)e[c+h]=e[u+h]+(e[c+h-o]+e[c+h-a]>>1)&255}if(4==d){for(h=0;h<a;h++)e[c+h]=e[u+h]+s(0,e[c+h-o],0)&255;for(h=a;h<o;h++)e[c+h]=e[u+h]+s(e[c+h-a],e[c+h-o],e[c+h-a-o])&255}}}return e},EC.decode._paeth=function(e,t,n){var r=e+t-n,i=Math.abs(r-e),a=Math.abs(r-t),o=Math.abs(r-n);return i<=a&&i<=o?e:a<=o?t:n},EC.decode._IHDR=function(e,t,n){var r=EC._bin;n.width=r.readUint(e,t),t+=4,n.height=r.readUint(e,t),t+=4,n.depth=e[t],t++,n.ctype=e[t],t++,n.compress=e[t],t++,n.filter=e[t],t++,n.interlace=e[t],t++},EC._bin={nextZero:function(e,t){for(;0!=e[t];)t++;return t},readUshort:function(e,t){return e[t]<<8|e[t+1]},writeUshort:function(e,t,n){e[t]=n>>8&255,e[t+1]=255&n},readUint:function(e,t){return 16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3])},writeUint:function(e,t,n){e[t]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n},readASCII:function(e,t,n){for(var r="",i=0;i<n;i++)r+=String.fromCharCode(e[t+i]);return r},writeASCII:function(e,t,n){for(var r=0;r<n.length;r++)e[t+r]=n.charCodeAt(r)},readBytes:function(e,t,n){for(var r=[],i=0;i<n;i++)r.push(e[t+i]);return r},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,n){for(var r,i="",a=0;a<n;a++)i+="%"+EC._bin.pad(e[t+a].toString(16));try{r=decodeURIComponent(i)}catch(o){return EC._bin.readASCII(e,t,n)}return r}},EC._copyTile=function(e,t,n,r,i,a,o,s,l){for(var c=Math.min(t,i),u=Math.min(n,a),d=0,h=0,f=0;f<u;f++)for(var p=0;p<c;p++)if(o>=0&&s>=0?(d=f*t+p<<2,h=(s+f)*i+o+p<<2):(d=(-s+f)*t-o+p<<2,h=f*i+p<<2),0==l)r[h]=e[d],r[h+1]=e[d+1],r[h+2]=e[d+2],r[h+3]=e[d+3];else if(1==l){var m=e[d+3]*(1/255),g=e[d]*m,v=e[d+1]*m,y=e[d+2]*m,b=r[h+3]*(1/255),x=r[h]*b,_=r[h+1]*b,w=r[h+2]*b,S=1-m,M=m+b*S,E=0==M?0:1/M;r[h+3]=255*M,r[h+0]=(g+x*S)*E,r[h+1]=(v+_*S)*E,r[h+2]=(y+w*S)*E}else if(2==l)m=e[d+3],g=e[d],v=e[d+1],y=e[d+2],b=r[h+3],x=r[h],_=r[h+1],w=r[h+2],m==b&&g==x&&v==_&&y==w?(r[h]=0,r[h+1]=0,r[h+2]=0,r[h+3]=0):(r[h]=g,r[h+1]=v,r[h+2]=y,r[h+3]=m);else if(3==l){if(m=e[d+3],g=e[d],v=e[d+1],y=e[d+2],b=r[h+3],x=r[h],_=r[h+1],w=r[h+2],m==b&&g==x&&v==_&&y==w)continue;if(m<220&&b>20)return!1}return!0},EC.encode=function(e,t,n,r,i,a){null==r&&(r=0),null==a&&(a=!1);for(var o=new Uint8Array(e[0].byteLength*e.length+100),s=[137,80,78,71,13,10,26,10],l=0;l<8;l++)o[l]=s[l];var c=8,u=EC._bin,d=EC.crc.crc,h=u.writeUint,f=u.writeUshort,p=u.writeASCII,m=EC.encode.compressPNG(e,t,n,r,a);h(o,c,13),p(o,c+=4,"IHDR"),h(o,c+=4,t),h(o,c+=4,n),o[c+=4]=m.depth,o[++c]=m.ctype,o[++c]=0,o[++c]=0,o[++c]=0,h(o,++c,d(o,c-17,17)),h(o,c+=4,1),p(o,c+=4,"sRGB"),o[c+=4]=1,h(o,++c,d(o,c-5,5)),c+=4;var g=e.length>1;if(g&&(h(o,c,8),p(o,c+=4,"acTL"),h(o,c+=4,e.length),h(o,c+=4,0),h(o,c+=4,d(o,c-12,12)),c+=4),3==m.ctype){for(h(o,c,3*(E=m.plte.length)),p(o,c+=4,"PLTE"),c+=4,l=0;l<E;l++){var v=3*l,y=m.plte[l],b=255&y,x=y>>8&255,_=y>>16&255;o[c+v+0]=b,o[c+v+1]=x,o[c+v+2]=_}if(h(o,c+=3*E,d(o,c-3*E-4,3*E+4)),c+=4,m.gotAlpha){for(h(o,c,E),p(o,c+=4,"tRNS"),c+=4,l=0;l<E;l++)o[c+l]=m.plte[l]>>24&255;h(o,c+=E,d(o,c-E-4,E+4)),c+=4}}for(var w=0,S=0;S<m.frames.length;S++){var M=m.frames[S];g&&(h(o,c,26),p(o,c+=4,"fcTL"),h(o,c+=4,w++),h(o,c+=4,M.rect.width),h(o,c+=4,M.rect.height),h(o,c+=4,M.rect.x),h(o,c+=4,M.rect.y),f(o,c+=4,i[S]),f(o,c+=2,1e3),o[c+=2]=M.dispose,o[++c]=M.blend,h(o,++c,d(o,c-30,30)),c+=4);var E,T=M.cimg;h(o,c,(E=T.length)+(0==S?0:4));var C=c+=4;for(p(o,c,0==S?"IDAT":"fdAT"),c+=4,0!=S&&(h(o,c,w++),c+=4),l=0;l<E;l++)o[c+l]=T[l];h(o,c+=E,d(o,C,c-C)),c+=4}return h(o,c,0),p(o,c+=4,"IEND"),h(o,c+=4,d(o,c-4,4)),c+=4,o.buffer.slice(0,c)},EC.encode.compressPNG=function(e,t,n,r,i){for(var a=EC.encode.compress(e,t,n,r,!1,i),o=0;o<e.length;o++){var s=a.frames[o];s.rect.width;var l=s.rect.height,c=s.bpl,u=s.bpp,d=new Uint8Array(l*c+l);s.cimg=EC.encode._filterZero(s.img,l,u,c,d)}return a},EC.encode.compress=function(e,t,n,r,i,a){null==a&&(a=!1);for(var o=6,s=8,l=4,c=255,u=0;u<e.length;u++)for(var d=new Uint8Array(e[u]),h=d.length,f=0;f<h;f+=4)c&=d[f+3];var p=255!=c,m={},g=[];if(0!=e.length&&(m[0]=0,g.push(0),0!=r&&r--),0!=r){var v=EC.quantize(e,r,i);for(e=v.bufs,f=0;f<v.plte.length;f++)null==m[b=v.plte[f].est.rgba]&&(m[b]=g.length,g.push(b))}else for(u=0;u<e.length;u++){var y=new Uint32Array(e[u]);for(h=y.length,f=0;f<h;f++){var b=y[f];if((f<t||b!=y[f-1]&&b!=y[f-t])&&null==m[b]&&(m[b]=g.length,g.push(b),g.length>=300))break}}var x=!!p&&i,_=g.length;_<=256&&0==a&&(s=_<=2?1:_<=4?2:_<=16?4:8,i&&(s=8),p=!0);var w=[];for(u=0;u<e.length;u++){var S=new Uint8Array(e[u]),M=new Uint32Array(S.buffer),E=0,T=0,C=t,A=n,k=0;if(0!=u&&!x){for(var R=i||1==u||2==w[w.length-2].dispose?1:2,N=0,P=1e9,I=0;I<R;I++){for(var L=new Uint8Array(e[u-1-I]),D=new Uint32Array(e[u-1-I]),z=t,O=n,U=-1,F=-1,B=0;B<n;B++)for(var j=0;j<t;j++)M[f=B*t+j]!=D[f]&&(j<z&&(z=j),j>U&&(U=j),B<O&&(O=B),B>F&&(F=B));var H=-1==U?1:(U-z+1)*(F-O+1);H<P&&(P=H,N=I,-1==U?(E=T=0,C=A=1):(E=z,T=O,C=U-z+1,A=F-O+1))}L=new Uint8Array(e[u-1-N]),1==N&&(w[w.length-1].dispose=2);var V=new Uint8Array(C*A*4);new Uint32Array(V.buffer),EC._copyTile(L,t,n,V,C,A,-E,-T,0),EC._copyTile(S,t,n,V,C,A,-E,-T,3)?(EC._copyTile(S,t,n,V,C,A,-E,-T,2),k=1):(EC._copyTile(S,t,n,V,C,A,-E,-T,0),k=0),S=V,M=new Uint32Array(S.buffer)}var G=4*C;if(_<=256&&0==a){for(G=Math.ceil(s*C/8),V=new Uint8Array(G*A),B=0;B<A;B++){f=B*G;var W=B*C;if(8==s)for(j=0;j<C;j++)V[f+j]=m[M[W+j]];else if(4==s)for(j=0;j<C;j++)V[f+(j>>1)]|=m[M[W+j]]<<4-4*(1&j);else if(2==s)for(j=0;j<C;j++)V[f+(j>>2)]|=m[M[W+j]]<<6-2*(3&j);else if(1==s)for(j=0;j<C;j++)V[f+(j>>3)]|=m[M[W+j]]<<7-1*(7&j)}S=V,o=3,l=1}else if(0==p&&1==e.length){V=new Uint8Array(C*A*3);var $=C*A;for(f=0;f<$;f++){var X=3*f,q=4*f;V[X]=S[q],V[X+1]=S[q+1],V[X+2]=S[q+2]}S=V,o=2,l=3,G=3*C}w.push({rect:{x:E,y:T,width:C,height:A},img:S,bpl:G,bpp:l,blend:k,dispose:x?1:0})}return{ctype:o,depth:s,plte:g,gotAlpha:p,frames:w}},EC.encode._filterZero=function(e,t,n,r,i){for(var a=[],o=0;o<5;o++)if(!(t*r>5e5)||2!=o&&3!=o&&4!=o){for(var s=0;s<t;s++)EC.encode._filterLine(i,e,s,r,n,o);if(a.push(TC.deflate(i)),1==n)break}for(var l,c=1e9,u=0;u<a.length;u++)a[u].length<c&&(l=u,c=a[u].length);return a[l]},EC.encode._filterLine=function(e,t,n,r,i,a){var o=n*r,s=o+n,l=EC.decode._paeth;if(e[s]=a,s++,0==a)for(var c=0;c<r;c++)e[s+c]=t[o+c];else if(1==a){for(c=0;c<i;c++)e[s+c]=t[o+c];for(c=i;c<r;c++)e[s+c]=t[o+c]-t[o+c-i]+256&255}else if(0==n){for(c=0;c<i;c++)e[s+c]=t[o+c];if(2==a)for(c=i;c<r;c++)e[s+c]=t[o+c];if(3==a)for(c=i;c<r;c++)e[s+c]=t[o+c]-(t[o+c-i]>>1)+256&255;if(4==a)for(c=i;c<r;c++)e[s+c]=t[o+c]-l(t[o+c-i],0,0)+256&255}else{if(2==a)for(c=0;c<r;c++)e[s+c]=t[o+c]+256-t[o+c-r]&255;if(3==a){for(c=0;c<i;c++)e[s+c]=t[o+c]+256-(t[o+c-r]>>1)&255;for(c=i;c<r;c++)e[s+c]=t[o+c]+256-(t[o+c-r]+t[o+c-i]>>1)&255}if(4==a){for(c=0;c<i;c++)e[s+c]=t[o+c]+256-l(0,t[o+c-r],0)&255;for(c=i;c<r;c++)e[s+c]=t[o+c]+256-l(t[o+c-i],t[o+c-r],t[o+c-i-r])&255}}},EC.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var n=t,r=0;r<8;r++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e}(),update:function(e,t,n,r){for(var i=0;i<r;i++)e=EC.crc.table[255&(e^t[n+i])]^e>>>8;return e},crc:function(e,t,n){return 4294967295^EC.crc.update(4294967295,e,t,n)}},EC.quantize=function(e,t,n){for(var r=[],i=0,a=0;a<e.length;a++)r.push(EC.encode.alphaMul(new Uint8Array(e[a]),n)),i+=e[a].byteLength;var o=new Uint8Array(i),s=new Uint32Array(o.buffer),l=0;for(a=0;a<r.length;a++){for(var c=r[a],u=c.length,d=0;d<u;d++)o[l+d]=c[d];l+=u}var h={i0:0,i1:o.length,bst:null,est:null,tdst:0,left:null,right:null};h.bst=EC.quantize.stats(o,h.i0,h.i1),h.est=EC.quantize.estats(h.bst);for(var f=[h];f.length<t;){var p=0,m=0;for(a=0;a<f.length;a++)f[a].est.L>p&&(p=f[a].est.L,m=a);if(p<.001)break;var g=f[m],v=EC.quantize.splitPixels(o,s,g.i0,g.i1,g.est.e,g.est.eMq255),y={i0:g.i0,i1:v,bst:null,est:null,tdst:0,left:null,right:null};y.bst=EC.quantize.stats(o,y.i0,y.i1),y.est=EC.quantize.estats(y.bst);var b={i0:v,i1:g.i1,bst:null,est:null,tdst:0,left:null,right:null};for(b.bst={R:[],m:[],N:g.bst.N-y.bst.N},a=0;a<16;a++)b.bst.R[a]=g.bst.R[a]-y.bst.R[a];for(a=0;a<4;a++)b.bst.m[a]=g.bst.m[a]-y.bst.m[a];b.est=EC.quantize.estats(b.bst),g.left=y,g.right=b,f[m]=y,f.push(b)}f.sort(function(e,t){return t.bst.N-e.bst.N});for(var x=0;x<r.length;x++){var _=EC.quantize.planeDst,w=new Uint8Array(r[x].buffer),S=new Uint32Array(r[x].buffer),M=w.length;for(a=0;a<M;a+=4){for(var E=w[a]*(1/255),T=w[a+1]*(1/255),C=w[a+2]*(1/255),A=w[a+3]*(1/255),k=h;k.left;)k=_(k.est,E,T,C,A)<=0?k.left:k.right;S[a>>2]=k.est.rgba}r[x]=S.buffer}return{bufs:r,plte:f}},EC.quantize.getNearest=function(e,t,n,r,i){if(null==e.left)return e.tdst=EC.quantize.dist(e.est.q,t,n,r,i),e;var a=EC.quantize.planeDst(e.est,t,n,r,i),o=e.left,s=e.right;a>0&&(o=e.right,s=e.left);var l=EC.quantize.getNearest(o,t,n,r,i);if(l.tdst<=a*a)return l;var c=EC.quantize.getNearest(s,t,n,r,i);return c.tdst<l.tdst?c:l},EC.quantize.planeDst=function(e,t,n,r,i){var a=e.e;return a[0]*t+a[1]*n+a[2]*r+a[3]*i-e.eMq},EC.quantize.dist=function(e,t,n,r,i){var a=t-e[0],o=n-e[1],s=r-e[2],l=i-e[3];return a*a+o*o+s*s+l*l},EC.quantize.splitPixels=function(e,t,n,r,i,a){var o=EC.quantize.vecDot;for(r-=4;n<r;){for(;o(e,n,i)<=a;)n+=4;for(;o(e,r,i)>a;)r-=4;if(n>=r)break;var s=t[n>>2];t[n>>2]=t[r>>2],t[r>>2]=s,n+=4,r-=4}for(;o(e,n,i)>a;)n-=4;return n+4},EC.quantize.vecDot=function(e,t,n){return e[t]*n[0]+e[t+1]*n[1]+e[t+2]*n[2]+e[t+3]*n[3]},EC.quantize.stats=function(e,t,n){for(var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=[0,0,0,0],a=n-t>>2,o=t;o<n;o+=4){var s=e[o]*(1/255),l=e[o+1]*(1/255),c=e[o+2]*(1/255),u=e[o+3]*(1/255);i[0]+=s,i[1]+=l,i[2]+=c,i[3]+=u,r[0]+=s*s,r[1]+=s*l,r[2]+=s*c,r[3]+=s*u,r[5]+=l*l,r[6]+=l*c,r[7]+=l*u,r[10]+=c*c,r[11]+=c*u,r[15]+=u*u}return r[4]=r[1],r[8]=r[2],r[12]=r[3],r[9]=r[6],r[13]=r[7],r[14]=r[11],{R:r,m:i,N:a}},EC.quantize.estats=function(e){var t=e.R,n=e.m,r=e.N,i=n[0],a=n[1],o=n[2],s=n[3],l=0==r?0:1/r,c=[t[0]-i*i*l,t[1]-i*a*l,t[2]-i*o*l,t[3]-i*s*l,t[4]-a*i*l,t[5]-a*a*l,t[6]-a*o*l,t[7]-a*s*l,t[8]-o*i*l,t[9]-o*a*l,t[10]-o*o*l,t[11]-o*s*l,t[12]-s*i*l,t[13]-s*a*l,t[14]-s*o*l,t[15]-s*s*l],u=c,d=EC.M4,h=[.5,.5,.5,.5],f=0,p=0;if(0!=r)for(var m=0;m<10&&(h=d.multVec(u,h),p=Math.sqrt(d.dot(h,h)),h=d.sml(1/p,h),!(Math.abs(p-f)<1e-9));m++)f=p;var g=[i*l,a*l,o*l,s*l],v=d.dot(d.sml(255,g),h),y=g[3]<.001?0:1/g[3];return{Cov:c,q:g,e:h,L:f,eMq255:v,eMq:d.dot(h,g),rgba:(Math.round(255*g[3])<<24|Math.round(255*g[2]*y)<<16|Math.round(255*g[1]*y)<<8|Math.round(255*g[0]*y))>>>0}},EC.M4={multVec:function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]]},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},sml:function(e,t){return[e*t[0],e*t[1],e*t[2],e*t[3]]}},EC.encode.alphaMul=function(e,t){for(var n=new Uint8Array(e.length),r=e.length>>2,i=0;i<r;i++){var a=i<<2,o=e[a+3];t&&(o=o<128?0:255);var s=o*(1/255);n[a+0]=e[a+0]*s,n[a+1]=e[a+1]*s,n[a+2]=e[a+2]*s,n[a+3]=o}return n}),BT.exports)),IC=({onClick:e,label:t,isActive:n,children:r,disabled:i=!1})=>s.jsx("button",{onClick:e,"aria-label":t,disabled:i,className:`p-1.5 rounded-md transition-colors ${n?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)]":"bg-[var(--color-bg-700)] hover:bg-[var(--color-bg-600)] text-[var(--color-text-300)]"} ${i?"opacity-50 cursor-not-allowed":""}`,children:r}),LC=({label:e,onClick:t,isActive:n})=>s.jsx("button",{onClick:t,className:"px-3 py-1 text-sm font-semibold rounded transition-colors "+(n?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)]":"hover:bg-[var(--color-bg-700)] text-[var(--color-text-300)]"),children:e}),DC=({onClick:e,label:t,isActive:n,disabled:r})=>s.jsx("button",{onClick:e,disabled:r,className:`px-3 py-1.5 rounded-md text-sm font-semibold transition-colors ${n?"bg-[var(--color-accent-primary)] text-[var(--color-text-100)]":"bg-[var(--color-bg-700)] hover:bg-[var(--color-bg-600)] text-[var(--color-text-300)]"} ${r?"opacity-50 cursor-not-allowed":""}`,children:t}),zC=[{value:"1:1",label:"1:1 (Square)"},{value:"4:3",label:"4:3 (Standard)"},{value:"3:2",label:"3:2 (Classic)"},{value:"16:9",label:"16:9 (Widescreen)"},{value:"21:9",label:"21:9 (Cinematic)"},{value:"9:16",label:"9:16 (Portrait)"},{value:"custom",label:"Custom"}],OC={"1:1":[{value:"1024x1024",label:"1024p"},{value:"2048x2048",label:"2K"},{value:"4096x4096",label:"4K"}],"4:3":[{value:"1024x768",label:"1K"},{value:"2048x1536",label:"2K"},{value:"4096x3072",label:"4K"}],"3:2":[{value:"1080x720",label:"720p"},{value:"1920x1280",label:"1080p"},{value:"3000x2000",label:"3K"}],"16:9":[{value:"1280x720",label:"720p HD"},{value:"1920x1080",label:"1080p FHD"},{value:"2560x1440",label:"1440p QHD"},{value:"3840x2160",label:"4K UHD"}],"21:9":[{value:"2560x1080",label:"Wide FHD"},{value:"3440x1440",label:"Wide QHD"},{value:"5120x2160",label:"5K"}],"9:16":[{value:"720x1280",label:"720p HD"},{value:"1080x1920",label:"1080p FHD"},{value:"1440x2560",label:"1440p QHD"},{value:"2160x3840",label:"4K UHD"}]},UC=({onClose:e})=>{const{isBaking2D:t,bakeAndDownload2DSlice:n}=Uw(),{generatedShader:r,nodes:i}=Xw(),[a,o]=h.useState("16:9"),[l,c]=h.useState("1920x1080"),[u,d]=h.useState(1920),[f,p]=h.useState(1080),[m,g]=h.useState(1),v=h.useMemo(()=>OC[a]||[],[a]),y=h.useCallback(e=>{const t=String(e);if(o(t),"custom"!==t){const e=OC[t];if(e&&e.length>0){const t=e[0].value;c(t);const[n,r]=t.split("x").map(Number);d(n),p(r)}}},[]),b=h.useCallback(e=>{const t=String(e);c(t);const[n,r]=t.split("x").map(Number);d(n),p(r)},[]),x=(e,t)=>{const n=parseInt(t,10);!isNaN(n)&&n>0&&("width"===e?d(n):p(n),o("custom"),c(""))};return s.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4","aria-modal":"true",role:"dialog",children:s.jsxs("div",{className:"bg-[var(--color-bg-800)] p-6 rounded-lg w-full max-w-md border border-[var(--color-border-700)] shadow-xl",children:[s.jsx("h3",{className:"text-lg font-bold mb-4 text-accent",children:"Bake 2D Slice"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-[var(--color-text-200)] mb-1",children:"Aspect Ratio"}),s.jsx($S,{options:zC,value:a,onChange:y})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-[var(--color-text-200)] mb-1",children:"Resolution"}),s.jsx($S,{options:v,value:l,onChange:b,disabled:"custom"===a})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"customWidth",className:"block text-sm font-medium text-[var(--color-text-200)] mb-1",children:"Width"}),s.jsx("input",{id:"customWidth",type:"number",value:u,min:"1",onChange:e=>x("width",e.target.value),className:"w-full bg-[var(--color-bg-700)] border border-[var(--color-border-600)] rounded-md px-3 py-2 text-sm text-[var(--color-text-100)] focus:outline-none focus:ring-2 focus:ring-[var(--color-accent-primary)] disabled:opacity-50",disabled:"custom"!==a})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"customHeight",className:"block text-sm font-medium text-[var(--color-text-200)] mb-1",children:"Height"}),s.jsx("input",{id:"customHeight",type:"number",value:f,min:"1",onChange:e=>x("height",e.target.value),className:"w-full bg-[var(--color-bg-700)] border border-[var(--color-border-600)] rounded-md px-3 py-2 text-sm text-[var(--color-text-100)] focus:outline-none focus:ring-2 focus:ring-[var(--color-accent-primary)] disabled:opacity-50",disabled:"custom"!==a})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-[var(--color-text-200)] mb-1",children:"Quality (Supersampling)"}),s.jsx($S,{value:m,onChange:e=>g(Number(e)),disabled:t,options:DT})]})]}),s.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[s.jsx("button",{onClick:e,disabled:t,className:"px-4 py-2 bg-[var(--color-bg-600)] hover:bg-[var(--color-bg-700)] rounded-md text-[var(--color-text-100)] font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),s.jsx("button",{onClick:()=>{n(r,i,u,f,m)},disabled:t,className:"flex items-center justify-center px-4 py-2 w-28 bg-[var(--color-accent-primary)] hover:bg-[var(--color-accent-secondary)] rounded-md text-[var(--color-text-100)] font-semibold transition-colors disabled:opacity-50 disabled:cursor-wait",children:t?"Baking...":"Bake"})]})]})})},FC=()=>{const{isPlaying:e,togglePlay:t,displayMode:n,setDisplayMode:r,shape:i,setShape:a,slice:o,setSlice:l,density:c,setDensity:u,tiling:d,setTiling:f,raymarchSteps:p,setRaymarchSteps:m,sliceAxis2D:g,setSliceAxis2D:v,slicePosition2D:y,setSlicePosition2D:b,resetDensity:x,resetRaymarchSteps:_,resetSlice2D:w,resetView2D:S}=Rl(),{bakedTexture:M,clearBakedTexture:E}=Uw(),{name:T}=pl(),[C,A]=h.useState(!1),[k,R]=h.useState(!1),[N,P]=h.useState(!1),[I,L]=h.useState((null==M?void 0:M.image.depth)??128);h.useEffect(()=>{M&&L(M.image.depth)},[M]);const D="surface"!==n,z=!M;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-4 bg-[var(--color-bg-800)] border-t border-[var(--color-border-700)] space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-md font-bold text-accent",children:"Controls"}),s.jsx(IC,{onClick:t,label:e?"Pause":"Play",isActive:!1,children:e?s.jsx(aS,{className:"w-5 h-5"}):s.jsx(iS,{className:"w-5 h-5"})})]}),M&&s.jsx("div",{className:"border-b border-[var(--color-border-700)] pb-3",children:s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("button",{onClick:E,className:"w-full flex items-center justify-center px-4 py-2 bg-rose-600 hover:bg-rose-500 rounded-md text-white font-semibold transition-colors duration-200",children:[s.jsx(mS,{className:"w-5 h-5 mr-2"}),"Return to Live"]}),s.jsxs("button",{onClick:()=>{M&&(L(M.image.depth),A(!0))},className:"w-full flex items-center justify-center px-4 py-2 bg-[var(--color-accent-primary)] hover:bg-[var(--color-accent-secondary)] rounded-md text-[var(--color-text-100)] font-semibold transition-colors duration-200",children:[s.jsx(nS,{className:"w-5 h-5 mr-2"}),"Export Atlas"]})]})}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-xs font-semibold uppercase text-accent tracking-wider",children:"Display & Shape"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("div",{className:"grid grid-cols-4 gap-2 flex-1",children:[s.jsx(IC,{onClick:()=>r("surface"),label:"Surface",isActive:"surface"===n,children:s.jsx(sS,{className:"w-5 h-5 mx-auto"})}),s.jsx(IC,{onClick:()=>r("volume"),label:"Volume",isActive:"volume"===n,children:s.jsx(hS,{className:"w-5 h-5 mx-auto"})}),s.jsx(IC,{onClick:()=>r("slice"),label:"3D Slices",isActive:"slice"===n,children:s.jsx(uS,{className:"w-5 h-5 mx-auto"})}),s.jsx(IC,{onClick:()=>r("2d"),label:"2D Slice",isActive:"2d"===n,children:s.jsx(dS,{className:"w-5 h-5 mx-auto"})})]}),s.jsx("div",{className:"h-8 w-px bg-[var(--color-border-600)]"}),s.jsxs("div",{className:"grid grid-cols-3 gap-2 flex-1",children:[s.jsx(IC,{onClick:()=>a("cube"),label:"Cube",isActive:"cube"===i,disabled:D,children:s.jsx(sS,{className:"w-5 h-5 mx-auto"})}),s.jsx(IC,{onClick:()=>a("sphere"),label:"Sphere",isActive:"sphere"===i,disabled:D,children:s.jsx(lS,{className:"w-5 h-5 mx-auto"})}),s.jsx(IC,{onClick:()=>a("torus"),label:"Torus",isActive:"torus"===i,disabled:D,children:s.jsx(cS,{className:"w-5 h-5 mx-auto"})})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider "+(z?"text-[var(--color-text-400)]":"text-accent"),children:"Tiling"}),s.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[s.jsx(DC,{onClick:()=>f(1),label:"1x",isActive:1===d,disabled:z}),s.jsx(DC,{onClick:()=>f(2),label:"2x",isActive:2===d,disabled:z}),s.jsx(DC,{onClick:()=>f(3),label:"3x",isActive:3===d,disabled:z})]})]}),"2d"===n&&s.jsxs("div",{className:"space-y-2 border-t border-[var(--color-border-700)] pt-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm font-semibold uppercase tracking-wide text-accent",children:"2D View Controls"}),s.jsxs("button",{onClick:S,className:"flex items-center text-xs text-[var(--color-text-300)] hover:text-[var(--color-text-100)] transition-colors",children:[s.jsx(bS,{className:"w-4 h-4 mr-1"}),"Reset View"]})]}),s.jsxs("div",{className:"flex items-center justify-between h-10",children:[s.jsx("label",{className:"text-sm font-medium text-[var(--color-text-200)]",children:"Slice Axis"}),s.jsxs("div",{className:"flex items-center bg-[var(--color-bg-900)]/70 p-1 rounded-md",children:[s.jsx(LC,{label:"X",onClick:()=>v("x"),isActive:"x"===g}),s.jsx(LC,{label:"Y",onClick:()=>v("y"),isActive:"y"===g}),s.jsx(LC,{label:"Z",onClick:()=>v("z"),isActive:"z"===g})]})]}),s.jsx(ZS,{label:"Position",value:y,onChange:b,onReset:w,isModified:.5!==y,min:0,max:1,step:.005}),s.jsx("div",{className:"pt-2",children:s.jsxs("button",{onClick:()=>P(!0),className:"w-full flex items-center justify-center px-4 py-2 bg-[var(--color-accent-primary)]/20 hover:bg-[var(--color-accent-primary)]/40 rounded-md text-[var(--color-accent-text)] hover:text-[var(--color-text-100)] font-semibold transition-colors duration-200",children:[s.jsx(TS,{className:"w-5 h-5 mr-2"}),"Bake Picture..."]})})]}),"slice"===n&&s.jsxs("div",{className:"space-y-1 border-t border-[var(--color-border-700)] pt-3",children:[s.jsx("p",{className:"text-sm font-semibold uppercase tracking-wide pb-1 text-accent",children:"3D Slicing Planes"}),s.jsx(ZS,{label:"Slice X",value:o.x,onChange:e=>l("x",e),onReset:()=>l("x",Cl.x),isModified:o.x!==Cl.x,min:0,max:1,step:.01}),s.jsx(ZS,{label:"Slice Y",value:o.y,onChange:e=>l("y",e),onReset:()=>l("y",Cl.y),isModified:o.y!==Cl.y,min:0,max:1,step:.01}),s.jsx(ZS,{label:"Slice Z",value:o.z,onChange:e=>l("z",e),onReset:()=>l("z",Cl.z),isModified:o.z!==Cl.z,min:0,max:1,step:.01})]}),"volume"===n&&s.jsxs("div",{className:"space-y-1 border-t border-[var(--color-border-700)] pt-3",children:[s.jsx("p",{className:"text-sm font-semibold uppercase tracking-wide pb-1 text-accent",children:"Volumetric Properties"}),s.jsx(ZS,{label:"Density",value:c,onChange:u,onReset:x,isModified:5!==c,min:.1,max:30,step:.1}),s.jsx(ZS,{label:"Quality",value:p,onChange:m,onReset:_,isModified:16!==p,min:8,max:128,step:1})]}),C&&M&&s.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-[var(--color-bg-800)] p-6 rounded-lg w-full max-w-sm border border-[var(--color-border-700)] shadow-xl",children:[s.jsx("h3",{className:"text-lg font-bold mb-4 text-accent",children:"Export Atlas Options"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("p",{className:"text-sm text-[var(--color-text-300)]",children:["Baked Texture: ",s.jsx("span",{className:"font-mono text-[var(--color-text-200)]",children:`${M.image.width}x${M.image.height}x${M.image.depth}`})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"sliceCount",className:"block text-sm font-medium text-[var(--color-text-200)] mb-1",children:"Number of Slices"}),s.jsx("input",{id:"sliceCount",type:"number",value:I,onChange:e=>{const t=parseInt(e.target.value,10);isNaN(t)?""===e.target.value&&L(1):L(Math.max(1,Math.min(M.image.depth,t)))},min:"1",max:M.image.depth,className:"w-full bg-[var(--color-bg-700)] border border-[var(--color-border-600)] rounded-md px-3 py-2 text-sm text-[var(--color-text-100)] focus:outline-none focus:ring-2 focus:ring-[var(--color-accent-primary)]"})]})]}),s.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[s.jsx("button",{onClick:()=>A(!1),disabled:k,className:"px-4 py-2 bg-[var(--color-bg-600)] hover:bg-[var(--color-bg-700)] rounded-md text-[var(--color-text-100)] font-semibold transition-colors disabled:opacity-50",children:"Cancel"}),s.jsx("button",{onClick:async()=>{if(M){R(!0);try{await(async(e,t,n)=>{const{width:r,height:i}=e.image,a=e.image.data,o=e.image.depth,s=e.type===Ic,l=Math.max(1,Math.min(n,o)),{tilesX:c,tilesY:u}=function(e){if(e<=0)return{tilesX:0,tilesY:0};let t=e,n=1;for(let r=1;r*r<=e;r++)e%r===0&&(n=r,t=e/r);return{tilesX:t,tilesY:n}}(l),d=c*r,h=u*i,f=new Uint8Array(d*h*4),p=new Uint8Array(r*i*4);for(let x=0;x<l;x++){const e=l<=1?0:Math.round(x*(o-1)/(l-1));for(let o=0;o<i;o++)for(let t=0;t<r;t++){const n=4*(e*r*i+o*r+t),l=4*(o*r+t);let c,u,d,h;if(s){const e=a;c=yf.fromHalfFloat(e[n]),u=yf.fromHalfFloat(e[n+1]),d=yf.fromHalfFloat(e[n+2]),h=yf.fromHalfFloat(e[n+3])}else c=a[n]/255,u=a[n+1]/255,d=a[n+2]/255,h=a[n+3]/255;p[l]=Math.floor(255*Math.max(0,Math.min(1,c))),p[l+1]=Math.floor(255*Math.max(0,Math.min(1,u))),p[l+2]=Math.floor(255*Math.max(0,Math.min(1,d))),p[l+3]=Math.floor(255*Math.max(0,Math.min(1,h)))}const t=x%c*r,n=Math.floor(x/c)*i;for(let a=0;a<i;a++){const e=a*r*4,o=4*((n+(i-1-a))*d+t),s=p.subarray(e,e+4*r);f.set(s,o)}}const m=PC.encode([f.buffer],d,h,0),g=new Blob([m],{type:"image/png"}),v=URL.createObjectURL(g),y=document.createElement("a");y.href=v;const b=t.replace(/[^a-z0-9]/gi,"_").toLowerCase()||"unnamed";y.download=`${b}_atlas_${r}x${i}x${l}.png`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(v)})(M,T,I)}catch(e){console.error("Export failed",e),alert(`Texture atlas export failed. See console for details. Error: ${e instanceof Error?e.message:String(e)}`)}finally{R(!1),A(!1)}}},disabled:k,className:"flex items-center justify-center px-4 py-2 w-28 bg-[var(--color-accent-primary)] hover:bg-[var(--color-accent-secondary)] rounded-md text-[var(--color-text-100)] font-semibold transition-colors disabled:opacity-50 disabled:cursor-wait",children:k?"Exporting...":"Export"})]})]})})]}),N&&s.jsx(UC,{onClose:()=>P(!1)})]})},BC=({onClick:e,label:t,children:n,disabled:r})=>s.jsxs("button",{onClick:e,disabled:r,className:"flex flex-col items-center justify-center text-center text-[var(--color-text-300)] hover:bg-[var(--color-bg-700)] p-2 rounded-lg transition-colors w-16 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent",children:[n,s.jsx("span",{className:"text-xs mt-1",children:t})]}),jC=({onToggleSidebar:e,onToggleRightPanel:t})=>{const{undo:n,redo:r,past:i,future:a}=Gw(),{deleteElements:o}=Fa(),l=Nr(h.useCallback(e=>({nodes:Array.from(e.nodeInternals.values()).filter(e=>e.selected),edges:e.edges.filter(e=>e.selected)}),[])),c=l.nodes.length>0||l.edges.length>0;return s.jsxs("footer",{className:"lg:hidden fixed bottom-0 left-0 right-0 h-16 bg-[var(--color-bg-900)] border-t border-[var(--color-border-700)] flex items-center justify-around z-20",children:[s.jsx(BC,{onClick:e,label:"Nodes",children:s.jsx(oS,{className:"w-6 h-6"})}),s.jsx(BC,{onClick:t,label:"Preview",children:s.jsx(sS,{className:"w-6 h-6"})}),s.jsx("div",{className:"h-full w-px bg-[var(--color-border-700)]"}),s.jsxs("button",{onClick:()=>{c&&o(l)},disabled:!c,className:"flex flex-col items-center justify-center text-center p-2 rounded-lg transition-colors w-16 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent "+(c?"text-rose-400 hover:bg-rose-500/20":"text-[var(--color-text-400)]"),"aria-label":"Delete selection",children:[s.jsx(kS,{className:"w-6 h-6"}),s.jsx("span",{className:"text-xs mt-1",children:"Delete"})]}),s.jsx("div",{className:"h-full w-px bg-[var(--color-border-700)]"}),s.jsx(BC,{onClick:n,label:"Undo",disabled:0===i.length,children:s.jsx(mS,{className:"w-6 h-6"})}),s.jsx(BC,{onClick:r,label:"Redo",disabled:0===a.length,children:s.jsx(gS,{className:"w-6 h-6"})})]})},HC="noisette-saved-layout";let VC=null;const GC=()=>{VC&&clearTimeout(VC),VC=window.setTimeout(()=>{if(Tl.getState().saveLayout)try{const e=(()=>{const{nodes:e,edges:t}=Xw.getState(),{name:n}=pl.getState(),{accentColor:r,themeMode:i,brightness:a,saturation:o}=xl.getState();return{version:2,workspaceName:n,nodes:e.map(({id:e,position:t,data:n,width:r,height:i,zIndex:a})=>{const o="Comment"===n.type,s={i:e,t:n.type,pos:t,z:a};return r&&i&&(s.size=[r,i]),o?s.d={text:n.text,fontSize:n.fontSize,fontWeight:n.fontWeight,fontStyle:n.fontStyle,backgroundColor:n.backgroundColor,textColor:n.textColor,opacity:n.opacity,textOpacity:n.textOpacity}:(s.l=n.label,n.params&&n.params.length>0&&(s.p=n.params.reduce((e,t)=>(void 0!==t.value&&(e[t.id]=t.value),e),{}))),s}),edges:t.map(({id:e,source:t,target:n,sourceHandle:r,targetHandle:i})=>({i:e,s:t,t:n,sh:r,th:i})),theme:{accentColor:r,themeMode:i,brightness:a,saturation:o}}})();localStorage.setItem(HC,JSON.stringify(e))}catch(e){console.error("Failed to auto-save layout:",e)}VC=null},500)},WC=()=>{const e=xl(e=>e.accentColor),t=xl(e=>e.themeMode),n=xl(e=>e.brightness),r=xl(e=>e.saturation);return h.useEffect(()=>{(function(e,t,n,r){const i=document.documentElement;if(!i||!/^#[0-9A-F]{6}$/i.test(e))return;const a=(e=>{const t=vl(e);if(!t)return null;let{r:n,g:r,b:i}=t;n/=255,r/=255,i/=255;const a=Math.max(n,r,i),o=Math.min(n,r,i);let s=0,l=0,c=(a+o)/2;if(a!==o){const e=a-o;switch(l=c>.5?e/(2-a-o):e/(a+o),a){case n:s=(r-i)/e+(r<i?6:0);break;case r:s=(i-n)/e+2;break;case i:s=(n-r)/e+4}s/=6}return{h:360*s,s:100*l,l:100*c}})(e);if(!a)return;const o=a.s<10,s=o?220:a.h,l=e=>o?0:e,c=n/100,u=r/100;let d;if("dark"===t){const e=5+15*c,t=25*u;d={"--color-bg-900":yl(s,l(t),e),"--color-bg-800":yl(s,l(t),e+4),"--color-bg-700":yl(s,l(1.2*t),e+10),"--color-bg-600":yl(s,l(1.2*t),e+16),"--color-border-700":yl(s,l(t),e+12),"--color-border-600":yl(s,l(1.1*t),e+18),"--color-text-100":yl(s,l(.2*t),95),"--color-text-200":yl(s,l(.2*t),80),"--color-text-300":yl(s,l(.15*t),65),"--color-text-400":yl(s,l(.1*t),50)}}else{const e=85+15*c,t=25*u;d={"--color-bg-900":yl(s,l(t),e),"--color-bg-800":yl(s,l(t),e-4),"--color-bg-700":yl(s,l(1.2*t),e-8),"--color-bg-600":yl(s,l(1.2*t),e-12),"--color-border-700":yl(s,l(.8*t),e-15),"--color-border-600":yl(s,l(.8*t),e-22),"--color-text-100":yl(s,l(.5*t),5),"--color-text-200":yl(s,l(.4*t),25),"--color-text-300":yl(s,l(.3*t),40),"--color-text-400":yl(s,l(.25*t),55)}}Object.assign(d,{"--color-accent-primary":e,"--color-accent-secondary":`hsl(${a.h} ${a.s}% ${Math.min(100,a.l+("dark"===t?10:-10))}%)`,"--color-accent-text":`hsl(${a.h} ${l(Math.max(60,a.s))}% ${"dark"===t?Math.max(70,a.l):Math.max(25,Math.min(45,a.l-15))}%)`});for(const[m,g]of Object.entries(d))i.style.setProperty(m,g);const h=vl(e),f="dark"===t?.15:.25,p=h?`rgba(${h.r}, ${h.g}, ${h.b}, ${f})`:"rgba(23, 67, 106, 0.15)";i.style.setProperty("--color-accent-glow",p),i.style.setProperty("--color-node-bg",d["--color-bg-700"])})(e,t,n,r),document.documentElement.style.colorScheme=t,(()=>{try{let t='<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">\n  <path d="M10 50 Q 30 5 50 50 T 90 50"\n        stroke="#000000"\n        stroke-width="15"\n        fill="none"\n        stroke-linecap="round"\n        stroke-linejoin="round" />\n</svg>'.replace(/stroke="[^"]+"/,`stroke="${e}"`);const n=`data:image/svg+xml,${encodeURIComponent(t)}`,r=document.querySelector("link[rel='icon']");r&&r.remove();const i=document.createElement("link");i.rel="icon",i.type="image/svg+xml",i.href=n,document.head.appendChild(i)}catch(t){console.error("Error updating dynamic favicon:",t)}})()},[e,t,n,r]),null},$C=({onResize:e})=>{const t=h.useCallback(t=>{t.preventDefault();const n=t=>{e(t.movementY)},r=()=>{document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",r),document.body.style.cursor=""};document.body.style.cursor="row-resize",document.addEventListener("mousemove",n),document.addEventListener("mouseup",r)},[e]);return s.jsx("div",{onMouseDown:t,className:"w-full h-1.5 bg-[var(--color-bg-700)] hover:bg-[var(--color-accent-primary)] cursor-row-resize transition-colors active:bg-[var(--color-accent-secondary)] flex-shrink-0","aria-label":"Resize viewport",role:"separator"})},XC=({onResize:e,edge:t})=>{const n=h.useCallback(t=>{t.preventDefault();const n=t=>{e(t.movementX)},r=()=>{document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",r),document.body.style.cursor=""};document.body.style.cursor="col-resize",document.addEventListener("mousemove",n),document.addEventListener("mouseup",r)},[e]);return s.jsx("div",{onMouseDown:n,className:"hidden lg:block absolute top-0 bottom-0 w-1.5 bg-[var(--color-bg-700)] hover:bg-[var(--color-accent-primary)] cursor-col-resize transition-colors active:bg-[var(--color-accent-secondary)] z-50 "+("right"===t?"left-0":"right-0"),"aria-label":"Resize panel",role:"separator"})},qC=({onResize:e,sidebarWidth:t,isSidebarOpen:n,isDesktop:r})=>{const[i,a]=h.useState(null);return s.jsxs(s.Fragment,{children:[s.jsxs("aside",{style:r?{width:`${t}px`}:{},className:`\n                    bg-[var(--color-bg-900)] border-r border-[var(--color-border-700)]\n                    absolute top-0 left-0 bottom-16 lg:bottom-0 w-64\n                    transform transition-transform duration-300 ease-in-out z-40\n                    ${n?"translate-x-0":"-translate-x-full"}\n            `,children:[s.jsx(BS,{onSetTip:a}),r&&n&&s.jsx(XC,{onResize:e,edge:"left"})]}),r&&n&&i&&s.jsxs("div",{style:{left:`${t}px`,top:`${i.top}px`},className:"absolute w-64 bg-[var(--color-bg-800)] border border-[var(--color-border-700)] rounded-r-lg p-4 z-30 shadow-2xl pointer-events-none",role:"tooltip",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(MS,{className:"w-6 h-6 mr-2 text-accent flex-shrink-0"}),s.jsx("h4",{className:"font-bold text-accent text-lg",children:i.label})]}),s.jsx("p",{className:"text-base leading-relaxed text-[var(--color-text-300)] whitespace-pre-wrap",children:i.description})]})]})};let YC=!1;const ZC=()=>{const e=pl(e=>e.viewportHeight),t=pl(e=>e.setViewportHeight),n=pl(e=>e.sidebarWidth),r=pl(e=>e.setSidebarWidth),i=pl(e=>e.rightPanelWidth),a=pl(e=>e.setRightPanelWidth),o=h.useRef(null),[l,c]=h.useState(!0),[u,d]=h.useState(!0),[f,p]=h.useState("viewport"),[m,g]=h.useState(window.matchMedia("(min-width: 1024px)").matches),v=pl(e=>e.isDraggingNode);h.useEffect(()=>{YC||(Xw.subscribe(GC),xl.subscribe(GC),pl.subscribe(GC),setTimeout(()=>{const{clearHistory:e}=Gw.getState(),{saveLayout:t}=Tl.getState();if(e(),t){const e=localStorage.getItem(HC);if(e)try{const t=JSON.parse(e);return void Vw(t,{recordHistory:!1})}catch(n){console.error("Failed to parse saved layout, loading default.",n)}}Vw(_l,{recordHistory:!1})},0),YC=!0)},[]),h.useEffect(()=>{const e=document.getElementById("loading-screen");e&&setTimeout(()=>{e.classList.add("hidden"),setTimeout(()=>{e.remove()},1500)},2e3)},[]),h.useEffect(()=>{const e=window.matchMedia("(min-width: 1024px)"),t=e=>{const t=e.matches;g(t),t?(c(!0),d(!0)):(c(!1),d(!1))};return t(e),e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[]);const y=h.useCallback(e=>{setTimeout(()=>{t(t=>{const n=t+e,r=o.current?o.current.clientHeight-250:800;return Math.max(200,Math.min(n,r))})},0)},[t]),b=h.useCallback(e=>{setTimeout(()=>{r(t=>{const n=t+e;return Math.max(250,Math.min(n,600))})},0)},[r]),x=h.useCallback(e=>{setTimeout(()=>{a(t=>{const n=t-e;return Math.max(250,Math.min(n,600))})},0)},[a]),_={paddingLeft:m&&l?`${n}px`:"0px",paddingRight:m&&u?`${i}px`:"0px"};return s.jsxs(rs,{children:[s.jsx(WC,{}),s.jsxs("div",{className:"flex flex-col h-screen bg-[var(--color-bg-800)] text-[var(--color-text-100)] font-sans overflow-hidden",children:[s.jsx(UT,{onToggleSidebar:()=>c(e=>!e),onToggleRightPanel:()=>d(e=>!e),isSidebarOpen:l,isRightPanelOpen:u}),s.jsxs("div",{className:"flex-grow relative overflow-hidden h-[calc(100vh-4rem)]",children:[(l||u)&&!m&&s.jsx("div",{id:"mobile-overlay",onClick:()=>{c(!1),d(!1)},className:"lg:hidden fixed inset-0 bg-black/70 z-30 "+(v?"pointer-events-none":""),"aria-hidden":"true"}),s.jsx(qC,{onResize:b,sidebarWidth:n,isSidebarOpen:l,isDesktop:m}),s.jsx("main",{style:_,className:"h-full transition-all duration-300 ease-in-out",children:s.jsx("div",{className:"w-full h-full",children:s.jsx(DS,{})})}),s.jsxs("aside",{ref:o,style:m?{width:`${i}px`}:{},className:`\n                    absolute top-0 right-0 w-full sm:max-w-md lg:max-w-none bg-[var(--color-bg-900)]\n                    flex flex-col border-l border-[var(--color-border-700)] overflow-hidden\n                    bottom-16 lg:bottom-0 transform transition-transform duration-300 ease-in-out z-40\n                    ${u?"translate-x-0":"translate-x-full"}\n                `,children:[m&&u&&s.jsx(XC,{onResize:x,edge:"right"}),s.jsxs("div",{className:"hidden lg:flex flex-col h-full",children:[s.jsx("div",{style:{height:`${e}px`},className:"flex-shrink-0 relative",children:s.jsx(RT,{})}),s.jsx($C,{onResize:y}),s.jsx("div",{className:"flex-shrink-0",children:s.jsx(FC,{})}),s.jsx("div",{className:"flex-grow min-h-0",children:s.jsx(JS,{})})]}),s.jsxs("div",{className:"flex flex-col h-full lg:hidden",children:[s.jsxs("div",{className:"flex-shrink-0 flex border-b border-[var(--color-border-700)]",children:[s.jsx("button",{onClick:()=>p("viewport"),className:"flex-1 p-3 text-sm font-semibold transition-colors "+("viewport"===f?"text-[var(--color-text-100)] border-b-2 border-[var(--color-accent-primary)]":"text-[var(--color-text-300)] hover:bg-[var(--color-bg-800)]"),children:"Viewport & Controls"}),s.jsx("button",{onClick:()=>p("properties"),className:"flex-1 p-3 text-sm font-semibold transition-colors "+("properties"===f?"text-[var(--color-text-100)] border-b-2 border-[var(--color-accent-primary)]":"text-[var(--color-text-300)] hover:bg-[var(--color-bg-800)]"),children:"Properties"})]}),s.jsxs("div",{className:"flex-grow overflow-y-auto",children:["viewport"===f&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"aspect-video relative bg-[var(--color-bg-900)]",children:s.jsx(RT,{})}),s.jsx(FC,{})]}),"properties"===f&&s.jsx(JS,{})]})]})]})]}),s.jsx(jC,{onToggleSidebar:()=>c(e=>!e),onToggleRightPanel:()=>d(e=>!e)})]})]})},KC=document.getElementById("root");if(!KC)throw new Error("Could not find root element to mount to");C.createRoot(KC).render(s.jsx(f.StrictMode,{children:s.jsx(ZC,{})}));